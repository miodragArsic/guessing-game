(function(ng) {
    'use strict';

    var app = ng.module('app', [
        'ui.router',
        'LocalStorageModule',
        'ui.bootstrap.modal',
        'angularMoment',
        'ui.select',
        'ngMaterial',
        'ui.knob',
        'jsonFormatter',
        'angularSpectrumColorpicker',
        'ja.qr',
        'nvd3',
        'btford.markdown',
        'angularRipple',
        'dndLists',
        'ngSmartlivingWidgets',
        '720kb.tooltips'
    ]);

    app.config([
        '$stateProvider',
        '$urlRouterProvider',
        '$locationProvider',
        '$sceProvider',
        function($stateProvider, $urlRouterProvider, $locationProvider, $sceProvider) {

            $sceProvider.enabled(false);

            $urlRouterProvider.otherwise('/signin');

            $stateProvider
                .state('login', {
                    url: '/signin',
                    templateUrl: '/assets/js/app/pages/login/view.html',
                    data: {}
                })
                .state('main', {
                    abstract: true,
                    templateUrl: '/assets/js/app/partials/main.html',
                    data: {
                        requireLogin: true,
                        section: 'devices'
                    }
                })
                .state('home', {
                    url: '/',
                    templateUrl: '/assets/js/app/pages/login/view.html',
                    data: {}
                })
                .state('main.quickDemo', {
                    url: '/apps/guessing-game',
                    templateUrl: '/assets/js/app/demo_device/game.html',
                    data: {}
                })
                .state('quickDemoLauncher', {
                    url: '/apps/quick-demo-launcher',
                    templateUrl: '/assets/js/app/demo_device/mobile_browser.html',
                    data: {}
                })

            $locationProvider.html5Mode(true);
        }

    ]);

    app.run([
        '$modalStack',
        '$rootScope',
        'session',
        'messaging.relay',
        'brandConfig',

        function(
            $modalStack,
            $rootScope,
            session,
            messageRelay,
            brandConfig) {

            session.init();
            messageRelay.init();
            brandConfig.init();

            $rootScope.$on('$stateChangeStart', function(event) {
                var top = $modalStack.getTop();
                if (top) {
                    $modalStack.dismissAll('routeChange');
                }
            });
        }

    ]);

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('activityRepository', activityRepository);

    activityRepository.$inject = ['activityService', 'utils', 'exception'];

    function activityRepository(activityService, utils, exception) {

        var service = {
            findGroundActivity: findGroundActivity,
            getSubscriptions: getSubscriptions,
            unsubscribeOnGroundActivity: unsubscribeOnGroundActivity,
            subscribeOnGroundActivity: subscribeOnGroundActivity
        };
        return service;

        ////////////////

        function findGroundActivity(groundId, page) {

            return activityService.getGroundActivity(groundId, page)
                .then(function(body) {
                    return body.items;
                })
                .catch(exception.catcher('There was a problem to load ground activity.'));
        }

        function getSubscriptions() {

            return activityService.getSubscriptions()
                .then(function(body) {
                    return body.items;
                })
                .catch(exception.catcher('There was a problem to get ground subscriptions.'));
        }

        function unsubscribeOnGroundActivity(groundId) {

            return activityService.unsubscribeOnGroundActivity(groundId)
                .catch(exception.catcher('There was a problem to unsubscribe from ground activity.'));

        }

        function subscribeOnGroundActivity(groundId) {

            return activityService.subscribeOnGroundActivity(groundId)
                .catch(exception.catcher('There was a problem to subsubscribe to ground activity.'));

        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('activityService', activityService);

    activityService.$inject = ['$http', 'api.url'];

    function activityService($http, apiUrl) {

        var service = {
            getSubscriptions: getSubscriptions,
            subscribeOnGroundActivity: subscribeOnGroundActivity,
            unsubscribeOnGroundActivity: unsubscribeOnGroundActivity,
            getGroundActivity: getGroundActivity
        };
        return service;

        ////////////////

        function getGroundActivity(groundId, page) {
            var url = apiUrl + 'ground/' + groundId + '/activity';

            url = url + getQuery(page);

            return $http.get(url).then(function(response) {
                return response.data;
            });
        }

        function getSubscriptions() {
            var url = apiUrl + 'me/subscriptions';
            return $http.get(url).then(function(response) {

                if (response.data) {
                    return response.data;
                } else {
                    return [];
                }
            });
        }

        function subscribeOnGroundActivity(groundId) {
            var url = apiUrl + 'ground/' + groundId + '/subscription';
            return $http.put(url);
        }

        function unsubscribeOnGroundActivity(groundId) {
            var url = apiUrl + 'ground/' + groundId + '/subscription';
            return $http.delete(url);
        }

        function getQuery(page) {
            if (!page) {
                return '';
            }

            var query = '?page=' + page;

            return query;
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('userContext', factory);

    factory.$inject = ['utils', 'activityRepository', 'session', 'api.usersService'];

    function factory(utils, activityRepository, session, users) {

        function UserContext() {

            this.subscriptions = [];
            this.user = null;
        }

        function getSubscriptions(context) {

            return activityRepository.getSubscriptions().then(function(subscriptions) {
                context.subscriptions = subscriptions;
            });
        }

        function getUserDetails(context) {

            return users.getMe()
                .then(function(userData) {

                    context.user = userData;

                    session.setUserDetails(userData);

                    return userData;

                });

        }

        UserContext.prototype.init = function() {

            var that = this;

            if (session.authentication().isAuth) {

                //get user details from session
                that.user = session.getUserDetails();

                //call server to refresh user details
                getUserDetails(that);

                //call server to get user subscriptions
                getSubscriptions(that);
            }

            utils.$rootScope.getCurrentUserDetails = function() {
                return that.user;
            };
        };

        UserContext.prototype.load = function() {

            var defered = utils.$q.defer();

            var that = this;
            if (session.authentication().isAuth) {

                getUserDetails(that).then(function() {
                    utils.$rootScope.$emit('user.login');
                    defered.resolve();
                }).catch(function() {
                    defered.reject('There was a problem to load user information.');
                });

                getSubscriptions(that);
            } else {
                defered.resolve();
            }

            return defered.promise;
        };

        UserContext.prototype.unload = function() {
            this.subscriptions = [];
            this.user = null;
            utils.$rootScope.$emit('user.logout');
        };

        UserContext.prototype.refresh = function() {

            var that = this;
            getSubscriptions(that);
        };

        UserContext.prototype.isSubscribedToGround = function(groundId) {

            var groundSubscriptionKey = 'ground/' + groundId + '/activity';
            return this.subscriptions.indexOf(groundSubscriptionKey) >= 0;
        };

        return new UserContext();
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('brandConfig', factory);

    factory.$inject = ['$rootScope'];

    function factory($rootScope) {

        var brandConfig = {"favicon":"assets/img/brand/smartliving/favicon.png","logoIcon":"assets/img/brand/smartliving/sl-logo.svg","logoType":"assets/img/brand/smartliving/sl-typo.svg","logoAlt":"smartliving","brandColor":"#2670e0","name":"SmartLiving","loginBgClass":"login-bg"};

        var service = {
            init: init,
            config: brandConfig
        };

        return service;

        function init() {

            $rootScope.brand = brandConfig;

        }
    }

})();

(function(ng) {

    ng
        .module('app')
        .controller('MainPageController', MainPageController);

    MainPageController.$inject = ['$scope', '$rootScope', 'session'];

    function MainPageController($scope, $rootScope, session) {

        var vm = this;

        vm.isNavigationVisible = isNavigationVisible;
        vm.groundModel = null;
        vm.groundMenuOpen = false;
        vm.inGround = null;

        activate();

        /////////////////////////////

        function activate() {
        }

        function isNavigationVisible() {

        }

    }

}(window.angular));

(function() {

    angular
        .module('app')
        .controller('NavigationController', NavigationController);

    NavigationController.$inject = ['$rootScope', 'session', '$state', 'authService', 'GroundContext', 'userContext'];

    function NavigationController($rootScope, session, $state, authService, groundContext, userContext) {

        var vm = this;

        vm.logout = logout;
        vm.loggedIn = false;
        vm.groundContext = groundContext;
        vm.user = session.authentication().userName;
        vm.route = $state.current.name;
        vm.menuItems = {
            users: 'main.admin',
            account: 'main.accountSettings',
            authorizedClients: 'main.authorizedClients',
            devices: 'main.devices',
            gateways: 'main.gateways',
            rules: 'main.rules'
        };

        vm.selectedMenuItem = '';

        vm.isAdmin = isAdmin;
        vm.showSelectedMenuItem = showSelectedItem;

        /////////////////////////////

        $rootScope.$on('user.login', function() {
            vm.loggedIn = session.authentication().isAuth;
            vm.user = session.authentication().userName;
        });

        $rootScope.$on('user.logout', function() {
            vm.loggedIn = session.authentication().isAuth;
            vm.user = null;
        });

        $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams) {
            vm.route = toState.name;

            if (vm.route == vm.menuItems.users) {
                vm.selectedMenuItem = 'God mode';
            } else if (vm.route == vm.menuItems.account) {
                vm.selectedMenuItem = 'Account settings';
            } else if (vm.route == vm.menuItems.authorizedClients) {
                vm.selectedMenuItem = 'Authorized clients';
            } else if (vm.route == vm.menuItems.metrics) {
                vm.selectedMenuItem = 'Metrics';
            } else if (vm.route == vm.menuItems.devices) {
                vm.selectedMenuItem = 'Your devices';
            } else if (vm.route == vm.menuItems.gateways) {
                vm.selectedMenuItem = 'Your gateways';
            } else if (vm.route == vm.menuItems.rules) {
                vm.selectedMenuItem = 'Your rules';
            }

        });

        $rootScope.$watch('inGround', function(newValue) {
            vm.inGround = newValue;
        });

        if (session.authentication().isAuth) {
            vm.loggedIn = true;
        }

        function showMenu() {

            if (groundContext.current) {
                return true;
            } else {
                return false;
            }
        }

        function isAdmin() {
            var user = userContext.user;
            if (user) {
                if (user.role == 'Administrator') {
                    return true;
                }
            } else {
                return false;
            }
        }

        function showSelectedItem() {
            if (vm.route == vm.menuItems.users) {
                return true;
            } else if (vm.route == vm.menuItems.account) {
                return true;
            } else if (vm.route == vm.menuItems.authorizedClients) {
                return true;
            } else if (vm.route == vm.menuItems.devices) {
                return true;
            } else if (vm.route == vm.menuItems.gateways) {
                return true;
            } else if (vm.route == vm.menuItems.rules) {
                return true;
            }

        }

        function logout() {

            authService.logout().then(function() {
                $state.go('login');
            });
        }
    }
}());

(function(ng) {
    ng
        .module('app')
        .factory('notifyService', NotifyService);

    NotifyService.$inject = ['$filter'];

    function NotifyService($filter) {

        var subscribers = [];

        var service = {
            error: error,
            warning: warning,
            info: info,
            success: success,
            offer: offer,
            subscribe: subscribe
        };

        return service;

        //////////////////////////////////////////////

        function error(title, msg, action, isPermanent) {
            publish('error', title, msg, action, isPermanent);
        }

        function warning(title, msg, action, isPermanent, actionHandler, actionText, closeHandler) {
            publish('warning', title, msg, action, isPermanent, actionHandler, actionText, closeHandler);
        }

        function info(title, msg, action, isPermanent) {
            publish('info', title, msg, action, isPermanent);
        }

        function success(title, msg, action, isPermanent) {
            publish('success', title, msg, action, isPermanent);
        }

        function offer(title, msg, actionHandler, actionText, closeHandler) {
            publish('offer', title, msg, null, true, actionHandler, actionText, closeHandler);
        }

        function subscribe(subscriberId, subscriberfn) {

            var foundSubscriber = $filter('filter')(subscribers, {
                id: subscriberId
            });

            if (!(foundSubscriber.length > 0)) {

                subscribers.push({
                    id: subscriberId,
                    fn: subscriberfn
                });
            }
        }

        function publish(type, title, msg, action, isPermanent, actionHandler, actionText, closeHandler) {

            for (var i = 0; i < subscribers.length; i++) {
                subscribers[i].fn({
                    title: title,
                    type: type,
                    msg: msg,
                    action: action,
                    isPermanent: isPermanent,
                    actionHandler: actionHandler,
                    actionText: actionText,
                    closeHandler: closeHandler
                });
            }
        }
    }
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('user.preferences', userPreferences);

    userPreferences.$inject = ['session', '$state', '$stateParams', 'localStorageService'];

    function userPreferences(session, $state, $stateParams, localStorage) {

        var service = {
            rememberPage: rememberPage,
            readPage: readPage,
            rememberGlobal: rememberGlobal,
            readGlobal: readGlobal
        };
        return service;

        ////////////////

        function rememberPage(key, value) {

            var uniqueKey = generateUniqueKey(key, false);

            localStorage.set(uniqueKey, value);
        }

        function readPage(key) {

            var uniqueKey = generateUniqueKey(key, false);

            return localStorage.get(uniqueKey);
        }

        function rememberGlobal(key, value, ignoreLoggedUser) {

            var ignore = false;

            if (ignoreLoggedUser !== undefined && ignoreLoggedUser !== null) {
                ignore = ignoreLoggedUser;
            }

            var uniqueKey = generateUniqueKey(key, true, ignore);

            localStorage.set(uniqueKey, value);
        }

        function readGlobal(key, ignoreLoggedUser) {

            var ignore = false;

            if (ignoreLoggedUser !== undefined && ignoreLoggedUser !== null) {
                ignore = ignoreLoggedUser;
            }

            var uniqueKey = generateUniqueKey(key, true, ignore);

            return localStorage.get(uniqueKey);
        }

        function generateUniqueKey(key, isGlobal, ignoreLoggedUser) {

            var user = 'guest';

            var auth = session.authentication();

            if (auth.isAuth) {
                user = auth.userName;
            }

            var uniqueKey = null;

            if (isGlobal) {
                if (ignoreLoggedUser) {
                    uniqueKey = 'preference_global_{0}'.format(key);
                } else {
                    uniqueKey = 'preference_global_{0}_{1}'.format(user, key);
                }

            } else {
                if (ignoreLoggedUser) {
                    uniqueKey = 'preference_{0}_{1}'.format(getStateKey(), key);
                } else {
                    uniqueKey = 'preference_{0}_{1}_{2}'.format(user, getStateKey(), key);
                }

            }

            return uniqueKey;
        }

        function getStateKey() {

            var stateKey = $state.current.name;

            for (var p in $stateParams) {
                if ($stateParams.hasOwnProperty(p)) {
                    stateKey += $stateParams[p];
                }
            }

            return stateKey;
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('utils', utils);

    utils.$inject = ['$q', '$timeout', '$interval', '$rootScope', '$state', 'notifyService', 'user.preferences', 'utility.viewConfigs'];

    function utils($q, $timeout, $interval, $rootScope, $state, notifyService, preferences, viewConfigs) {
        var service = {
            //common angular dependaencies
            $q: $q,
            $timeout: $timeout,
            $interval: $interval,
            $rootScope: $rootScope,

            //common app dependaencies
            notify: notifyService,
            preferences: preferences,
            viewConfigs: viewConfigs,

            //helpers
            getDeviceInfo: getDeviceInfo,
            getRandomString: getRandomString,
            isBot: isBot,
            tryParseJSON: tryParseJSON,
            transformResponse: transformResponse,
            handleViewModelInitializtionError: handleViewModelInitializtionError,
            normalizeAssetName: normalizeAssetName,
            generateRandomString: generateRandomString,
            toCamelCase: toCamelCase,

            whenAll: whenAll
        };
        return service;

        //////////////////////////////////////////////////

        function getDeviceInfo() {
            var unknown = '-';

            // screen
            var screenSize = '';
            if (screen.width) {
                var width = (screen.width) ? screen.width : '';
                var height = (screen.height) ? screen.height : '';
                screenSize += '' + width + ' x ' + height;
            }

            //browser
            var nVer = navigator.appVersion;
            var nAgt = navigator.userAgent;
            var browser = navigator.appName;
            var version = '' + parseFloat(navigator.appVersion);
            var majorVersion = parseInt(navigator.appVersion, 10);
            var nameOffset;
            var verOffset;
            var ix;

            // Opera
            if ((verOffset = nAgt.indexOf('Opera')) != -1) {
                browser = 'Opera';
                version = nAgt.substring(verOffset + 6);
                if ((verOffset = nAgt.indexOf('Version')) != -1) {
                    version = nAgt.substring(verOffset + 8);
                }
            }

            // MSIE
            else if ((verOffset = nAgt.indexOf('MSIE')) != -1) {
                browser = 'Microsoft Internet Explorer';
                version = nAgt.substring(verOffset + 5);
            }

            // Chrome
            else if ((verOffset = nAgt.indexOf('Chrome')) != -1) {
                browser = 'Chrome';
                version = nAgt.substring(verOffset + 7);
            }

            // Safari
            else if ((verOffset = nAgt.indexOf('Safari')) != -1) {
                browser = 'Safari';
                version = nAgt.substring(verOffset + 7);
                if ((verOffset = nAgt.indexOf('Version')) != -1) {
                    version = nAgt.substring(verOffset + 8);
                }
            }

            // Firefox
            else if ((verOffset = nAgt.indexOf('Firefox')) != -1) {
                browser = 'Firefox';
                version = nAgt.substring(verOffset + 8);
            }

            // MSIE 11+
            else if (nAgt.indexOf('Trident/') != -1) {
                browser = 'Microsoft Internet Explorer';
                version = nAgt.substring(nAgt.indexOf('rv:') + 3);
            }

            // Other browsers
            else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt.lastIndexOf('/'))) {
                browser = nAgt.substring(nameOffset, verOffset);
                version = nAgt.substring(verOffset + 1);
                if (browser.toLowerCase() == browser.toUpperCase()) {
                    browser = navigator.appName;
                }
            }

            // trim the version string
            if ((ix = version.indexOf(';')) != -1) {
                version = version.substring(0, ix);
            }

            if ((ix = version.indexOf(' ')) != -1) {
                version = version.substring(0, ix);
            }

            if ((ix = version.indexOf(')')) != -1) {
                version = version.substring(0, ix);
            }

            majorVersion = parseInt('' + version, 10);
            if (isNaN(majorVersion)) {
                version = '' + parseFloat(navigator.appVersion);
                majorVersion = parseInt(navigator.appVersion, 10);
            }

            // mobile version
            var mobile = /Mobile|mini|Fennec|WPDesktop|Android|iP(ad|od|hone)/.test(nVer);

            // cookie
            var cookieEnabled = (navigator.cookieEnabled) ? true : false;

            if (typeof navigator.cookieEnabled == 'undefined' && !cookieEnabled) {
                document.cookie = 'testcookie';
                cookieEnabled = (document.cookie.indexOf('testcookie') != -1) ? true : false;
            }

            // system
            var os = unknown;
            var clientStrings = [{
                s: 'Windows 3.11',
                r: /Win16/
            }, {
                s: 'Windows 95',
                r: /(Windows 95|Win95|Windows_95)/
            }, {
                s: 'Windows ME',
                r: /(Win 9x 4.90|Windows ME)/
            }, {
                s: 'Windows 98',
                r: /(Windows 98|Win98)/
            }, {
                s: 'Windows CE',
                r: /Windows CE/
            }, {
                s: 'Windows 2000',
                r: /(Windows NT 5.0|Windows 2000)/
            }, {
                s: 'Windows XP',
                r: /(Windows NT 5.1|Windows XP)/
            }, {
                s: 'Windows Server 2003',
                r: /Windows NT 5.2/
            }, {
                s: 'Windows Vista',
                r: /Windows NT 6.0/
            }, {
                s: 'Windows 7',
                r: /(Windows 7|Windows NT 6.1)/
            }, {
                s: 'Windows 8.1',
                r: /(Windows 8.1|Windows NT 6.3)/
            }, {
                s: 'Windows 8',
                r: /(Windows 8|Windows NT 6.2)/
            }, {
                s: 'Windows NT 4.0',
                r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/
            }, {
                s: 'Windows ME',
                r: /Windows ME/
            }, {
                s: 'Android',
                r: /Android/
            }, {
                s: 'Open BSD',
                r: /OpenBSD/
            }, {
                s: 'Sun OS',
                r: /SunOS/
            }, {
                s: 'Linux',
                r: /(Linux|X11)/
            }, {
                s: 'iOS',
                r: /(iPhone|iPad|iPod)/
            }, {
                s: 'Mac OS X',
                r: /Mac OS X/
            }, {
                s: 'Mac OS',
                r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/
            }, {
                s: 'QNX',
                r: /QNX/
            }, {
                s: 'UNIX',
                r: /UNIX/
            }, {
                s: 'BeOS',
                r: /BeOS/
            }, {
                s: 'OS/2',
                r: /OS\/2/
            }, {
                s: 'Search Bot',
                r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/
            }];
            for (var id in clientStrings) {
                var cs = clientStrings[id];
                if (cs.r.test(nAgt)) {
                    os = cs.s;
                    break;
                }
            }

            var osVersion = unknown;

            if (/Windows/.test(os)) {
                osVersion = /Windows (.*)/.exec(os)[1];
                os = 'Windows';
            }

            switch (os) {
                case 'Mac OS X':
                    osVersion = /Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];
                    break;

                case 'Android':

                    var androidVersion = /Android ([\.\_\d]+)/.exec(nAgt);
                    if (androidVersion) {
                        osVersion = androidVersion[1];
                    }

                    break;

                case 'iOS':
                    osVersion = /OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);
                    osVersion = osVersion[1] + '.' + osVersion[2] + '.' + (osVersion[3] | 0);
                    break;
            }

            // flash (you'll need to include swfobject)
            /* script src="//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js" */
            var flashVersion = 'no check';
            if (typeof swfobject != 'undefined') {
                var fv = swfobject.getFlashPlayerVersion();
                if (fv.major > 0) {
                    flashVersion = fv.major + '.' + fv.minor + ' r' + fv.release;
                } else {
                    flashVersion = unknown;
                }
            }

            return {
                screenSize: screenSize,
                browser: browser,
                browserVersion: version,
                mobile: mobile,
                os: os,
                osVersion: osVersion,
                cookies: cookieEnabled,
                flashVersion: flashVersion,
                nVer: nVer
            };
        }

        function getRandomString(length) {

            var l = 10;
            if (length && angular.isNumber(length)) {
                l = length;
            }

            var hash = '';
            var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            for (var i = 0; i < l; i++) {
                hash += possible.charAt(Math.floor(Math.random() * possible.length));
            }

            return hash;
        }

        function isBot() {

            return /bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent);
        }

        function tryParseJSON(str) {

            var deferred = $q.defer();

            try {
                var obj = JSON.parse(str);
                deferred.resolve(obj);

            } catch (e) {

                deferred.reject();
            }

            return deferred.promise;
        }

        function transformResponse(ModelConstructor) {

            return function(responseData) {

                if (responseData === null || responseData === undefined) {
                    return;
                }

                if (responseData.items && responseData.items.constructor === Array) {
                    return processArray(responseData.items, ModelConstructor);
                } else if (responseData.data && responseData.data.constructor === Array) {
                    return processArray(responseData.data, ModelConstructor);
                } else if (responseData.constructor === Array) {
                    return processArray(responseData, ModelConstructor);
                } else if (responseData.data) {
                    return new ModelConstructor(responseData.data);
                } else {
                    return new ModelConstructor(responseData);
                }

                function processArray(items, ModelConstructor) {

                    var result = [];
                    for (var i = 0; i < items.length; i++) {
                        var model = new ModelConstructor(items[i]);
                        result.push(model);
                    }

                    return result;
                }
            };
        }

        function handleViewModelInitializtionError(err) {

            if (err && err.status === 404) {
                $state.transitionTo('error', {}, {
                    location: false
                });
            }
        }

        //Returns a single promise that will be resolved with an array/hash of values,
        //each value corresponding to the promise at the same index/key in the promises array/hash. Unlike angular $q.all, this method will
        //resolve even if some of the promises in array/hash are rejected:
        //Promises resloved with success will be included in resulting promises with { isSuccess:true, data: dataReturned }
        //Promises resolved with a rejection will also be included in resulting promises with { isSuccess: false, error: error }
        function whenAll(promises) {

            var wrappedPromises = [];

            angular.forEach(promises, function(promise) {

                var wrappedPromise = promise
                    .then(function(res) {

                        return {
                            isSuccess: true,
                            data: res
                        };

                    })
                    .catch(function(err) {

                        return {
                            isSuccess: false,
                            error: err
                        };

                    });

                wrappedPromises.push(wrappedPromise);

            });

            return $q.all(wrappedPromises);
        }

        function normalizeAssetName(assetTitle) {

            var generatedName = null;
            var pattern = /[^a-z0-9]+/gi;

            if (assetTitle === null || assetTitle === undefined) {
                return null;
            }

            generatedName = assetTitle.replace(pattern, '_').replace(/^_+/, '').replace(/_+$/, '');

            return generatedName;
        }

        function generateRandomString(length, chars) {

            var mask = '';
            var result = '';

            if (chars.indexOf('a') > -1) {
                mask += 'abcdefghijklmnopqrstuvwxyz';
            }

            if (chars.indexOf('A') > -1) {
                mask += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            }

            if (chars.indexOf('#') > -1) {
                mask += '0123456789';
            }

            if (chars.indexOf('!') > -1) {
                mask += '~`!@#$%^&*()_+-={}[]:";\'<>?,./|\\';
            }

            for (var i = length; i > 0; --i) {

                result += mask[Math.floor(Math.random() * mask.length)];

            }

            return result;
        }

        function toCamelCase(str) {
            return str.replace(/(?:^\w|[A-Z]|\b\w)/g, function(letter, index) {
                return index == 0 ? letter.toLowerCase() : letter.toUpperCase();
            }).replace(/\s+/g, '');
        }

    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('demo.adoptService', adoptService);

    adoptService.$inject = ['$rootScope', 'utils', 'demo.configuration', 'api.devicesService'];

    function adoptService($rootScope, utils, gameConfiguration, devicesService) {
        var service = {
            init: init
        };

        return service;

        ///////////////////////////////////////////

        function init() {

            $rootScope.$on('user.login', function() {
                var deviceId = utils.preferences.readGlobal(gameConfiguration.deviceIdKey, true);
                if (deviceId) {
                    adoptDevice(deviceId);
                }
            });
        }

        function adoptDevice(deviceId) {

            devicesService.adopt(deviceId).then(function() {
                utils.preferences.rememberGlobal(gameConfiguration.deviceIdKey, null, true);

                $rootScope.$emit('demo.deviceAdopted', deviceId);
            });
        }

    }
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.configuration', configuration);

    function configuration() {

        var totalAssets = 7;
        var assetConfiguration = {
            shake: {
                profile: {
                    type: 'string',
                    supported: false
                },
                control: {
                    name: 'shake'
                }
            },
            position: {
                profile: {
                    type: 'string',
                    supported: false
                },
                control: {
                    name: 'ontable'
                }
            },
            visibility: {
                profile: {
                    type: 'boolean',
                    supported: false
                },
                control: {
                    name: 'onoff'
                }
            },
            control: {
                profile: {
                    type: 'string',
                    supported: true
                },
                control: {
                    name: 'label'
                }
            },
            handshake: {
                profile: {
                    type: 'string',
                    supported: true
                },
                control: {
                    name: 'label'
                }
            },
            rotation: {
                profile: {
                    type: 'string',
                    supported: false
                },
                control: {
                    name: 'rotate'
                }
            },
            deviceInfo: {
                profile: {
                    type: 'object',
                    supported: true
                },
                control: {
                    name: 'json'
                }
            }
        };

        var service = {
            deviceType: 'quick-demo',
            sessionKey: 'quick-demo-device-name',
            deviceIdKey: 'quick-demo-device-id',
            deviceDescription: 'ready',
            deviceNamePrefix: 'Game-',
            publicUser: 'gg',
            publicUserPassword: 'game1234',
            deviceControlName: 'qrcode',
            assetConfiguration: assetConfiguration,
            totalAssets: totalAssets
        };

        return service;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('GuessingGameController', GuessingGameController);

    GuessingGameController.$inject = [
        '$scope',
        '$stateParams',
        'utils',
        'device.repository',
        'demo.game',
        '$window'
    ];

    function GuessingGameController($scope, $stateParams, utils, deviceRepository, Game, $window) {

        var vm = this;

        vm.gameDevice = null;

        vm.status = 'playing';

        vm.errorMessage = null;

        vm.game = new Game();

        vm.simulate = simulate;
        vm.suspend = suspend;
        vm.resetGame = resetGame;
        vm.reload = reload;
        vm.getConnectedDeviceInfo = getConnectedDeviceInfo;
        vm.connectedDevice = null;

        vm.disconnectDevice = disconnectDevice;

        var deviceId = utils.$rootScope.deviceId;

        var deviceTicket = utils.$rootScope.ticket;

        var HANDSHAKE_FAIL_THRESHOLD = 30000;
        var isSubscribedToAssets = false;

        var handshakeFailTimer = null;

        activate();

        ////////////////

        function activate() {

            loadGameDevice(deviceTicket);

            $scope.$on('$destroy', function() {
                if (vm.gameDevice) {
                    vm.gameDevice.unsubscribe();
                }
            });
        }

        function loadGameDevice(id) {

            return deviceRepository.findAllUsingToken( 'Your smartphone',id).then(function(device) {

                vm.gameDevice = device;
                vm.gameDevice.subscribe(true);

                init();

            }).catch(function() {
                setError();
            });
        }

        function init() {

            var engagerActiveAsset = vm.gameDevice.getAsset('sendingdata');

            if (engagerActiveAsset.state && engagerActiveAsset.state.value === false) {

                vm.game.suspend();

                processGame();

            } else {

                startGame();

                processGame();
            }
        }

        function processGame() {

            var engagerActiveAsset = vm.gameDevice.getAsset('sendingdata');

            if (vm.game.status === 'suspended') {

                var isStillSuspended = engagerActiveAsset.state && engagerActiveAsset.state.value === false;

                if (!isStillSuspended) {

                    vm.game.unsuspend();

                }
            }

            if (vm.status === 'playing') {

                if (engagerActiveAsset.state && engagerActiveAsset.state.value === true) {

                    vm.game.unsuspend();

                } else {

                    vm.game.suspend();

                }
            }

            if (!isSubscribedToAssets) {

                angular.forEach(vm.gameDevice.assets, function(asset) {

                    if (asset.name === 'sendingdata') {

                        asset.on('state', isEnagerActiveStateChangeHandler);

                    } else {

                        asset.on('state', function(state) {

                            vm.game.play(asset.name, state.Value);
                            $scope.$apply();

                        });
                    }
                });

                isSubscribedToAssets = true;
            }
        }

        function getConnectedDeviceInfo() {

            var deviceInfo = {
                os: '',
                browser: ''
            };

            var deviceInfoAsset = vm.gameDevice.getAsset('deviceinfoasset');

            if (deviceInfoAsset.state) {

                deviceInfo = deviceInfoAsset.state.value;

            }

            return deviceInfo;
        }

        function simulate(a, v) {

            vm.game.play(a, v);

        }

        function setError(message) {

            vm.status = 'error';

            vm.errorMessage = message;

        }

        function reload() {

            $window.location.reload(true);

        }

        function suspend(s) {

            if (s) {

                vm.game.suspend();

            } else {

                vm.game.unsuspend();

            }
        }

        function isEnagerActiveStateChangeHandler(state) {

            if (state.Value === false) {

                vm.game.suspend();

            } else {

                vm.game.unsuspend();

            }

            $scope.$apply();
        }

        function startGame() {

            vm.game.start();

            vm.status = 'playing';

        }

        function resetGame() {

            vm.game.reset();

        }

        function disconnectDevice() {

            var controlAsset = vm.gameDevice.getAsset('controlasset');

            controlAsset.send(JSON.stringify({
                Value: 'disconnect'
            }));

            vm.status = 'awaiting';

        }

    }
})();

(function() {

    angular
        .module('app')
        .controller('MobileBrowserDeviceController', MobileBrowserDeviceController);

    MobileBrowserDeviceController.$inject = [
        'device.repository',
        'asset.repository',
        'demo.sensors',
        'demo.configuration',
        '$location',
        'messaging.gateway',
        'utils'
    ];

    function MobileBrowserDeviceController(deviceRepository, assetRepository, sensors, gameConfiguration, $location, messagingGateway, utils) {

        var deviceInfo = utils.getDeviceInfo();

        var deviceName = $location.search().deviceName;
        var token = $location.search().token;

        var deviceTitle = deviceInfo.os + ' ' + deviceInfo.browser;

        var deviceDescription = '# "Quick demo" device\n';

        var vm = this;

        vm.gameDevice = null;
        vm.showLog = false;
        vm.logs = [];
        vm.status = 'connecting';
        vm.errorMessage = null;
        vm.disconnect = null;

        vm.reload = reload;
        vm.restart = restartGame;
        vm.play = playGame;
        vm.toggleShowLog = toggleShowLog;
        vm.deviceInfo = deviceInfo;

        activate();

        ////////////////

        function activate() {

            if (!token || !deviceName) {
                utils.notify.error('Game Initialization', 'Game paramteres are missing.', null, true);
                return;
            }

            if (!deviceInfo.mobile) {
                vm.status = 'notmobile';
                return;
            }

            configureSensorProfiles();

            getDevice()
                .then(initializeDevice)
                .then(connect)
                .then(initializeAssets)
                .then(setupForGame);
        }

        function configureSensorProfiles() {

            if (sensors.shake.isSupported()) {

                gameConfiguration.assetConfiguration.shake.profile.supported = true;

            }

            if (sensors.position.isSupported()) {

                gameConfiguration.assetConfiguration.position.profile.supported = true;

            }

            if (sensors.rotation.isSupported()) {

                gameConfiguration.assetConfiguration.rotation.profile.supported = true;

            }

            gameConfiguration.assetConfiguration.visibility.profile.supported = true;

        }

        function getDevice() {

            return deviceRepository.findSelfUsingTicket(token).catch(function() {

                setError('Error contacting server, try reloading the page.');

            });
        }

        function initializeDevice(device) {

            vm.gameDevice = device;

            return utils.$q(function(resolve, reject) {

                resolve(device);

            });
        }

        function connect(device) {

            var client = device.client;

            if (!messagingGateway.isConnected) {

                return messagingGateway.connect(client.clientId, client.clientSecret).catch(function() {

                    setError('Looks like something went wrong while connecting to the server. Try reloading your page.');

                });
            } else {

                return utils.$q(function(resolve, reject) {

                    resolve(true);

                });
            }
        }

        function setDescription(device) {

            deviceDescription = deviceDescription.format(device.id);

            return deviceRepository.updateUsingToken({
                id: vm.gameDevice.id,
                name: deviceName,
                description: deviceDescription
            }, token).then(function() {

                return device;

            });
        }

        function initializeAssets() {

            var gameAssets = getGameAssets();

            var promises = [];

            function handleAssetCreated(createdAsset) {

                vm.gameDevice.assets.push(createdAsset);

                return createdAsset;

            }

            for (var i = 0; i < gameAssets.length; i++) {

                var asset = gameAssets[i];
                var existingAsset = vm.gameDevice.getAsset(asset.name);

                if (!existingAsset) {

                    asset.deviceId = vm.gameDevice.id;

                    var assetCreatePromise = assetRepository.createUsingTicket(token, asset)
                        .then(handleAssetCreated);

                    promises.push(assetCreatePromise);

                }
            }

            return utils.$q.all(promises);

        }

        function getGameAssets() {

            var gameAssets = [];

            gameAssets.push(createAssetDefinition('amishaking', 'Shaking', 'sensor', gameConfiguration.assetConfiguration.shake.profile, gameConfiguration.assetConfiguration.shake.control));

            gameAssets.push(createAssetDefinition('position', 'Position', 'sensor', gameConfiguration.assetConfiguration.position.profile, gameConfiguration.assetConfiguration.position.control));

            gameAssets.push(createAssetDefinition('sendingdata', 'Sending data', 'sensor', gameConfiguration.assetConfiguration.visibility.profile, gameConfiguration.assetConfiguration.visibility.control));

            gameAssets.push(createAssetDefinition('rotation', 'Rotation', 'sensor', gameConfiguration.assetConfiguration.rotation.profile, gameConfiguration.assetConfiguration.rotation.control));

            return gameAssets;
        }

        function createAssetDefinition(name, title, is, profile, control, style) {

            var assetObject = {};

            if (name) {

                assetObject.name = name;

            }

            if (title) {

                assetObject.title = title;

            }

            if (is) {

                assetObject.is = is;

            }

            if (profile) {

                assetObject.profile = profile;

            }

            if (control) {

                assetObject.control = control;

            }

            if (style) {

                assetObject.style = style;

            }

            return assetObject;
        }

        function subscribeToHtml5Sensors() {

            if (sensors.shake.isSupported()) {

                sensors.shake.subscribeOnShakeChange(function(isShakin) {

                    var shakeAsset = vm.gameDevice.getAsset('amishaking');

                    var data = {};

                    if (isShakin) {

                        data.Value = 'shaking';

                    } else {

                        data.Value = 'still';

                    }

                    shakeAsset.send(JSON.stringify(data));

                    logMessage(data.Value);

                });
            }

            if (sensors.position.isSupported()) {

                sensors.position.subscribeOnPositionChange(function(position) {

                    var positionAsset = vm.gameDevice.getAsset('position');

                    var data = {};

                    if (position) {

                        data.Value = 'ontable';

                    } else {

                        data.Value = 'notontable';

                    }

                    positionAsset.send(JSON.stringify(data));

                    logMessage(data.Value);

                });
            }

            if (sensors.rotation.isSupported()) {

                sensors.rotation.subscribeOnRotation(function(rotation) {

                    var rotationAsset = vm.gameDevice.getAsset('rotation');

                    rotationAsset.send(JSON.stringify({
                        Value: rotation
                    }));

                    logMessage(rotation);

                });
            }

            sensors.pageVisibility.subscribeOnPageVisibility(function(message) {

                var visibilityAsset = vm.gameDevice.getAsset('sendingdata');

                if (message === true) {

                    visibilityAsset.send(JSON.stringify({
                        Value: message
                    }));

                    vm.status = 'playing';

                } else {

                    visibilityAsset.send(JSON.stringify({
                        Value: message
                    }));
                }

            });
        }

        function setupForGame() {

            vm.status = 'ready';

            playGame();

        }

        function sendInitialStatesAndSubscribe() {

            var deviceInfoAsset = vm.gameDevice.getAsset('deviceinfoasset');

            deviceInfoAsset.send(JSON.stringify({
                Value: deviceInfo
            }));
        }

        function restartGame() {

            var activityAsset = vm.gameDevice.getAsset('controlasset');

            var data = {
                Value: 'restart'
            };

            activityAsset.send(JSON.stringify(data));

        }

        function setError(message) {

            vm.status = 'error';

            vm.errorMessage = message;

        }

        function reload() {

            window.location.reload(true);

        }

        function toggleShowLog() {

            vm.showLog = !vm.showLog;

        }

        function playGame() {

            subscribeToHtml5Sensors();

            vm.status = 'playing';

            utils.$timeout(function() {

                var visibilityAsset = vm.gameDevice.getAsset('sendingdata');

                visibilityAsset.send(JSON.stringify({
                    Value: true
                }));

            }, 500);

        }

        function logMessage(message, data) {

            var datetime = getTime();

            vm.logs.push({
                time: datetime,
                message: message,
                data: data
            });

        }

        function getTime() {

            var currentdate = new Date();

            var datetime = currentdate.getDate() + '/' + (currentdate.getMonth() + 1) + '/' + currentdate.getFullYear() + ' @ ' + currentdate.getHours() + ':' + currentdate.getMinutes() + ':' + currentdate.getSeconds() + ' ' + currentdate.getMilliseconds();

            return datetime;

        }
    }
}());

(function() {
    'use strict';

    angular
        .module('app')
        .directive('qrcodeDeviceControl', qrcodeDeviceControl);

    function qrcodeDeviceControl() {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: Controller,
            templateUrl: '/assets/js/app/demo_device/qrcodeDeviceControl.html',
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            scope: {
                device: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {}
    }

    Controller.$inject = ['session', 'urlShortenerService', 'origin'];

    function Controller(session, urlShortenerService, origin) {

        var vm = this;
        var sessionData = session.authentication();
        var gameToken = null;

        vm.qrCodeUrl = '';

        activate();

        ///////////////////////////////////////////////

        function activate() {

            if (sessionData.isAuth) {
                gameToken = sessionData.accessToken;
            } else {
                gameToken = publicToken;
            }

            var longUrl = getQRCodeUrl(vm.device.name, gameToken);
            urlShortenerService.shortenUrl(longUrl)
                .then(function(shortUrl) {
                    vm.qrCodeUrl = shortUrl;
                });
        }

        function getQRCodeUrl(deviceName, token) {

            return '{0}/mobilebrowserdevice?deviceName={1}&token={2}'.format(origin, deviceName, token);
        }
    }
})();

(function(ng) {

    ng
        .module('app')
        .controller('AssetController', AssetController);

    AssetController.$inject = ['$scope', '$stateParams', '$state', 'session', 'utils', 'model'];

    function AssetController($scope, $stateParams, $state, session, utils, model) {

        var vm = this;

        vm.model = null;
        vm.goBack = goBack;
        vm.deleteAsset = deleteAsset;

        vm.client = {
            clientId: session.authentication().rmq.clientId,
            clientKey: session.authentication().rmq.clientKey
        };

        activate();

        ////////////////////////////////////////////

        function activate() {

            vm.model = model;

            $scope.$on('$destroy', function() {
                if (vm.model.asset) {
                    vm.model.asset.unsubscribe();
                }
            });
        }

        function goBack() {

            if (vm.model.origin == 'Device') {
                $state.go('main.device', {
                    id: vm.model.asset.deviceId
                });
            } else {
                $state.go('main.gateway', {
                    id: vm.model.asset.deviceId
                });
            }
        }

        function deleteAsset() {

            vm.model.delete().then(function() {
                goBack();
            });
        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('AssetViewModel', factory);

    factory.$inject = [
        'utils',
        'device.repository',
        'asset.repository',
        'ground.repository',
        'gateway.repository',
        'HeaderItemModel',
        'api.controlsService',
        'roles.manager'
    ];

    function factory(utils, deviceRepository, assetRepository, groundRepository, gatewayRepository, HeaderItemModel, ctrlsService, rolesManager) {

        function AssetViewModel(asset, parent, origin, controls, ground) {

            this.configOpen = false;

            if (ground) {

                this.groundId = ground.id;

                this.ground = ground;

            }

            this.drawerActiveTab = 0;
            this.editorOptions = utils.viewConfigs.getJsonEditorOptions();

            //Temporary solution to show JSON editors in read-only mode.
            //Each editor (State, Command, Profile) should have it's own editor configuration
            //because it will be possible users not to have permission to update asset state, but
            //do have permission to change profile.
            this.editorOptions.readOnly = rolesManager.authorize('device-asset-state') ? false : 'nocursor';
            this.editorRefresh = null;
            this.publishCommandJson = null;
            this.publishFeedJson = null;
            this.jsonEditorRefresh = null;

            var that = this;
            asset.on('state', function(stateData) {
                that.headerModel.replaceInfo('state', stateData.Value);
            });

            this.init(asset, parent, origin, controls);
        }

        AssetViewModel.prototype.init = function(asset, parent, origin, controls) {

            this.asset = asset;

            this.newAssetTitle = asset.title;

            this.profileJson = JSON.stringify(asset.profile, null, this.editorOptions.tabSize);

            this.controlJson = JSON.stringify(asset.control, null, this.editorOptions.tabSize);

            this.headerModel = HeaderItemModel.fromAsset(asset, parent, origin, this.ground);

            this.controls = controls;

            if (this.asset.control && this.asset.control.name) {

                this.controlName = this.asset.control.name;

            }

            this.control = this.getControlLabel();

            this.parent = parent;

            this.origin = origin;

        };

        AssetViewModel.prototype.toggleConfig = function() {

            var that = this;

            that.configOpen = !that.configOpen;

            if (that.configOpen) {

                utils.$timeout(function() {

                    that.editorRefresh = Math.random().toString();

                });

            } else {

                that.editorRefresh = false;

            }
        };

        AssetViewModel.prototype.isConfigOpen = function() {

            return this.configOpen;

        };

        AssetViewModel.prototype.getControlLabel = function() {

            var lbl = 'Select control...';

            if (this.asset.control && this.asset.control.name) {

                for (var i = 0; i < this.controls.length; i++) {

                    if (this.controls[i].name == this.asset.control.name) {

                        lbl = this.controls[i].title;

                    }
                }
            }

            return lbl;
        };

        AssetViewModel.prototype.publishFeed = function() {

            var that = this;

            return utils.tryParseJSON(that.publishFeedJson)
                .then(parseSuccessHandler, parseFailHandler);

            function parseSuccessHandler(obj) {

                return assetRepository.publishState(that.asset.id, obj)
                    .then(function() {

                        utils.notify.success('Success: ', 'Asset feed has been published.');

                        return true;

                    }).catch(function() {

                        return false;

                    });
            }

            function parseFailHandler() {

                utils.notify.error('JSON: ', 'JSON not valid.');

                return false;

            }
        };

        AssetViewModel.prototype.publishCommand = function() {

            var that = this;

            return utils.tryParseJSON(that.publishCommandJson)
                .then(parseSuccessHandler, parseFailHandler);

            function parseSuccessHandler(obj) {
                return assetRepository.publishCommand(that.asset.id, obj)
                    .then(function() {

                        return true;

                    })
                    .catch(function(error) {

                        return false;

                    });
            }

            function parseFailHandler() {

                utils.notify.error('JSON: ', 'JSON not valid.');

                return false;

            }
        };

        AssetViewModel.prototype.replaceProfile = function() {

            var that = this;

            return utils.tryParseJSON(that.profileJson)
                .then(parseSuccessHandler, parseFailHandler);

            function parseSuccessHandler(obj) {

                return assetRepository.replaceProfile(that.asset.deviceId, that.asset.name, obj)
                    .then(function() {

                        utils.notify.success('Success: ', 'Asset profile has been replaced.');

                        assetRepository.find(that.asset.id).then(function(asset) {

                            return asset;

                        }).then(function(asset) {

                            ctrlsService.getControlsForAsset(that.asset.id)
                                .then(function(controls) {

                                    that.init(asset, that.parent, that.origin, controls);

                                });
                        });

                        return true;
                    })
                    .catch(function(error) {

                        return false;

                    });
            }

            function parseFailHandler() {

                utils.notify.error('JSON: ', 'JSON not valid.');

                return false;

            }
        };

        AssetViewModel.prototype.replaceControl = function() {

            var that = this;

            return utils.tryParseJSON(that.controlJson)
                .then(parseSuccessHandler, parseFailHandler);

            function parseSuccessHandler(obj) {
                return assetRepository.replaceControl(that.asset.deviceId, that.asset.name, obj)
                    .then(function() {

                        utils.notify.success('Success: ', 'Asset control has been replaced.');

                        assetRepository.find(that.asset.id).then(function(asset) {

                            that.init(asset, that.parent, that.origin, that.controls);

                        });

                        return true;
                    })
                    .catch(function(error) {

                        return false;

                    });
            }

            function parseFailHandler() {

                utils.notify.error('JSON: ', 'JSON not valid.');

                return false;

            }
        };

        AssetViewModel.prototype.delete = function() {

            return assetRepository.remove(this.asset.deviceId, this.asset.name).then(function() {

                utils.notify.success('Success: ', 'Asset is deleted.');

            });
        };

        AssetViewModel.prototype.update = function() {

            var that = this;

            return assetRepository.update(that.asset.deviceId, that.asset.id, that.asset.name, that.asset.is, that.newAssetTitle)
                .then(function(a) {

                    that.asset.title = a.title;

                    utils.notify.success('Success: ', 'Asset is updated');

                    that.headerModel.update(that.asset.title);

                });
        };

        AssetViewModel.prototype.setControl = function(item) {

            var that = this;

            var assetControl = that.asset.control;

            if (!assetControl) {

                assetControl = {};

            }

            assetControl.name = item.name;

            return assetRepository.replaceControl(that.asset.deviceId, that.asset.name, assetControl)
                .then(function() {

                    that.init(that.asset, that.parent, that.origin, that.controls);

                    return true;

                })
                .catch(function(error) {

                    return false;

                });
        };

        AssetViewModel.prototype.refreshEditors = function() {

            var that = this;

            that.editorRefresh = false;

            utils.$timeout(function() {

                that.editorRefresh = Math.random().toString();

            }, 100);

        };

        AssetViewModel.resolve = function(assetId) {

            var foundAsset = null;
            var foundParent = null;
            var foundControls = null;
            var foundOrigin = null;
            var foundGround = null;

            return getAsset(assetId)
                .then(getParent)
                .then(getGround)
                .then(getControls)
                .then(function() {
                    return new AssetViewModel(foundAsset, foundParent, foundOrigin, foundControls, foundGround);
                });

            function getAsset(assetId) {

                return assetRepository.find(assetId)
                    .then(function(asset) {

                        foundAsset = asset;

                    });
            }

            function getParent() {

                return findDevice(foundAsset.deviceId)
                    .then(null, findGateway);

                function findDevice(deviceId) {

                    return deviceRepository.find(foundAsset.deviceId)
                        .then(function(device) {

                            if (device) {

                                foundOrigin = 'Device';

                                foundParent = device;

                            }

                            return device;
                        });
                }

                function findGateway(reject) {

                    return gatewayRepository.find(foundAsset.deviceId)
                        .then(function(gateway) {

                            if (gateway) {

                                foundOrigin = 'Gateway';

                                foundParent = gateway;

                            }

                            return gateway;
                        });
                }

            }

            function getControls() {

                return ctrlsService.getControlsForAsset(foundAsset.id)
                    .then(function(controls) {

                        foundControls = controls;

                    });
            }

            function getGround(device) {

                if (device.groundId) {

                    return groundRepository.find(device.groundId)
                        .then(function(ground) {

                            foundGround = ground;

                            return ground;

                        });

                }

                return utils.$q.when();

            }
        };

        return AssetViewModel;
    }
})();

(function() {

    angular
        .module('app')
        .controller('DeviceController', DeviceController);

    DeviceController.$inject = [
        '$scope',
        '$state',
        '$stateParams',
        '$modal',
        'session',
        'utils',
        'model'
    ];

    function DeviceController($scope, $state, $stateParams, $modal, session, utils, model) {

        var PREFERENCE_CONTROL_KEY = 'device_tab';

        var vm = this;

        vm.model = null;
        vm.goToAsset = goToAsset;
        vm.openDeleteDeviceModal = openDeleteDeviceModal;
        vm.setControl = setControl;
        vm.qrControl = 'enroll-demo';

        vm.modalStatus = utils.preferences.readGlobal('DeleteDeviceModalStatus');

        //TODO: refactor to $root
        vm.client = {
            clientId: session.authentication().rmq.clientId,
            clientKey: session.authentication().rmq.clientKey
        };

        activate();

        ////////////////

        function activate() {

            vm.model = model;

            var controlToShow = getControlToShow();

            if (controlToShow === 'device-control' && (!vm.model.device.control || !vm.model.device.control.name)) {

                controlToShow = 'device-control';

            }

            vm.model.setControl(controlToShow);

            $scope.$on('$destroy', function() {

                if (vm.model.device) {

                    vm.model.device.unsubscribe();

                    for (var i = 0; i < vm.model.device.assets.length; i++) {

                        vm.model.device.assets[i].unsubscribe();

                    }
                }
            });
        }

        function getControlToShow() {

            var defaultControl = 'asset-controls';

            var supportedControls = ['asset-controls', 'asset-list', 'activity', 'device-control'];

            if ($stateParams.assetCtrl && supportedControls.indexOf($stateParams.assetCtrl) >= 0) {

                return $stateParams.assetCtrl;

            } else {

                var userPref = utils.preferences.readPage(PREFERENCE_CONTROL_KEY);

                if (supportedControls.indexOf(userPref) >= 0) {

                    return userPref;

                }
            }

            return defaultControl;
        }

        function setControl(ctrl) {

            vm.model.setControl(ctrl);

            utils.preferences.rememberPage(PREFERENCE_CONTROL_KEY, ctrl);

            $state.go('main.deviceOpt', {
                id: vm.model.device.id,
                assetCtrl: ctrl

            }, {
                notify: false,
                reload: false
            });
        }

        function goToAsset(assetId) {

            $state.go('main.asset', {
                id: assetId
            });

        }

        function openDeleteDeviceModal() {

            if (vm.modalStatus !== 'true') {

                var modalInstance = $modal.open({
                    templateUrl: '/assets/js/app/modals/confirm_item_delete/view.html',
                    controller: 'modals.confirmItemDelete',
                    controllerAs: 'vm',
                    resolve: {
                        item: function() {
                            return vm.model;
                        },
                        model: function() {
                            return null;
                        }
                    }
                });
            } else {

                vm.model.delete().then(function() {
                    if (vm.model.hasOwnProperty('device')) {
                        $state.go('main.groundDevices', {
                            id: vm.model.groundId
                        });
                    } else if (vm.model.hasOwnProperty('gateway')) {
                        $state.go('main.groundGateways', {
                            id: vm.model.groundId
                        });
                    }
                });
            }

        }
    }

}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('DeviceViewModel', factory);

    factory.$inject = [
        'utils',
        'CreateAssetModel',
        'EditDeviceModel',
        'device.repository',
        'asset.repository',
        'HeaderItemModel',
        'roles.manager',
        'api.rulesService',
        'utility.common',
        'session',
        'controls.repository',
        'FirstAppDictionary'
    ];

    function factory(utils, CreateAssetModel, EditDeviceModel, deviceRepository, assetRepository, HeaderItemModel, rolesManager, rulesService, common, session, controlsRepository, FirstAppDictionary) {

        function DeviceViewModel(device, groundId) {

            var that = this;

            that.settings = {};

            that.selectedControl = null;

            that.client = {
                clientId: session.authentication().rmq.clientId,
                clientKey: session.authentication().rmq.clientKey
            };

            that.isOpen = null;

            that.configOpen = false;

            that.guideOpen = false;

            that.groundId = groundId;

            that.editorOptions = utils.viewConfigs.getJsonEditorOptions();

            that.editorOptions.readOnly = rolesManager.authorize('device-control-save', {
                groundId: groundId
            }) ? false : 'nocursor';

            that.activeControl = 'controls';

            that.createAssetDisabled = false;

            try {

                var isFileSaverSupported = !!new Blob;

                that.isDownloadSupported = true;

            } catch (e) {

                that.isDownloadSupported = false;

            }

            that.init(device);

            that.editorOptions = utils.viewConfigs.getJsonEditorOptions();
            that.editorModel = '';
            that.stepsUrl = getStepsUrl(device.type);

            var dictionary = new FirstAppDictionary();

            that.editorModel = dictionary.generateScript(device, { id: device.id, clientId: that.client.clientId, clientKey: that.client.clientKey });

            that.editorRefresh = false;
        }

        DeviceViewModel.prototype.init = function(device) {

            var that = this;

            that.device = device;

            that.assetModel = new CreateAssetModel();

            that.editDeviceModel = new EditDeviceModel(device.name, device.description, device.title);

            that.editorControl = JSON.stringify(device.control, null, that.editorOptions.tabSize);

            if (device.type === 'intel-edison') {

                //for Edison device 'credentials.json'
                setupIntelEdisonCredentialsFile(that, that.device, that.client);

            }

            if (device.type === 'proximus-lora') {

                //for LoRa device 'keys.h'
                var keysFileIsReady = setupProximusLoraKeysFile(that, that.device);

                if (!keysFileIsReady) {

                    that.isDownloadSupported = false;

                }
            }

            rulesService.getDeviceRulesCount(device.id)
                .then(function(response) {

                    that.device.hasRules = response.data.hasRules;

                    that.device.hasNotificationRules = response.data.hasNotificationRules;

                    that.headerModel = HeaderItemModel.fromDevice(device);

                });

            var promises = [];

            promises.push(deviceRepository.getDeviceSettings(device.id));
            promises.push(controlsRepository.findAllDeviceControls());

            utils.$q.all(promises).then(function(results) {

                that.settings = results[0];

                that.controls = results[1];

                angular.forEach(that.controls, function(control) {

                    if (control.name === that.settings.control) {

                        that.selectedControl = control;

                    }
                });

            });
        };

        DeviceViewModel.prototype.downloadKeysFile = function() {

            var blob = new Blob([this.keysText], {

                type: 'text/plain;charset=utf-8'

            });

            saveAs(blob, 'keys.h');

        };

        DeviceViewModel.prototype.downloadCredentialsFile = function() {

            var blob = new Blob([this.credentialsJsonText], {

                type: 'text/plain;charset=utf-8'

            });

            saveAs(blob, 'credentials.json');

        };

        DeviceViewModel.prototype.toggleConfig = function() {

            this.configOpen = !this.configOpen;

        };

        DeviceViewModel.prototype.toggleGuide = function() {

            this.guideOpen = !this.guideOpen;

        };

        DeviceViewModel.prototype.isConfigOpen = function() {

            return this.configOpen;

        };

        DeviceViewModel.prototype.setControl = function(control) {

            this.activeControl = control;
        };

        DeviceViewModel.prototype.createAsset = function() {

            var that = this;

            that.createAssetDisabled = true;

            return assetRepository.create(that.device.id, utils.normalizeAssetName(that.assetModel.name), that.assetModel.name, that.assetModel.type)
                .then(function(asset) {

                    common.markNew(that.device.assets, [asset]);

                    utils.notify.success('Success: ', 'Asset is created.');

                    that.device.assets.push(asset);

                    that.assetModel.name = '';

                    that.isOpen = false;

                    return true;
                })
                .catch(function(error) {

                    return false;

                }).finally(function() {

                    that.createAssetDisabled = false;

                });
        };

        DeviceViewModel.prototype.delete = function() {

            return deviceRepository.remove(this.device.id)
                .then(function(response) {

                    utils.notify.success('Success: ', 'Device is deleted.');

                });
        };

        DeviceViewModel.prototype.updateControl = function(ctrl) {

            this.settings.control = ctrl.name;

            deviceRepository.saveDeviceSettings(this.device.id, this.settings);

        };

        DeviceViewModel.prototype.updateTitle = function() {

            var that = this;

            return deviceRepository.update(that.device.id, {
                    name: that.device.name,
                    title: that.editDeviceModel.title
                })
                .then(function(d) {

                    that.device.title = d.title;

                    that.device.description = d.description;

                    utils.notify.success('Success: ', 'Device Updated');

                    that.headerModel.update(that.device.title, that.device.description);

                });
        };

        DeviceViewModel.prototype.updateDescription = function() {

            var that = this;

            that.editDeviceModel.saved = true;

            return deviceRepository.update(that.device.id, {
                    name: that.device.name,
                    description: that.editDeviceModel.description
                })
                .then(function(d) {

                    that.device.name = d.name;

                    that.device.description = d.description;

                    utils.notify.success('Success: ', 'Device Updated');

                    that.headerModel.update(that.device.name, that.device.description);

                });

        };

        DeviceViewModel.prototype.enableActivity = function() {

            var that = this;

            return deviceRepository.update(that.device.id, {
                name: that.device.name,
                activityEnabled: true
            }).then(function(response) {

                utils.notify.success('Success: ', 'Activity Log enabled.');

                that.device.activityEnabled = true;

            });
        };

        DeviceViewModel.prototype.disableActivity = function() {

            var that = this;

            return deviceRepository.update(that.device.id, {
                name: that.device.name,
                activityEnabled: false
            }).then(function(response) {

                utils.notify.success('Success: ', 'Activity Log disabled.');

                that.device.activityEnabled = false;

            });
        };

        DeviceViewModel.prototype.allowAssetTypeCreation = function(assetType) {

            var that = this;
            var permission = true;

            if (that.device.type === 'proximus-lora' && assetType === 'actuator') {

                permission = false;

            }

            return permission;
        };

        DeviceViewModel.prototype.downloadScript = function() {

            var that = this;

            var blob = null;

            if (that.device.type === 'rpi') {

                blob = new Blob([this.editorModel], {

                    type: 'text/plain;charset=utf-8'

                });

                saveAs(blob, 'first_app.py');

            } else if (that.device.type === 'arduino') {

                blob = new Blob([this.editorModel], {

                    type: 'text/plain'

                });

                saveAs(blob, 'first_app.ino');

            } else if (that.device.type === 'intel-edison') {

                blob = new Blob([this.editorModel], {

                    type: 'text/plain'

                });

                saveAs(blob, 'main.js');

            }
        };

        DeviceViewModel.resolve = function(deviceId) {

            return deviceRepository.find(deviceId)
                .then(function(device) {

                    var viewModel = new DeviceViewModel(device, device.groundId);

                    return viewModel;

                });
        };

        function setupIntelEdisonCredentialsFile(model, device, client) {

            model.credentialsJsonText = '{\r\n' +
                '   "deviceId": "' + device.id + '",\r\n' +
                '   "clientId": "' + client.clientId + '",\r\n' +
                '   "clientKey": "' + client.clientKey + '"\r\n' +
                '}';

        }

        function setupProximusLoraKeysFile(model, device) {

            if (device.meta && device.meta.keys && device.meta.keys.DEV_ADDR && device.meta.keys.APPSKEY && device.meta.keys.NWKSKEY) {

                model.keysText = '#ifndef KEYS_h\r\n' +
                    '#define KEYS_h\r\n\r\n' +

                    'uint8_t DEV_ADDR[4] = ' + device.meta.keys.DEV_ADDR + ';\r\n' +
                    'uint8_t APPSKEY[16] = ' + device.meta.keys.APPSKEY + ';\r\n' +
                    'uint8_t NWKSKEY[16] = ' + device.meta.keys.NWKSKEY + ';\r\n\r\n' +

                    '#endif';

                return true;

            } else {

                model.keysText = 'Looks like data for keys.h file is not available.';

                return false;
            }
        }

        function getStepsUrl(deviceType) {

            var url = '/assets/js/app/devices/setup-steps/';

            url += deviceType + '-steps.html';

            return url;
        }

        return DeviceViewModel;
    }
})();

(function(ng) {
    ng
        .module('app')
        .controller('DevicesController', DevicesController);

    DevicesController.$inject = [
        '$state',
        '$scope',
        '$modal',
        'model',
        'utils'
    ];

    function DevicesController($state, $scope, $modal, model, utils) {

        var vm = this;

        vm.model = model;
        vm.createDevice = createDevice;
        vm.openDeleteDeviceModal = openDeleteDeviceModal;

        var status = utils.preferences.readGlobal('DeleteDeviceModalStatus');

        activate();

        function activate() {
            $scope.$on('$destroy', function() {
                angular.forEach(vm.model.devices, function(device) {
                    // device.unsubscribe();
                });
            });
        }

        function createDevice(name, type) {

            vm.model.createDevice(name, type)
                .then(function(device) {

                    $state.go('main.device', {
                        id: device.id
                    });
                });
        }

        function openDeleteDeviceModal(device) {

            if (status !== 'true') {

                var modalInstance = $modal.open({
                    templateUrl: '/assets/js/app/modals/confirm_item_delete/view.html',
                    controller: 'modals.confirmItemDelete',
                    controllerAs: 'vm',
                    resolve: {
                        item: function() {
                            return device;
                        },
                        model: function() {
                            return vm.model;
                        }
                    }
                });

            } else {

                vm.model.delete(device.device);
            }

        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('DeviceListViewModel', DeviceListViewModelFactory);

    DeviceListViewModelFactory.$inject = [
        '$state',
        'device.repository',
        'utils',
        'demo.configuration',
        'sl.listHeader',
        'sl.listItem',
        'api.rulesService',
        'GroundContext'
    ];

    function DeviceListViewModelFactory($state, devicesRepository, utils, gameConfiguration, ListHeaderViewModel, ListItemViewModel, rulesService, groundContext) {

        function DeviceListViewModel(devices, groundId) {

            this.devices = [];
            this.groundId = groundId;
            this.grounds = groundContext.grounds;
            this.init(devices);
        }

        DeviceListViewModel.prototype.init = function(devices) {

            var that = this;

            if (devices.length === 0) {
                this.headerModel = new ListHeaderViewModel('Devices', 'assets/img/devices-header.svg', 'Overview of all devices serving this ground. Currently you don\'t have any devices.');
            } else {
                this.headerModel = new ListHeaderViewModel('Devices', 'assets/img/devices-header.svg', 'Overview of all devices serving this ground.');
            }

            angular.forEach(that.grounds, function(ground) {
                if (ground.id === that.groundId) {
                    that.currentGroundVisibility = ground.visibility;
                }
            });

            angular.forEach(devices, function(device) {

                device.subscribe();

                rulesService.getDeviceRulesCount(device.id)
                    .then(function(response) {
                        device.rulesMeta = response.data;
                        that.devices.push(ListItemViewModel.fromDevice(device));
                    });
            });

            if (devices.length > 0) {
                that.headerModel.setHeaderMode('colapsed');
            } else {
                that.headerModel.setHeaderMode('expanded');
            }

            utils.$rootScope.$on('$messaging.device.created', function(e, eventData) {

                var deviceExists = false;
                angular.forEach(that.devices, function(device) {
                    if (device.itemId === eventData.deviceId) {
                        deviceExists = true;
                    }
                });

                if (!deviceExists) {
                    devicesRepository.find(eventData.deviceId).then(function(dev) {
                        dev.$isNew = true;
                        dev.subscribe();
                        that.devices.push(ListItemViewModel.fromDevice(dev));
                        if (that.devices.length > 0) {
                            that.headerModel.setHeaderMode('colapsed');
                        } else {
                            that.headerModel.setHeaderMode('expanded');
                        }

                    });
                }
            });

            utils.$rootScope.$on('$messaging.device.deleted', function(e, eventData) {

                var deletedDevice = null;
                angular.forEach(that.devices, function(device) {
                    if (device.itemId === eventData.deviceId) {
                        deletedDevice = device;
                    }
                });

                if (deletedDevice !== null) {
                    deletedDevice.setDeleted();
                }

            });

            utils.$rootScope.$on('demo.deviceAdopted', function(e, data) {
                devicesRepository.find(data).then(function(dev) {
                    dev.$isNew = true;
                    that.devices.push(ListItemViewModel.fromDevice(dev));
                });
            });

        };

        DeviceListViewModel.prototype.createDevice = function(name, type) {

            var that = this;

            if (name === null || name === '') {
                return;
            }

            var data = {
                name: name,
                type: type
            };

            return devicesRepository.createInGround(data, that.groundId).then(function(device) {

                utils.notify.success('Success.', 'New device is created');

                utils.$rootScope.$emit('user.created.device', device);

                return device;
            });
        };

        DeviceListViewModel.prototype.removeDevice = function(deletedDevice) {

            var index = this.devices.indexOf(deletedDevice);
            this.devices.splice(index, 1);
        };

        DeviceListViewModel.prototype.delete = function(device) {

            var that = this;
            var deviceDeleted = device;

            return devicesRepository.remove(deviceDeleted.id)
                .then(function() {

                    utils.notify.success('Success.', 'Device is deleted');

                    for (var i = 0; i < that.devices.length; i++) {

                        if (that.devices[i].device === deviceDeleted) {

                            that.devices.splice(i, 1);
                        }
                    }

                });

        };

        DeviceListViewModel.resolve = function(groundId) {

            return devicesRepository.findAllInGround(groundId).then(function(devices) {
                return new DeviceListViewModel(devices, groundId);
            });
        };

        return DeviceListViewModel;
    }
}());

(function(ng) {
    ng
        .module('app')
        .controller('YourDevicesController', YourDevicesController);

    YourDevicesController.$inject = [
        '$state',
        '$scope',
        'YourDevicesViewModel'
    ];

    function YourDevicesController($state, $scope, YourDevicesViewModel) {

        var vm = this;

        vm.model = null;
        vm.goToEnvironment = goToEnvironment;

        activate();

        function activate() {

            YourDevicesViewModel.resolve().then(function(model) {
                vm.model = model;
            });

        }

        function goToEnvironment() {
            $state.go('main.environment');
        }

    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('YourDevicesViewModel', YourDevicesViewModelFactory);

    YourDevicesViewModelFactory.$inject = [
        'device.repository',
        'utils',
        'sl.listHeader',
        'sl.listItem'
    ];

    function YourDevicesViewModelFactory(devicesRepository, utils, ListHeaderViewModel, ListItemViewModel) {

        function YourDevicesViewModel(devices) {

            this.devices = [];
            this.headerModel = null;
            this.callToAction = false;
            this.init(devices);
        }

        YourDevicesViewModel.prototype.init = function(devices) {
            var that = this;

            angular.forEach(devices, function(device) {
                that.devices.push(ListItemViewModel.fromDevice(device));
            });

            if (devices.length > 0) {
                that.headerModel = new ListHeaderViewModel('Your devices', 'assets/img/devices-header.svg', 'Overview of all devices that you own.');
                that.headerModel.setHeaderMode('colapsed');
                that.callToAction = false;
            } else {
                that.headerModel = new ListHeaderViewModel('Your Devices', 'assets/img/devices-header.svg', 'Overview of all devices that you own.. Currently you don\'t have any devices. To create grounds and devices navigate to environment');
                that.headerModel.setHeaderMode('expanded');
                that.callToAction = true;
            }

        };

        YourDevicesViewModel.resolve = function() {

            return devicesRepository.findAll()
                .then(function(devices) {
                    return new YourDevicesViewModel(devices);
                });

        };

        return YourDevicesViewModel;
    }
}());

    (function (ng) {
    ng.module('app').directive('balloonError', [
        function () {
            var RIGHT_OFFSET = 62;
            //var BALLON = 'balloon';
            var BALLOON_ERROR = 'balloon-error';
            var SAD_SMILE_ICON = 'sl-emotion-sad';

            function BalloonError(parentElement) {
                this.element = null;
                this.textElement = null;
                this.parentElement = parentElement instanceof ng.element ? parentElement[0] : parentElement;
            }

            BalloonError.prototype.getTopRightPosition = function () {
                var clientRect = this.parentElement.getBoundingClientRect();
                var x = Math.round(clientRect.width + clientRect.left) - RIGHT_OFFSET;
                var y = Math.round(clientRect.top);

                return {x: x, y: y};
            };

            BalloonError.prototype.setPosition = function (balloon) {
                if (balloon) {
                    var position = this.getTopRightPosition();

                    balloon.style.position = 'absolute';
                    balloon.style.top = position.y + 'px';
                    balloon.style.left = position.x + 'px';
                }
            };

            BalloonError.prototype.createErrorObject = function () {
                var balloon = this.element = document.createElement('div');
                var arrow = document.createElement('span');
                var icon = document.createElement('i');

                this.textElement = document.createElement('span');

                //balloon.classList.add(BALLON);
                balloon.classList.add(BALLOON_ERROR);
                icon.classList.add(SAD_SMILE_ICON);
                arrow.classList.add('arrow');

                balloon.appendChild(arrow);
                balloon.appendChild(icon);
                balloon.appendChild(this.textElement);

                this.setPosition(balloon);
                this.parentElement.parentNode.appendChild(balloon);
            };

            BalloonError.prototype.destroyErrorObject = function () {
                this.parentElement.parentNode.removeChild(this.element);
                this.element = null;
                this.textElement = null;
            };

            BalloonError.prototype.setErrorMessage = function (message) {
                if (this.element && message) {
                    this.textElement.innerHTML = message;
                }
            };

            BalloonError.prototype.clearErrorMessage = function () {
                this.textElement.innerHTML = null;
            };

            return {
                restrict: 'A',
                scope: {
                    message: '=balloonError'
                },
                link: function (scope, element, attrs) {
                    var balloon = null;

                    scope.$watch('message', function (value) {
                        if (value) {
                            if (!balloon) {
                                balloon = new BalloonError(element);
                                balloon.createErrorObject();
                            }

                            balloon.setErrorMessage(value);
                        }
                        else {
                            if (balloon) {
                                balloon.destroyErrorObject();
                                balloon = null;
                            }
                        }
                    });

                    function setBallonPositionOnEvent() {
                        if (balloon) {
                            balloon.setPosition(balloon.element);
                        }
                    }

                    window.addEventListener('resize', setBallonPositionOnEvent);

                    var container = window.document.body.querySelector(".grid-col-container");

                    if (container) {
                        container.addEventListener('scroll', setBallonPositionOnEvent);
                    }

                    scope.$on('$destroy', function () {
                        if (balloon) {
                            balloon.destroyErrorObject();
                        }

                        window.removeEventListener('resize', setBallonPositionOnEvent);
                        window.removeEventListener('scroll', setBallonPositionOnEvent);
                    });
                }
            };
        }
    ]);
}(window.angular));
(function(ng) {
        ng.module('app').directive('counterInput', [
            '$rootScope',
            function($rootScope) {
                return {
                    restrict: 'A',
                    scope: {
                        time: '='
                    },
                    link: function(scope, element) {
                        var el = element[0];
                        var ch = element.children();
                        var height = element.height();
                        var value = element.children().height();
                        var identifyClass = 'this';

                        scope.$watch('time', function() {
                                for (var i = 0; i < ch.length; i++) {
                                    var oneElement = ch[i];
                                    if ($(ch[i]).hasClass(identifyClass)) {
                                        $(ch[i]).removeClass(identifyClass);
                                    };
                                    if (ch[i].getAttribute('data-value') == scope.time) {
                                        $(ch[i]).addClass(identifyClass);
                                        var position = (i - 1) * value;
                                        var newPosition = position + value;
                                        el.style.top = '-' + newPosition + 'px';
                                        break;
                                    }
                                }
                            }
                        );



                    function resetCounterTop() {
                        el.style.top = '0px';
                        ch.removeClass(identifyClass);
                        ch.first().addClass(identifyClass);
                        scope.$apply(function() {
                            scope.time = ch.first().attr("data-value");

                        });
                    }

                    function resetCounterBottom() {
                        el.style.top = '-' + (height - value) + 'px';
                        ch.removeClass(identifyClass);
                        ch.last().addClass(identifyClass);
                        scope.$apply(function() {
                            scope.time = ch.last().attr("data-value");

                        });
                    }

                    function countForward() {
                        var current = element.find('.' + identifyClass + '');
                        scope.$apply(function() {
                            scope.time = current.next().attr("data-value");

                        });

                        var index = current.index();
                        var currentPosition = index * value;
                        var move = currentPosition + value;

                        function animateCountForward() {
                            el.style.top = '-' + move + 'px';
                            current.removeClass(identifyClass);
                            current.next().addClass(identifyClass);
                        }

                        if (move < height) {
                            animateCountForward();
                        } else {
                            resetCounterTop();
                        }

                    }

                    function countBack() {
                        var current = element.find('.' + identifyClass + '');
                        scope.$apply(function() {
                            scope.time = current.prev().attr("data-value");

                        });
                        var index = current.index();
                        var currentPosition = index * value;
                        var move = currentPosition - value;

                        function animateCountBack() {
                            el.style.top = '-' + move + 'px';
                            current.removeClass(identifyClass);
                            current.prev().addClass(identifyClass);
                        }

                        if (move >= 0) {
                            animateCountBack();
                        } else {
                            resetCounterBottom();
                        }

                    }

                    ng.element(ch).on('click', function() {
                        value = element.children().height();
                        height = element.height();
                        countForward();
                    });
                    ng.element(ch).on('mousewheel', function(e, direction) {
                        value = element.children().height();
                        height = element.height();
                        if (direction < 0) {
                            countForward();
                        } else {
                            countBack();
                        }
                        e.preventDefault()
                    });
                }
            };
        }]);
}(window.angular));
(function() {

    angular
        .module('app')
        .directive('deviceStatus', deviceStatus);

    deviceStatus.$inject = ['$rootScope'];

    function deviceStatus($rootScope) {
        var directive = {
            restrict: 'A',
            scope: {
                device: '='
            },
            link: linker
        };

        return directive;

        function linker(scope, element, attribute) {

            scope.$watch('device.deviceActiveAt', function() {
                scope.setStatusLabel(scope.device.lastActiveAt);
            });

            scope.isFirstTime = true;

            $rootScope.$on('$messaging.asset.state', function(event, payload) {

                var isAssetFromThisDevice = false;
                var asset = null;

                for (var i = 0; i < scope.device.assets.length; i++) {

                    if (payload.assetId === scope.device.assets[i].id) {

                        isAssetFromThisDevice = true;
                        asset = scope.device.assets[i];
                        break;
                    }

                }

                if (asset) {

                    if (asset.name === 'sendingdata' && scope.isFirstTime) {

                        $rootScope.$broadcast('user.playing.quick-demo', asset.state);

                        scope.isFirstTime = false;
                    }

                }

                if (isAssetFromThisDevice && asset.is === 'sensor') {

                    scope.setStatusLabel(payload.payload.State.At);

                }

            });

            scope.setStatusLabel = function(time) {

                var status = null;

                if (time !== null && time !== undefined && time !== '') {

                    var offsetTime = moment(time).add(-4, 's');
                    var timeEdited = moment(offsetTime, moment.ISO_8601);
                    var finalTime = timeEdited.fromNow();
                    element[0].innerHTML = 'active ' + finalTime;

                    $(element[0]).attr('title', timeEdited.format('DD.MM.YYYY. [at] HH:MM'));

                }

            };

        }
    }
}());

(function(ng) {
    ng.module('app').directive('drag', function() {
        return {
            restrict: 'A',
            link: function(scope, element) {
                    var t = element;

                    $(function() {
                        $(t).mousedown(function (event) {
                            $(t)
                                .data('down', true)
                                .data('x', event.pageX)
                                .data('y', event.pageY)
                                .data('scrollLeft', this.scrollLeft)
                                .data('scrollTop', this.scrollTop)
                                .css('cursor', 'move');
                        }),

                            $(t).mouseup(function (event) {
                                $(t)
                                    .data('down', false)
                                    .removeAttr('style');
                            }),

                            $(t).mousemove(function (event) {
                                if ($(t).data('down') == true) {
                                    this.scrollLeft = $(t).data('scrollLeft') + $(t).data('x') - event.pageX;
                                }

                                if ($(t).data('down') == true) {
                                    this.scrollTop = $(t).data('scrollTop') + $(t).data('y') - event.pageY;
                                }
                            });

                    });


            }
        };
    });
}(window.angular));






(function(ng) {
    ng
        .module('app')
        .directive('fromNow', fromNow);

    fromNow.$inject = ['$interval'];

    function fromNow($interval) {
        var directive = {
            restrict: 'A',
            scope: {
                fromNow: '='
            },
            link: linker
        };

        return directive;

        function linker(scope, element, attribute) {

            scope.$watch('fromNow', function() {
                scope.setTimeLabel(scope.fromNow);
            });

            var refreshTimer = $interval(function() {
                scope.setTimeLabel(scope.fromNow);
            }, 30000);

            scope.setTimeLabel = function(time) {
                if (time) {
                    var offsetTime = moment(time).add(-4, 's');
                    var timeEdited = moment(offsetTime, moment.ISO_8601);
                    var finalTime = timeEdited.fromNow();
                    element[0].innerHTML = finalTime;

                    $(element[0]).attr('title', timeEdited.format('DD.MM.YYYY. [at] HH:MM'));
                }
            };

            scope.$on('$destroy', function() {
                $interval.cancel(refreshTimer);
            });
        }
    }
}(window.angular));

//(function (ng) {
//    ng.module('app').directive('fullHeight',
//        ['$window',
//            function ($window) {
//                return {
//                    restrict: 'A',
//                    link: function (scope, element, attrs) {
//                        var el = element[0];
//
//                        scope.onResize = function () {
//                            resizeElement();
//                        };
//
//                        function resizeElement() {
//                            if (el) {
//                                el.style.height = (window.innerHeight - el.offsetTop) + 'px';
//                            }
//                        }
//
//                        ng.element($window).on('resize', function () {
//                            scope.onResize();
//                        });
//
//                        resizeElement();
//                    }
//                };
//            }]
//    );
//}(window.angular));

(function(ng) {
    ng.module('app').directive('inlineControl', [
        '$log',
        '$compile',
        function($log, $compile) {
            function addArrayToElement(array, el) {
                if (array.length > 0 && el) {
                    for (var i = 0; i < array.length; i++) {
                        if (!el.classList.contains(array[i])) {
                            el.classList.add(array[i]);
                        }
                    }
                }
            }

            function removeArrayFromElement(array, el) {
                if (array.length > 0 && el) {
                    for (var i = 0; i < array.length; i++) {
                        if (el.classList.contains(array[i])) {
                            el.classList.remove(array[i]);
                        }
                    }
                }
            }

            function hideChildren(el) {
                var elements = el.querySelectorAll("article");
                for (var i = 0; i < elements.length; i++) {
                    elements[i].style.display = 'none';
                }
            }

            function showChildren(el) {
                var elements = el.querySelectorAll("article");
                for (var i = 0; i < elements.length; i++) {
                    elements[i].style.display = 'block';
                }
            }

            return {
                restrict: 'E',
                scope: {
                    firstState: '@', // css classes that are always "active" on element
                    secondState: '@', // css classes that are added and removed according to state
                    confirmElementId: '@',
                    confirmAction: '&',
                    declineElementId: '@',
                    declineAction: '&',
                    clearData: '&',
                    state: '=?'
                },

                link: function(scope, element, attrs) {
                    var el = element[0];

                    var firstStateClasses = null;
                    var secondStateClasses = null;
                    scope.state = true;

                    if (scope.firstState) {
                        firstStateClasses = scope.firstState.split(' ');
                    }

                    if (scope.secondState) {
                        secondStateClasses = scope.secondState.split(' ');
                    }

                    if (scope.confirmElementId) {
                        var confirmElement = el.querySelector('#' + scope.confirmElementId);
                        if (confirmElement) {
                            $(confirmElement).on('click', function(e) {
                                scope.confirmAction();
                                e.stopPropagation();
                            });
                        }
                    }

                    if (scope.declineElementId) {
                        var declineElement = el.querySelector('#' + scope.declineElementId);
                        if (declineElement) {
                            $(declineElementId).on('click', function() {
                                scope.declineAction();
                            });
                        }
                    }

                    var inputs = el.querySelectorAll('input');
                    for (var i = 0; i < inputs.length; i++) {
                        $(inputs[i]).click(function(e) {
                            e.stopImmediatePropagation();
                        });
                        $(inputs[i]).keypress(function(e) {
                            if (e.which == 13) {
                                scope.confirmAction();
                            }
                        });
                    }

                    addArrayToElement(firstStateClasses, el);

                    el.addEventListener('click', onClick);

                    function onClick(e) {
                        scope.state = !scope.state;
                        changeState(scope.state);
                    }

                    function firstState() {
                        addArrayToElement(secondStateClasses, el);

                    }

                    function secondState() {
                        removeArrayFromElement(secondStateClasses, el);

                        scope.clearData();
                    }

                    function changeState(newState) {
                        if (!newState) {
                            firstState();
                        } else {
                            secondState();
                        }
                    }

                    scope.$watch('state', function(newState, oldState) {
                        changeState(newState);
                    });

                    scope.$on('$destroy', function() {
                        $(el).off();
                        if (inputs) {
                            for (var i = 0; i < inputs.length; i++) {
                                $(inputs[i]).off();
                            }
                        }
                        if (confirmElement) {
                            $(confirmElement).off();
                        }

                        if (declineElement) {
                            $(declineElement).off();
                        }
                    });
                }
            };
        }
    ]);
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .directive('menuItem', menuItem);

    menuItem.$inject = ['$location', '$state', '$rootScope'];

    function menuItem($location, $state, $rootScope) {

        var directive = {
            restrict: 'EA',
            link: linker
        };

        return directive;

        ///////////////////////

        function linker(scope, element, attrs) {

            var menuPath = element.attr('menu-path') || element.find('a').attr('menu-path');

            var activeClass = attrs.activeClass || 'active';

            var currentState = $state.current;

            function isActive(toState, fromState) {

                var link = '/' + menuPath;

                var location = $location.$$path;

                var asset = '/asset';

                if (menuPath === toState.data.section) {

                    element.addClass(activeClass);

                } else {

                    element.removeClass(activeClass);

                }
            }

            if (currentState.data && currentState.data.section) {

                isActive(currentState);

            }

            $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams) {

                if (toState.data && toState.data.section) {

                    isActive(toState);

                }

                if (toState.data && fromState.data && toState.data.section && toState.data.section) {

                    isActive(toState, fromState);

                }
            });

        }
    }
}(window.angular));

(function (ng) {
    ng.module('app').directive('modalHeight',
        ['$window',
            function ($window, $modal) {
                return {
                    restrict: 'A',
                    link: function (scope, element) {
                        var el = element[0];

                        function resizeElement() {
                            setTimeout(function(){
                                var hgt = el.offsetHeight;
                                if (el) {
                                    if (el.offsetHeight < window.innerHeight) {
                                        el.classList.add('center');
                                        $(el).css({top:'50%', 'margin-top': '-' +hgt/2+ 'px'});
                                    }
                                    else {
                                        el.classList.remove('center');
                                        $(el).removeAttr('style');
                                    }
                                }

                            }, 300);
                        }
                        ng.element($window).on('resize', function () {
                            resizeElement();
                        });


                        ng.element($modal).on('click', function () {
                            resizeElement();
                        });

                        scope.$watch(function () {
                                return el.offsetHeight;
                            },
                            function (newValue, oldValue) {
                                if (newValue != oldValue) {
                                    resizeElement();
                                }
                            });

                    }
                };
            }]
    );
}(window.angular));

(function(ng) {
    ng.module('app').directive('randomColor', [
        function() {
            function getRandomColor() {
                return "#" + Math.random().toString(16).slice(2, 8);
            }

            return {
                restrict: 'A',
                link: function(scope, element, attrs) {
                    element[0].style.color = getRandomColor();
                }
            };
        }
    ]);
}(window.angular));

(function(ng) {
    ng.module('app').directive('scrollTo', function() {
        return function(scope, element, attrs) {
            scope.$watch(attrs.scrollTo, function(value) {
                if (value) {
                    var pos = $(element).position().top + $(element).closest('.grid-col-container').scrollTop();
                    $(element).closest('.grid-col-container').animate({
                        scrollTop: pos
                    }, 500);
                }
            });
        }
    });
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .factory('utility.common', utilityCommon);

    utilityCommon.$inject = ['$rootScope', '$timeout', '$filter', 'service.dayTime'];

    function utilityCommon($rootScope, $timeout, $filter, dayTime) {

        var service = {
            tryParseJSON: tryParseJSON,
            markNew: markNew,
            markNewDevices: markNewDevices,
            findDevice: findDevice,
            findAsset: findAsset,
            mapRuleSectionDefinitionToViewModel: mapRuleSection,
            createRuleSectionViewModel: createRuleSectionViewModel,
            resetRuleSectionViewModel: resetRuleSectionViewModel,
            toPascalCase: toPascalCase,
            limitStringLength: limitStringLength,
            mapRulePreviewToViewModel: mapRulePreview
        };

        return service;

        ////////////////////////////

        function tryParseJSON(str, successHandler, failHandler) {
            var obj;
            try {

                obj = JSON.parse(str);
                if (successHandler) {
                    successHandler(obj);
                }

            } catch (e) {

                if (failHandler) {
                    failHandler();
                }
            }

            return obj;
        }

        function limitStringLength(stringToLimit, sizeToLimit) {

            if (stringToLimit != null || stringToLimit != undefined) {

                if (stringToLimit.length > sizeToLimit) {
                    return stringToLimit.slice(0, sizeToLimit) + '...';
                } else {
                    return stringToLimit;
                }
            }
        }

        function markNewDevices(a, b) {
            var aIds = {};

            ng.forEach(a, function(obj) {
                aIds[obj.id] = obj;
            });

            ng.forEach(b, function(obj) {
                if (!aIds.hasOwnProperty(obj.id)) {
                    obj.$isNew = true;
                    $timeout(function() {
                        $rootScope.$apply(function() {
                            obj.$isNew = false;
                        });
                    }, 2000);
                }
            });
        }

        function markNew(a, b) {
            var aIds = {};

            ng.forEach(a, function(obj) {
                aIds[obj.id] = obj;
            });

            ng.forEach(b, function(obj) {
                if (!aIds.hasOwnProperty(obj.id)) {
                    obj.$isNew = true;
                    $timeout(function() {
                        $rootScope.$apply(function() {
                            obj.$isNew = false;
                        });
                    }, 2000);
                }
            });
        }

        function findDevice(devices, deviceId) {
            var found = $filter('filter')(devices, {
                id: deviceId
            }, true);

            if (found.length) {
                return found[0];
            }

            return null;
        }

        function findAsset(devices, deviceId, assetId) {
            var device = findDevice(devices, deviceId);

            if (device) {
                var foundAssets = $filter('filter')(device.assets, {
                    id: assetId
                }, true);

                if (foundAssets.length) {
                    return foundAssets[0];
                }
            }

            return null;
        }

        function findService(services, serviceId) {
            var found = $filter('filter')(services, {
                id: serviceId
            }, true);

            if (found.length) {
                return found[0];
            }

            return null;
        }

        function toPascalCase(s) {
            return s.replace(/\w+/g,
                function(w) {
                    return w[0].toUpperCase() + w.slice(1).toLowerCase();
                });
        }

        function isProfileNumeric(profileType) {

            if (profileType == 'int' || profileType == 'integer') {
                return true;
            }

            if (profileType == 'double' || profileType == 'float' || profileType == 'decimal' || profileType == 'number') {
                return true;
            }

            return false;
        }

        function isProfileBoolean(profileType) {
            if (profileType == 'bool' || profileType == 'boolean') {
                return true;
            }

            return false;
        }

        function mapRuleSection(ruleDefinition, sectionName, sectionViewModel, devices, services) {

            var defSection = null;

            var dayTimeService = dayTime.dayTime();

            for (var i = 0; i < ruleDefinition.length; i++) {
                if (ruleDefinition[i].hasOwnProperty(sectionName)) {
                    defSection = ruleDefinition[i][sectionName][0];
                } else {

                    var upperCaseSectionName = toPascalCase(sectionName);
                    if (ruleDefinition[i].hasOwnProperty(upperCaseSectionName)) {
                        defSection = ruleDefinition[i][upperCaseSectionName][0];
                    }
                }
            }

            if (!defSection) {
                return false;
            }

            var profile = null;

            if (!defSection.left) { //if there is no 'left' part in section it is assumed the rule is DeviceStateChange rule and that OnEveryChange was selected.

                mapDeviceStatePart(sectionViewModel, defSection, devices);

                sectionViewModel.selectedCompareType = 'onEveryChange';
                sectionViewModel.constantCompareOperation.op = 'OEC';

                if (!sectionViewModel.selectedAsset) {
                    sectionViewModel.missingLeftAsset = true;
                } else {
                    profile = sectionViewModel.selectedAsset.profile;
                }

                return sectionViewModel;
            }

            //Mapping left part
            if (defSection.left.service == 'asset') {

                mapDeviceStatePart(sectionViewModel, defSection.left, devices);

                if (!sectionViewModel.selectedAsset) {
                    sectionViewModel.missingLeftAsset = true;
                } else {
                    profile = sectionViewModel.selectedAsset.profile;
                }

            }

            if (defSection.left.service == 'dayTime') {
                sectionViewModel.deviceOrServiceChoice = 'service';

                if (defSection.left.sensor) {
                    sectionViewModel.selectedService = dayTimeService[0];
                }

                profile = sectionViewModel.selectedService.profile;

            }

            if (defSection.left.service == 'notify') {
                sectionViewModel.deviceOrServiceChoice = 'service';

                if (defSection.left.actuator) {
                    // sectionViewModel.selectedService = findService(services, defSection.left.actuator);
                    sectionViewModel.selectedService = services[0];
                    sectionViewModel.selectedNotifications.web = getSelectedNotifications(defSection.left.actuator, 'web');
                    sectionViewModel.selectedNotifications.push = getSelectedNotifications(defSection.left.actuator, 'push');
                    sectionViewModel.selectedNotifications.email = getSelectedNotifications(defSection.left.actuator, 'email');
                    sectionViewModel.serviceActuatorValue = defSection.left.actuator;
                }

                if (defSection.left.sensor) {
                    // sectionViewModel.selectedService = findService(services, defSection.left.sensor);
                    sectionViewModel.selectedService = services[0];
                    sectionViewModel.selectedNotifications.web = getSelectedNotifications(defSection.left.actuator, 'web');
                    sectionViewModel.selectedNotifications.push = getSelectedNotifications(defSection.left.actuator, 'push');
                    sectionViewModel.selectedNotifications.email = getSelectedNotifications(defSection.left.actuator, 'email');
                    sectionViewModel.serviceActuatorValue = defSection.left.actuator;
                }

                // profile = sectionViewModel.selectedService.profile;
            }

            //Mapping right part
            if (!defSection.right.hasOwnProperty('service')) {
                sectionViewModel.selectedCompareType = 'constant';
                sectionViewModel.constantCompareOperation.op = defSection.op;

                if (profile && profile.type == 'date') {
                    sectionViewModel.constantCompareOperation.value = new Date(defSection.right);
                } else if (profile && isProfileNumeric(profile.type)) {
                    sectionViewModel.constantCompareOperation.value = Number(defSection.right);
                } else if (profile && isProfileBoolean(profile.type)) {

                    if (typeof defSection.right == 'boolean') {
                        sectionViewModel.constantCompareOperation.value = defSection.right.toString();
                    } else {
                        sectionViewModel.constantCompareOperation.value = defSection.right;
                    }
                } else if (defSection.left.service == 'dayTime') {
                    sectionViewModel.constantCompareOperation.value = dayTime.utcCronToLocalTime(defSection.right);
                } else {
                    sectionViewModel.constantCompareOperation.value = defSection.right;
                }

            } else {

                sectionViewModel.selectedCompareType = 'reference';
                sectionViewModel.referenceCompareOperation.op = defSection.op;

                if (defSection.right.service == 'asset') {

                    sectionViewModel.referenceCompareOperation.device = findDevice(devices, defSection.right.device);

                    if (!sectionViewModel.referenceCompareOperation.device) {
                        sectionViewModel.missingRightDevice = true;
                    }

                    if (defSection.right.actuator) {
                        sectionViewModel.referenceCompareOperation.asset = findAsset(devices, defSection.right.device, defSection.right.actuator);
                    }

                    if (defSection.right.sensor) {
                        sectionViewModel.referenceCompareOperation.asset = findAsset(devices, defSection.right.device, defSection.right.sensor);
                    }

                    if (!sectionViewModel.referenceCompareOperation.asset) {
                        sectionViewModel.missingRightAsset = true;
                    }
                }

                if (defSection.right.service == 'notify') {

                    if (defSection.right.actuator) {
                        // sectionViewModel.referenceCompareOperation.service = findService(services, defSection.right.actuator);
                        sectionViewModel.referenceCompareOperation.service = services[0];
                    }

                    if (defSection.right.sensor) {
                        // sectionViewModel.referenceCompareOperation.service = findService(services, defSection.right.sensor);
                        sectionViewModel.referenceCompareOperation.service = services[0];
                    }
                }
            }

            return true;
        }

        function getSelectedNotifications(actuator, notificationType) {
            var notifications = actuator.split('/')[2].split(',');
            var isNotificationSelected = false;

            for (var i = 0; i < notifications.length; i++) {
                if (notifications[i] === notificationType) {
                    isNotificationSelected = true;
                }
            }

            return isNotificationSelected;
        }

        function mapDeviceStatePart(sectionViewModel, deviceStateConfig, devices) {

            sectionViewModel.selectedDevice = findDevice(devices, deviceStateConfig.device);
            sectionViewModel.deviceOrServiceChoice = 'device';

            if (!sectionViewModel.selectedDevice) {
                sectionViewModel.missingLeftDevice = true;
            }

            if (deviceStateConfig.actuator) {
                sectionViewModel.selectedAsset = findAsset(devices, deviceStateConfig.device, deviceStateConfig.actuator);
            }

            if (deviceStateConfig.sensor) {
                sectionViewModel.selectedAsset = findAsset(devices, deviceStateConfig.device, deviceStateConfig.sensor);
            }
        }

        function createRuleSectionViewModel(operator) {
            var sectionViewModel = {
                deviceOrServiceChoice: null,
                selectedDevice: null,
                selectedService: null,
                selectedNotifications: {
                    web: true,
                    push: false,
                    email: false
                },
                selectedCompareType: null,
                selectedAsset: null,
                constantCompareOperation: {
                    op: operator ? operator : null,
                    value: null
                },
                referenceCompareOperation: {
                    op: operator ? operator : null,
                    device: null,
                    service: null,
                    asset: null
                },
                sectionOperand: null,
                serviceActuatorValue: null
            };

            return sectionViewModel;
        }

        function mapRulePreview(ruleDefinition, sectionName, wholeSectionViewModel, devices, services) {

            var defSection = null;

            var result = null;

            var dayTimeService = dayTime.dayTime();

            for (var i = 0; i < ruleDefinition.length; i++) {
                if (ruleDefinition[i].hasOwnProperty(sectionName)) {
                    for (var j = 0; j < ruleDefinition[i][sectionName].length; j++) {
                        if (sectionName === 'when') {
                            wholeSectionViewModel.push(createRuleSectionViewModel());
                        } else {
                            wholeSectionViewModel.push(createRuleSectionViewModel('='));
                        }

                        defSection = ruleDefinition[i][sectionName][j];
                        result = mapSingleSection(defSection, sectionName, wholeSectionViewModel[j], devices, services, dayTimeService);
                    }
                } else {

                    var upperCaseSectionName = toPascalCase(sectionName);
                    if (ruleDefinition[i].hasOwnProperty(upperCaseSectionName)) {

                        for (var j = 0; j < ruleDefinition[i][sectionName].length; j++) {
                            if (sectionName === 'when') {
                                wholeSectionViewModel.push(createRuleSectionViewModel());
                            } else {
                                wholeSectionViewModel.push(createRuleSectionViewModel('='));
                            }

                            defSection = ruleDefinition[i][upperCaseSectionName][j];
                            result = mapSingleSection(defSection, sectionName, wholeSectionViewModel[j], devices, services, dayTimeService);
                        }

                        // defSection = ruleDefinition[i][upperCaseSectionName][0];
                    }
                }
            }

            return result;
        }

        function mapSingleSection(defSection, sectionName, sectionViewModel, devices, services, dayTimeService) {
            if (!defSection) {
                return false;
            }

            if (defSection.hasOwnProperty('and')) {
                defSection = defSection.and;
                sectionViewModel.sectionOperand = 'and';
            }

            if (defSection.hasOwnProperty('or')) {
                defSection = defSection.or;
                sectionViewModel.sectionOperand = 'or';
            }

            var profile = null;

            if (!defSection.left) { //if there is no 'left' part in section it is assumed the rule is DeviceStateChange rule and that OnEveryChange was selected.

                mapDeviceStatePart(sectionViewModel, defSection, devices);

                sectionViewModel.selectedCompareType = 'constant';
                sectionViewModel.constantCompareOperation.op = 'OEC';

                if (!sectionViewModel.selectedAsset) {
                    sectionViewModel.missingLeftAsset = true;
                } else {
                    profile = sectionViewModel.selectedAsset.profile;
                }

                return sectionViewModel;
            }

            //Mapping left part
            if (defSection.left.service == 'asset') {

                mapDeviceStatePart(sectionViewModel, defSection.left, devices);

                if (!sectionViewModel.selectedAsset) {
                    sectionViewModel.missingLeftAsset = true;
                } else {
                    profile = sectionViewModel.selectedAsset.profile;
                }

            }

            if (defSection.left.service == 'dayTime') {
                sectionViewModel.deviceOrServiceChoice = 'service';

                if (defSection.left.sensor) {
                    sectionViewModel.selectedService = dayTimeService[0];
                }

                profile = sectionViewModel.selectedService.profile;

            }

            if (defSection.left.service == 'notify') {
                sectionViewModel.deviceOrServiceChoice = 'service';

                if (defSection.left.actuator) {
                    // sectionViewModel.selectedService = findService(services, defSection.left.actuator);
                    sectionViewModel.selectedService = services[0];
                }

                if (defSection.left.sensor) {
                    // sectionViewModel.selectedService = findService(services, defSection.left.sensor);
                    sectionViewModel.selectedService = services[0];
                }

                // profile = sectionViewModel.selectedService.profile;
            }

            //Mapping right part
            if (!defSection.right.hasOwnProperty('service')) {
                sectionViewModel.selectedCompareType = 'constant';
                sectionViewModel.constantCompareOperation.op = defSection.op;

                if (profile && profile.type == 'date') {
                    sectionViewModel.constantCompareOperation.value = new Date(defSection.right);
                } else if (profile && isProfileNumeric(profile.type)) {
                    sectionViewModel.constantCompareOperation.value = Number(defSection.right);
                } else if (profile && isProfileBoolean(profile.type)) {

                    if (typeof defSection.right == 'boolean') {
                        sectionViewModel.constantCompareOperation.value = defSection.right.toString();
                    } else {
                        sectionViewModel.constantCompareOperation.value = defSection.right;
                    }
                } else if (defSection.left.service == 'dayTime') {
                    sectionViewModel.constantCompareOperation.value = dayTime.utcCronToLocalTime(defSection.right);
                } else {
                    sectionViewModel.constantCompareOperation.value = defSection.right;
                }

            } else {

                sectionViewModel.selectedCompareType = 'reference';
                sectionViewModel.referenceCompareOperation.op = defSection.op;

                if (defSection.right.service == 'asset') {

                    sectionViewModel.referenceCompareOperation.device = findDevice(devices, defSection.right.device);

                    if (!sectionViewModel.referenceCompareOperation.device) {
                        sectionViewModel.missingRightDevice = true;
                    }

                    if (defSection.right.actuator) {
                        sectionViewModel.referenceCompareOperation.asset = findAsset(devices, defSection.right.device, defSection.right.actuator);
                    }

                    if (defSection.right.sensor) {
                        sectionViewModel.referenceCompareOperation.asset = findAsset(devices, defSection.right.device, defSection.right.sensor);
                    }

                    if (!sectionViewModel.referenceCompareOperation.asset) {
                        sectionViewModel.missingRightAsset = true;
                    }
                }

                if (defSection.right.service == 'notify') {

                    if (defSection.right.actuator) {
                        // sectionViewModel.referenceCompareOperation.service = findService(services, defSection.right.actuator);
                        sectionViewModel.referenceCompareOperation.service = services[0];
                    }

                    if (defSection.right.sensor) {
                        // sectionViewModel.referenceCompareOperation.service = findService(services, defSection.right.sensor);
                        sectionViewModel.referenceCompareOperation.service = services[0];
                    }
                }
            }

            return true;

        }

        function resetRuleSectionViewModel(viewModel) {
            viewModel.deviceOrServiceChoice = null;
            viewModel.selectedDevice = null;
            viewModel.selectedService = null;
            viewModel.selectedNotifications.web = null;
            viewModel.selectedNotifications.push = null;
            viewModel.selectedNotifications.email = null;
            viewModel.selectedCompareType = null;
            viewModel.selectedAsset = null;
            viewModel.constantCompareOperation.op = null;
            viewModel.constantCompareOperation.value = null;
            viewModel.referenceCompareOperation.op = null;
            viewModel.referenceCompareOperation.device = null;
            viewModel.referenceCompareOperation.asset = null;
            viewModel.referenceCompareOperation.service = null;
            viewModel.sectionOperand = null;
            viewModel.serviceActuatorValue = null;

        }

    }
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .factory('service.dayTime', serviceDayTime);

    serviceDayTime.$inject = [];

    function serviceDayTime() {

        var service = {
            dayTime: returnDayTimeService,
            localTimeCronToUTCTime: generateCronForUTC,
            utcCronToLocalTime: generateCronForLocalTime
        };

        return service;
        ////////////////////////////

       function returnDayTimeService() {
           var dayTime = [{
                is: 'sensor',
                profile: {
                    type: 'cron'
                },
                id: '5412eab3da8ab71d14bfffff',
                name: 'Day and Time',
                type: 'dayTime',
                iconKey: 'fa-day-time',
                description: 'Set day and time to trigger this rule',
                detailsPage: ''
            }];

            return dayTime;
       };

       function generateCronForLocalTime (utcCron){
        var  utcTimeCron = utcCron.split(" ");
            var min = utcTimeCron[1];
            var hour = utcTimeCron[2];
            var dayOfMonth = utcTimeCron[3];
            var month = utcTimeCron[4];
            var daysOfWeek = ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'];
            var selectedDays;

            if (utcCron[5]) {
                selectedDays = utcTimeCron[5].split(",");
            }

            var offset = new Date().getTimezoneOffset();
            var localMinutes = 0;
            var cron = '0 ';
            var hours = parseInt(hour);
            var minutes = parseInt(min);


            localMinutes = hours * 60 + minutes;


            var diff = localMinutes - offset;

            var shiftDays;

            if (diff < 0) {
                if (hours == 0) {
                    hours = 24 + Math.floor(diff / 60);
                    minutes = (((minutes + 60) + offset) % 60);
                } else {
                    minutes = ((diff) % 60) * (-1);
                }
                shiftDays = 'previous';
            } else if (diff >= 1440) {
                hours = Math.floor(diff / 60) - 24;
                minutes = (diff) % 60;
                shiftDays = 'next';

            } else {

                hours = Math.floor(diff / 60);
                minutes = diff % 60;
            }


            cron += minutes + ' ';
            cron += hours + ' ';
            cron += '? * ';

            for (var i = 0; i < selectedDays.length; i++) {
                var dayOrder = daysOfWeek.indexOf(selectedDays[i]);

                if (shiftDays == 'previous') {
                    if (dayOrder > 0) {
                        cron += daysOfWeek[dayOrder - 1] + ',';
                    } else {
                        cron += daysOfWeek[daysOfWeek.length - 1] + ',';
                    }
                } else if (shiftDays == 'next') {
                    if (dayOrder == (daysOfWeek.length - 1)) {
                        cron += daysOfWeek[0] + ',';
                    } else {
                        cron += daysOfWeek[dayOrder + 1] + ',';
                    }
                } else {
                    cron += selectedDays[i] + ',';
                }

            };
            cron = cron.slice(0, -1);

            return cron;
       };



        function generateCronForUTC(localTimeCron) {

            var localCron = localTimeCron.split(" ");
            var min = localCron[1];
            var hour = localCron[2];
            var dayOfMonth = localCron[3];
            var month = localCron[4];
            var daysOfWeek = ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'];
            var selectedDays;

            if (localCron[5]) {
                selectedDays = localCron[5].split(",");
            }

            var offset = new Date().getTimezoneOffset();
            var localMinutes = 0;
            var cron = '0 ';
            var hours = parseInt(hour);
            var minutes = parseInt(min);


            localMinutes = hours * 60 + minutes;


            var diff = localMinutes + offset;

            var shiftDays;

            if (diff < 0) {
                if (hours == 0) {
                    hours = 24 + Math.floor(diff / 60);
                    minutes = (((minutes + 60) + offset) % 60);
                } else {
                    minutes = ((diff) % 60) * (-1);
                }
                shiftDays = 'previous';
            } else if (diff > 1440) {
                hours = Math.floor(diff / 60) - 24;
                minutes = (diff) % 60;
                shiftDays = 'next';

            } else {

                hours = Math.floor(diff / 60);
                minutes = diff % 60;
            }


            cron += minutes + ' ';
            cron += hours + ' ';
            cron += '? * ';

            for (var i = 0; i < selectedDays.length; i++) {
                var dayOrder = daysOfWeek.indexOf(selectedDays[i]);

                if (shiftDays == 'previous') {
                    if (dayOrder > 0) {
                        cron += daysOfWeek[dayOrder - 1] + ',';
                    } else {
                        cron += daysOfWeek[daysOfWeek.length - 1] + ',';
                    }
                } else if (shiftDays == 'next') {
                    if (dayOrder == (daysOfWeek.length - 1)) {
                        cron += daysOfWeek[0] + ',';
                    } else {
                        cron += daysOfWeek[dayOrder + 1] + ',';
                    }
                } else {
                    cron += selectedDays[i] + ',';
                }

            };
            cron = cron.slice(0, -1);

            return cron;
        }

    };
}(window.angular));
(function(ng) {
    ng
        .module('app')
        .factory('utility.deviceIcons', deviceIcons);
    deviceIcons.$inject = [];

    function deviceIcons() {

        var service = {
            getIcon: getIcon
        };

        var icons = {
            'binary-sensor': 'sl-device-flood-sensor',
            'binary-switch': 'sl-device-relay',
            'flood-sensor': 'sl-device-flood-sensor',
            'motion-sensor': 'sl-device-motion-sensor',
            'wall-plug': 'sl-device-wall-plug',
            'device-custom': 'sl-device-custom',
            'intel-edison': 'sl-device-intel-edison',
            'quick-demo': 'sl-device-mobile',
            'proximus-lora': 'sl-device-lora',
            'device-proximus-lora': 'sl-device-lora',

            gateway: 'sl-device-gateway',

            arduino: 'sl-device-arduino',
            rpi: 'sl-device-rpi',
            fa_envelope: 'sl-service-email',
            fa_day_time: 'sl-service-calendar',
            asset: 'sl-asset-default',
            sensor: 'sl-asset-sensor',
            actuator: 'sl-asset-actuator',
            virtual: 'sl-asset-virtual',
            config: 'sl-asset-config',
            custom: 'sl-device-custom'
        };

        return service;

        //////////////////////////////

        function getIcon(deviceName) {
            if (deviceName === null) {
                return icons.custom;
            }

            var icon = icons[deviceName];

            if (icon) {
                return icon;
            } else {
                return icons.custom;
            }
        }

    }
}(window.angular));

(function(ng) {
    ng.module('app').factory('utility.geoLocation', [
        '$q',
        function($q) {
            return {
                getLocation: function() {
                    if (!navigator.geolocation) {
                        return;
                    }
                    var deferred = $q.defer();
                    navigator.geolocation.getCurrentPosition(deferred.resolve, deferred.reject);
                    return deferred.promise;
                }
            }
        }
    ]);
}(window.angular));

(function (ng) {
    ng.module('app').factory('utility.googleMaps', [
        '$q',
        '$log',
        '$rootScope',
        '$document',
        '$window',
        function ($q, $log, $rootScope, $document, $window) {
            var apiKey = "AIzaSyBbahKWU9YY3eAQ2yHNJW3QENyZNG_SY8w";
            var deferred = $q.defer();

            $window.googleMapsLoadDone = function () {
                deferred.resolve($window.google);
            };

            function loadScript() {
                var script = $document[0].createElement('script');

                script.type = 'text/javascript';
                script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&callback=googleMapsLoadDone&libraries=places,geometry&key=' + apiKey;

                $document[0].head.appendChild(script);
            }

            if (!ng.isDefined($window.google)) {
                loadScript();
            }

            return deferred.promise;
        }
    ]);
}(window.angular));

(function() {

    var app = angular
        .module('app')
        .factory('httpTokenInterceptor', HttpTokenInterceptor);

    HttpTokenInterceptor.$inject = [
        '$q',
        '$injector',
        'api.url',
        'localStorageService',
        'session'
    ];

    function HttpTokenInterceptor($q, $injector, apiUrl, localStorageService, session) {

        var service = {
            request: request,
            responseError: responseError
        };

        return service;

        ///////////////////////

        function request(config) {

            if (isAttApi(config.url)) {
                config.headers = config.headers || {};

                var accessToken = session.authentication().accessToken;

                if (accessToken && !config.headers.Authorization) {
                    config.headers.Authorization = 'Bearer ' + accessToken;
                }
            }

            return config || $q.when(config);
        }

        function responseError(rejection) {

            var deferred = $q.defer();

            if (rejection.status === 401 && isAttApi(rejection.config.url)) {

                if (rejection.config.__donotrefreshtoken) {
                    deferred.reject(rejection);
                    return deffered.promise;
                }

                var state = $injector.get('$state');

                if (!rejection.config.__tokenrefreshed) {

                    var authService = $injector.get('authService');
                    var refreshToken = session.authentication().refreshToken;

                    session.clearAuthenticationData();

                    if (refreshToken !== null) {
                        authService.refreshToken(refreshToken)
                            .then(function() {
                                rejection.config.__tokenrefreshed = true;
                                var config = rejection.config;
                                delete config.headers.Authorization;
                                retryHttpRequest(rejection.config, deferred);
                            })
                            .catch(function() {
                                state.go('login');
                            });
                    } else {
                        state.go('login');
                    }

                } else {
                    state.go('unauthorized');
                }

            } else {

                deferred.reject(rejection);
            }

            return deferred.promise;
        }

        function isAttApi(url) {
            return url.substring(0, apiUrl.length) == apiUrl;
        }

        function retryHttpRequest(config, deferred) {

            var $http = $injector.get('$http');

            $http(config)
                .then(function(response) {
                    deferred.resolve(response);
                })
                .catch(function(response) {
                    deferred.reject(response);
                });
        }

        function getKeyFromLocalStorageAuth(key) {

            var auth = session.authentication();

            return (auth && auth[key]) ? auth[key] : null;
        }
    }

    app.config(['$httpProvider', function($httpProvider) {

        $httpProvider.interceptors.push('httpTokenInterceptor');

    }]);

}());

(function(ng) {
    ng.module('app').factory('utility.inputStateValidator', [
        function() {
            function isEmpty(val) {
                if (val == '' || !val) {
                    return false;
                }
                return true;
            }

            return {
                isValidInteger: function(val) {
                    if (!isEmpty(val)) {
                        return false;
                    }
                    return !isNaN(val);
                },

                isValidString: function(val) {
                    if (!isEmpty(val)) {
                        return false;
                    }
                    return true;
                },

                isValidBoolean: function(val) {
                    if (!isEmpty(val)) {
                        return false;
                    }

                    if (val == 'true' || val == 'false') {
                        return true;
                    }
                    return false;
                },

                isValidJson: function(val) {
                    if (!isEmpty(val)) {
                        return false;
                    }

                    try {
                        ng.fromJSON(val);
                        return true;
                    } catch (e) {
                        return false;
                    }
                },


                validateByType: function(type, val) {
                    switch (type) {
                        case 'bool':
                            return this.isValidBoolean(val);
                        case 'int':
                            return this.isValidInteger(val);
                        case 'string':
                            return this.isValidString(val);
                        case 'json':
                            return this.isValidJson(val);
                    }
                    return false;
                }

            };
        }
    ]);
}(window.angular));

(function() {

    angular
        .module('app')
        .factory('session', session);

    session.$inject = ['$q', '$log', 'localStorageService', '$rootScope', 'notifyService'];

    function session($q, $log, localStorageService, $rootScope, notifyService) {

        var service = {
            init: init,
            authentication: getAuthenticationData,
            saveAuthenticationData: saveAuthenticationData,
            clearAuthenticationData: clearAuthenticationData,
            getUserDetails: getUserDetails,
            setUserDetails: setUserDetails
        };

        return service;

        //////////////////////////////////////////////

        function init() {

            if (!getAuthenticationData()) {

                clearAuthenticationData();

            }

            $rootScope.getCurrentUser = function() {

                return getAuthenticationData();

            };
        }

        function getAuthenticationData() {

            var data = localStorageService.get('authenticationData');

            if (isValidAccessToken(data)) {

                data.isAuth = true;

            }

            return data;
        }

        function saveAuthenticationData(data) {

            if (data) {

                data.isAuth = true;

            }

            localStorageService.set('authenticationData', {
                accessToken: data.access_token,
                refreshToken: data.refresh_token,
                issued: data['.issued'],
                expires: data['.expires'],
                rmq: {
                    clientId: data['rmq:clientId'],
                    clientKey: data['rmq:clientKey']
                },
                userName: data.userName,
                isAuth: data.isAuth
            });
        }

        function clearAuthenticationData() {

            localStorageService.set('authenticationData', {
                accessToken: null,
                refreshToken: null,
                issued: null,
                expires: null,
                rmq: null,
                userName: '',
                isAuth: false
            });

            localStorageService.set('userDetails', null);
        }

        function setUserDetails(data) {

            localStorageService.set('userDetails', data);

        }

        function getUserDetails() {

            return localStorageService.get('userDetails');

        }

        function isValidAccessToken(data) {

            if (data) {

                return new Date(data.expires) > new Date();

            } else {

                return false;

            }
        }

    }
}());

(function(ng) {
    ng.module('app').factory('utility.typeConverter', function() {
        return function(toType, fromType) {
            switch (toType) {
                case 'int':
                    return parseInt(fromType);
                case 'string':
                    return fromType;
                case 'bool':
                    if (fromType == 'true') return true;
                    else return false;
                case 'json':
                    return fromType;
            }
        };
    });
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('validatorHelper', factory);

    factory.$inject = [];

    function factory() {

        function ValidatorHelper() {
            this.hideUsernameInputError = true;
            this.hideFullNameInputError = true;
            this.hideEmailInputError = true;
            this.hidePasswordInputError = true;
            this.hideGroundNameInputError = true;
            this.usernamePattern = '^[a-zA-Z0-9_]{1,30}$';

        }

        ValidatorHelper.prototype.onUsernameFocus = function() {
            var that = this;
            that.hideUsernameInputError = false;
        };

        ValidatorHelper.prototype.onUsernameBlur = function() {
            var that = this;
            that.hideUsernameInputError = true;
        };

        ValidatorHelper.prototype.onFullNameFocus = function() {
            var that = this;
            that.hideFullNameInputError = false;
        };

        ValidatorHelper.prototype.onFullNameBlur = function() {
            var that = this;
            that.hideFullNameInputError = true;
        };

        ValidatorHelper.prototype.onEmailFocus = function() {
            var that = this;
            that.hideEmailInputError = false;
        };

        ValidatorHelper.prototype.onEmailBlur = function() {
            var that = this;
            that.hideEmailInputError = true;
        };

        ValidatorHelper.prototype.onPasswordFocus = function() {
            var that = this;
            that.hidePasswordInputError = false;
        };

        ValidatorHelper.prototype.onPasswordBlur = function() {
            var that = this;
            that.hidePasswordInputError = true;
        };

        ValidatorHelper.prototype.onGroundNameFocus = function() {
            var that = this;
            that.hideGroundNameInputError = false;
        };

        ValidatorHelper.prototype.onGroundNameBlur = function() {
            var that = this;
            that.hideGroundNameInputError = true;
        };

        return ValidatorHelper;
    }
})();

(function(ng) {
    ng.module('app').factory('utility.viewConfigs', [

        function() {

            var jsonEditorOptions = {
                lineWrapping: true,
                lineNumbers: false,
                mode: 'application/json',
                theme: 'neo',
                smartIndent: true,
                indentUnit: 4,
                tabSize: 4
            };

            return {
                getJsonEditorOptions: function() {
                    return jsonEditorOptions;
                }
            }
        }
    ]);
}(window.angular));

(function(ng) {

    ng.module('app').filter('assetTypeFilter', function() {
        return function(items, assetType) {
            var filtered = [];

            if (!items) {
                return filtered;
            }

            if (!assetType) {
                return items;
            }

            for (var assetIndex = 0; assetIndex < items.length; assetIndex++) {
                if (items[assetIndex].is == assetType || items[assetIndex].is == 'virtual') {
                    filtered.push(items[assetIndex]);
                }
            }

            return filtered;
        };
    });

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .filter('assetValueFormat', assetValueFormatFilter);

    assetValueFormatFilter.$inject = ['api.assetsService', '$filter'];

    function assetValueFormatFilter(assetsService, $filter) {
        return function(item, profile) {

            if (!profile) {
                return item;
            }

            if (!profile.type) {
                return item;
            }

            var profileType = assetsService.normalizeProfileType(profile.type);

            if (profileType == 'datetime') {
                return $filter('amDateFormat')(item, 'MMMM Do YYYY');
            }

            if (profileType == 'cron') {
                return $filter('cronFilter')(item);
            }

            return item;
        };
    }
}(window.angular));

(function(ng) {

    ng.module('app').filter('capitalize', function() {
        return function(input, scope) {
            if (!input) {
                return;
            }

            input = input.toLowerCase();
            return input.substring(0, 1).toUpperCase() + input.substring(1);
        };
    });

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .filter('cronFilter', cronFilter);

    cronFilter.$inject = [];

    function cronFilter() {
        return function(item) {
            var prettyCron = '';

            if (item) {

                var cron = item.split(" ");
                var min = cron[1];
                var hour = cron[2];
                var dayOfMonth = cron[3];
                var month = cron[4];
                var daysOfWeek;
                var timeOfDay = 'AM';

                var days = '';
                if (cron[5]) {
                    daysOfWeek = cron[5].split(",");

                    for (var i = 0; i < daysOfWeek.length; i++) {

                        switch (daysOfWeek[i]) {
                            case 'MON':
                                days += "Monday, ";
                                break;
                            case 'TUE':
                                days += "Tuesday, ";
                                break;
                            case 'WED':
                                days += "Wednesday, ";
                                break;
                            case 'THU':
                                days += "Thursday, ";
                                break;
                            case 'FRI':
                                days += "Friday, ";
                                break;
                            case 'SAT':
                                days += "Saturday, ";
                                break;
                            case 'SUN':
                                days += "Sunday, ";
                                break;
                        }
                    }
                }

                if (daysOfWeek) {
                    if (daysOfWeek[0] == '*') {
                        return "This rule will not trigger without any selected day!"
                    }
                }

                if (days == 'Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday, ') {
                    prettyCron += 'Every weekday';
                } else if (days == 'Saturday, Sunday, ') {
                    prettyCron += 'Every weekend';
                } else if (days == 'Monday, Tuesday, Wednesday, Thursday, Friday, ') {
                    prettyCron += 'Every workday';
                } else {
                    prettyCron += days.slice(0, -2);
                }

                prettyCron += ' at ';

                var cHour = parseInt(hour);
                var normalizedHours = null;
                var normalizedMinutes = null;

                if (min == '0' || min == '5') {
                    normalizedMinutes = '0' + min;
                } else {
                    normalizedMinutes = min;
                }

                if (cHour > 12 && cHour < 24) {
                    timeOfDay = 'PM';
                    normalizedHours = (hour - 12).toString();
                    if (parseInt(normalizedHours) < 10) {
                        prettyCron += '0' + normalizedHours + ':' + normalizedMinutes + ' ' + timeOfDay;
                    } else {
                        prettyCron += normalizedHours + ':' + normalizedMinutes + ' ' + timeOfDay;
                    }

                } else if (cHour < 12) {
                    timeOfDay = 'AM';
                    if (cHour < 10) {
                        prettyCron += '0' + cHour.toString() + ':' + normalizedMinutes + ' ' + timeOfDay;
                    } else {
                        prettyCron += cHour.toString() + ':' + normalizedMinutes + ' ' + timeOfDay;
                    }
                } else if (cHour == 12) {
                    timeOfDay = 'PM';
                    prettyCron += cHour.toString() + ':' + normalizedMinutes + ' ' + timeOfDay;

                } else if (cHour == 0) {
                    timeOfDay = 'AM';
                    prettyCron += cHour.toString() + ':' + normalizedMinutes + ' ' + timeOfDay;
                } else if (cHour == 24) {
                    timeOfDay = 'AM';
                    prettyCron += '00' + ':' + normalizedMinutes + ' ' + timeOfDay;
                }
            }

            return prettyCron;
        };
    }
}(window.angular));

(function(ng) {

    ng
        .module('app')
        .filter('devicesWithAssetFilter', devicesWithAssetFilterFactory);

    function devicesWithAssetFilterFactory() {

        return filterMethod;

        ////////

        function filterMethod(items, assetType) {

            if (!items) {
                return [];
            }

            if (!assetType) {
                return items;
            }

            if (assetType == '*') {
                return findDevicesContainingAnyAsset(items);
            }

            return findDevicesContainingAssetsOfType(items, assetType);
        }

        function findDevicesContainingAnyAsset(items) {

            var filtered = [];

            for (var deviceIndex = 0; deviceIndex < items.length; deviceIndex++) {
                if (items[deviceIndex].assets.length > 0) {
                    filtered.push(items[deviceIndex]);
                }
            }

            return filtered;
        }

        function findDevicesContainingAssetsOfType(items, assetType) {

            var filtered = [];

            for (var deviceIndex = 0; deviceIndex < items.length; deviceIndex++) {
                for (var assetIndex = 0; assetIndex < items[deviceIndex].assets.length; assetIndex++) {
                    if (items[deviceIndex].assets[assetIndex].is == assetType || items[deviceIndex].assets[assetIndex].is == 'virtual') {
                        filtered.push(items[deviceIndex]);
                        break;
                    }

                }
            }

            return filtered;
        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .controller('TermsOfUseController', TermsOfUseController);

    TermsOfUseController.$inject = ['$state', 'termsOfUseRepository', 'userContext'];

    function TermsOfUseController($state, termsOfUseRepository, userContext) {

        var vm = this;

        vm.termsOfUseHtml = null;

        vm.acceptTerms = acceptTerms;

        vm.showAcceptButton = userContext.user && !userContext.user.termsAcceptedOn;

        activate();

        ////////////////

        function activate() {

            termsOfUseRepository.getTermsOfUse()
                .then(function(termsOfUseHtml) {

                    vm.termsOfUseHtml = termsOfUseHtml;

                });
        }

        function acceptTerms() {

            termsOfUseRepository.acceptTermsOfUse()
                .then(function() {

                    userContext.load().then(function() {

                        $state.go('home');

                    });

                });

        }
    }
})();

(function() {

    var app = angular
        .module('app')
        .factory('ToUInterceptor', ToUInterceptor);

    ToUInterceptor.$inject = [
        '$q',
        '$injector',
        'api.url',
        'localStorageService',
        'session'
    ];

    function ToUInterceptor($q, $injector, apiUrl, localStorageService, session) {

        var service = {
            request: request
        };

        return service;

        ///////////////////////

        function request(config) {

            if (isAttApi(config.url)) {

                var userDetails = session.getUserDetails();

                if (userDetails && !userDetails.termsAcceptedOn && !config.__ingoreTermsOfUseAcceptance) {

                    var state = $injector.get('$state');

                    state.go('termsOfUse');

                    return $q.reject({ isSilentError: true });
                }

            }

            return config || $q.when(config);
        }

        function isAttApi(url) {

            return url.substring(0, apiUrl.length) == apiUrl;

        }
    }

    app.config(['$httpProvider', function($httpProvider) {

        $httpProvider.interceptors.push('ToUInterceptor');

    }]);

}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('termsOfUseRepository', factory);

    factory.$inject = ['utils', 'session', '$http', 'api.url', 'termsOfUseCDNUrl'];

    function factory(utils, session, $http, apiUrl, termsOfUseCDNUrl) {

        var service = {
            getTermsOfUse: getTermsOfUse,
            acceptTermsOfUse: acceptTermsOfUse
        };

        return service;

        ////////////////

        function getTermsOfUse() {

            return $http.get(termsOfUseCDNUrl)
                .then(function(response) {

                    return response.data;

                });
        }

        function acceptTermsOfUse() {

            var url = apiUrl + 'terms/latest/acceptance';

            return $http.post(url, null, {

                __ingoreTermsOfUseAcceptance: true

            });

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('awaitingContent', awaitingContent);

    awaitingContent.$inject = [];

    function awaitingContent() {

        var directive = {
            link: link,
            restrict: 'A'
        };

        return directive;

        function link(scope, element, attrs) {

            attrs.$observe('awaitingContent', function(val) {

                if (!val) {

                    var loaderElement = element.find('loader-wrapper');

                    if (loaderElement.length) {

                        loaderElement.show();

                    } else {

                        element.append('<loader-wrapper class="small overlay-loader">' +
                            '<loader>' +
                            '<ld/>' +
                            '<ld/>' +
                            '<ld/>' +
                            '</loader>' +
                            '</loader-wrapper>');

                    }
                } else {

                    element.find('loader-wrapper').hide();

                }
            });
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('buttonLoadMore', buttonLoadMore);

    function buttonLoadMore() {

        // Usage:
        // function 'load', linked using scope property 'load' needs to return promise
        var directive = {
            templateUrl: '/assets/js/app/widgets/button-load-more.html',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                load: '&',
                size: '='
            }
        };
        return directive;
    }

    function Controller() {

        var vm = this;
        vm.isLoading = false;
        vm.hasError = false;
        vm.loadMore = loadMore;
        vm.thereIsNoMoreItems = false;

        function loadMore() {

            if (vm.load) {

                vm.isLoading = true;
                vm.hasError = false;

                vm.load().then(function(result) {
                    if (result && angular.isArray(result)) {

                        if (vm.size > result.length) {
                            vm.thereIsNoMoreItems = true;
                        }
                    }

                    return result;
                }).catch(function() {
                    vm.hasError = true;
                }).
                finally(function() {
                    vm.isLoading = false;
                });
            }
        }
    }
})();

(function() {

    angular
        .module('app')
        .directive('controlHandler', controlHandler);

    controlHandler.$inject = ['$compile', 'asset.repository', 'api.controlsService', 'utils'];

    function controlHandler($compile, assetRepository, controlsService, utils) {

        var directive = {
            restrict: 'E',
            link: linker,
            scope: {
                controlName: '=',
                asset: '=',
                enabled: '='
            }
        };

        return directive;

        ///////////////////////////

        function getControl(asset) {

            var widgetName = null;

            if (asset.control && asset.control.name) {

                widgetName = asset.control.name;

            } else {

                widgetName = controlsService.getDefaultControl(asset);

            }

            var template = '<{0}-control enabled="enabled" value="asset.state.value" profile="asset.profile" id="asset.id" on-change="onChange(val)" asset="asset" configuration="asset.control.extras"></{0}-control>'.format(widgetName);

            return template;

        }

        function linker(scope, element, attrs) {

            scope.onChange = function(val) {

                if (scope.enabled) {

                    return assetRepository.publishCommand(scope.asset.id, val);

                }

                return utils.$q.when();

            };

            scope.$watch('asset.control.name', function() {
                element.html(getControl(scope.asset));

                $compile(element.contents())(scope);

            });
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('flexTextarea', flexTextarea);

    flexTextarea.$inject = ['$timeout'];

    function flexTextarea($timeout) {

        var directive = {
            bindToController: true,
            transclude: true,
            controller: FlexTextController,
            templateUrl: '/assets/js/app/widgets/flex-textarea.html',
            controllerAs: 'vm',
            link: link,
            replace: true,
            restrict: 'E',
            scope: {
                data: '=',
                saved: '='
            }
        };
        return directive;

        function link(scope, element, attrs, ctrl, transclude) {

            var textarea = element.find('textarea');
            var oldValue = '';

            if (textarea) {

                $(textarea).click(function() {
                    $timeout(function() {
                        oldValue = textarea.val();
                    }, 1);
                });

                element.find('to-replace').replaceWith(transclude());

                if (textarea) {
                    $(textarea).focusout(function(e) {

                        $timeout(function() {

                            if (!scope.vm.saved) {
                                scope.$apply(function() {
                                    scope.vm.data = oldValue;
                                });
                            }
                        }, 100);
                    });
                }
            }
        }

        function FlexTextController() {

        }
    }
})();

(function(ng) {

    ng
        .module('app')
        .directive('focusIf', FocusIf);

    FocusIf.$inject = ['$timeout'];

    function FocusIf($timeout) {

        var directive = {
            restrict: 'A',
            link: linker
        };

        return directive;
        
        ////////////////////////

        function linker(scope, element, attrs) {

            var focusClass = attrs.focusClass;

            if (!focusClass)
                focusClass = 'focus';

            scope.$watch(attrs.focusIf, watchHandler);

            function watchHandler(value) {

                if (value) {

                    $(element[0]).addClass(focusClass);

                    $timeout(function() {
                        $(element[0]).removeClass(focusClass);
                    }, 1000);
                }
            }
        }

        function randomString(length, chars) {
            var mask = '';
            if (chars.indexOf('a') > -1) mask += 'abcdefghijklmnopqrstuvwxyz';
            if (chars.indexOf('A') > -1) mask += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (chars.indexOf('#') > -1) mask += '0123456789';
            if (chars.indexOf('!') > -1) mask += '~`!@#$%^&*()_+-={}[]:";\'<>?,./|\\';
            var result = '';
            for (var i = length; i > 0; --i) result += mask[Math.round(Math.random() * (mask.length - 1))];
            return result;
        }

    }
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .directive('pageLoader', pageLoader);

    function pageLoader() {

        return {
            restrict: 'EA',
            link: function(scope, element) {
                // Store original display mode of element
                var shownType = element.css('display');

                scope.$on('$routeChangeStart', function() {
                    element.removeClass('hidden');
                });

                scope.$on('$routeChangeError', function() {
                    element.addClass('hidden');
                });

                scope.$on('$routeChangeEnd', function() {
                    element.addClass('hidden');
                });

                // Initially hidden
                hideElement();
            }
        };
    }
})();

(function(ng) {
    ng
        .module('app')
        .directive('scrollIf', scrollIf);

    scrollIf.$inject = ['$timeout', '$window'];

    function scrollIf($timeout, $window) {

        return function(scope, el, attrs) {

            scope.$watch(attrs.scrollIf, watchHandler);

            function watchHandler(value) {

                $timeout(function() {

                    if (value) {

                        var scrollingParent = getScrollingParent(el[0]);
                        var centerScroll = scrollingParent.scrollHeight;
                        
                        $(scrollingParent).animate({
                            scrollTop: centerScroll
                        }, 1000);
                    }
                });
            }

            function getScrollingParent(element) {
                element = element.parentElement;
                while (element) {
                    if (element.scrollHeight !== element.clientHeight) {
                        return element;
                    }
                    element = element.parentElement;
                }
                return null;
            };
        };
    };

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .directive('subscribedIndicator', subscribedIndicator);

    function subscribedIndicator() {

        var directive = {
            bindToController: true,
            controller: Controller,
            templateUrl: '/assets/js/app/widgets/subscribed-indicator.html',
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                itemId: '='
            }
        };
        return directive;
    }

    Controller.$inject = ['GroundContext'];

    function Controller(groundContext) {

        var vm = this;
        vm.isSubscribed = isSubscribed;

        function isSubscribed() {

            var ground = groundContext.find(vm.itemId);

            if (!ground) {
                return false;
            }

            return ground.isSubscribed();
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('slTabs', slTabs);

    function slTabs() {

        var directive = {

            template: '<div class="tab-panel">' +
                '<ul class="tab-control-header">' +
                ' <li ng-class="{ active:tab.active }" ng-repeat="tab in vm.tabs | orderBy:\'order\' track by $index">' +
                ' <a id="{{tab.name}}" ng-click="vm.select(tab)"><i ng-if="tab.icon" class="{{tab.icon}}"></i><span>{{tab.heading}}</span></a>' +
                ' </li>' +
                '</ul>' +
                '<ng-transclude class="tab-holder">' +
                '</ng-transclude>' +
                '</div>',
            bindToController: true,
            replace: true,
            transclude: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                onTabClick: '&',
                activeTab: '=?'
            }
        };
        return directive;
    }

    Controller.$inject = ['$scope', 'orderByFilter'];

    function Controller($scope, orderByFilter) {

        var vm = this;
        vm.tabs = [];
        vm.activeTab = null;
        vm.select = select;
        vm.selectByName = selectByName;
        vm.addTab = addTab;
        vm.removeTab = removeTab;

        $scope.$watch('vm.activeTab', function(tabName) {
            if (tabName) {
                selectByName(tabName);
            }
        });

        function select(selectedTab) {

            vm.activeTab = selectedTab.name;

            if (vm.onTabClick) {
                vm.onTabClick();
            }
        }

        function selectByName(tabName) {
            angular.forEach(vm.tabs, function(tab) {

                if (tab.name !== tabName) {
                    tab.active = false;
                } else {
                    tab.active = true;
                }
            });
        }

        function addTab(tab) {

            vm.tabs.push(tab);
            if (vm.tabs.length === 1) {
                tab.active = true;
            }

            if (!vm.activeTab) {
                if (vm.tabs.length === 1) {
                    tab.active = true;
                } else {
                    if (tab.order) {
                        selectByName(orderByFilter(vm.tabs, 'order')[0].name);
                    }
                }
            }

        }

        function removeTab(tab) {

            var index = vm.tabs.indexOf(tab);
            if (index !== -1) {

                vm.tabs.splice(index, 1);

                if (tab.active && vm.tabs.length > 0) {
                    vm.tabs[0].active = true;
                }
            }
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('slTab', slTab);

    function slTab() {

        var directive = {
            link: link,
            restrict: 'E',
            transclude: true,
            template: '<div role="tabpanel" ng-show="active" ng-transclude></div>',
            require: '^slTabs',
            scope: {
                heading: '@',
                icon: '@',
                name: '@',
                order: '@'
            }
        };
        return directive;

        function link($scope, elem, attr, tabsetCtrl) {

            $scope.active = false;
            tabsetCtrl.addTab($scope);

            $scope.$on('$destroy', function() {
                console.log('destroy tab has been called');
                tabsetCtrl.removeTab($scope);
            });
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('app.config', appConfig);

    appConfig.$inject = [
        'api.url',
        'api.clientId',
        'broker.url',
        'broker.port',
        'broker.sourceRoot',
        'public.token',
        'public.clientId',
        'public.clientKey',
        'public.urlShortenerApiKey',
        'public.urlShortenerApiUrl',
        'origin'
    ];

    function appConfig(apiUrl, apiClientId, brokerUrl, brokerPort, brokerSourceRoot, publicToken, publicClientId, publicClientKey, urlShortenerApiKey, urlShortenerApiUrl, origin) {
        var service = {
            api: {
                url: apiUrl,
                clientId: apiClientId
            },
            broker: {
                url: brokerUrl,
                port: brokerPort,
                sourceRoot: brokerSourceRoot
            },
            guest: {
                token: publicToken,
                clientId: publicClientId,
                clientKey: publicClientKey
            },
            urlShortener: {
                key: urlShortenerApiKey,
                url: urlShortenerApiUrl
            },
            origin: origin
        };
        return service;
    }
})();

(function() {

    angular
        .module('app')
        .factory('exception', exception);

    exception.$inject = ['$log', 'logger', 'utils'];

    function exception($log, logger, utils) {

        var service = {
            catcher: catcher
        };

        return service;

        /////////////////////////

        function catcher(message) {

            return function(reason) {

                var errorMessage = message;

                if (isClientError(reason)) {

                    var msg = getErrorMessage(reason);

                    if (msg) {

                        errorMessage = msg;

                    }

                }

                if (!reason.isSilentError) {

                    logger.error(errorMessage, reason, 'Error: ');

                }

                return utils.$q.reject(reason);
            };
        }

        function isClientError(reason) {

            return reason.status >= 400 && reason.status <= 499;

        }

        function getErrorMessage(reason) {

            if (reason.data) {

                if (reason.data.error_description) {

                    return reason.data.error_description;

                }

                if (reason.data.error) {

                    return reason.data.error;

                }

                if (reason.data.message) {

                    return reason.data.message;

                }

            }

            return undefined;

        }
    }

}());

// (function(ng) {

//     ng
//         .module('app')
//         .provider('exceptionHandler', exceptionHandlerProvider)
//         .config(config);

//     /**
//      * Must configure the exception handling
//      * @return {[type]}
//      */
//     function exceptionHandlerProvider() {
//         /* jshint validthis:true */
//         this.config = {
//             appErrorPrefix: undefined
//         };

//         this.configure = function(appErrorPrefix) {
//             this.config.appErrorPrefix = appErrorPrefix;
//         };

//         this.$get = function() {
//             return {
//                 config: this.config
//             };
//         };
//     }

//     /**
//      * Configure by setting an optional string value for appErrorPrefix.
//      * Accessible via config.appErrorPrefix (via config value).
//      * @param  {[type]} $provide
//      * @return {[type]}
//      */

//     config.inject = ['$provide'];

//     function config($provide) {
//         $provide.decorator('$exceptionHandler', extendExceptionHandler);
//     }

//     *
//      * Extend the $exceptionHandler service to also display a toast.
//      * @param  {Object} $delegate
//      * @param  {Object} exceptionHandler
//      * @param  {Object} logger
//      * @return {Function} the decorated $exceptionHandler service
     

//     extendExceptionHandler.$inject = ['$delegate', 'exceptionHandler', 'logger'];

//     function extendExceptionHandler($delegate, exceptionHandler, logger) {
//         return function(exception, cause) {
//             var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
//             var errorData = {
//                 exception: exception,
//                 cause: cause
//             };
//             exception.message = appErrorPrefix + exception.message;
//             $delegate(exception, cause);
//             /**
//              * Could add the error to a service's collection,
//              * add errors to $rootScope, log errors to remote web server,
//              * or log locally. Or throw hard. It is entirely up to you.
//              * throw exception;
//              *
//              * @example
//              *     throw { message: 'error message we added' };
//              */
//             logger.error(exception.message, errorData, 'Error');
//         };
//     }
// }(window.angular));
(function() {

    angular
        .module('app')
        .factory('logger', logger);

    logger.$inject = ['$log', 'notifyService'];

    function logger($log, notifyService) {

        var service = {

            error: error,
            info: info,
            success: success,
            warning: warning

        };

        return service;

        /////////////////////

        function error(message, data, title) {

            notifyService.error(title, message, null, true);

            $log.error('Error: ' + message, data);

        }

        function info(message, data, title) {

            notifyService.info(title, message);

            $log.info('Info: ' + message, data);

        }

        function success(message, data, title) {

            notifyService.success(title, message);

            $log.info('Success: ' + message, data);

        }

        function warning(message, data, title) {

            notifyService.warning(title, message);

            $log.warn('Warning: ' + message, data);

        }
    }

}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('messaging.gateway', factory);

    factory.$inject = ['$window', 'app.config', 'utils'];

    function factory($window, appConfig, utils) {

        function Gateway() {

            this.isConnected = false;
            this.clientId = null;
            this.clientKey = null;
            $window.CappMessaging.brokerUrl = appConfig.broker.url;
            $window.CappMessaging.brokerPort = appConfig.broker.port;
            $window.CappMessaging.sourceRoot = appConfig.broker.sourceRoot;
        }

        Gateway.prototype.connect = function(clientId, clientKey, failHandler) {

            this.clientId = clientId;
            this.clientKey = clientKey;

            saveClient(clientId, clientKey);

            var that = this;

            var deffered = utils.$q.defer();

            var disconnectPromise = that.disconnect();

            disconnectPromise.then(function() {

                $window.CappMessaging.connect(clientId, clientKey, function() {
                        deffered.resolve();
                        that.connected = true;
                    },

                    function() {
                        deffered.reject();
                        that.connected = false;

                        if (failHandler) {
                            failHandler();
                        }
                    });
            });

            return deffered.promise;
        };

        Gateway.prototype.disconnect = function() {

            var that = this;
            var deffered = utils.$q.defer();

            $window.CappMessaging.disconnect(function() {
                deffered.resolve();
                that.connected = false;
            });

            return deffered.promise;
        };

        Gateway.prototype.subscribe = function(topic, callbackFn, subscriptionCallbackFn) {

            $window.CappMessaging.subscribe(topic, callbackFn, subscriptionCallbackFn);
        };

        Gateway.prototype.unsubscribe = function(sub) {

            $window.CappMessaging.unsubscribe(sub);
        };

        Gateway.prototype.publish = function(topic, payload) {

            $window.CappMessaging.publish(topic, payload);
        };

        function saveClient(clientId, clientKey) {

            $window.CappMessaging.clientId = clientId;
            $window.CappMessaging.clientKey = clientKey;
        }

        return new Gateway();
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('messaging.parser', factory);

    factory.$inject = ['utils'];

    function factory(utils) {

        var service = {
            parseMessage: parseMessage,
            getMessageTopic: getMessageTopic
        };

        return service;

        ////////////////

        function parseMessage(topic, payload) {

            var topicElements = topic.split('.');
            var info = {
                name: '',
                data: {
                    payload: payload
                }
            };

            if (isMatch('ground.%.in.asset.%.state', topicElements)) {
                info.name = 'asset.state';
                info.data.groundId = topicElements[1];
                info.data.assetId = topicElements[4];
                return info;
            }

            if (isMatch('client.%.in.asset.%.state', topicElements)) {
                info.name = 'asset.state';
                info.data.assetId = topicElements[4];
                return info;
            }

            if (isMatch('ground.%.in.activity', topicElements)) {
                info.name = 'ground.activity';
                info.data.groundId = topicElements[1];
                return info;
            }

            if (isMatch('client.%.in.asset.%.event', topicElements)) {

                if (payload.Name === 'create') {
                    info.name = 'asset.created';
                    info.data.assetId = topicElements[4];
                }

                if (payload.Name === 'delete') {
                    info.name = 'asset.deleted';
                    info.data.assetId = topicElements[4];
                }

                return info;
            }

            if (isMatch('client.%.in.device.%.asset.%.command', topicElements)) {
                info.name = 'asset.command';
                info.data.assetId = topicElements[6];
                return info;
            }

            if (isMatch('client.%.in.device.%.event', topicElements)) {

                if (payload.Name === 'create') {
                    info.name = 'device.created';
                    info.data.deviceId = topicElements[4];
                }

                if (payload.Name === 'delete') {
                    info.name = 'device.deleted';
                    info.data.deviceId = topicElements[4];
                }

                return info;
            }

            if (isMatch('client.%.in.gateway.%.event', topicElements)) {

                if (payload.Name === 'create') {
                    info.name = 'gateway.created';
                    info.data.gatewayId = topicElements[4];
                }

                if (payload.Name === 'delete') {
                    info.name = 'gateway.deleted';
                    info.data.gatewayId = topicElements[4];
                }

                return info;
            }

            return info;
        }

        function isMatch(topicPattern, topicElements) {

            var patternElements = topicPattern.split('.');

            if (patternElements.length !== topicElements.length) {
                return false;
            }

            var match = true;
            for (var i = 0; i < patternElements.length; i++) {

                if (patternElements[i] !== topicElements[i]) {

                    if (patternElements[i] !== '%') {
                        match = false;
                    }
                }
            }

            return match;
        }

        function getMessageTopic(clientId, action, entity) {

            var topic = null;

            if (action === 'command') {
                topic = 'client.{0}.in.device.{1}.asset.{2}.command'.format(
                    clientId,
                    entity.deviceId,
                    entity.id);
            }

            if (action === 'state') {
                topic = 'client.{0}.out.asset.{1}.state'.format(
                    clientId,
                    entity.id);
            }

            return topic;
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('messaging.relay', factory);

    factory.$inject = ['messaging.gateway', 'utils', 'session', 'userContext', 'messaging.parser', 'NotificationModel'];

    function factory(messagingGateway, utils, session, userContext, parser, Notification) {

        var notificationSubscription = null;
        var groundSubscription = null;

        var reconnectAttemptCount = 0;

        //how many times to try to reconnect before aborting
        var reconnectAttemptThreshold = 3;

        //wait interval between reconnect attempts
        var reconnectAttemptInterval = 5000;

        function MessageRelay() {
            this.items = [];
        }

        MessageRelay.prototype.init = function() {

            var that = this;

            if (session.authentication().isAuth) {

                connect();
            }

            utils.$rootScope.$on('user.login', function() {

                messagingGateway.disconnect().then(function() {
                    connect();
                });

            });

            utils.$rootScope.$on('user.logout', function() {

                messagingGateway.disconnect();

            });

            function connect() {

                messagingGateway.connect(session.authentication().rmq.clientId, session.authentication().rmq.clientKey, connectionFailHandler)
                    .then(function() {

                        that.subscribeForUserNotifications();

                        that.subscribeForAllNotifications();

                        reconnectAttemptCount = 0;

                        utils.$rootScope.$emit('$messaging.connection.connected');

                    });

            }

            function connectionFailHandler() {

                if (reconnectAttemptCount >= reconnectAttemptThreshold) {

                    console.log('###MESSAGING### - FAILED TO RECONNECT, ABORTING. ');

                    utils.$rootScope.$emit('$messaging.connection.disconnected');

                } else {

                    utils.$timeout(function() {

                        reconnectAttemptCount++;

                        console.log('###MESSAGING### - RECONNECT ATTEMPT ' + reconnectAttemptCount);

                        connect();

                    }, reconnectAttemptInterval);
                }
            }
        };

        MessageRelay.prototype.subscribeForUserNotifications = function() {

            if (!userContext.user) {
                return;
            }

            notificationSubscription = messagingGateway.subscribe(
                'client.{0}.in.user.{1}.notifications'.format(messagingGateway.clientId, userContext.user.id),
                handleNotificationMessage);

            function handleNotificationMessage(payload) {
                //HACK!
                var normalizedMessage = {
                    at: payload.At,
                    data: payload.Value
                };

                utils.$rootScope.$emit('$messaging.notification', new Notification(normalizedMessage));
            }
        };

        MessageRelay.prototype.subscribeForGroundNotifications = function(groundId) {

            if (groundSubscription) {

                messagingGateway.unsubscribe(groundSubscription);

                groundSubscription = null;

            }

            messagingGateway.subscribe(
                'ground.{0}.in.#'.format(groundId),
                handleGroundMessage,
                handleSubscribed);

            function handleGroundMessage(payload, topic) {

                var message = parser.parseMessage(topic, payload);

                if (message.name) {

                    utils.$rootScope.$emit('$messaging.' + message.name, message.data);

                }
            }

            function handleSubscribed(subscription) {

                groundSubscription = subscription;

            }
        };

        //Obsolete - will be removed when all messages are transferred under ground.{id}.in.#
        MessageRelay.prototype.subscribeForAllNotifications = function() {

            messagingGateway.subscribe(
                'client.{0}.in.#'.format(messagingGateway.clientId),
                handleMessage);

            function handleMessage(payload, topic) {

                var message = parser.parseMessage(topic, payload);

                if (message.name) {

                    utils.$rootScope.$emit('$messaging.' + message.name, message.data);

                }
            }
        };

        MessageRelay.prototype.unsubscribeFromGroundNotifications = function() {

            if (groundSubscription) {

                messagingGateway.unsubscribe(groundSubscription);

                groundSubscription = null;

            }
        };

        MessageRelay.prototype.publishState = function(asset, stateData) {

            var topic = parser.getMessageTopic(messagingGateway.clientId, 'state', asset);

            messagingGateway.publish(topic, stateData);

        };

        MessageRelay.prototype.publishCommand = function(asset, commandData) {

            var topic = parser.getMessageTopic(messagingGateway.clientId, 'command', asset);

            messagingGateway.publish(topic, commandData);

        };

        return new MessageRelay();
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('AllNotificationsController', AllNotificationsController);

    AllNotificationsController.$inject = ['$scope', 'model', 'viewNotificationCallback'];

    function AllNotificationsController($scope, model, viewNotificationCallback) {

        var vm = this;
        vm.model = model;
        vm.viewNotification = viewNotification;

        activate();

        ///////////////////////////////////

        function activate() {

            vm.model.subscribe();

            $scope.$on('$destroy', function() {
                vm.model.destroy();
            });
        }

        function viewNotification(notification) {
            vm.model.viewNotification(notification);

            if (viewNotificationCallback) {
                viewNotificationCallback(notification);
            }
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('AllNotificationsViewModel', factory);

    factory.$inject = ['notificationsRepository', 'notificationContext', 'utils'];

    function factory(notificationsRepository, notificationContext, utils) {

        var PAGE_SIZE = 10;
        var unsubscribeHandler = null;

        function AllNotificationsViewModel(notifications) {

            var that = this;
            that.notifications = notifications;
            that.pageSize = PAGE_SIZE;
            that.page = 0;
        }

        AllNotificationsViewModel.prototype.markAsRead = function(notification) {

            notificationContext.markAsRead(notification);
        };

        AllNotificationsViewModel.prototype.viewNotification = function(notification) {

            this.markAsRead(notification);
            notification.view(true);
        };

        AllNotificationsViewModel.prototype.loadMore = function() {

            var that = this;

            that.page++;

            return notificationsRepository.find(PAGE_SIZE, that.page)
                .then(function(result) {
                    that.notifications = that.notifications.concat(result);
                    return result;
                });
        };

        AllNotificationsViewModel.prototype.destroy = function() {

            if (unsubscribeHandler) {
                unsubscribeHandler();
                unsubscribeHandler = null;
            }
        };

        AllNotificationsViewModel.prototype.subscribe = function() {

            var that = this;

            unsubscribeHandler = utils.$rootScope.$on('user.notification', userNotificationHandler);

            function userNotificationHandler(event, notification) {
                that.notifications.push(notification);
            }
        };

        AllNotificationsViewModel.resolve = function() {

            return notificationsRepository.find(PAGE_SIZE)
                .then(function(result) {
                    return new AllNotificationsViewModel(result);
                });
        };

        return AllNotificationsViewModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('notificationContext', factory);

    factory.$inject = ['utils', 'session', 'notificationsRepository', 'NotificationModel', 'userContext'];

    function factory(utils, session, notificationsRepository, Notification, userContext) {

        function NotificationContext() {
            this.notifications = [];
        }

        NotificationContext.prototype.getUnreadCount = function() {

            var unreadCount = 0;

            angular.forEach(this.notifications, function(notification) {
                if (!notification.value.isRead) {
                    unreadCount++;
                }
            });

            return unreadCount;
        };

        NotificationContext.prototype.markAsRead = function(notification) {

            notification.value.isRead = true;

            notificationsRepository.markAsRead(notification);
        };

        NotificationContext.prototype.markAllAsRead = function() {

            angular.forEach(this.notifications, function(notification) {
                notification.value.isRead = true;
            });

            notificationsRepository.markAllAsRead();
        };

        NotificationContext.prototype.init = function() {

            var that = this;

            utils.$rootScope.$on('user.login', userLoginHandler);
            utils.$rootScope.$on('user.logout', userLogoutHandler);
            utils.$rootScope.$on('$messaging.notification', userNotificationHandler);

            if (session.authentication().isAuth) {
                setupNotifications();
            }

            function userLoginHandler() {

                setupNotifications();
            }

            function userLogoutHandler() {

                that.notifications = [];
            }

            function userNotificationHandler(event, notification) {

                that.notifications.push(notification);
                utils.$rootScope.$apply();
            }

            function setupNotifications() {

                return notificationsRepository.find().then(function(notifications) {
                    that.notifications = notifications;
                });
            }
        };

        return new NotificationContext();
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('NotificationController', NotificationController);

    NotificationController.$inject = ['$state', '$modal', 'notificationContext', 'AllNotificationsViewModel', 'GroundContext'];

    function NotificationController($state, $modal, notificationContext, AllNotificationsViewModel, groundContext) {

        var vm = this;
        vm.context = notificationContext;
        vm.notificationLimit = 5;
        vm.viewNotification = viewNotification;
        vm.markAsRead = markAsRead;
        vm.markAllAsRead = markAllAsRead;
        vm.showAll = showAll;

        ////////////////////////////////

        function viewNotification(notification) {

            markAsRead(notification);
            notification.view();
        }

        function markAsRead(notification) {

            notificationContext.markAsRead(notification);
        }

        function markAllAsRead() {

            notificationContext.markAllAsRead();
        }

        function showAll() {

            if ($state.current.name === 'main.notifications') {
                return;
            }

            var previousStateName = $state.current.name;
            var previousStateParams = angular.copy($state.params);

            var modalInstance = $modal.open({
                templateUrl: '/assets/js/app/core/notifications/all-notifications.html',
                controller: 'AllNotificationsController',
                controllerAs: 'vm',
                resolve: {
                    model: function() {

                        return new AllNotificationsViewModel.resolve().then(function(anvm) {
                            return anvm;
                        });
                    },

                    viewNotificationCallback: function() {

                        function closeModal(notification) {
                            modalInstance.close();
                        }

                        return closeModal;
                    }
                }
            });

            modalInstance.result.then(function(a, b, c) {
                //modal result promise is resolved as success if
                //link is clicked (state changed) from within the modal content
            }, function(reason) {

                //user clicked x or outside of the bounds of the modal
                //so we should return to previous state

                if (reason !== 'routeChange') {
                    $state.go(previousStateName, previousStateParams);
                }
            });

            $state.go('main.notifications', {}, {
                notify: false
            });
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('NotificationModel', factory);

    factory.$inject = ['$state'];

    function factory($state) {

        function Notification(data) {

            this.at = data.at;
            this.value = data.data;

            if (this.value.event === 'DeviceAssetNewState') {
                this.template = '/assets/js/app/core/notifications/asset-state-change.template.html';
            }

            if (this.value.event === 'RuleEngineExecutionNotification') {
                this.template = '/assets/js/app/core/notifications/message.template.html';
            }
        }

        Notification.prototype.view = function(replaceLocation) {

            var routeOptions = {};
            var routeName = null;
            var routeParams = {};

            if (replaceLocation) {
                routeOptions.location = 'replace';
            }

            if (this.value.data.asset) {
                routeName = 'main.asset';
                routeParams.id = this.value.data.asset.Id;
            }

            if (this.value.data.ground) {

                routeName = 'main.ground';
                routeParams.id = this.value.data.ground.Id;
            }

            if (routeName) {
                $state.go(
                    routeName,
                    routeParams,
                    routeOptions);
            }
        };

        return Notification;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('notificationsRepository', notificationsRepository);

    notificationsRepository.$inject = ['NotificationModel', 'notificationService', 'utils', 'exception'];

    function notificationsRepository(Notification, notificationService, utils, exception) {

        var service = {
            find: find,
            markAsRead: markAsRead,
            markAllAsRead: markAllAsRead
        };

        return service;

        ////////////////

        function find(count, page) {

            return notificationService.find(count, page).then(function(body) {

                var models = [];
                angular.forEach(body.items, function(item) {
                    models.push(new Notification(item));
                });

                return models;
            }).catch(exception.catcher('There was a problem to load notifications.'));
        }

        function markAsRead(notification) {

            return notificationService.markAsRead(notification.at)
                .catch(exception.catcher('There was a problem to mark notification as read'));
        }

        function markAllAsRead() {

            return notificationService.markAllAsRead()
                .catch(exception.catcher('There was a problem to mark all notifications as read'));
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('offline', offline);

    function offline() {
        var directive = {
            templateUrl: '/assets/js/app/core/offline/offline.template.html',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope:{}
        };
        return directive;
    }

    Controller.$inject = ['offline'];

    function Controller(offline) {

        var vm = this;
        vm.status = offline;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('offline', factory);

    factory.$inject = ['$window', 'utils'];

    function factory($window, utils) {

        var service = {
            isOffline: false,
            isMessagingDisconnected: false,
            init: init
        };
        return service;

        ////////////////

        function init() {

            utils.$rootScope.$on('$messaging.connection.connected', function() {
                service.isMessagingDisconnected = false;
            });

            utils.$rootScope.$on('$messaging.connection.disconnected', function() {

                if (!service.isMessagingDisconnected) {

                    utils.notify.warning(
                        'Connection',
                        'Server connection has dropped.',
                        null,
                        true,
                        function() {
                            $window.location.reload();
                        },

                        'Reload page');

                    utils.$rootScope.$apply();
                }

                service.isMessagingDisconnected = true;

            });
        }

        function setOffline() {

            if (!service.isOffline) {
                utils.notify.warning('Connection', 'Server does not respond at the moment. Changes that you make now, may not be applied.', null, true);
            }

            service.isOffline = true;
            utils.$rootScope.$apply();
        }

        function setOnline() {

            service.isOffline = false;
            utils.$rootScope.$apply();
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('permission', permission);

    permission.$inject = ['$animate', 'utils', 'roles.manager'];

    function permission($animate, utils, roleManager) {
        var directive = {
            restrict: 'A',
            multiElement: true,
            priority: 599,
            terminal: true,
            transclude: 'element',
            link: linker,
            $$tlb: true
        };
        return directive;

        function linker($scope, $element, $attr, ctrl, $transclude) {

            var block;
            var childScope;
            var previousElements;

            var permission = parsePermissionRef($attr.permission);

            if (permission.payloadExpr) {
                $scope.$watch(permission.payloadExpr, function(val) {
                    if (val !== permission.payload) {
                        update(val);
                    }
                }, true);

                permission.payload = angular.copy($scope.$eval(permission.payloadExpr));
            } else {

                permission.payload = {};
            }

            utils.$rootScope.$on('user.login', function() {
                update(permission.payload);
            });

            utils.$rootScope.$on('user.logout', function() {
                update(permission.payload);
            });

            update(permission.payload);

            function parsePermissionRef(ref) {

                var parsed = ref.replace(/\n/g, ' ').match(/^([^(]+?)\s*(\((.*)\))?$/);
                if (!parsed || parsed.length !== 4) {
                    throw new Error('Invalid permission ref "' + ref + '"');
                }

                return {
                    name: parsed[1],
                    payloadExpr: parsed[3] || null
                };
            }

            function update(newPermissionPayload) {

                if (newPermissionPayload) {
                    permission.payload = angular.copy(newPermissionPayload);
                }

                var authorized = roleManager.authorize(permission.name, permission.payload);

                //run ngIf to remove elements and child scopes if not authorized or to add elements
                runNgIf(authorized);
            }

            //Code entirely taken from angular ngIf directive
            function runNgIf(value) {
                if (value) {
                    if (!childScope) {
                        $transclude(function(clone, newScope) {
                            childScope = newScope;
                            clone[clone.length++] = document.createComment(' end permission: ' + $attr.permission + ' ');

                            // Note: We only need the first/last node of the cloned nodes.
                            // However, we need to keep the reference to the jqlite wrapper as it might be changed later
                            // by a directive with templateUrl when its template arrives.
                            block = {
                                clone: clone
                            };
                            $animate.enter(clone, $element.parent(), $element);
                        });
                    }
                } else {
                    if (previousElements) {
                        previousElements.remove();
                        previousElements = null;
                    }

                    if (childScope) {
                        childScope.$destroy();
                        childScope = null;
                    }

                    if (block) {
                        previousElements = getBlockNodes(block.clone);
                        $animate.leave(previousElements).then(function() {
                            previousElements = null;
                        });

                        block = null;
                    }
                }
            }

            //Code entirely take from angular core, as ngIf was using it internally
            function getBlockNodes(nodes) {
                // TODO(perf): update `nodes` instead of creating a new object?
                var node = nodes[0];
                var endNode = nodes[nodes.length - 1];
                var blockNodes;

                for (var i = 1; node !== endNode && (node = node.nextSibling); i++) {
                    if (blockNodes || nodes[i] !== node) {
                        if (!blockNodes) {
                            blockNodes = jqLite(slice.call(nodes, 0, i));
                        }

                        blockNodes.push(node);
                    }
                }

                return blockNodes || nodes;
            }
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('roles.initializator', roleInitializator);

    roleInitializator.$inject = ['roles.manager', 'GroundContext', 'userContext', 'utils'];

    function roleInitializator(roleManager, groundContext, userContext, utils) {

        var service = {
            init: init
        };

        return service;

        ///////////////////////////////////////////////////////////////

        function init() {

            roleManager.registerRole('ground-owner', function(payload) {

                var ground = null;

                if (!userContext.user) {
                    return false;
                }

                if (payload && payload.groundId) {
                    ground = groundContext.find(payload.groundId);
                } else {
                    ground = groundContext.current;
                }

                if (!ground) {
                    return true;
                }

                if (ground.ownerId === userContext.user.id) {
                    return true;
                }

                return false;
            });

            roleManager.registerRole('self', function(payload) {

                if (!userContext.user) {
                    return false;
                }

                return payload.relatedUserId === userContext.user.id;
            });

            roleManager.registerRole('god', function(payload) {

                if (!userContext.user) {
                    return false;
                }

                return userContext.user.role === 'Administrator';
            });

            roleManager.registerPermission('ground-view-devices', ['ground-owner']);
            roleManager.registerPermission('ground-member-remove', ['self', 'ground-owner']);
            roleManager.registerPermission('ground-delete', ['ground-owner']);
            roleManager.registerPermission('ground-save', ['ground-owner']);
            roleManager.registerPermission('ground-member-add', ['ground-owner']);

            roleManager.registerPermission('devices-add', ['ground-owner']);
            roleManager.registerPermission('device-save', ['ground-owner']);
            roleManager.registerPermission('device-delete', ['ground-owner']);
            roleManager.registerPermission('device-control-save', ['ground-owner']);
            roleManager.registerPermission('device-profile-save', ['ground-owner']);

            roleManager.registerPermission('device-assets-add', ['ground-owner']);
            roleManager.registerPermission('device-asset-remove', ['ground-owner']);

            roleManager.registerPermission('device-asset-save', ['ground-owner']);
            roleManager.registerPermission('device-asset-command', ['ground-owner']);
            roleManager.registerPermission('device-asset-control-save', ['ground-owner']);
            roleManager.registerPermission('device-asset-profile-save', ['ground-owner']);
            roleManager.registerPermission('device-asset-state', ['ground-owner', 'god']);
            roleManager.registerPermission('device-command', ['ground-owner']);

            roleManager.registerPermission('gateway-claim', ['ground-owner']);
            roleManager.registerPermission('gateway-save', ['ground-owner']);
            roleManager.registerPermission('gateway-delete', ['ground-owner']);

            roleManager.registerPermission('usermenu-godsection', ['god']);

            utils.$rootScope.hasPermission = function(permissionName, payload) {
                return roleManager.authorize(permissionName, payload);
            };
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('roles.manager', factory);

    function factory() {

        return new RoleManager();
    }

    function RoleManager() {

        this.roles = {};
        this.permissions = {};
    }

    RoleManager.prototype.registerRole = function(name, grantFn) {

        this.roles[name] = {
            grant: grantFn
        };
    };

    RoleManager.prototype.registerPermission = function(name, roles) {

        this.permissions[name] = {
            roles: roles
        };
    };

    RoleManager.prototype.authorize = function(permissionName, payload) {

        var that = this;

        var permission = this.permissions[permissionName];

        var authorized = false;

        angular.forEach(permission.roles, function(role) {
            if (that.roles[role].grant(payload)) {
                authorized = true;
            }
        });

        return authorized;
    };
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('assetName', assetName);

    assetName.$inject = ['asset.repository', 'nameCache'];

    function assetName(assetRepository, nameCache) {

        var directive = {
            link: link,
            restrict: 'A',
            scope: {
                id: '=assetName'
            }
        };
        return directive;

        function link(scope, element, attrs) {

            scope.$watch('id', function(newId) {

                if (!scope.id) {
                    return;
                }

                if (nameCache.assets[scope.id]) {
                    $(element[0]).html(nameCache.assets[scope.id]);
                } else {

                    assetRepository.find(scope.id).then(function(asset) {
                        $(element[0]).html(asset.title);
                        nameCache.assets[scope.id] = asset.title;
                    });
                }
            });
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('deviceName', deviceName);

    deviceName.$inject = ['device.repository', 'nameCache'];

    function deviceName(deviceRepository, nameCache) {

        var directive = {
            link: link,
            restrict: 'A',
            scope: {
                id: '=deviceName'
            }
        };
        return directive;

        function link(scope, element, attrs) {

            scope.$watch('id', function(newId) {

                if (!scope.id) {
                    return;
                }

                if (nameCache.devices[scope.id]) {
                    $(element[0]).html(nameCache.devices[scope.id]);
                } else {

                    deviceRepository.find(scope.id).then(function(device) {
                        $(element[0]).html(device.title);
                        nameCache.devices[scope.id] = device.title;
                    });
                }
            });
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('groundName', groundName);

    groundName.$inject = ['ground.repository', 'nameCache'];

    function groundName(groundRepository, nameCache) {

        var directive = {
            link: link,
            restrict: 'A',
            scope: {
                id: '=groundName'
            }
        };
        return directive;

        function link(scope, element, attrs) {

            scope.$watch('id', function(newId) {

                if (!scope.id) {
                    return;
                }

                if (nameCache.grounds[scope.id]) {
                    $(element[0]).html(nameCache.grounds[scope.id]);
                } else {
                    groundRepository.find(scope.id).then(function(ground) {
                        $(element[0]).html(ground.title);
                        nameCache.grounds[scope.id] = ground.title;
                    });
                }

            });
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('nameCache', nameCache);

    function nameCache() {
        var service = {
            assets: [],
            grounds: [],
            devices: []
        };
        return service;

        ////////////////
    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('api.accountService', AccountService);

    AccountService.$inject = [
        '$http',
        'session',
        'api.url',
        'exception'
    ];

    function AccountService($http, session, apiUrl, exception) {

        var service = {
            activate: activate,
            resendActivation: resendActivation,
            recoverPassword: recoverPassword,
            changePassword: changePassword
        };

        return service;

        /////////////////////////

        function activate(token) {

            var url = apiUrl + 'account/activation/' + token;
            return $http.put(url)
                .catch(exception.catcher('There was a problem to activate account.'));
        }

        function resendActivation(userNameEmail) {

            var url = apiUrl + 'account/resendactivation';
            var data = {
                email: userNameEmail
            };

            return $http.put(url, data)
                .then(handleSuccess)
                .catch(exception.catcher('There was a problem to send activation mail.'));
        }

        function recoverPassword(userName) {

            var url = apiUrl + 'account/recoverpassword';
            var data = {
                username: userName
            };

            return $http.put(url, data)
                .then(handleSuccess)
                .catch(exception.catcher('There was a problem to recover password.'));
        }

        function changePassword(oldPassword, newPassword, confirmedPassword) {

            var url = apiUrl + 'account/changepassword';
            var data = {
                oldPassword: oldPassword,
                newPassword: newPassword,
                confirmPassword: confirmedPassword
            };

            return $http.post(url, data)
                .catch(exception.catcher('There was a problem to change password.'));
        }

        function handleSuccess(response) {
            return {
                success: true
            };
        }
    }

}(window.angular));

(function(ng) {
    ng.module('app').factory('api.assetsService', AssetsService);

    AssetsService.$inject = ['$http', 'api.url', 'exception', 'deviceActivityService', 'utils'];

    function AssetsService($http, apiUrl, exception, deviceActivityService, utils) {

        var assetTypes = [{
            name: 'Sensor',
            type: 'sensor',
            cssClass: 'sl-device-wall-plug'
        }, {
            name: 'Actuator',
            type: 'actuator',
            cssClass: 'sl-device-wall-plug'
        }, {
            name: 'Virtual',
            type: 'virtual'
        }, {
            name: 'Config',
            type: 'config'
        }];

        var service = {
            publishCommand: publishCommand,
            publishState: publishState,
            replaceProfile: replaceProfile,
            replaceControl: replaceControl,
            createAsset: createAsset,
            getAsset: getAsset,
            getAssetTypes: getAssetTypes,
            deleteAsset: deleteAsset,
            updateAsset: updateAsset,
            areSameProfiles: areSameProfiles,
            normalizeProfileType: normalizeProfileType,
            getAssetHistory: getAssetHistory,

            createAssetUsingToken: createAssetUsingToken,
            createAssetUsingTicket: createAssetUsingTicket

        };

        return service;

        //////////////////////////////

        function publishCommand(id, value) {
            var url = apiUrl + 'asset/' + id + '/command';

            var data = {
                value: value
            };

            return $http.put(url, data)
                .then(function(response) {
                    return true;
                });
        }

        function publishState(id, value) {

            var url = apiUrl + 'asset/' + id + '/state';

            var data = {
                value: value
            };

            return $http.put(url, data);
        }

        function replaceProfile(deviceId, assetName, profile) {

            var url = apiUrl + 'device/' + deviceId + '/asset/' + assetName + '/profile';

            return $http.put(url, profile);
        }

        function replaceControl(deviceId, assetName, value) {
            var url = apiUrl + 'device/' + deviceId + '/asset/' + assetName + '/control';

            var data = value;

            return $http.put(url, data);
        }

        function createAsset(deviceId, name, title, type, profile, control) {

            var url = apiUrl + 'device/' + deviceId + '/asset/' + name;

            var data = {};

            if (deviceId) {
                data.deviceId = deviceId;
            }

            if (title) {
                data.title = title;
            }

            if (type) {
                data.is = type;
            }

            if (profile !== null && profile !== undefined) {

                if ((typeof profile) === 'object') {

                    data.profile = profile;

                } else {

                    data.profile = {

                        type: profile

                    };
                }

            } else {

                data.profile = {

                    type: 'string'
                };

            }

            if (control !== null && control !== undefined) {

                data.control = {
                    name: control
                };

            }

            return $http.put(url, data);
        }

        function createAssetUsingToken(deviceId, assetConfig, token) {

            var url = apiUrl + 'device/' + deviceId + '/asset/' + assetConfig.name;

            var config = getConfig(token);

            return $http.put(url, assetConfig, config);
        }

        function getAsset(id) {
            var url = apiUrl + 'asset/' + id;

            return $http.get(url);
        }

        function getAssetTypes() {
            return assetTypes;
        }

        function deleteAsset(deviceId, name) {
            var url = apiUrl + 'device/' + deviceId + '/asset/' + name;
            return $http.delete(url);
        }

        function updateAsset(deviceId, assetId, name, assetIs, title) {
            var url = apiUrl + 'device/' + deviceId + '/asset/' + name;

            var data = {
                id: assetId,
                title: title,
                is: assetIs
            };

            return $http.put(url, data);
        }

        function getAssetHistory(id, from, to, resolution) {

            var url = apiUrl + 'asset/' + id + '/activity';

            var query = '?from=' + encodeURIComponent(from) + '&to=' + encodeURIComponent(to) + '&resolution=' + resolution;

            url = url + query;

            return $http.get(url).then(function(response) {
                return response.data;
            });

        }

        function createAssetUsingTicket(ticket, data){

            var url = apiUrl + 'asset/' + data.name;

            var config = getConfigForTicket(ticket);

            return $http.put(url, data, config)
        }

        function areSameProfiles(leftProfile, rightProfile) {

            if (!leftProfile || !rightProfile) {
                return false;
            }

            if (!leftProfile.type || !rightProfile.type) {
                return false;
            }

            var left = normalizeProfileType(leftProfile.type);
            var right = normalizeProfileType(rightProfile.type);

            return left == right;
        }

        function normalizeProfileType(profileType) {

            if (typeof profileType != 'string') {
                return null;
            }

            profileType = profileType.toLowerCase();

            if (profileType == 'bool' || profileType == 'boolean') {
                return 'bool';
            }

            if (profileType == 'int' || profileType == 'integer') {
                return 'int';
            }

            if (profileType == 'double' || profileType == 'float' || profileType == 'decimal' || profileType == 'number') {
                return 'number';
            }

            if (profileType == 'string' || profileType == 'text') {
                return 'string';
            }

            if (profileType == 'datetime' || profileType == 'date' || profileType == 'time') {
                return 'datetime';
            }

            if (profileType == 'timespan' || profileType == 'timerange' || profileType == 'duration') {
                return 'timespan';
            }

            return profileType;
        }

        function getConfigForTicket(ticket) {

            var config = {
                headers: {}
            };

            if (ticket) {
                config.headers.Authorization = 'Ticket {0}'.format(ticket);
            }

            return config;

        }

        function getConfig(token) {
            var config = {
                headers: {}
            };

            if (token) {
                config.headers.Authorization = 'Bearer {0}'.format(token);
            }

            return config;
        }
    }

}(window.angular));

(function() {

    angular
        .module('app')
        .factory('authHelper', authenticationHelper);

    authenticationHelper.$inject = ['$rootScope', 'session', '$state'];

    function authenticationHelper($rootScope, session, $state) {

        var attemptedRoute = {
            name: null,
            params: null
        };

        var service = {
            getAttemptedRoute: getAttemptedRoute
        };

        $rootScope.$on('$stateChangeStart', stateChangeHandler);

        return service;

        function getAttemptedRoute() {

            return attemptedRoute;

        }

        function stateChangeHandler(event, toState, toParams, fromState, fromParams) {

            if (typeof toState.data === 'undefined' || typeof toState.data.requireLogin === 'undefined') {

                return;

            }

            if (!session.authentication().isAuth) {

                event.preventDefault();

                attemptedRoute.name = toState.name;

                attemptedRoute.params = toParams;

                $state.transitionTo('login');

            }

        }
    }

})();

(function() {

    angular
        .module('app')
        .factory('authService', AuthService);

    AuthService.$inject = [
        '$http',
        'api.url',
        'session',
        'api.clientId',
        'userContext',
        'exception'
    ];

    function AuthService($http, apiUrl, session, apiClientId, userContext, exception) {

        var headers = {
            'Content-Type': 'application/x-www-form-urlencoded'
        };

        var service = {
            register: register,
            refreshToken: refreshToken,
            login: login,
            logout: logout,
            getDataFromHash: getDataFromHash,
            continueActivation: continueActivation,
            root: root
        };

        return service;

        ///////////////////////////

        function register(registration) {

            return $http.post(apiUrl + 'register', registration)
                .catch(exception.catcher('There was problem to create your account.'));
        }

        function refreshToken(token) {

            var data = 'grant_type=refresh_token&refresh_token=' + token + '&client_id=' + apiClientId;

            return $http.post(apiUrl + 'login', data, {
                headers: headers
            }).then(function(response) {
                session.saveAuthenticationData(response.data);
                return response.data;
            });
        }

        function login(loginData) {

            var data = 'grant_type=password&username=' + encodeURIComponent(loginData.username) + '&password=' + encodeURIComponent(loginData.password) + '&client_id=' + apiClientId;

            return $http.post(apiUrl + 'login', data, {
                    headers: headers
                })
                .then(onSuccessfullLogin)
                .then(loadUserInformation)
                .catch(exception.catcher('Could not login with credentials provided.'));
        }

        function onSuccessfullLogin(response) {

            session.saveAuthenticationData(response.data);

            return response.data;
        }

        function loadUserInformation() {

            return userContext.load();
        }

        function logout() {

            return $http.post(apiUrl + 'logout', null, {
                    headers: headers
                }).then(function(response) {

                    session.clearAuthenticationData();
                    userContext.unload();
                })
                .catch(exception.catcher('There was a problem to sign you out.'));
        }

        function getDataFromHash(hash) {

            var url = apiUrl + 'account/completion/' + hash;
            return $http.get(url)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem with your activation link.'));
        }

        function continueActivation(hash, newUsername, newPassword) {

            var url = apiUrl + 'account/completion/' + hash;

            var data = {
                username: newUsername,
                password: newPassword
            };

            return $http.put(url, data)
                .catch(exception.catcher('There was a problem to continue activation process.'));
        }

        function root() {

            var url = apiUrl;

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

    }
}());

(function() {

    angular
        .module('app')
        .factory('api.clientAuthorizationService', ClientAuthorizationService);

    ClientAuthorizationService.$inject = ['$http', 'api.url', 'exception'];

    function ClientAuthorizationService($http, apiUrl, exception) {

        var service = {
            getClients: getClients,
            revokeClientAuthorization: revokeClientAuthorization
        };

        return service;

        ///////////////////////////////////////////

        // - /authorizations gets all authorized clients

        function getClients() {

            var url = apiUrl + 'me/clients';

            return $http.get(url)
                .then(function(response) {

                    return response.data;

                })
                .catch(exception.catcher('There was a problem to load authorized clients.'));
        }

        function revokeClientAuthorization(clientId) {

            var url = apiUrl + 'client/' + clientId;

            return $http.delete(url)
                .catch(exception.catcher('There was a problem to load authorized clients.'));

        }
    }
}());

(function() {

    angular
        .module('app')
        .factory('api.controlsService', ControlsService);

    ControlsService.$inject = ['$http', 'api.url', 'widgetsCommon', 'exception'];

    function ControlsService($http, apiUrl, widgetsCommon, exception) {

        var service = {
            getAll: getAll,
            getControl: getControl,
            getControlsForAsset: getControlsForAsset,
            getControlsForProfile: getControlsForProfile,
            getDefaultControl: getDefaultControl
        };

        return service;

        ///////////////////////////////////////////

        // - /controls gets all controls
        // - /controls/ {id} gets control by it's name
        // - /controls/asset / {id} gets controls for asset by it 's id
        // - POST / controls / profile gets controls for profile in the body

        function getAll() {
            var url = apiUrl + 'controls';

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem to load controls.'));
        }

        function getControl(controlName) {
            var url = apiUrl + 'controls/' + controlName;

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem to load control.'));
        }

        function getControlsForAsset(assetId) {
            var url = apiUrl + 'controls/asset/' + assetId;

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem to load asset controls.'));
        }

        function getControlsForProfile(profile) {
            var url = apiUrl + 'controls/profile';

            return $http.post(url, profile)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem to load controls for a profile.'));
        }

        function getDefaultControl(asset) {

            return widgetsCommon.findDefaultControl(asset);

        }
    }

}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('deviceActivityService', deviceActivityService);

    deviceActivityService.$inject = ['$http', 'api.url', '$q'];

    function deviceActivityService($http, apiUrl, $q) {

        var service = {
            getAssetActivity: getAssetActivity
        };

        var testData = [{
            at: '2015-08-20T13:00:00.000Z',
            data: {
                min: 0,
                avg: 1.5,
                max: 2
            }
        }, {
            at: '2015-08-20T14:00:00.000Z',
            data: {
                min: 0,
                avg: 1.6,
                max: 2.2
            }
        }, {
            at: '2015-08-20T15:00:00.000Z',
            data: {
                min: 0,
                avg: 1.8,
                max: 2.9
            }
        }, {
            at: '2015-08-20T16:00:00.000Z',
            data: null
        }, {
            at: '2015-08-20T17:00:00.000Z',
            data: null
        }, {
            at: '2015-08-20T18:00:00.000Z',
            data: {
                min: 0,
                avg: 1.8,
                max: 3.5
            }
        }, {
            at: '2015-08-20T19:00:00.000Z',
            data: {
                min: 0,
                avg: 7,
                max: 14
            }
        }, {
            at: '2015-08-20T20:00:00.000Z',
            data: {
                min: 0,
                avg: 2.5,
                max: 3.7
            }
        }, {
            at: '2015-08-20T21:00:00.000Z',
            data: {
                min: 0,
                avg: 1.8,
                max: 3.5
            }
        }, {
            at: '2015-08-20T22:00:00.000Z',
            data: {
                min: 0,
                avg: 4,
                max: 7
            }
        }];

        return service;

        ////////////////

        function getAssetActivity() {
            return $q(function(resolve, reject) {
                resolve(testData);
            });
        }

    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('api.devicesService', DeviceService);

    DeviceService.$inject = ['$http', 'session', 'api.url', 'public.token'];

    function DeviceService($http, session, apiUrl, publicToken) {

        var service = {
            getAll: getAll,
            create: create,
            createInGround: createInGround,
            getFromGround: getFromGround,
            get: get,
            refresh: refresh,
            enable: enable,
            disable: disable,
            deleteDevice: deleteDevice,
            updateDeviceControl: updateDeviceControl,
            updateDevice: updateDevice,
            adopt: adopt,

            ///using token
            getAllUsingToken: getAllUsingToken,
            getSelfUsingTicket: getSelfUsingTicket,
            createUsingToken: createUsingToken,
            updateUsingToken: updateUsingToken
        };

        return service;

        /////////////////////////////////////

        function getAll(gatewayId, newDevicesOnly) {
            var url = apiUrl + 'device?includeAssets=true';

            var config = {
                params: {}
            };

            if (gatewayId) {
                config.params.gatewayId = gatewayId;
            }

            if (newDevicesOnly) {
                config.params.new = true;
            }

            return $http.get(url, config);
        }

        function create(data) {
            var url = apiUrl + 'device';

            return $http.post(url, data);
        }

        function createInGround(data, groundId) {
            var url = apiUrl + 'ground/' + groundId + '/devices';

            return $http.post(url, data);
        }

        function get(id) {
            return $http.get(apiUrl + 'device/' + id)
                .then(function(response) {
                    return response.data;
                });
        }

        function getFromGround(groundId) {
            var url = apiUrl + 'ground/' + groundId + '/devices';

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function doDeviceAction(actionName, deviceId) {
            return $http.put(apiUrl + 'device/' + deviceId + '/' + actionName);
        }

        function refresh(id) {
            return doDeviceAction('refresh', id);
        }

        function enable(id) {
            return doDeviceAction('enable', id);
        }

        function disable(id) {
            return doDeviceAction('disable', id);
        }

        function deleteDevice(id) {
            var url = apiUrl + 'device/' + id;
            return $http.delete(url);
        }

        function updateDeviceControl(id, control) {

            var data = {};

            if (control) {
                data.control = control;
            }

            return $http.put(apiUrl + 'device/' + id + '/control', data);
        }

        function updateDevice(id, data) {

            return $http.put(apiUrl + 'device/' + id, data);
        }

        function adopt(deviceId) {
            var url = apiUrl + 'device/' + deviceId + '/adopt';

            return $http.post(url);
        }

        function getAllUsingToken(byName, token) {

            var url = apiUrl + 'device?includeAssets=true';

            if (byName) {
                url += '&name=' + byName;
            }

            var config = getConfigForTicket(token);

            return $http.get(url, config);
        }

        function createUsingToken(deviceConfig, token) {
            var url = apiUrl + 'device';

            var config = getConfigForTicket(token);

            return $http.post(url, deviceConfig, config);
        }

        function updateUsingToken(deviceConfig, token) {

            var data = {};

            if (deviceConfig.name) {
                data.name = deviceConfig.name;
            }

            if (deviceConfig.description) {
                data.description = deviceConfig.description;
            }

            if (deviceConfig.activityEnabled !== undefined && deviceConfig.activityEnabled !== null) {
                data.activityEnabled = deviceConfig.activityEnabled;
            }

            if (deviceConfig.assets) {
                data.assets = deviceConfig.assets;
            }

            if (deviceConfig.title) {
                data.title = deviceConfig.title;
            }

            var config = getConfig(token);

            return $http.put(apiUrl + 'device/' + deviceConfig.id, data, config);
        }

        function getSelfUsingTicket(ticket) {

            var config = getConfigForTicket(ticket);

            var url = apiUrl + 'self';

            return $http.get(url, config);

        }

        function getConfigForTicket(ticket) {

            var config = {
                headers: {}
            };

            if (ticket) {
                config.headers.Authorization = 'Ticket {0}'.format(ticket);
            }

            return config;

        }

        function getConfig(token) {
            var config = {
                headers: {}
            };

            if (token) {
                config.headers.Authorization = 'Bearer {0}'.format(token);
            }

            return config;
        }
    }
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .factory('api.GatewayService', GatewayService);

    GatewayService.$inject = ['$http', 'api.url', 'exception'];

    function GatewayService($http, apiUrl, exception) {
        var service = {

            listGateways: listGateways,
            getFromGround: getFromGround,
            getGateway: getGateway,
            claimGateway: claimGateway,
            enrollGateway: enrollGateway,
            updateGateway: updateGateway,
            deleteGateway: deleteGateway

        };

        return service;

        ////////////////////////////

        function deleteGateway(gatewayId) {
            var url = apiUrl + 'gateway/' + gatewayId;

            return $http.delete(url)
                .then(function(response) {
                    return true;
                });
        }

        function listGateways() {
            var url = apiUrl + 'gateway';

            return $http.get(url, {
                    headers: getHeaders()
                })
                .then(function(response) {
                    return response.data;
                });
        }

        function getFromGround(groundId) {
            var url = apiUrl + 'ground/' + groundId + '/gateways';

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function getGateway(id, includeDevices, includeAssets) {
            var url = apiUrl + 'gateway/' + id;

            if (includeDevices && includeAssets) {
                url += '?includeDevices=true&includeAssets=true';
            } else if (includeDevices) {
                url += '?includeDevices=true';
            } else if (includeAssets) {
                url += '?includeAssets=true';
            }

            return $http.get(url, {
                    headers: getHeaders()
                })
                .then(function(response) {
                    return response.data;
                });

        }

        function claimGateway(groundId, claimCode) {
            var url = apiUrl + 'ground/' + groundId + '/claim';

            var data = {
                claimCode: claimCode
            };

            return $http.post(url, JSON.stringify(data), {
                headers: getHeaders()
            });
        }

        function enrollGateway(uid, id, name, description, key) {
            var url = apiUrl + 'gateway/';

            var data = {};

            if (id) {
                data.id = id;
            }

            if (name) {
                data.name = name;
            }

            if (description) {
                data.description = description;
            }

            if (key) {
                data.key = key;
            }

            return $http.post(url, JSON.stringify(data), {
                headers: getHeaders()
            });
        }

        function updateGateway(id, name, description) {
            var url = apiUrl + 'gateway/' + id;

            var data = {
                name: name,
                description: description
            };

            return $http.put(url, JSON.stringify(data), {
                    headers: getHeaders()
                })
                .then(function(response) {
                    return response.data;
                });
        }

        function getHeaders() {
            return {
                'Content-Type': 'application/json'
            };
        }

    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('groundsService', factory);

    factory.$inject = ['$http', 'app.config'];

    function factory($http, appConfig) {
        var service = {
            find: find,
            findAll: findAll,
            findAllPublic: findAllPublic,
            findAllShared: findAllShared,
            delete: deleteGround,
            create: create,
            update: update
        };
        return service;

        ////////////////

        function findAll() {

            var url = appConfig.api.url + 'me/grounds';
            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function findAllPublic() {

            var url = appConfig.api.url + 'grounds';
            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function findAllShared() {

            var url = appConfig.api.url + 'me/grounds?type=shared';
            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function find(id) {
            var url = appConfig.api.url + 'ground/' + id;
            return $http.get(url);
        }

        function deleteGround(id) {
            var url = appConfig.api.url + 'ground/' + id;
            return $http.delete(url);
        }

        function create(name, visibility) {
            var url = appConfig.api.url + 'me/grounds';

            return $http.post(url, {
                name: name,
                title: name,
                visibility: visibility
            });
        }

        function update(id, data) {
            var url = appConfig.api.url + 'ground/' + id;

            return $http.post(url, data);
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('membersService', factory);

    factory.$inject = ['$http', 'app.config'];

    function factory($http, appConfig) {
        var service = {
            findAll: findAll,
            addMember: addMember,
            deleteMember: deleteMember

        };
        return service;

        ////////////////

        function findAll(groundId) {

            var url = appConfig.api.url + 'ground/' + groundId + '/members';
            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function addMember(groundId, memberEmail) {
            var url = appConfig.api.url + 'ground/' + groundId + '/members';
            var data = {
                email: memberEmail
            };
            return $http.post(url, data)
                .then(function(response) {
                    return response.data;
                });
        }

        function deleteMember(groundId, memberId) {
            var url = appConfig.api.url + 'ground/' + groundId + '/member/' + memberId;
            return $http.delete(url)
                .then(function(response) {
                    return response.data;
                });
        }

    }
})();

(function() {

    angular
        .module('app')
        .factory('api.metricsService', MetricsService);

    MetricsService.$inject = [
        '$http',
        'api.url'
    ];

    function MetricsService($http, apiUrl) {

        var service = {
            getPerformance: getPerformance
        };

        return service;

        function getPerformance() {
            var url = apiUrl + 'metrics/performance/current';
            return $http.get(url);
        }
    }
}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('notificationService', factory);

    factory.$inject = ['$http', 'app.config'];

    function factory($http, appConfig) {

        var service = {
            find: find,
            markAsRead: markAsRead,
            markAllAsRead: markAllAsRead
        };
        return service;

        ////////////////

        function find(count, page) {

            var url = appConfig.api.url + 'me/notifications';

            url = url + getQuery(count, page);

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function getQuery(count, page) {
            if (!page && !count) {
                return '';
            }

            var query = '?';
            var items = [];

            if (page) {
                items.push('page=' + page);
            }

            if (count) {
                items.push('count=' + count);
            }

            query = query + items.join('&');

            return query;
        }

        function markAsRead(timestamp) {

            var url = appConfig.api.url + 'me/notifications';

            return $http.patch(url, {
                at: timestamp
            });
        }

        function markAllAsRead() {

            var url = appConfig.api.url + 'me/notifications';
            return $http.patch(url, {});
        }
    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('api.rulesService', RulesService);

    RulesService.$inject = [
        '$http',
        'api.url'
    ];

    function RulesService($http, apiUrl) {

        var service = {
            getAll: getAll,
            get: get,
            getHistory: getHistory,
            create: create,
            update: update,
            delete: deleteRule,
            enabled: enabled,
            hasIssue: hasIssue,
            getDeviceRulesCount: getDeviceRulesCount,
            getDeviceRules: getDeviceRules,
            subscribeOnRuleNotifications: subscribe,
            unsubscribeFromRuleNotifications: unsubscribe
        };

        return service;

        ///////////////////////////////////////////

        function getAll() {

            var url = apiUrl + 'rules';
            return $http.get(url);
        }

        function get(ruleId) {

            var url = apiUrl + 'rules/' + ruleId;
            return $http.get(url);
        }

        function getHistory(ruleId) {

            var url = '{0}rules/{1}/history'.format(apiUrl, ruleId);
            return $http.get(url);
        }

        function create(name, description, definition) {

            var url = apiUrl + 'rules';
            var data = {
                Name: name,
                Description: description,
                Definition: definition
            };

            return $http.post(url, data);
        }

        function update(id, name, description, definition) {
            var url = apiUrl + 'rules/' + id;

            var data = {};

            if (name) {
                data.Name = name;
            }

            if (description) {
                data.Description = description;
            }

            if (definition) {
                data.Definition = definition;
            }

            return $http.put(url, data);
        }

        function deleteRule(id) {
            var url = apiUrl + 'rules/' + id;

            return $http.delete(url);
        }

        function enabled(id, value) {
            var url = apiUrl + 'rules/enabled/' + id + '?value=' + value;

            return $http.post(url);
        }

        function hasIssue(rule) {

            //undefined, compliation error, missing assets
            if (rule.status === 0 || rule.status === 3 || rule.status === 4) {
                return true;
            }

            return false;
        }

        function getDeviceRules(deviceID, pageSize, page) {

            var url = apiUrl + 'device/' + deviceID + '/rules';

            url = url + getQuery(pageSize, page);

            return $http.get(url)
                .then(function(response) {
                    return response.data;
                });
        }

        function getDeviceRulesCount(deviceID) {

            var url = apiUrl + 'device/' + deviceID + '/rules/meta';

            return $http.get(url);
        }

        function subscribe(ruleId) {
            var url = apiUrl + 'device/notifications/' + ruleId + '/subscription';

            return $http.put(url);
        }

        function unsubscribe(ruleId) {
            var url = apiUrl + 'device/notifications/' + ruleId + '/subscription';

            return $http.delete(url);
        }

        function getQuery(count, page) {
            if (!page && !count) {
                return '';
            }

            var query = '?';
            var items = [];

            if (count) {
                items.push('perPage=' + count);
            }

            if (page) {
                items.push('page=' + page);
            }

            query = query + items.join('&');

            return query;
        }
    }
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .factory('api.servicesService', servicesService);

    servicesService.$inject = ['$http', 'session', 'api.url', '$q'];

    function servicesService($http, session, apiUrl, $q) {

        var service = {
            getAll: getAll,
            get: get
        };

        return service;
        //////////////////////////////

        function getAll() {
            var url = apiUrl + 'services';
            return $http.get(url);
        }

        function get(serviceAlias) {
            var url = apiUrl + 'services/' + serviceAlias;
            return $http.get(url);
        }

        /////////Fakes until the API is available
        function getAllFake() {
            var deferred = $q.defer();

            deferred.resolve({
                data: [{
                    "id": "5497eacfd1510009ece8369b",
                    "name": "Email Me",
                    "type": "emailMe",
                    "is": "actuator",
                    "iconKey": "fa-envelope",
                    "description": "View the details of your notify-me email service",
                    "detailsPage": "services/emailme",
                    "profile": {
                        "type": {
                            "to": "string",
                            "subject": "string",
                            "body": "string"
                        }
                    }
                }]
            });

            return deferred.promise;
        }

        function getFake(serviceAlias) {
            var deferred = $q.defer();

            deferred.resolve({
                data: {
                    "id": "demo",
                    "name": "email me",
                    "is": "actuator",
                    "description": null,
                    "createdOn": "0001-01-01T00:00:00",
                    "createdBy": null,
                    "updatedOn": "0001-01-01T00:00:00",
                    "updatedBy": null,
                    "profile": {
                        "type": {
                            "to": "string",
                            "subject": "string",
                            "body": "string"
                        }
                    }
                }
            });

            return deferred.promise;
        }
    }

}(window.angular));

(function() {

    angular.module('app').constant('api.url', 'https://apidev.smartliving.io/');
    angular.module('app').constant('api.clientId', 'maker_local');
    angular.module('app').constant('broker.url', 'https://brokerdev.smartliving.io');
    angular.module('app').constant('broker.port', 15671);
    angular.module('app').constant('broker.sourceRoot', '/exchange/root/');
    angular.module('app').constant('widget.hostUrl', 'http://widget.smartliving.io');
    angular.module('app').constant('origin', 'https://feature-create-kit-device.firebaseapp.com');
    angular.module('app').constant('public.token', '0LLHtj3ytaYIg2XyAB-5NjyTY1edZVL1td3l2SJx7wKwEG');
    angular.module('app').constant('public.clientId', 'guest_user');
    angular.module('app').constant('public.clientKey', 'guest_user');
    angular.module('app').constant('public.urlShortenerApiKey', 'AIzaSyDLqgICAbnq75SJF5NfpNqzpjwPXQo7YgA');
    angular.module('app').constant('public.urlShortenerApiUrl', 'https://www.googleapis.com/urlshortener/v1/url');
    angular.module('app').constant('termsOfUseCDNUrl', 'https://59ac97f6ca65569bb2d9a82888280ff3814a4274.googledrive.com/host/0B6z8XZULtV7xRGpyNktrM3hDWnc/Terms_of_Use/tou-text.html');
}());



(function() {

    angular
        .module('app')
        .factory('urlShortenerService', urlShortenerService);

    urlShortenerService.$inject = [
        '$http',
        'public.urlShortenerApiKey',
        'public.urlShortenerApiUrl',
        'exception'
    ];

    function urlShortenerService($http, shortenerApiKey, urlShortenerApiUrl, exception) {

        var service = {
            shortenUrl: shortenUrl
        };

        return service;

        ///////////////////////////////////////////

        function shortenUrl(url) {

            var body = {
                longUrl: url
            };

            return $http.post(urlShortenerApiUrl + '?key=' + shortenerApiKey, body)
                .then(function(response) {
                    return response.data.id;
                })
                .catch(exception.catcher('There was a problem generating short url'));
        }

    }

}());

(function() {

    angular
        .module('app')
        .factory('api.usersService', UserService);

    UserService.$inject = ['$http', 'api.url', 'exception', '$q'];

    function UserService($http, apiUrl, exception, $q) {

        var service = {
            getAll: getAll,
            deleteUser: deleteUser,
            getMe: getMe,
            getClients: getClients,
            godCreatesUser: godCreatesUser
        };

        return service;

        //////////////////////////////////////

        function getAll() {

            var url = apiUrl + 'users';

            return $http.get(url)
                .catch(exception.catcher('There was a problem to get all users.'));
        }

        function deleteUser(id) {

            var url = apiUrl + 'user/' + id;

            return $http.delete(url)
                .catch(exception.catcher('There was a problem to delete user.'));

        }

        function getMe() {

            var url = apiUrl + 'me';

            return $http.get(url, {
                    __ingoreTermsOfUseAcceptance: true
                })
                .then(function(response) {

                    return response.data;

                })
                .catch(exception.catcher('There was a problem while getting your data.'));
        }

        function getClients(token) {

            var deffered = $q.defer();

            var url = apiUrl + 'user/clients';
            var config = getConfig(token);

            $http.get(url, config)
                .then(function(response) {
                    deffered.resolve(response.data);
                })
                .catch(function(error) {
                    deffered.reject('Token is invalid.');
                });

            return deffered.promise;
        }

        function godCreatesUser(user) {

            var url = apiUrl + 'users';

            var data = {
                username: user.username,
                password: user.password,
                email: user.email,
                organizationName: user.organisation,
                name: user.fullName
            };

            return $http.post(url, data)
                .then(function(response) {
                    return response.data;
                })
                .catch(exception.catcher('There was a problem create new user.'));
        }

        function getConfig(token) {

            var config = {
                headers: {},
                __donotrefreshtoken: true
            };

            if (token) {

                config.headers.Authorization = 'Bearer {0}'.format(token);

            }

            return config;
        }
    }

}());

(function(ng) {

    ng
        .module('app')
        .factory('asset.repository', assetsRepository);

    assetsRepository.$inject = ['api.assetsService', 'exception', 'assetModel'];

    function assetsRepository(assetsService, exception, AssetModel) {

        var service = {
            find: find,
            create: create,
            createUsingToken: createUsingToken,
            createUsingTicket: createUsingTicket,
            replaceControl: replaceControl,
            replaceProfile: replaceProfile,
            publishCommand: publishCommand,
            publishState: publishState,
            remove: remove,
            update: update
        };

        return service;

        //////////////////////////////

        function find(assetId) {

            return assetsService.getAsset(assetId)
                .then(function(response) {
                    var model = new AssetModel(response.data);
                    model.subscribe();
                    return model;
                });
        }

        function create(deviceId, name, title, type, profile, control) {

            return assetsService.createAsset(deviceId, name, title, type, profile, control)
                .then(function(response) {
                    var model = new AssetModel(response.data);
                    model.subscribe();
                    return model;
                })
                .catch(exception.catcher('Error creating new asset.'));
        }

        function createUsingToken(deviceId, asset, token) {

            return assetsService.createAssetUsingToken(deviceId, asset, token)
                .then(function(response) {
                    var model = new AssetModel(response.data);
                    model.subscribe();
                    return model;
                })
                .catch(exception.catcher('Error creating new asset.'));

        }

        function createUsingTicket(ticket, data) {

            return assetsService.createAssetUsingTicket(ticket, data)
                .then (function(response) {

                    var model = new AssetModel(response.data);
                    model.subscribe();
                    return model;

                })
                .catch(exception.catcher('Error creating new asset.'));

        }

        function replaceControl(deviceId, assetName, value) {

            return assetsService.replaceControl(deviceId, assetName, value)
                .then(function(response) {
                    return true;
                })
                .catch(exception.catcher('Error replacing control asset.'));
        }

        function replaceProfile(deviceId, assetName, value) {

            return assetsService.replaceProfile(deviceId, assetName, value)
                .then(function(response) {
                    return true;
                })
                .catch(exception.catcher('Error replacing asset profile.'));
        }

        function publishCommand(id, value) {

            return assetsService.publishCommand(id, value)
                .then(function(response) {
                    return true;
                })
                .catch(exception.catcher('Error publishing command.'));
        }

        function publishState(id, value) {

            return assetsService.publishState(id, value)
                .then(function(response) {
                    return true;
                })
                .catch(exception.catcher('Error publishing state.'));
        }

        function remove(deviceId, assetName) {
            return assetsService.deleteAsset(deviceId, assetName);
        }

        function update(deviceId, assetId, assetName, assetIs, title) {
            return assetsService.updateAsset(deviceId, assetId, assetName, assetIs, title)
                .then(function(response) {
                    var model = new AssetModel(response.data);
                    model.subscribe();
                    return model;
                });
        }
    }

}(window.angular));

 (function(ng) {
     ng
         .module('app')
         .factory('capp.live', cappLive);

     //cappLive.$inject = ['$window', '$rootScope', 'session', 'broker.url', 'broker.port', 'broker.sourceRoot', 'public.clientId', 'public.clientKey', '$q'];
     cappLive.$inject = ['$window', '$rootScope', 'session', 'app.config', '$q'];

     function cappLive($window, $rootScope, session, appConfig, $q) {

         var connected = false;
         var service = {
             init: init,
             entity: $window.CappLive,
             connect: connect,
             disconnect: disconnect,
             isConnected: isConnected,
             all: $window.CappLive.all,
             subscribe: $window.CappLive.subscribe
         };

         return service;

         /////////////////////

         function init() {

             $window.CappLive.brokerUrl = appConfig.broker.url;
             $window.CappLive.brokerPort = appConfig.broker.port;
             $window.CappLive.sourceRoot = appConfig.broker.sourceRoot;

             if (session.authentication().isAuth) {
                 save(session.authentication().rmq.clientId, session.authentication().rmq.clientKey);
                 connect(session.authentication().rmq.clientId, session.authentication().rmq.clientKey);
             }

             $rootScope.$on('user.login', function() {

                 disconnect().then(function() {
                     save(session.authentication().rmq.clientId, session.authentication().rmq.clientKey);
                     connect(session.authentication().rmq.clientId, session.authentication().rmq.clientKey);
                 });
             });

             $rootScope.$on('user.logout', function() {

                 disconnect();
             });
         }

         function connect(clientId, clientKey) {

             var deffered = $q.defer();

             var disconnectPromise = disconnect();

             disconnectPromise.then(function() {
                 $window.CappLive.connect(clientId, clientKey, function() {
                         deffered.resolve();
                         connected = true;
                     },

                     function() {
                         deffered.reject();
                         connected = false;
                     });
             });

             return deffered.promise;
         }

         function disconnect() {
             var deffered = $q.defer();

             $window.CappLive.disconnect(function() {
                 deffered.resolve();
                 connected = false;
             });

             return deffered.promise;
         }

         function isConnected() {
             return connected;
         }

         function save(clientId, clientKey) {

             $window.CappLive.clientId = clientId;
             $window.CappLive.clientKey = clientKey;
         }
     }

 }(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('controls.repository', controlsRepository);

    controlsRepository.$inject = ['utils'];

    function controlsRepository(utils) {

        var defaultDeviceControlName = 'bar-chart';

        var deviceControls = [{
            name: 'bar-chart',
            title: 'Bar Chart',
            description: 'Shows numerical assets activity in bar chart.'
        }, {
            name: 'line-chart',
            title: 'Line Chart',
            description: 'Shows numerical assets activity in line chart.'
        }, {
            name: 'area-range-chart',
            title: 'Area Graph Chart',
            description: 'Shows numerical assets activity with minimum and maximum values.'
        }];

        var service = {

            findAllDeviceControls: findAllDeviceControls,
            defaultDeviceControlName: defaultDeviceControlName

        };

        return service;

        ////////////////

        function findAllDeviceControls() {

            return utils.$q.when(deviceControls);

        }
    }
})();

(function() {

    angular
        .module('app')
        .factory('device.repository', devicesRepository);

    devicesRepository.$inject = ['api.devicesService', 'exception', 'deviceModel', 'utils', 'controls.repository'];

    function devicesRepository(devicesService, exception, DeviceModel, utils, controlsRepository) {

        var _defaultDeviceSettings = {

            control: controlsRepository.defaultDeviceControlName

        };

        var service = {
            create: create,
            createInGround: createInGround,
            update: update,
            updateControl: updateControl,
            remove: remove,
            find: find,
            findAll: findAll,
            findAllInGround: findAllInGround,

            //using token
            createUsingToken: createUsingToken,
            updateUsingToken: updateUsingToken,
            findAllUsingToken: findAllUsingToken,
            findSelfUsingTicket: findSelfUsingTicket,

            saveDeviceSettings: saveDeviceSettings,
            getDeviceSettings: getDeviceSettings
        };

        return service;

        //////////////////////////////

        function create(data) {

            return devicesService.create(data)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice)
                .catch(exception.catcher('Error creating new device.'));

        }

        function subscribeDevice(device) {

            device.subscribe(true);

            return device;

        }

        function createInGround(data, groundId) {

            return devicesService.createInGround(data, groundId)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice)
                .catch(exception.catcher('Error creating new device.'));

        }

        function update(deviceId, data) {

            return devicesService.updateDevice(deviceId, data)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice)
                .catch(exception.catcher('Error updating device.'));

        }

        function updateControl(id, control) {

            return devicesService.updateDeviceControl(id, control)
                .catch(exception.catcher('Error updating device control.'));

        }

        function remove(id) {

            return devicesService.deleteDevice(id)
                .catch(exception.catcher('Error deleting device'));

        }

        function createUsingToken(deviceConfig, token) {

            return devicesService.createUsingToken(deviceConfig, token)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice)
                .catch(exception.catcher('Error creating new device.'));

        }

        function updateUsingToken(deviceConfig, token) {

            return devicesService.updateUsingToken(deviceConfig, token)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice)
                .catch(exception.catcher('Error updating device.'));

        }

        function find(deviceId) {

            return devicesService.get(deviceId)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice);

        }

        function findAll(byName) {

            return devicesService.getAll(byName)
                .then(utils.transformResponse(DeviceModel))
                .catch(exception.catcher('Error loading devices'));

        }

        function findAllInGround(groundId) {

            return devicesService.getFromGround(groundId)
                .then(utils.transformResponse(DeviceModel))
                .catch(exception.catcher('Error loading devices'));

        }

        function findAllUsingToken(byName, token) {

            return devicesService.getAllUsingToken(byName, token)
                .then(utils.transformResponse(DeviceModel))
                .catch(exception.catcher('Error loading public devices'));

        }

        function saveDeviceSettings(deviceId, settings) {

            var key = getDeviceSettingsKey(deviceId);

            var existingSettings = utils.preferences.readGlobal(key);

            if (existingSettings) {

                angular.extend(existingSettings, settings);

            } else {

                existingSettings = settings;

            }

            utils.preferences.rememberGlobal(key, existingSettings);

            return utils.$q.when();

        }

        function getDeviceSettings(deviceId) {

            var key = getDeviceSettingsKey(deviceId);

            var existingSettings = utils.preferences.readGlobal(key);

            var settings = null;

            if (existingSettings) {

                settings = angular.extend({}, _defaultDeviceSettings, existingSettings);

            } else {

                settings = angular.extend({}, _defaultDeviceSettings);

            }

            return utils.$q.when(settings);
        }

        function findSelfUsingTicket(ticket) {

            return devicesService.getSelfUsingTicket(ticket)
                .then(utils.transformResponse(DeviceModel))
                .then(subscribeDevice);

        }

        function getDeviceSettingsKey(deviceId) {

            return 'device-settings-{0}'.format(deviceId);

        }
    }

}());

(function() {

    angular
        .module('app')
        .factory('gateway.repository', gatewayRepository);

    gatewayRepository.$inject = ['api.GatewayService', 'exception', 'gatewayModel', 'utils'];

    function gatewayRepository(gatewayService, exception, GatewayModel, utils) {

        var service = {
            find: find,
            findAll: findAll,
            remove: remove,
            update: update,
            findAllInGround: findAllInGround,
            claimGateway: claimGateway
        };

        return service;

        //////////////////////////////

        function find(gatewayId, includeDevices, includeAssets) {

            if (!includeDevices) {

                includeDevices = false;

            }

            if (!includeAssets) {

                includeAssets = false;

            }

            return gatewayService.getGateway(gatewayId, includeDevices, includeAssets)
                .then(utils.transformResponse(GatewayModel))
                .catch(exception.catcher('There was a problem to load gateway.'));
        }

        function findAll() {

            return gatewayService.listGateways()
                .then(utils.transformResponse(GatewayModel))
                .catch(exception.catcher('There was a problem to load gateways.'));

        }

        function findAllInGround(groundId) {

            return gatewayService.getFromGround(groundId)
                .then(utils.transformResponse(GatewayModel))
                .catch(exception.catcher('There was a problem to load gateways.'));

        }

        function remove(gatewayId) {

            return gatewayService.deleteGateway(gatewayId)
                .catch(exception.catcher('There was a problem to remove gateway.'));

        }

        function update(gatewayId, name, description) {

            return gatewayService.updateGateway(gatewayId, name, description)
                .catch(exception.catcher('There was a problem to update gateway.'));

        }

        function claimGateway(groundId, claimCode) {

            return gatewayService.claimGateway(groundId, claimCode)
                .catch(exception.catcher('There was a problem to claim gateway.'));
        }

    }

}());

(function() {
    'use strict';

    angular
        .module('app')
        .factory('ground.repository', groundRepository);

    groundRepository.$inject = ['groundsService', 'groundModel', 'exception', 'utils'];

    function groundRepository(groundsService, GroundModel, exception, utils) {

        var service = {
            find: find,
            findAll: findAll,
            findAllPublic: findAllPublic,
            findAllShared: findAllShared,
            delete: deleteGround,
            create: create,
            update: update
        };

        return service;

        ////////////////

        function find(id) {

            return groundsService.find(id)
                .then(utils.transformResponse(GroundModel));
        }

        function findAll() {

            return groundsService.findAll()
                .then(utils.transformResponse(GroundModel))
                // .catch(exception.catcher('Error while loading Grounds.'));
        }

        function findAllPublic() {

            return groundsService.findAllPublic()
                .then(utils.transformResponse(GroundModel))
                // .catch(exception.catcher('Error while loading Grounds.'));
        }

        function findAllShared() {

            return groundsService.findAllShared()
                .then(utils.transformResponse(GroundModel))
                // .catch(exception.catcher('Error while loading Grounds.'));
        }

        function deleteGround(id) {

            return groundsService.delete(id)
                .then(function() {
                    utils.$rootScope.$emit('ground.delete', id);
                })
                .catch(exception.catcher('Error while deleting ground.'));
        }

        function create(name, visibility) {

            return groundsService.create(name, visibility)
                .then(utils.transformResponse(GroundModel))
                .then(function(ground) {
                    utils.$rootScope.$emit('ground.create', ground);
                    return ground;
                })
                .catch(exception.catcher('Error while creating ground.'));

        }

        function update(id, data) {

            return groundsService.update(id, data)
                .then(utils.transformResponse(GroundModel))
                .then(function(ground) {
                    utils.$rootScope.$emit('ground.update', ground);
                    return ground;
                })
                .catch(exception.catcher('Error while updating ground.'));
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('history.service', historyService);

    historyService.$inject = ['api.assetsService'];

    function historyService(assetsService) {

        var service = {

            getAssetHistory: getAssetHistory,

            subscribeOnAssetStateChange: subscribeOnAssetStateChange

        };

        return service;

        ////////////////////////////////////////////////////////////

        function getAssetHistory(assetId, from, to, resolution) {

            return assetsService.getAssetHistory(assetId, from, to, resolution);

        }

        function subscribeOnAssetStateChange(asset, stateChangeHandler) {

            asset.on('state', stateChangeHandler);

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('members.repository', membersRepository);

    membersRepository.$inject = ['membersService', 'memberModel', 'exception', 'utils'];

    function membersRepository(membersService, MemberModel, exception, utils) {

        var service = {
            findAll: findAll,
            deleteMember: deleteMember,
            addMember: addMember
        };

        return service;

        ////////////////

        function findAll(groundId) {

            return membersService.findAll(groundId)
                .then(utils.transformResponse(MemberModel))
                .catch(exception.catcher('Error while loading members.'));
        }

        function deleteMember(groundId, memberId) {

            return membersService.deleteMember(groundId, memberId)
                .catch(exception.catcher('Error deleting member.'));
        }

        function addMember(groundID, memberEmail) {

            return membersService.addMember(groundID, memberEmail)
                .then(utils.transformResponse(MemberModel))
                .catch(exception.catcher('Error occured while adding member.'));

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.game', GameFactory);

    GameFactory.$inject = ['demo.level', '$timeout'];

    function GameFactory(Level, $timeout) {

        var startCaption = '';
        var preSuspensionStatus = 'playing';

        function Game() {
            this.levels = [];
            this.caption = startCaption;
            this.status = 'tutorial';
            this.gameScreen = 'up';
            this.currentLevelIndex = 0;
            this.finishTimeout = null;
            this.transitionTimeout = null;
            this.transitionKeyTimeout = null;
            this.isLocked = false;
            this.key = '';

            var l1 = new Level.State(this, {
                order: 1,
                key: 'down',
                text: 'Put your phone on table',
                timeoutCaption: 'Nope, it\'s not on the table yet',
                successCaption: 'Cool, your phone is on table!',
                expectedAssetState: {
                    name: 'position',
                    value: 'ontable'
                }
            });

            var l2 = new Level.State(this, {
                order: 2,
                key: 'left',
                text: 'Now, rotate your phone left',
                timeoutCaption: 'Cmon, rotate it left',
                successCaption: 'Great, you rotated left!',
                expectedAssetState: {
                    name: 'rotation',
                    value: 'leftRotation'
                }
            });

            var l3 = new Level.State(this, {
                order: 3,
                key: 'right',
                text: 'Now, rotate your phone right',
                timeoutCaption: 'Cmon, rotate it right',
                successCaption: 'Great, you rotate it right!',
                expectedAssetState: {
                    name: 'rotation',
                    value: 'rightRotation'
                }
            });

            var l4 = new Level.State(this, {
                order: 4,
                key: 'shake',
                text: 'Now, shake it baby',
                timeoutCaption: 'Don\'t be shy, shake it :)',
                successCaption: 'Ooo, yeees, great.',
                expectedAssetState: {
                    name: 'amishaking',
                    value: 'shaking'
                },
                transition: {
                    delay: 4000,
                    status: {
                        delay: 1500,
                        caption: 'Going to the free level...',
                        key: 'tutorial-end'
                    }
                }
            });

            var l5 = new Level.Free(this, {
                order: 5,
                key: 'free',
                text: 'Try making some of previous moves, we\'ll guess which one it is',
                hideInNav: true
            });

            this.levels.push(l1, l2, l3, l4, l5);
        }

        Game.prototype.addLevel = function(levelConfig) {
            this.levels.push(this, levelConfig);
        };

        Game.prototype.setCaption = function(captionText) {
            this.caption = captionText;
        };

        Game.prototype.start = function() {
            this.getCurrentLevel().enter();
            if (this.status !== 'suspended') {
                this.status = 'tutorial';
            }
        };

        Game.prototype.suspend = function() {
            if (this.status !== 'suspended') {
                preSuspensionStatus = this.status;
                this.status = 'suspended';
            }
        };

        Game.prototype.unsuspend = function() {
            if (this.status === 'suspended') {
                this.status = preSuspensionStatus;
            }
        };

        Game.prototype.getCurrentLevel = function() {
            return this.levels[this.currentLevelIndex];
        };

        Game.prototype.isCurrentLevel = function(l) {
            return l.order === this.getCurrentLevel().order;
        };

        Game.prototype.isComplete = function() {
            var isComplete = true;

            angular.forEach(this.levels, function(l) {
                if (!l.isComplete) {
                    isComplete = false;
                }
            });

            return isComplete;
        };

        Game.prototype.setGameScreen = function(gameScreen) {
            this.gameScreen = gameScreen;
        };

        Game.prototype.play = function(assetName, assetValue) {

            var that = this;

            if (that.isComplete() || that.isLocked) {
                return;
            }

            var level = that.getCurrentLevel();
            level.stateChanged(assetName, assetValue);

            if (!that.isComplete() && level.isComplete) {
                if (!level.transition) {
                    that.currentLevelIndex++;
                    that.getCurrentLevel().enter();
                    that.key = that.getCurrentLevel().key;
                } else {
                    that.isLocked = true;

                    //delay transition to the next step
                    that.transitionTimeout = $timeout(function() {
                            that.currentLevelIndex++;
                            that.getCurrentLevel().enter();
                            that.key = that.getCurrentLevel().key;
                            that.isLocked = false;
                        },

                        level.transition.delay);

                    //delay change of the text and screen
                    that.transitionKeyTimeout = $timeout(function() {
                            that.setCaption(level.transition.status.caption);
                            that.key = level.transition.status.key;
                        },

                        level.transition.status.delay);
                }
            }
        };

        Game.prototype.skip = function() {

            var level = this.getCurrentLevel();
            level.skip();

            if (!this.isComplete() && level.isComplete) {
                this.currentLevelIndex++;
                this.getCurrentLevel().enter();
                this.key = this.getCurrentLevel().key;
            }

            this.setCaption('');
        };

        Game.prototype.restart = function() {
            if (this.finishTimeout) {
                $timeout.cancel(this.finishTimeout);
            }

            if (this.transitionTimeout) {
                $timeout.cancel(this.transitionTimeout);
            }

            if (this.transitionKeyTimeout) {
                $timeout.cancel(this.transitionKeyTimeout);
            }

            angular.forEach(this.levels, function(l) {
                l.reset();
            });

            this.currentLevelIndex = 0;
            this.caption = startCaption;
            this.status = 'tutorial';
            this.key = null;
            this.isLocked = false;
            this.gameScreen = 'up';
            this.start();
        };

        return Game;
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.level', LevelFactory);

    LevelFactory.$inject = ['$timeout', '$interval'];

    function LevelFactory($timeout, $interval) {

        //Base Level
        function BaseLevel() {

            this.isComplete = false;
            this.isTimeouted = false;
            this.isWaiting = false;
            this.order = 0;
            this.key = '';
            this.text = '';
            this.game = null;
            this.hideInNav = false;
            this.transition = null;
        }

        BaseLevel.prototype.stateChanged = function(assetName, assetValue) {};

        BaseLevel.prototype.enter = function() {};

        BaseLevel.prototype.reset = function() {};

        BaseLevel.prototype.skip = function() {};

        //State Level
        function StateLevel(game, config) {

            this.game = game;
            this.order = config.order;
            this.key = config.key;
            this.text = config.text;
            this.timeoutCaption = config.timeoutCaption;
            this.successCaption = config.successCaption;
            this.expectedAssetState = config.expectedAssetState;

            this.captionWarningTimerInterval = 7000;
            this.captionWarningTimer = null;
            this.waitingTimerInterval = 3000;
            this.waitingTimer = null;

            if (config.transition) {
                this.transition = config.transition;
            }

            if (config.captionWarningTimerInterval) {
                this.captionWarningTimerInterval = config.captionWarningTimerInterval;
            }

            if (config.waitingTimerInterval) {
                this.waitingTimerInterval = config.waitingTimerInterval;
            }
        }

        StateLevel.prototype = new BaseLevel();
        StateLevel.prototype.constructor = StateLevel;

        StateLevel.prototype.stateChanged = function(assetName, assetValue) {

            if (this.expectedAssetState.name === assetName && this.expectedAssetState.value === assetValue) {

                $timeout.cancel(this.captionWarningTimer);
                $timeout.cancel(this.waitingTimer);

                this.game.setCaption(this.successCaption);
                this.game.setGameScreen(this.key);
                this.isComplete = true;
                this.isTimeouted = false;
                this.isWaiting = false;
            }
        };

        StateLevel.prototype.skip = function() {
            this.isComplete = true;
            this.isTimeouted = false;
            this.isWaiting = false;

            if (this.captionWarningTimer) {
                $timeout.cancel(this.captionWarningTimer);
            }

            if (this.waitingTimer) {
                $timeout.cancel(this.waitingTimer);
            }
        };

        StateLevel.prototype.enter = function() {
            var that = this;

            that.captionWarningTimer = $timeout(function() {
                that.game.setCaption(that.timeoutCaption);
                that.isTimeouted = true;
            }, that.captionWarningTimerInterval);

            that.waitingTimer = $timeout(function() {
                that.isWaiting = true;
            }, that.waitingTimerInterval);
        };

        StateLevel.prototype.reset = function() {

            this.isComplete = false;
            this.isTimeouted = false;
            this.isWaiting = false;

            if (this.captionWarningTimer) {
                $timeout.cancel(this.captionWarningTimer);
            }

            if (this.waitingTimer) {
                $timeout.cancel(this.waitingTimer);
            }
        };

        //Free Level
        function FreeLevel(game, config) {
            this.game = game;
            this.order = config.order;
            this.key = config.key;
            this.text = config.text;
            this.hideInNav = config.hideInNav;

            this.queue = [];
        }

        FreeLevel.prototype = new BaseLevel();
        FreeLevel.prototype.constructor = FreeLevel;

        FreeLevel.prototype.stateChanged = function(assetName, assetValue) {

            this.queue.push({
                assetName: assetName,
                assetValue: assetValue
            });
        };

        FreeLevel.prototype.enter = function() {
            var that = this;
            that.game.setGameScreen('up');

            $interval(function() {
                that.processQueue();
            }, 30);

            that.game.status = 'free';
            that.game.setCaption('');
        };

        FreeLevel.prototype.processQueue = function() {
            var that = this;
            var item = that.queue.shift();

            if (!item) {
                return;
            }

            var assetName = item.assetName;
            var assetValue = item.assetValue;

            if (that.game.gameScreen === 'up') {
                if (assetName === 'position' && assetValue === 'ontable') {

                    that.game.setGameScreen('down');
                    that.game.setCaption('I\'m on a table');
                }
            }

            if (that.game.gameScreen === 'down' || that.game.gameScreen === 'left' || that.game.gameScreen === 'right') {
                if (assetName === 'position' && assetValue === 'notontable') {

                    that.game.setGameScreen('up');
                    that.game.setCaption('I\'m up!');
                }
            }

            if (assetName === 'amishaking' && assetValue === 'shaking') {

                that.game.setGameScreen('shake');
                that.game.setCaption('I\'m Shakin\'!');
            }

            if (that.game.gameScreen === 'shake') {
                if (assetName === 'amishaking' && assetValue === 'still') {

                    that.game.setGameScreen('up');
                    that.game.setCaption('I\'m up!');
                }
            }

            if (that.game.gameScreen === 'shake') {
                if (assetName === 'position' && assetValue === 'ontable') {

                    that.game.setGameScreen('down');
                    that.game.setCaption('I\'m on a table');
                }
            }

            if (that.game.gameScreen !== 'shake') {
                if (assetName === 'rotation' && assetValue === 'leftRotation') {

                    that.game.setGameScreen('left');
                    that.game.setCaption('Left rotation!');
                }

                if (assetName === 'rotation' && assetValue === 'rightRotation') {

                    that.game.setGameScreen('right');
                    that.game.setCaption('Right rotation!');
                }
            }
        };

        return {
            State: StateLevel,
            Free: FreeLevel
        };
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.motion', Motion);

    Motion.$inject = ['$window'];

    function Motion($window) {

        var service = {
            isSupported: isSupported,
            subscribeOnMoveChange: subscribeOnMoveChange
        };

        var moveSubscribers = [];
        var lastUpdate = -1;
        var x;
        var y;
        var z;
        var lastX;
        var lastY;
        var lastZ;
        var isListenerAttached = false;
        var lastPublishedMoveValue = null;
        var lastKnownDirection = null;
        var numRight = 0;
        var numLeft = 0;
        var isStill = null;
        var sampleCount = 0;

        var SAMPLE_INTERVAL = 20; //miliseconds
        var MOVE_THRESHOLD = 0.6;

        return service;

        /////////////////////////////

        function isSupported() {
            return ('ondevicemotion' in $window);
        }

        function subscribeOnMoveChange(moveHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            moveSubscribers.push(moveHandler);
        }

        function attachListener() {
            $window.addEventListener('devicemotion', deviceMotionChanged);
            isListenerAttached = true;
        }

        function deviceMotionChanged(event) {

            var date = new Date();
            var currentTime = date.getTime();

            x = event.acceleration.x;
            y = event.acceleration.y;
            z = event.acceleration.z;

            //one update every 100ms
            if ((currentTime - lastUpdate) > SAMPLE_INTERVAL) {

                var diffTime = currentTime - lastUpdate;
                lastUpdate = currentTime;

                var xDiff = lastX - x;
                sampleCount++;

                //decide direction
                if (xDiff > MOVE_THRESHOLD) {
                    numRight++;
                } else if (xDiff < -MOVE_THRESHOLD) {
                    numLeft++;
                }

            }

            if (sampleCount > 4) {
                if (numRight > numLeft) {
                    lastKnownDirection = 'right';
                } else if (numLeft > numRight) {
                    lastKnownDirection = 'left';
                } else {
                    publishMove(lastKnownDirection);
                }

                numRight = 0;
                numLeft = 0;
                sampleCount = 0;
            }

            lastX = x;
            lastY = y;
            lastZ = z;
        }

        function publishMove(isMoving) {
            if (lastPublishedMoveValue !== isMoving) {
                for (var i = 0; i < moveSubscribers.length; i++) {
                    moveSubscribers[i](isMoving);
                }

                lastPublishedMoveValue = isMoving;
            }
        }
    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('demo.orientation', orientation);

    orientation.$inject = ['$window'];

    function orientation($window) {

        var UPPER_BETA_POSITION_BOUND = 120;
        var LOWER_BETA_POSITION_BOUND = 60;
        var UPPER_BETA_LAYING_ON_TABLE = 10;
        var LOWER_BETA_LAYING_ON_TABLE = -5;
        var UPPER_ROTATION_BOUND = 5;
        var LOWER_ROTATION_BOUND = -5;
        var ROTATION_SENSITIVITY = 30;
        var SAMPLE_INTERVAL = 100; //ms

        var rotationSubscribers = [];
        var verticalSubscribers = [];
        var lastUpdate = -1;
        var isListenerAttached = false;
        var lastPublishedValue = null;

        var alpha, beta, gamma;
        var pAlpha, pBeta, pGamma;

        var service = {
            isSupported: isSupported,
            subscribeOnRotation: subscribeRotation,
            subscribeOnVerticalOrientationChange: subscribeVertical
        };

        return service;

        ////////////////////////////

        function isSupported() {
            return ('ondeviceorientation' in $window);
        }

        function subscribeRotation(rotationHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            rotationSubscribers.push(rotationHandler);
        }

        function subscribeVertical(verticalHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            verticalSubscribers.push(verticalHandler);
        }

        function attachListener() {
            $window.addEventListener('deviceorientation', deviceOrientationChanged);
            isListenerAttached = true;
        }

        function deviceOrientationChanged(event) {
            var date = new Date();
            var currentTime = date.getTime();

            alpha = Math.round(event.alpha);
            beta = Math.round(event.beta);
            gamma = Math.round(event.gamma);

            if (pAlpha === undefined || pBeta === undefined || pGamma === undefined) {
                pAlpha = alpha;
                pBeta = beta;
                pGamma = gamma;
            }

            if ((currentTime - lastUpdate) > SAMPLE_INTERVAL && (isValidRotation(alpha - pAlpha) || isValidRotation(beta - pBeta) || isValidRotation(gamma - pGamma))) {

                lastUpdate = currentTime;

                if (isRotating()) {
                    publishRotation('ROTATING');
                }

                if (isOnTable(beta)) {
                    publishVertical('ON TABLE RESTING');
                } else {
                    publishVertical('I AM NOT RESTING');
                }

                pAlpha = alpha;
                pBeta = beta;
                pGamma = gamma;
            }
        }

        function publishRotation(message) {

            for (var i = 0; i < rotationSubscribers.length; i++) {
                rotationSubscribers[i](message);
            }
        }

        function publishVertical(message) {

            if (lastPublishedValue !== message) {
                for (var i = 0; i < verticalSubscribers.length; i++) {
                    verticalSubscribers[i](message);
                }

                lastPublishedValue = message;
            }
        }

        function isVertical(value) {

            if (value > LOWER_BETA_POSITION_BOUND && value < UPPER_BETA_POSITION_BOUND) {
                return true;
            } else {
                return false;
            }
        }

        function isOnTable(value) {
            if (value > LOWER_BETA_LAYING_ON_TABLE && value < UPPER_BETA_LAYING_ON_TABLE) {
                return true;
            } else {
                return false;
            }
        }

        function isRotating() {

            alphaDiff = alpha - pAlpha;
            betaDiff = beta - pBeta;
            gammaDiff = gamma - pGamma;

            if (inRotationBound(alphaDiff) || inRotationBound(betaDiff) || inRotationBound(gammaDiff)) {
                return true;
            } else {
                return false;
            }
        }

        function isValidRotation(difference) {

            if (Math.abs(difference) > ROTATION_SENSITIVITY) {
                return true;
            } else {
                return false;
            }
        }

        function inRotationBound(value) {

            if (value < UPPER_ROTATION_BOUND && value > LOWER_ROTATION_BOUND) {
                return false;
            } else {
                return true;
            }
        }
    }
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .factory('demo.pageVisibility', pageVisibility);

    pageVisibility.$inject = ['$window'];

    function pageVisibility($window) {

        var visibilitySubscribers = [];
        var lastUpdate = -1;
        var isListenerAttached = false;
        var lastPublishedValue = true;
        var eventName = null;

        var service = {
            subscribeOnPageVisibility: subscribeOnPageVisibility,
            unsubscribeOnPageVisibility: unsubscribeOnPageVisibility
        };

        return service;

        ////////////////////////////

        function getHiddenProp() {
            var prefixes = ['webkit', 'moz', 'ms', 'o'];

            if ('hidden' in document) {
                return 'hidden';
            }

            for (var i = 0; i < prefixes.length; i++) {
                if ((prefixes[i] + 'Hidden') in document) {
                    return prefixes[i] + 'Hidden';
                }
            }

            return null;
        }

        function subscribeOnPageVisibility(visibilityHandler) {

            if (!isListenerAttached) {
                attachListener();
            }

            visibilitySubscribers.push(visibilityHandler);
        }

        function unsubscribeOnPageVisibility() {
            visibilitySubscribers = [];
            document.removeEventListener(eventName, pageVisibilityChanges);
            isListenerAttached = false;
        }

        function attachListener() {
            var visProp = getHiddenProp();
            if (visProp) {
                eventName = visProp.replace(/[H|h]idden/, '') + 'visibilitychange';
                document.addEventListener(eventName, pageVisibilityChanges);
            }

            isListenerAttached = true;
        }

        function pageVisibilityChanges(event) {
            publishVisibility(!lastPublishedValue);

        }

        function publishVisibility(message) {
            if (lastPublishedValue !== message) {
                for (var i = 0; i < visibilitySubscribers.length; i++) {
                    visibilitySubscribers[i](message);
                }

                lastPublishedValue = message;
            }
        }

    }
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.position', Position);

    Position.$inject = ['$window', '$timeout'];

    function Position($window, $timeout) {

        var service = {
            isSupported: isSupported,
            subscribeOnPositionChange: subscribeOnPositionChange,
            unsubscribeOnPositionChange: unsubscribeOnPositionChange
        };

        var positionSubscribers = [];
        var lastPublishedPosition = null;
        var otherLastPublishedPos = null;
        var isListenerAttached = false;

        var alpha;
        var beta;
        var gamma;
        var x;
        var y;
        var z;

        var MOVE_BOUND = 0.3;
        var HORIZONTAL_BOUND = 2;

        return service;

        ///////////////////////////////////////////

        function isSupported() {
            var isIt = (('ondevicemotion' in $window) && ('ondeviceorientation' in $window));
            return isIt;
        }

        function subscribeOnPositionChange(positionChangeHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            positionSubscribers.push(positionChangeHandler);

        }

        function unsubscribeOnPositionChange() {
            positionSubscribers = [];
            $window.removeEventListener('devicemotion', positionHandler);
            $window.removeEventListener('deviceorientation', positionHandler);
            isListenerAttached = false;
        }

        function attachListener() {
            $window.addEventListener('devicemotion', positionHandler);
            $window.addEventListener('deviceorientation', positionHandler);
            isListenerAttached = true;
        }

        function positionHandler(event) {
            if (event.alpha || event.beta || event.gamma) {
                alpha = event.alpha;
                beta = event.beta;
                gamma = event.gamma;
            }

            if (event.acceleration) {
                x = event.acceleration.x;
                y = event.acceleration.y;
                z = event.acceleration.z;
            }

            if (isDataCollected(alpha, beta, gamma) && isDataCollected(x, y, z)) {
                if (isLayingDown(beta, gamma)) {
                    if (isStill(x, y, z)) {
                        pub(true);
                    }
                } else {
                    pub(false);
                }
            }
        }

        var trueTimeout = null;

        function pub(position) {

            if (lastPublishedPosition != position) {

                if (trueTimeout) {
                    $timeout.cancel(trueTimeout);
                }

                if (position) {

                    trueTimeout = $timeout(function() {

                        publishPosition(true);

                    }, 200);

                } else {
                    publishPosition(false);
                }

                lastPublishedPosition = position;
            }
        }

        function publishPosition(position) {
            if (otherLastPublishedPos != position) {
                for (var i = 0; i < positionSubscribers.length; i++) {
                    positionSubscribers[i](position);
                }

                otherLastPublishedPos = position;
            }

        }

        function isDataCollected(x, y, z) {
            if (x !== null && y !== null && z !== null) {
                return true;
            } else {
                return false;
            }
        }

        function isLayingDown(beta, gamma) {
            if (beta > -HORIZONTAL_BOUND && beta < HORIZONTAL_BOUND) {
                if (gamma > -HORIZONTAL_BOUND && gamma < HORIZONTAL_BOUND) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return false;
            }
        }

        function isStill(x, y, z) {
            if ((x < MOVE_BOUND && x > -MOVE_BOUND) || (y < MOVE_BOUND && y > -MOVE_BOUND) || (z < MOVE_BOUND && z > -MOVE_BOUND)) {
                return true;
            } else {
                return false;
            }
        }
    }
})();

(function(ng) {
    ng
        .module('app')
        .factory('demo.rotation', rotation);

    rotation.$inject = ['$window', '$interval'];

    function rotation($window, $interval) {

        var UPPER_ROTATION_BOUND = 100;
        var LOWER_ROTATION_BOUND = -100;
        var SAMPLE_INTERVAL = 40; //ms
        var HORIZONTAL_BOUND = 5;

        var rotationSubscribers = [];
        var lastUpdate = -1;
        var isListenerAttached = false;
        var lastPublishedValue = null;
        var sampleCount = 0;
        var rightCount = 0;
        var leftCount = 0;

        var alpha;
        var beta;
        var gamma;
        var pAlpha;
        var pBeta;
        var pGamma;
        var alphaDiffSum = null;

        var service = {
            isSupported: isSupported,
            subscribeOnRotation: subscribeRotation,
            unsubscribeOnRotationChange: unsubscribeOnRotationChange
        };

        return service;

        ////////////////////////////

        function isSupported() {
            return ('ondeviceorientation' in $window);
        }

        function subscribeRotation(rotationHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            rotationSubscribers.push(rotationHandler);
        }

        function unsubscribeOnRotationChange() {
            rotationSubscribers = [];
            $window.removeEventListener('deviceorientation', deviceOrientationChanged);
            isListenerAttached = false;
        }

        function attachListener() {
            $window.addEventListener('deviceorientation', deviceOrientationChanged);
            isListenerAttached = true;

            $interval(function() {

                if (Math.abs(alphaDiffSum) > 20) {
                    if (isPhoneHorizontal(beta, gamma)) {
                        if (alphaDiffSum > 0) {
                            publishRotation('leftRotation');
                        } else {
                            publishRotation('rightRotation');
                        }
                    }
                }

                alphaDiffSum = null;

            }, 1000);
        }

        function deviceOrientationChanged(event) {

            var date = new Date();
            var currentTime = date.getTime();

            alpha = Math.round(event.alpha);
            beta = Math.round(event.beta);
            gamma = Math.round(event.gamma);

            if (pAlpha === undefined) {
                pAlpha = alpha;
            }

            if ((currentTime - lastUpdate) > SAMPLE_INTERVAL && alpha !== pAlpha) {

                lastUpdate = currentTime;
                var alphaDiff = alpha - pAlpha;

                if (Math.abs(alphaDiff) < 100) {
                    if (alphaDiffSum === null) {
                        alphaDiffSum = 0;
                    }

                    alphaDiffSum += alphaDiff;
                }
            }

            pAlpha = alpha;
        }

        function publishRotation(message) {

            for (var i = 0; i < rotationSubscribers.length; i++) {
                rotationSubscribers[i](message);
            }

        }

        function isPhoneHorizontal(beta, gamma) {
            if ((beta > -HORIZONTAL_BOUND && beta < HORIZONTAL_BOUND) && (gamma > -HORIZONTAL_BOUND && gamma < HORIZONTAL_BOUND)) {
                return true;
            } else {
                return false;
            }
        }

    }
}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.sensors', sensorsFactory);

    sensorsFactory.$inject = ['demo.shake',
        'demo.position',
        'demo.motion',
        'demo.pageVisibility',
        'demo.rotation'
    ];

    function sensorsFactory(shake, position, motion, pageVisibility, rotation) {
        var service = {
            shake: shake,
            position:position,
            motion:motion,
            pageVisibility: pageVisibility,
            rotation:rotation
        };
        return service;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.shake', shake);

    shake.$inject = ['$window', '$interval'];

    function shake($window, $interval) {

        var service = {
            isSupported: isSupported,
            subscribeOnShakeChange: subscribeShaker,
            unsubscribeOnShakeChange: unsubscribeShaker,
            subscribeOnSpeedChange: subscribeOnSpeedChange
        };

        var shakeSubscribers = [];
        var speedSubscribers = [];
        var lastUpdate = -1;
        var x;
        var y;
        var z;
        var lastX;
        var lastY;
        var lastZ;
        var isListenerAttached = false;
        var lastPublishedShakeValue = null;
        var lastPublishedSpeedValue = null;
        var timesShaken = 0;
        var intervalPromise = null;

        var SHAKE_THRESHOLD_SPEED = 500;
        var SAMPLE_INTERVAL = 50; //miliseconds
        var MOVE_THRESHOLD = 0.3;

        return service;

        /////////////////////////////

        function isSupported() {
            return ('ondevicemotion' in $window);
        }

        function subscribeShaker(shakeHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            shakeSubscribers.push(shakeHandler);
        }

        function unsubscribeShaker() {
            shakeSubscribers = [];
            $window.removeEventListener('devicemotion', deviceMotionChanged);
            isListenerAttached = false;

            if (intervalPromise !== null) {
                $interval.cancel(intervalPromise);
            }
        }

        function subscribeOnSpeedChange(speedHandler) {
            if (!isSupported()) {
                return;
            }

            if (!isListenerAttached) {
                attachListener();
            }

            speedSubscribers.push(speedHandler);
        }

        function attachListener() {
            $window.addEventListener('devicemotion', deviceMotionChanged);
            isListenerAttached = true;

            intervalPromise = $interval(function() {

                console.log(timesShaken, 'Times Shaken');

                if (timesShaken > 4) {
                    publishShake(true);
                }

                if (timesShaken <= 2) {
                    publishShake(false);
                }

                timesShaken = 0;
            }, 1000);
        }

        function deviceMotionChanged(event) {

            var date = new Date();
            var currentTime = date.getTime();

            x = event.acceleration.x;
            y = event.acceleration.y;
            z = event.acceleration.z;

            if ((currentTime - lastUpdate) > SAMPLE_INTERVAL) {

                var diffTime = currentTime - lastUpdate;
                lastUpdate = currentTime;

                var speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;
                if (speed > SHAKE_THRESHOLD_SPEED) {
                    timesShaken++;
                }
            }

            lastX = x;
            lastY = y;
            lastZ = z;
        }

        function publishShake(isShakin) {
            if (lastPublishedShakeValue !== isShakin) {
                for (var i = 0; i < shakeSubscribers.length; i++) {
                    shakeSubscribers[i](isShakin);
                }

                lastPublishedShakeValue = isShakin;
            }
        }

        function publishSpeed(speed) {
            if (lastPublishedSpeedValue !== speed) {
                for (var i = 0; i < speedSubscribers.length; i++) {
                    speedSubscribers[i](speed);
                }

                lastPublishedSpeedValue = speed;
            }

        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('demo.vibration', vibration);

    vibration.$inject = ['$window'];

    function vibration($window) {

        var service = {
            isSupported: isSupported,
            vibrate: vibrate
        };
        return service;

        ////////////////

        function isSupported() {
            return $window.navigator && $window.navigator.vibrate;
        }

        function vibrate(ms) {

            if (!isSupported()) {
                return;
            }

            if (!ms) {
                ms = 500;
            }

            $window.navigator.vibrate(ms);
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('deviceActivity', deviceActivity);

    deviceActivity.$inject = [];

    function deviceActivity() {

        var directive = {
            bindToController: true,
            controller: DeviceActivityController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/activity.html',
            restrict: 'E',
            scope: {
                device: '=',
                config: '='
            }
        };
        return directive;
    }

    DeviceActivityController.$inject = ['device.repository', 'utils'];

    function DeviceActivityController(deviceRepository, utils) {

        var vm = this;
        vm.assets = [];

        vm.colors = ['#56646D', '#2670E0', '#25C2D5', '#43C399', '#A8C14D', '#F4C45B', '#FF855A', '#FF6458', '#ED4D73', '#9068C8'];

        vm.assetChartConfig = {
            type: vm.config.type,
            refreshChart: false,
            timeScale: '60m',
            page: 0
        };

        var settings = {
            assetsToShow: [],
            control: vm.config.type
        };

        var showDefault = true;

        vm.numberOfNumericAssets = 0;

        vm.assetClicked = assetClicked;
        vm.generateColor = generateColor;
        vm.enableActivity = enableActivity;
        vm.setControl = setControl;
        vm.timeSelected = timeSelected;
        vm.setTimeLabel = setTimeLabel;
        vm.toggleFullscreen = toggleFullscreen;

        vm.scrollLeft = scrollLeft;
        vm.scrollRight = scrollRight;

        activate();

        // ////////////////

        function activate() {

            var deviceAssets = vm.device.assets;

            deviceRepository.getDeviceSettings(vm.device.id)
                .then(function(sett) {

                    if (sett.assetsToShow) {
                        settings.assetsToShow = sett.assetsToShow;
                        showDefault = false;
                    }

                    if (sett.page) {

                        settings.page = sett.page;

                    } else {

                        settings.page = 0;

                    }

                    if (sett.timeScale) {
                        settings.timeScale = sett.timeScale;
                    } else {
                        settings.timeScale = '60m';
                    }

                    for (var i = 0; i < deviceAssets.length; i++) {
                        if (isProfileNumeric(deviceAssets[i].profile)) {

                            vm.numberOfNumericAssets++;

                            var j = i;

                            if (showDefault === false) {

                                deviceAssets[i]._showAsset = false;

                                for (var m = 0; m < settings.assetsToShow.length; m++) {
                                    if (settings.assetsToShow[m] === deviceAssets[i].id) {
                                        deviceAssets[i]._showAsset = true;
                                    }
                                }
                            } else {

                                deviceAssets[i]._showAsset = true;

                                settings.assetsToShow.push(deviceAssets[i].id);

                                deviceRepository.saveDeviceSettings(vm.device.id, settings);

                                showDefault = false;
                            }

                            if (i < vm.colors.length) {

                                deviceAssets[i]._assetColor = vm.colors[i];

                            } else {

                                deviceAssets[i]._assetColor = vm.colors[j - vm.colors.length];

                            }

                            vm.assets.push(deviceAssets[i]);
                        }
                    }

                    vm.assetChartConfig.timeScale = settings.timeScale;

                    vm.assetChartConfig.page = settings.page;

                });

            utils.$rootScope.$on('timeScaleUpdated', function(event, params) {

                settings.timeScale = params;

                setTimeLabel();

                deviceRepository.saveDeviceSettings(vm.device.id, settings);

            });
        }

        function isProfileNumeric(profile) {

            if (profile.type === 'integer' || profile.type === 'number') {

                return true;

            } else {

                return false;

            }
        }

        function assetClicked(asset) {

            for (var i = 0; i < vm.assets.length; i++) {

                if (vm.assets[i].id === asset.id) {

                    vm.assets[i]._showAsset = !vm.assets[i]._showAsset;

                    vm.assetChartConfig.refreshChart = true;

                    if (vm.assets[i]._showAsset) {

                        settings.assetsToShow.push(vm.assets[i].id);

                        deviceRepository.saveDeviceSettings(vm.device.id, settings);

                    } else {

                        var index = settings.assetsToShow.indexOf(vm.assets[i].id);

                        if (index > -1) {
                            settings.assetsToShow.splice(index, 1);
                        }

                        deviceRepository.saveDeviceSettings(vm.device.id, settings);

                    }
                }

            }
        }

        function generateColor(asset) {

            var colorStyle = {
                'background-color': null
            };

            if (asset._assetColor) {
                colorStyle['background-color'] = asset._assetColor;
            } else {
                colorStyle['background-color'] = vm.colors[0];
            }

            return colorStyle;
        }

        function enableActivity(device) {

            return deviceRepository.update(device.id, {
                    name: device.name,
                    activityEnabled: true
                }).then(function(response) {

                    utils.notify.success('Success: ', 'Activity Log enabled.');

                    device.activityEnabled = true;

                })
                .catch(function(error) {

                    utils.notify.error('Error: ', 'Error updating device', null, true);

                });
        }

        function setControl(control) {

            vm.assetChartConfig.type = control;

            settings.control = control;

            deviceRepository.saveDeviceSettings(vm.device.id, settings);

            vm.assetChartConfig.refreshChart = true;

        }

        function timeSelected(time) {

            vm.assetChartConfig.timeScale = time;

            vm.assetChartConfig.page = 0;

            settings.timeScale = time;
            settings.page = 0;

            deviceRepository.saveDeviceSettings(vm.device.id, settings);

            vm.assetChartConfig.refreshChart = true;
        }

        function setTimeLabel() {

            var label = null;

            if (settings.timeScale === '24h') {

                label = '24 hours';

            }

            if (settings.timeScale === '60m') {
                label = '1 hour';
            }

            if (settings.timeScale === '7d') {

                label = '1 week';

            }

            if (settings.timeScale === '30d') {

                label = '1 month';

            }

            if (settings.timeScale !== '24h' && settings.timeScale !== '60m' && settings.timeScale !== '7d' && settings.timeScale !== '30d') {

                label = settings.timeScale;

            }

            return label;

        }

        function toggleFullscreen() {
            this.isFullscreen = !this.isFullscreen;
            vm.assetChartConfig.refreshChart = true;
        }

        function scrollLeft() {

            vm.assetChartConfig.page++;

            settings.page = vm.assetChartConfig.page;

            deviceRepository.saveDeviceSettings(vm.device.id, settings);

            vm.assetChartConfig.refreshChart = true;

        }

        function scrollRight() {

            if (vm.assetChartConfig.page > 0) {
                vm.assetChartConfig.page--;

                settings.page = vm.assetChartConfig.page;

                deviceRepository.saveDeviceSettings(vm.device.id, settings);

                vm.assetChartConfig.refreshChart = true;
            }

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('assetControlGrid', assetControlGrid);

    function assetControlGrid() {

        var directive = {
            bindToController: true,
            controller: AssetControlGridController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/controlgrid.html',
            restrict: 'E',
            scope: {
                assets: '=',
                groundId: '=',
                model: '='
            }
        };

        return directive;
    }

    AssetControlGridController.$inject = ['$scope', 'pinRepository', 'assetModel', 'GroundContext'];

    function AssetControlGridController($scope, pinRepository, AssetModel, groundContext) {

        var vm = this;

        vm.removeAsset = removeAsset;
        vm.isPinned = isPinned;
        vm.togglePin = togglePin;
        vm.bindableAssets = [];
        vm.currentGround = null;

        activate();

        ////////////////////////////

        function activate() {

            $scope.model = vm.model;

            $scope.$watchCollection('vm.assets', function(newAssets) {

                if (!newAssets) {

                    return;

                }

                for (var i = 0; i < newAssets.length; i++) {

                    var asset = newAssets[i];

                    asset._isPinned = isPinned(asset);

                }

                vm.bindableAssets = newAssets;

            });

            $scope.$watch('vm.groundId', function(newGroundId) {

                if (newGroundId) {

                    vm.currentGround = groundContext.find(newGroundId);

                }

            });
        }

        function removeAsset(assetId) {

            for (var i = 0; i < vm.assets.length; i++) {

                if (vm.assets[i].id == assetId) {

                    vm.assets.splice(i, 1);

                }
            }
        }

        function isPinned(asset) {

            return pinRepository.isPinned(vm.groundId, asset.id);

        }

        function togglePin(asset) {

            if (isPinned(asset)) {

                pinRepository.unpin(vm.groundId, asset);

                asset._isPinned = false;

                if (vm.removeOnUnpin) {

                    removeAsset(asset.id);

                }

            } else {

                pinRepository.pin(vm.groundId, asset);

                asset._isPinned = true;

            }
        }
    }

})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('deviceControl', deviceControl);

    deviceControl.$inject = ['$compile'];

    function deviceControl($compile) {

        var directive = {
            restrict: 'E',
            scope: {
                device: '=',
                control: '='
            },
            link: linker
        };

        return directive;

        /////////////////////////////////////////////

        function linker(scope, element, attrs) {

            scope.$watch('control', function(newValue) {
                if (scope.device) {
                    var ctrl = getControl(scope.control);
                    if (ctrl) {
                        element.html(ctrl);
                        $compile(element.contents())(scope);
                    }
                }
            });
        }

        function getControl(control) {

            if (!control) {
                return null;
            }

            return '<{0}-device-control device="device"></{0}-device-control>'.format(control);
        }
    }

})();

(function(ng) {
    ng
        .module('app')
        .directive('assetGrid', assetGrid);

    assetGrid.$inject = ['utility.deviceIcons', '$filter', '$state', 'utility.common'];

    function assetGrid(icons, $filter, $state, common) {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/devices/controls/grid.html',
            scope: {
                assets: '=',
                model: '='
            },
            link: linker
        };

        return directive;

        ////////////////////////
        function linker(scope) {

            scope.howMany = 0;

            scope.categories = [{
                name: 'primary',
                exists: false,
                assets: []
            }, {
                name: 'secondary',
                exists: false,
                assets: []
            }, {
                name: 'management',
                exists: false,
                assets: []
            }, {
                name: 'battery',
                exists: false,
                assets: []
            }, {
                name: 'config',
                exists: false,
                assets: []
            }, {
                name: 'undefined',
                exists: false,
                assets: []
            }];

            function prepareSections() {

                for (var i = 0; i < scope.categories.length; i++) {
                    scope.categories[i].assets = [];
                    scope.categories[i].exists = false;
                    scope.howMany = 0;
                }

                if (scope.assets) {
                    for (var i = 0; i < scope.assets.length; i++) {
                        for (var j = 0; j < scope.categories.length; j++) {
                            if (scope.assets[i].style == scope.categories[j].name) {
                                scope.categories[j].exists = true;
                                scope.categories[j].assets.push(scope.assets[i]);
                            }
                        }
                    }
                }
            }

            scope.shortenString = function(value) {

                if (value !== null && value !== undefined) {
                    if (typeof(value) == 'object') {
                        var stringified = JSON.stringify(value);
                        return common.limitStringLength(stringified, 10);
                    } else {
                        return common.limitStringLength(value, 10);
                    }
                }
            };

            scope.getAssetIcon = function(iconKey) {
                if (iconKey) {
                    return icons.getIcon(iconKey);
                } else {
                    return icons.getIcon('asset');
                }
            };

            scope.isSectionVisible = function(category) {
                if (category.exists && (scope.howMany > 1)) {
                    return true;
                }

                return false;
            };

            scope.prepareNameForView = function(sectionName) {
                if (sectionName == 'Undefined' || sectionName == 'undefined') {
                    sectionName = 'Other';
                }

                return sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
            };

            scope.goToAsset = function(assetId) {
                $state.go('main.asset', {
                    id: assetId
                });
            };

            scope.removeAsset = function(assetId) {

                for (var i = 0; i < scope.assets.length; i++) {
                    if (scope.assets[i].id == assetId) {
                        scope.assets.splice(i, 1);
                    }
                }

                for (var i = 0; i < scope.categories.length; i++) {
                    for (var y = 0; y < scope.categories[i].assets.length; y++) {
                        if (scope.categories[i].assets[y].id == assetId) {
                            scope.categories[i].assets.splice(y, 1);
                        }
                    }
                }
            };

            scope.$watchCollection('assets', function() {
                prepareSections();

                for (var i = 0; i < scope.categories.length; i++) {
                    if (scope.categories[i].exists === true) {
                        scope.howMany++;
                    }
                }

            });
        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .factory('FirstAppDictionary', factory);

    factory.$inject = ['firstAppRepository'];

    function factory(firstAppRepository) {

        function FirstAppDictionary() {

            this.rpiParts = firstAppRepository.getRPIParts();

            this.arduinoParts = firstAppRepository.getArduinoParts();

            this['intel-edisonParts'] = firstAppRepository.getEdisonParts();

        }

        FirstAppDictionary.prototype.getHeader = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.header;

        };

        FirstAppDictionary.prototype.getAsset = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.asset;
        };

        FirstAppDictionary.prototype.getCredentials = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.credentials;
        };

        FirstAppDictionary.prototype.getPinModes = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.pinModes;
        };

        FirstAppDictionary.prototype.getCallback = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.callback;

        };

        FirstAppDictionary.prototype.getConnect = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.connect;

        };

        FirstAppDictionary.prototype.getWhileLoop = function(deviceType) {

            var item = this[deviceType + 'Parts'];

            return item.while;
        };

        FirstAppDictionary.prototype.generateScript = function(device, auth) {

            var that = this;

            var script = null;

            if (device.type === 'arduino') {

                script = that.generateArduinoScript(device, auth);

            } else if (device.type === 'rpi') {

                script = that.generateRPIScript(device, auth);

            } else if (device.type === 'intel-edison') {

                script = that.generateEdisonScript(device, auth);

            }

            return script;

        };

        FirstAppDictionary.prototype.generateRPIScript = function(device, auth) {

            var that = this;

            var script = '';

            script += that.getHeader(device.type);

            var credentials = that.getCredentials(device.type);

            credentials = credentials.replace('DEVICE_ID', device.id);
            credentials = credentials.replace('CLIENT_ID', auth.clientId);
            credentials = credentials.replace('CLIENT_KEY', auth.clientKey);

            script += credentials;

            var asset1 = null;
            var asset2 = null;

            if (device.assets.length > 0) {

                for (var i = 0; i < device.assets.length; i++) {

                    var currentAsset = device.assets[i];

                    if (currentAsset.name === 'led' && asset1 === null) {

                        asset1 = configureAsset(that.getAsset(device.type), currentAsset.name, currentAsset.is, 4, currentAsset.title, 'digital');
                    }

                    if (currentAsset.name === 'rotary_knob' && asset2 === null) {

                        asset2 = configureAsset(that.getAsset(device.type), currentAsset.name, currentAsset.is, 0, currentAsset.title, 'analog');

                    }
                }
            }

            script += asset1 + asset2 + that.getPinModes(device.type);

            script += that.getCallback(device.type) + that.getConnect(device.type) + that.getWhileLoop(device.type);

            return script;
        };

        FirstAppDictionary.prototype.generateArduinoScript = function(device, auth) {

            var that = this;

            var script = null;

            script = that.getHeader(device.type);

            var credentials = that.getCredentials(device.type);

            credentials = credentials.replace('DEVICE_ID', device.id);
            credentials = credentials.replace('CLIENT_ID', auth.clientId);
            credentials = credentials.replace('CLIENT_KEY', auth.clientKey);

            script += credentials;

            script += that.getPinModes(device.type);

            script += that.getConnect(device.type);

            script += that.getWhileLoop(device.type) + that.getCallback(device.type);

            return script;
        };

        FirstAppDictionary.prototype.generateEdisonScript = function(device, auth) {

            var that = this;

            var script = '';

            script += that.getHeader(device.type);

            var credentials = that.getCredentials(device.type);

            credentials = credentials.replace('DEVICE_ID', device.id);
            credentials = credentials.replace('CLIENT_ID', auth.clientId);
            credentials = credentials.replace('CLIENT_KEY', auth.clientKey);

            script += credentials;

            var asset = null;

            if (device.assets.length > 0) {

                for (var i = 0; i < device.assets.length; i++) {

                    var assetName = device.assets[i].name;

                    var assetNameTrail = assetName.slice(-1);

                    if (assetNameTrail === '4' && asset === null) {

                        asset = that.getAsset(device.type);

                        asset = asset.replace('ACTUATOR_ID', assetNameTrail);
                    }
                }
            }

            script += asset;

            script += that.getPinModes(device.type);

            script += that.getCallback(device.type);

            script += that.getConnect(device.type);

            script += that.getWhileLoop(device.type);

            return script;
        };

        function configureAsset(assetScript, assetName, assetType, pinNumber, assetTitle, assetMode) {

            assetScript = assetScript.replace('ASSET_NAME', assetName);

            assetScript = assetScript.replace(new RegExp('PIN_NUMBER', 'g'), pinNumber);

            assetScript = assetScript.replace(new RegExp('ASSET_TYPE', 'g'), assetType);

            if (assetMode !== null && assetMode !== undefined) {

                assetScript = assetScript.replace('ASSET_MODE', assetMode);

            } else {

                assetScript = assetScript.replace('ASSET_MODE', 'digital');
            }

            if (assetTitle !== null && assetTitle !== undefined) {

                assetScript = assetScript.replace('ASSET_TITLE', assetTitle);

            } else {

                assetScript = assetScript.replace('ASSET_TITLE', assetName);
            }

            return assetScript;

        }

        FirstAppDictionary.prototype.create = function() {

            return new FirstAppDictionary();
        };

        return FirstAppDictionary;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('firstAppRepository', FirstAppRepo);

    FirstAppRepo.$inject = [];

    function FirstAppRepo() {

        var service = {

            getRPIParts: getRPIParts,
            getArduinoParts: getArduinoParts,
            getEdisonParts: getEdisonParts
        };

        var scriptParts = {

            rpi: [
            {title: 'header', content: 'import grovepi  #provides pin support\nimport ATT_IOT as IOT   #provide cloud support\nfrom time import sleep  #pause the app\n\n'},
            {title: 'credentials', content: '#credentials for the ATT IOT platform connection\nIOT.DeviceId = "DEVICE_ID"\nIOT.ClientId = "CLIENT_ID"\nIOT.ClientKey = "CLIENT_KEY"\n\n'},
            {title: 'asset', content: '#set ASSET_TITLE pin to ASSET_MODE PIN_NUMBER and get its name\nASSET_TYPEName = "ASSET_NAME"  #name of the ASSET_TYPE\nASSET_TYPEPin = PIN_NUMBER\n\n'},
            {title: 'pinModes', content: '#set up the pins for usage\ngrovepi.pinMode(sensorPin,"INPUT")\ngrovepi.pinMode(actuatorPin,"OUTPUT")\n\n'},
            {title: 'callback', content: '#callback: handles values sent from the cloudapp to the device\ndef on_message(assetName, value):\n    if assetName == actuatorName:\n        value = value.lower()                    #make certain that the value is in lower case, for True vs true\n        if value == "true":\n            grovepi.digitalWrite(actuatorPin, 1)\n            IOT.send("true", actuatorPin)        #provide feedback to the cloud that the operation was succesful\n        elif value == "false":\n            grovepi.digitalWrite(actuatorPin, 0)\n            IOT.send("false", actuatorPin)       #provide feedback to the cloud that the operation was succesful\n        else:\n            print("unknown value: " + value)\n    else:\n        print("unknown actuator: " + assetName)\nIOT.on_message = on_message\n\n'},
            {title: 'connect', content: 'IOT.connect()  #connects your device to the ATT IOT platform\nIOT.subscribe()  #starts the bi-directional communication\n\n'},
            {title: 'while', content: '#main loop: run as long as the device is turned on\nwhile True:\n    try:\n        # Read sensor value from potentiometer\n        sensor_value = grovepi.analogRead(sensorPin)\n        # Send sensor value to cloud\n        IOT.send(sensor_value, sensorName)\n        print ("Rotary knob value: " + str(sensor_value))\n    except IOError:\n        print ""'}
            ],

            arduino: [
            {title: 'header', content: '#include <Ethernet.h>\n#include <EthernetClient.h>\n#include <PubSubClient.h>\n#include <ATT_IOT.h>\n#include <SPI.h>  //required to have support for signed/unsigned long type.\n\n'},
            {title: 'credentials', content: 'char deviceId[] = "DEVICE_ID";\nchar clientId[] = "CLIENT_ID";\nchar clientKey[] = "CLIENT_KEY";\nbyte mac[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x01};  //Adapt to your Arduino MAC address if needed\n\n'},
            {title: 'asset', content: ''},
            {title: 'pinModes', content: 'int knobPin = 0;  // Analog 0 is the input pin\nint ledPin = 4;  // Pin 4 is the LED output pin\n\n'},
            {title: 'callback', content: '// Callback function: handles messages that were sent from the IOT platform to this device.\nvoid callback(char* topic, byte* payload, unsigned int length)\n{\n  String msgString;\n  {\n    char message_buff[length + 1];  //need to copy over the payload so that we can add a /0 terminator, this can then be wrapped inside a string for easy manipulation.\n    strncpy(message_buff, (char*)payload, length);  //copy over the data\n    message_buff[length] = \'\\0\';   //make certain that it ends with a null\n\n    msgString = String(message_buff);\n    msgString.toLowerCase();  //to make certain that our comparison later on works ok (it could be that a True or False was sent)\n  }\n\n  int* idOut = NULL;\n\n  {\n    // get asset pin\n    int pinNr = Device.GetPinNr(topic, strlen(topic));\n\n    Serial.print("Payload: ");\n    Serial.println(msgString);\n    Serial.print("topic: ");\n    Serial.println(topic);\n\n    if (pinNr == ledPin)\n    {\n      if (msgString == "false") {\n        digitalWrite(ledPin, LOW);  //turn off LED asset\n        idOut = &ledPin;\n      }\n      else if (msgString == "true") {\n        digitalWrite(ledPin, HIGH);  //turn on LED asset\n        idOut = &ledPin;\n      }\n    }\n  }\n  if(idOut != NULL)\n    Device.Send(msgString, *idOut);\n}\n' },
            {title: 'connect', content: '//required for the device connection\nvoid callback(char* topic, byte* payload, unsigned int length);\nchar httpServer[] = "api.smartliving.io";\nchar* mqttServer = "broker.smartliving.io";\nEthernetClient ethClient;\nPubSubClient pubSub(mqttServer, 1883, callback, ethClient);\nATTDevice Device(deviceId, clientId, clientKey);  //create the object that provides the connection to the cloud to manage the device.\n\nvoid setup()\n{\n  pinMode(ledPin, OUTPUT);  // initialize the digital pin as an output.\n  Serial.begin(9600);  // init serial link for debugging\n\n  if (Ethernet.begin(mac) == 0)  // Initialize the Ethernet connection\n  {\n    Serial.println(F("DHCP failed,end"));\n    while(true);  //we failed to connect, halt execution here.\n  }\n  delay(1000);  //give the Ethernet shield a second to initialize\n\n  while(!Device.Connect(&ethClient, httpServer))  // connect the device with the IOT platform\n    Serial.println("retrying");\n\n  while(!Device.Subscribe(pubSub))  // make certain that we can receive message from the iot platform (activate mqtt)\n    Serial.println("retrying");\n}\n\n'},
            {title: 'while', content: 'unsigned long time;  //only send every x amount of time.\nunsigned int prevVal =0;\nvoid loop()\n{\n  unsigned long curTime = millis();\n  if (curTime > (time + 1000))  // publish light reading every 5 seconds to sensor 1\n  {\n    unsigned int lightRead = analogRead(knobPin);  // read from Knob sensor\n    if(prevVal != lightRead){\n      Device.Send(String(lightRead), knobPin);\n      prevVal = lightRead;\n    }\n    time = curTime;\n  }\n  Device.Process();\n}\n\n'}
            ],

            'intel-edison': [
            {title: 'header', content: '\'use strict\';\nvar smartliving = require(\'smartliving\');\nvar mraa = require(\'mraa\'); //Wrapper for GPIO Pins\n\n'},
            {title: 'credentials', content: 'smartliving.credentials = {\n    deviceId: \'DEVICE_ID\',\n    clientId: \'CLIENT_ID\',\n    clientKey: \'CLIENT_KEY\'\n};\n\n'},
            {title: 'asset', content: 'var actuatorId = \'ACTUATOR_ID\';\n'},
            {title: 'pinModes', content: 'var a0 = new mraa.Aio(0); //setup access analog input Analog pin #0 (A0)\nvar d4 = new mraa.Gpio(4); //LED hooked up to digital pin 4\nd4.dir(mraa.DIR_OUT); //set the gpio direction to output\nvar state = false; //Boolean to hold the state of Led\n\n'},
            {title: 'callback', content: 'function actuatorCallback() {\n    d4.write(state ? 0 : 1); //if state is true then write a 1 (high) otherwise write a 0 (low)\n    state = !state; //invert the ledState\n}\nsmartliving.registerActuatorCallback(actuatorId, actuatorCallback);\n\n'},
            {title: 'connect', content: 'smartliving.connect();\n\n'},
            {title: 'while', content: 'setInterval(function(){\n    var value = a0.read(); //read the value of the analog pin\n    smartliving.send(value, \'0\');\n}, 3000);'}
            ]
        };

        return service;

        ///////////////////////////////////////

        function getRPIParts() {

            var parts = {};

            var RPI = scriptParts.rpi;

            for (var i = 0; i < RPI.length; i++) {

                parts[RPI[i].title] = RPI[i].content;

            }

            return parts;

        }

        function getArduinoParts() {

            var parts = {};

            var arduino = scriptParts.arduino;

            for (var i = 0; i < arduino.length; i++) {

                parts[arduino[i].title] = arduino[i].content;

            }

            return parts;

        }

        function getEdisonParts() {

            var parts = {};

            var edison = scriptParts['intel-edison'];

            for (var i = 0; i < edison.length; i++) {

                parts[edison[i].title] = edison[i].content;

            }

            return parts;

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('assetModel', AssetModelFactory);

    AssetModelFactory.$inject = ['utility.deviceIcons', 'utils', 'messaging.relay'];

    function AssetModelFactory(icons, utils, messageRelay) {

        function AssetModel(data) {

            for (var attr in data) {
                if (data.hasOwnProperty(attr)) {
                    this[attr] = data[attr];
                }
            }

            this.subscriptions = [];
        }

        AssetModel.prototype.getIcon = function() {
            return icons.getIcon(this.is);
        };

        AssetModel.prototype.subscribe = function() {

            var that = this;

            var unsubscribeDelete = utils.$rootScope.$on('$messaging.asset.deleted', function(e, eventData) {

                if (that.id === eventData.assetId) {
                    that._deleted = true;
                }

                utils.$rootScope.$apply();
            });

            var unsubscribeState = utils.$rootScope.$on('$messaging.asset.state', function(e, eventData) {

                if (that.id !== eventData.assetId) {
                    return;
                }

                if (!that.state) {
                    that.state = {};
                }

                that.state.at = eventData.payload.At;
                that.state.value = eventData.payload.Value;

                utils.$rootScope.$apply();
            });

            that.subscriptions.push(unsubscribeDelete);
            that.subscriptions.push(unsubscribeState);
        };

        AssetModel.prototype.on = function(eventName, callbackFn) {

            var that = this;
            var unsubscribeHandler = utils.$rootScope.$on('$messaging.asset.{0}'.format(eventName), function(e, eventData) {

                if (that.id !== eventData.assetId) {
                    return;
                }

                callbackFn(eventData.payload);
                utils.$rootScope.$apply();
            });

            that.subscriptions.push(unsubscribeHandler);
        };

        AssetModel.prototype.send = function(sendData) {

            messageRelay.publishState(this, sendData);
        };

        AssetModel.prototype.sendCommand = function(commandData) {

            messageRelay.publishCommand(this, commandData);
        };

        AssetModel.prototype.unsubscribe = function() {

            angular.forEach(this.subscriptions, function(unsubscribeFn) {
                unsubscribeFn();
            });

            this.subscriptions = [];
        };

        return AssetModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('CreateAssetModel', CreateAssetModelFactory);

    CreateAssetModelFactory.$inject = ['api.assetsService'];

    function CreateAssetModelFactory(assetsService) {

        var assetTypes = assetsService.getAssetTypes();

        function CreateAssetModel(assetType, assetName) {

            if (assetType) {
                this.type = assetType;
            } else {
                this.type = assetTypes.length > 0 ? assetTypes[0].type : null;
            }

            if (assetName) {
                this.name = assetName;
            }
        }

        CreateAssetModel.prototype.setType = function(type) {
            this.type = type;
        };

        CreateAssetModel.prototype.getTypes = function() {
            return assetTypes;
        };

        CreateAssetModel.prototype.isValid = function() {

            return this.type && this.name;
        };

        return CreateAssetModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('deviceModel', DeviceModelFactory);

    DeviceModelFactory.$inject = ['utility.deviceIcons', 'utils', 'assetModel'];

    function DeviceModelFactory(icons, utils, AssetModel) {

        function DeviceModel(data) {

            for (var attr in data) {
                if (data.hasOwnProperty(attr)) {
                    this[attr] = data[attr];
                }
            }

            for (var i = 0; i < this.assets.length; i++) {
                this.assets[i] = new AssetModel(this.assets[i]);
            }

            this.subscriptions = [];
        }

        DeviceModel.prototype.getIcon = function() {
            return icons.getIcon(this.type);
        };

        DeviceModel.prototype.getAsset = function(name) {

            var foundAsset = null;

            angular.forEach(this.assets, function(asset) {
                if (asset.name === name) {
                    foundAsset = asset;
                }
            });

            return foundAsset;
        };

        DeviceModel.prototype.getTitle = function() {

            if (this.title) {
                return this.title;
            }

            return this.name;
        };

        DeviceModel.prototype.subscribe = function(includingAssets) {

            var that = this;

            var unsubscribeDelete = utils.$rootScope.$on('$messaging.device.deleted', function(e, eventData) {

                if (that.id === eventData.deviceId) {
                    that._deleted = true;
                }

                utils.$rootScope.$apply();
            });

            var unsubscribeAssetCreate = utils.$rootScope.$on('$messaging.asset.created', function(e, eventData) {

                var asset = normalizePayloadData(eventData.payload.Data);

                if (that.id === asset.deviceId) {

                    var isAssetInArray = false;

                    for (var i = 0; i < that.assets.length; i++) {

                        if (that.assets[i].id === asset.id) {

                            isAssetInArray = true;
                            break;
                        }

                    }

                    if (!isAssetInArray) {

                        var assetModel = new AssetModel(asset);

                        assetModel.subscribe();

                        that.assets.push(assetModel);

                    }

                    utils.$rootScope.$apply();
                }

            });

            that.subscriptions.push(unsubscribeDelete);

            if (includingAssets) {
                angular.forEach(that.assets, function(asset) {
                    asset.subscribe();
                });
            }
        };

        DeviceModel.prototype.on = function(eventName, callback) {

            var that = this;
            var unsubscribeHandler = utils.$rootScope.$on('$messaging.device.{0}'.format(eventName), function(e, eventData) {

                if (that.id !== eventData.deviceId) {
                    return;
                }

                callbackFn(eventData.payload);
                utils.$rootScope.$apply();
            });

            that.subscriptions.push(unsubscribeHandler);
        };

        DeviceModel.prototype.unsubscribe = function() {

            var that = this;

            angular.forEach(that.subscriptions, function(unsubscribeFn) {
                unsubscribeFn();
            });

            that.subscriptions = [];

            angular.forEach(that.assets, function(asset) {
                asset.unsubscribe();
            });
        };

        function normalizePayloadData(payloadData) {

            var data = {};

            for (var attr in payloadData) {
                if (payloadData.hasOwnProperty(attr)) {
                    data[utils.toCamelCase(attr)] = payloadData[attr];
                }
            }

            return data;
        }

        return DeviceModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('EditDeviceModel', EditDeviceModelFactory);

    EditDeviceModelFactory.$inject = [];

    function EditDeviceModelFactory() {

        function EditDeviceModel(name, description, title) {
            this.name = name;
            this.description = description;
            if (title) {
                this.title = title;
            } else {
                this.title = name;
            }

            this.isEditEnabled = true;
            this.saved = false;
        }

        return EditDeviceModel;
    }
})();

(function(ng) {
    ng.module('app').directive('deviceHolder', [
        '$log',
        'utility.deviceIcons',
        function($log, deviceIcons) {
            function createDirectiveByType(element, type) {
                var el = document.createElement(type);
                element.appendChild(el);
            }

            function getPrimaryAsset(assets) {
                for (var i = 0; i < assets.length; i++) {
                    if (assets[i].style == 'primary') {
                        return assets[i];
                    }
                }
            }

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/device-holder/view.html',
                scope: {
                    deviceData: '='
                },
                link: function(scope, element, attrs) {
                    var deviceContent = element[0].querySelector('.device-content');

                    $log.log(scope.deviceData);

                    scope.deviceHeaderIcon = deviceIcons.getIcon(scope.deviceData.iconKey);
                    scope.primaryAsset = getPrimaryAsset(scope.deviceData.assets);

                    if (scope.deviceData.control.type) {
                        createDirectiveByType(deviceContent, scope.deviceData.control.type);
                    }
                }
            }
        }
    ]);
}(window.angular));

(function(ng) {
    ng.module('app').directive('googleMap', [
        '$q',
        '$log',
        '$rootScope',
        'utility.googleMaps',
        'utility.geoLocation',
        function($q, $log, $rootScope, googleMaps, geoLocation) {
            var DEFAULT_LOCATION = {
                latitude: 44.81666699999994,
                longitude: 20.46666700000003
            };
            var CIRCLE_WIDTH_RATIO = 2 * 1.5;

            googleMaps.catch(function() {
                $log.error('Google Maps API v3 not loaded!');
            });

            return {
                restrict: 'E',
                scope: {
                    place: '='
                },
                templateUrl: '/assets/js/app/directives/google-map/view.html',
                link: function(scope, element, attrs) {
                    var map = null;
                    var markers = [];
                    var mapZoom = 14;
                    var handler = null;
                    var location = null;
                    var mapSearch = null;
                    var searchInput = attrs.searchSelector ? element[0].parentNode.querySelector(attrs.searchSelector) : element[0].querySelector('.map-search');

                    // Show hidden input if selector not provided
                    searchInput.type = 'text';

                    scope.mapReady = false;

                    googleMaps.then(function(google) {
                        var mapSettings = {
                            zoom: mapZoom,
                            scrollwheel: false,
                            center: new google.maps.LatLng(DEFAULT_LOCATION.latitude, DEFAULT_LOCATION.longitude),
                            mapTypeId: google.maps.MapTypeId.ROADMAP,
                            disableDefaultUI: true
                        };

                        map = new google.maps.Map(element[0].querySelector('.map-canvas'), mapSettings);
                        mapSearch = new google.maps.places.SearchBox(searchInput);

                        google.maps.event.addListener(map, 'bounds_changed', function() {
                            var me = this;
                            calculateMapRadius().then(function(height) {
                                mapSearch.setBounds(map.getBounds());
                                updateMapCoordinates(me.getCenter().lat(), me.getCenter().lng(), height);
                            });
                        });

                        google.maps.event.addListener(map, 'dragend', function() {
                            var me = this;
                            calculateMapRadius().then(function(height) {
                                updateMapCoordinates(me.getCenter().lat(), me.getCenter().lng(), height);
                            });
                        });

                        google.maps.event.addListener(mapSearch, 'places_changed', function() {
                            var places = mapSearch.getPlaces();
                            var bounds = null;

                            if (places.length == 0) {
                                return;
                            }

                            ng.forEach(markers, function(marker) {
                                marker.setMap(null);
                            });

                            // For each place, get the icon, place name, and location.
                            markers = [];
                            bounds = new google.maps.LatLngBounds();

                            ng.forEach(places, function(place) {
                                var image = {
                                    url: place.icon,
                                    size: new google.maps.Size(71, 71),
                                    origin: new google.maps.Point(0, 0),
                                    anchor: new google.maps.Point(17, 34),
                                    scaledSize: new google.maps.Size(25, 25)
                                };

                                // Create a marker for each place.
                                markers.push(new google.maps.Marker({
                                    map: map,
                                    icon: image,
                                    title: place.name,
                                    position: place.geometry.location
                                }));

                                bounds.extend(place.geometry.location);
                            });

                            map.fitBounds(bounds);

                            calculateMapRadius().then(function(height) {
                                mapZoom = map.getZoom();
                                updateMapCoordinates(map.getCenter().lat(), map.getCenter().lng(), height);
                            });
                        });

                        scope.mapReady = true;
                    });

                    if (attrs.setLocation) {
                        setGeoLocation();
                    }

                    function updateMapCoordinates(latitude, longitude, radius) {
                        scope.place.radius = radius;
                        scope.place.center.latitude = latitude;
                        scope.place.center.longitude = longitude;

                        $rootScope.$$phase || scope.$apply();
                    }

                    function calculateMapRadius() {
                        var deferred = $q.defer();

                        googleMaps.then(function(google) {
                            if (map) {
                                var spherical = google.maps.geometry.spherical;
                                var bounds = map.getBounds();
                                var cor1 = bounds.getNorthEast();
                                var cor2 = bounds.getSouthWest();
                                //  var cor3 = new google.maps.LatLng(cor2.lat(), cor1.lng());
                                var cor4 = new google.maps.LatLng(cor1.lat(), cor2.lng());
                                //  var width = spherical.computeDistanceBetween(cor1, cor3);
                                var height = spherical.computeDistanceBetween(cor1, cor4);

                                deferred.resolve(height / CIRCLE_WIDTH_RATIO);
                            } else {
                                deferred.reject('Map not instantiated!');
                            }
                        });

                        return deferred.promise;
                    }

                    function setGeoLocation() {
                        var deferred = $q.defer();

                        googleMaps.then(function(google) {
                            if (map) {
                                geoLocation.getLocation()
                                    .then(function(result) {
                                        location = result;
                                        map.setCenter(new google.maps.LatLng(result.coords.latitude, result.coords.longitude), mapZoom);
                                        deferred.resolve();
                                    })
                                    .catch(function() {
                                        deferred.reject('Geo location not available!');
                                    });
                            } else {
                                deferred.reject('Map not instantiated!');
                            }
                        });

                        return deferred.promise;
                    }

                    scope.zoomIn = function() {
                        if (map) {
                            map.setZoom(mapZoom + 1);
                            mapZoom = map.getZoom();
                        }
                    };

                    scope.zoomOut = function() {
                        if (map) {
                            map.setZoom(mapZoom - 1);
                            mapZoom = map.getZoom();
                        }
                    };

                    scope.$watch('place', function(newValue, oldValue) {
                        if (!ng.equals(newValue, oldValue)) {
                            googleMaps.then(function(google) {
                                if (map) {
                                    map.setCenter(new google.maps.LatLng(newValue.center.latitude, newValue.center.longitude), mapZoom);
                                }
                            });
                        }
                    }, true);

                    handler = $rootScope.$on('places.map:set_geo_location', function() {
                        setGeoLocation();
                    });

                    $rootScope.$on('places.map:set_bounds', function(event, data) {
                        map.fitBounds(data.bounds);
                        
                        google.maps.event.addListenerOnce(map, 'idle', function() {
                            mapZoom = map.getZoom();
                        });
                    });

                    scope.$on('$destroy', function() {
                        if (handler) {
                            handler();
                        }
                        googleMaps.then(function(google) {
                            if (map) {
                                google.maps.event.clearListeners(map, 'bounds_changed');
                                google.maps.event.clearListeners(map, 'places_changed');
                                google.maps.event.clearListeners(map, 'dragend');
                            }
                        });
                    });
                }
            };
        }
    ]);
}(window.angular));

(function(ng) {
    ng.module('app').directive('randomBackground', [
        function() {
            function getRandomColor() {
                return "#" + Math.random().toString(16).slice(2, 8);
            }

            return {
                restrict: 'A',
                link: function(scope, element, attrs) {
                    element[0].style.backgroundColor = getRandomColor();
                }
            };
        }
    ]);
}(window.angular));

(function(ng) {
    ng.module('app').directive('inlineEdit', [
        '$timeout',
        function($timeout) {
            var classes = {
                icon: 'sl-sl-edit',
                activeClass: 'active',
                editButton: 'inline-edit-rename-button',
                editIndicator: 'inline-edit-indicator'
            };

            return {
                restrict: 'E',
                scope: {
                    value: '=',
                    confirmAction: '&',
                    isEnabled: '='
                },
                templateUrl: '/assets/js/app/directives/inline-edit/view.html',

                link: function(scope, element, attrs) {
                    var el = element[0];

                    var oldValue = null;
                    var saved = false;

                    scope.inputDisabled = true;

                    var editButton = el.querySelector('.' + classes.editButton);
                    var editIndicator = el.querySelector('.' + classes.editIndicator);
                    var input = el.querySelector('input');

                    if (editButton) {
                        $(editButton).mousedown(editButtonClick);
                    }

                    if (input) {
                        $(input).click(function() {
                            scope.inputDisabled = false;
                            focus();
                        });

                        $(input).focusout(function(e) {
                            unfocus();
                        });

                        $(input).keypress(function(e) {
                            if (e.which == 13) {
                                editButtonClick();
                            }
                        });
                    }

                    function focus() {
                        saved = false;

                        scope.$apply(function() {
                            scope.inputDisabled = false;
                        });

                        if (editButton) {
                            editButton.classList.add(classes.activeClass);
                        }

                        if (input) {
                            $timeout(function() {
                                oldValue = $(input).val();
                                len = oldValue.length * 2;

                                $(input).focus();

                               // input.setSelectionRange(len, len);

                            }, 1);
                        }
                    }

                    function save() {
                        saved = true;
                        scope.confirmAction();
                    }

                    function unfocus() {
                        if (editButton) {
                            editButton.classList.remove(classes.activeClass);
                        }

                        if (input && !saved) {
                            $(input).val(oldValue);
                        }

                        scope.$apply(function() {
                            scope.inputDisabled = true;
                        });
                    }

                    function editButtonClick() {
                        if (scope.inputDisabled) {
                            focus();
                        } else {
                            save();
                            unfocus();
                        }
                    }

                    scope.$watch('isEnabled', function(newValue, oldValue) {
                        if (newValue) {
                            if (editButton) {
                                editButton.style.visibility = 'visible';
                            }
                            if (editIndicator) {
                                editIndicator.style.visibility = 'visible';
                            }

                            if (input) {
                                $(input).prop('disabled', false);
                            }
                        } else {
                            if (editButton) {
                                editButton.style.visibility = 'hidden';
                            }
                            if (editIndicator) {
                                editIndicator.style.visibility = 'hidden';
                            }

                            if (input) {
                                $(input).prop('disabled', true);
                            }
                        }
                    });

                    scope.$on('$destroy', function() {
                        $(el).off();

                        if (editButton) {
                            $(editButton).off();
                        }

                        if (input) {
                            $(input).off();
                        }
                    });
                }
            };
        }
    ]);
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .directive('newDevice', NewDevice);
    NewDevice.$inject = ['utility.deviceIcons'];

    function NewDevice(icons) {

        var directive = {
            restrict: 'EA',
            templateUrl: '/assets/js/app/directives/new-device/view.html',
            scope: {
                onDeviceAdd: '&',
                onDeviceNameChange: '&',
                deviceError: '=',
                deviceType: '=',
                showCustom: '='
            },
            link: linker
        };

        return directive;

        /////////////////////////////////

        function linker($scope, iElm, iAttrs, controller) {

            $scope.deviceType = 'arduino';
            $scope.deviceName = null;
            var custom = {
                type: 'custom',
                text: 'Custom',
                icon: 'sl-device-custom'
            };

            var de = $scope.deviceError;

            $scope.deviceTypes = [{
                type: 'arduino',
                text: 'Arduino',
                icon: 'sl-device-arduino'
            }, {
                type: 'rpi',
                text: 'Raspberry Pi',
                icon: 'sl-device-rpi'
            }, {
                type: 'intel-edison',
                text: 'Intel Edison',
                icon: 'sl-device-intel-edison'
            }];
            if($scope.showCustom){
                $scope.deviceTypes.push(custom);
            }

            $scope.setDeviceType = function(deviceType) {
                $scope.deviceType = deviceType;
            };

            $scope.deviceAdd = function() {
                $scope.onDeviceAdd({
                    name: $scope.deviceName,
                    type: $scope.deviceType
                });
                $scope.deviceName = null;
            };

            $scope.isActiveDeviceType = function(dType) {
                return dType == $scope.deviceType;
            };

            $scope.deviceChangeName = function() {

                $scope.onDeviceNameChange({
                    name: $scope.deviceName,
                    type: $scope.deviceType
                });
            };

            $scope.getDeviceTypeIcon = function(dType) {
                return icons.getIcon(dType);
            };

            var el = iElm[0];
        }
    }
}(window.angular));
(function(ng) {
    ng
        .module('app')
        .directive('notifyControl', NotifyControl);

    NotifyControl.$inject = [
        'notifyService',
        '$animate',
        '$timeout',
        '$rootScope'
    ];

    function NotifyControl(notify, $animate, $timeout, $rootScope) {

        var settings = {
            duration: 2000 //3 seconds
        };

        var directive = {

            restrict: 'E',
            templateUrl: '/assets/js/app/directives/notify-control/view.html',
            link: linker,
            scope: {}
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            var el = element[0];
            var hideNotificationTimeout = null;

            scope.isClosed = true;
            scope.isPermanent = false;
            scope.title = null;
            scope.msg = null;
            scope.type = null;

            scope.close = onClosed;
            scope.onMouseOver = onMouseOver;
            scope.onMouseLeave = onMouseLeave;

            notify.subscribe('notificationControl', function(notificationData) {

                processNotification(notificationData);
            });

            $rootScope.$on('$stateChangeSuccess', function() {
                closeNotification();
            });

            function onClosed() {

                closeNotification();

                if (scope.closeHandler) {
                    scope.closeHandler();
                }
            }

            function closeNotification() {

                var container = el.querySelector('.alert');

                if (container) {
                    $animate.addClass(container, 'alert-hidden').then(function() {
                        scope.isClosed = true;
                    });
                }
            }

            function onMouseOver() {
                if (hideNotificationTimeout) {
                    $timeout.cancel(hideNotificationTimeout);
                }
            }

            function onMouseLeave() {
                if (!scope.isPermanent) {
                    setCloseTimeout();
                }
            }

            function processNotification(data) {

                if (hideNotificationTimeout) {
                    $timeout.cancel(hideNotificationTimeout);
                }

                scope.title = data.title;
                scope.msg = data.msg;
                scope.type = data.type;
                scope.isPermanent = data.isPermanent;
                scope.isClosed = false;

                if (data.closeHandler) {
                    scope.closeHandler = data.closeHandler;
                    scope.showCloseButton = true;
                } else {
                    scope.closeHandler = null;
                    scope.showCloseButton = false;
                }

                if (data.actionHandler) {
                    scope.actionHandler = data.actionHandler;
                    scope.showActionButton = true;
                    scope.actionText = data.actionText;
                } else {
                    scope.actionHandler = null;
                    scope.showActionButton = false;
                    scope.actionText = null;
                }

                if (!scope.isPermanent) {

                    //delaying setting up mouse move event or 1s because
                    //the move that caused the notification is detected as movement.
                    setTimeout(function() {
                        $(document).one('touchmove', function() {
                            setCloseTimeout();
                        });

                        $(document).one('mousemove', function() {
                            setCloseTimeout();
                        });

                    }, 1000);
                }

            }

            function setCloseTimeout() {
                hideNotificationTimeout = $timeout(closeNotification, settings.duration);
            }
        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .directive('stateControlButton', stateControlButton);

    stateControlButton.$inject = ['$rootScope'];

    function stateControlButton($rootScope) {

        var directive = {
            restrict: 'A',
            scope: {
                identifier: '@'
            },
            link: linker
        };

        return directive;

        function linker(scope, element, attrs) {

            var eventArgs = {
                identifier: scope.identifier,
                state: false
            };

            element.bind('click', function() {

                eventArgs.state = !eventArgs.state;

                $rootScope.$broadcast('stateControlButtonEvent', eventArgs);
            });

        }
    }
})();

(function(ng) {

    ng
        .module('app')
        .controller('StateControlController', StateControlController);

    StateControlController.$inject = ['$scope', '$rootScope', 'stateControlManager'];

    function StateControlController($scope, $rootScope, stateControlManager, el) {

        var modifierClass = $scope.modifierClass;
        var morphEl = $('[state-control-type="morph"]');

        var ctrl = this;

        ctrl.identifier = $scope.identifier;
        ctrl.containers = [];
        ctrl.triggers = [];
        ctrl.morphs = [];
        ctrl.parentStateControlIdentifiers = [];
        ctrl.registerContainer = registerContainer;
        ctrl.registerTrigger = registerTrigger;
        ctrl.registerMorph = registerMorph;

        ctrl.toggle = toggle;
        ctrl.hide = hide;

        ctrl.addParentStateControlId = addParentStateControlId;
        ctrl.getParentStateControlIds = getParentStateControlIds;

        stateControlManager.register(ctrl);

        //////////////

        $scope.$on('$destroy', function() {

            stateControlManager.unregister(ctrl);
        });

        $scope.$watch('state', function(newValue, oldValue) {

            var isOldValueUndefined = typeof oldValue === 'undefined';

            if (!isOldValueUndefined && (oldValue != newValue)) {

                toggle();
            }

        }, true);

        $rootScope.$on('stateControlButtonEvent', function(event, args) {

            if (args.identifier === ctrl.identifier) {

                toggle();

            }
        });

        function toggleFromBeyond() {

            var elements = getAllElementsWithAttribute('state-control-type');

            return elements;

        };

        function getAllElementsWithAttribute(attribute) {

            var matchingElements = [];
            var allElements = document.getElementsByTagName('*');
            for (var i = 0, n = allElements.length; i < n; i++) {
                if (allElements[i].getAttribute(attribute) !== null) {
                    // Element exists with attribute. Add to array.
                    matchingElements.push(allElements[i]);
                }
            }

            return matchingElements;
        }

        function hideMorph() {
            if (morphEl.hasClass(modifierClass)) {
                morphEl.removeAttr('style');
            }
        }

        function toggle() {

            if ($scope.onToggle) {
                $scope.onToggle();
            }

            angular.forEach(ctrl.containers, function(container) {
                container.toggle(modifierClass);
            });

            angular.forEach(ctrl.triggers, function(trigger) {
                trigger.toggle(modifierClass);
            });

            angular.forEach(ctrl.morphs, function(morph) {
                morph.toggle(modifierClass);
            });

            hideMorph();

            stateControlManager.reportStateChange(ctrl);
        }

        function hide() {

            angular.forEach(ctrl.containers, function(container) {
                container.hide(modifierClass);
            });

            angular.forEach(ctrl.triggers, function(trigger) {
                trigger.hide(modifierClass);
            });

            angular.forEach(ctrl.morphs, function(morph) {
                morph.hide(modifierClass);
            });

            hideMorph();
        }

        function registerContainer(container) {

            ctrl.containers.push(container);
        }

        function registerTrigger(trigger) {

            ctrl.triggers.push(trigger);
        }

        function registerMorph(morph) {

            ctrl.morphs.push(morph);
        }

        function addParentStateControlId(parentId) {

            ctrl.parentStateControlIdentifiers.push(parentId);
        }

        function getParentStateControlIds() {
            return ctrl.parentStateControlIdentifiers;
        }
    }

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .service('stateControlManager', StateControlManager);

    StateControlManager.$inject = ['$rootScope'];

    function StateControlManager($rootScope) {

        var stateControls = [];

        var service = {
            register: register,
            unregister: unregister,
            reportStateChange: reportStateChange
        };

        $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams) {

            angular.forEach(stateControls, function(sc) {
                sc.hide();
            });
        });

        return service;

        function register(stateControl) {

            stateControls.push(stateControl);
        }

        function unregister(stateControl) {

            var index = stateControls.indexOf(stateControl);
            stateControls.splice(index, 1);
        }

        function reportStateChange(stateControl) {

            angular.forEach(stateControls, function(sc) {
                if (sc.identifier != stateControl.identifier) {

                    //make sure parent-state control does not close
                    var isParent = false;

                    var parentIds = stateControl.getParentStateControlIds();
                    for (var i = 0; i < parentIds.length; i++) {
                        if (sc.identifier == parentIds[i]) {
                            isParent = true;
                        }
                    }

                    if (!isParent) {
                        sc.hide();
                    }
                }
            });
        }
    }

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('stateControlType', StateControlType);

    function StateControlType() {

        var directive = {
            restrict: 'A',
            require: '^stateControl',
            scope: {
                type: '@stateControlType'
            },
            compile: function(elm, attrs, transclude) {
                return linker;
            }

        };

        return directive;

        ////////////////////

        function linker(scope, elm, attrs, stateController) {
            var type = scope.type;
            var stateEl = elm[0];

            scope.hide = hide;
            scope.toggle = toggle;

            if (type == 'trigger') {
                stateController.registerTrigger(scope);
                $(stateEl).click(function(e) {
                    stateController.toggle();
                    e.stopPropagation();
                });
            }

            if (type == 'container') {
                stateController.registerContainer(scope);
            }

            if (type == 'morph') {
                stateController.registerMorph(scope);
            }

            if (type == 'close') {
                $(stateEl).click(function(e) {
                    stateController.hide();
                    e.stopPropagation();
                });
            }

            function hide(className) {

                $(stateEl).removeClass(className);
            }

            function toggle(className) {

                if (stateEl.classList.contains(className)) {
                    stateEl.classList.remove(className);
                } else {
                    stateEl.classList.add(className);
                    $(document).one('click', documentClickHandler);
                    $(document).one('keyup', documentKeyUpHandler);
                }
            }

            function documentClickHandler(e) {

                var $el = $(e.target);

                var isInsideStateControl = $el.parents('state-control').length > 0;

                //if trigger to toggle state-control is outside of the state-control
                //it is required to set  'state-control-trigger' attribute
                //in order to prevent document.click to close the state-control
                var attr = $el.attr('state-control-toggler');

                var button = $el.attr('state-control-button');

                var isStateControlToggler = typeof attr !== typeof undefined && attr !== false;

                var isStateControlButton = typeof button !== typeof undefined && button !== false;

                if (isInsideStateControl || isStateControlToggler || isStateControlButton) {

                    $(document).one('click', documentClickHandler);

                } else {

                    stateController.hide();
                }
            }

            function documentKeyUpHandler(e) {

                if (e.keyCode === 27) {
                    stateController.hide();
                }
            }

            scope.$on('$destroy', function() {

                $(stateEl).off();
            });
        }
    }

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('stateControl', StateControl);

    function StateControl() {

        var directive = {
            restrict: 'E',
            controller: 'StateControlController',
            scope: {
                modifierClass: '@',
                identifier: '@',
                state: '=?',
                onToggle: '&'
            },
            link: linker
        };

        return directive;

        //////////

        function linker(scope, element, attrs, ctrl) {

            var parentStateControls = $(element).parents('state-control');

            for (var i = 0; i < parentStateControls.length; i++) {
                var parentIdentifier = $(parentStateControls[i]).attr('identifier');
                ctrl.addParentStateControlId(parentIdentifier);
            }

        }
    }
}(window.angular));


(function (ng) {
    ng.module('app').directive('stateMorph',
        ['$window',
            function ($window) {
                return {
                    restrict: 'A',
                    link: function (scope, element) {

                        var el = element[0],
                            trigger = $(el).find('[state-control-type="trigger"]'),
                            container = $(el).find('[state-control-type="container"]'),
                            morph = $(el).find('[state-control-type="morph"]'),
                            modifierClass = $(el).attr('modifier-class'),
                            time = 10;

                        trigger.on('click', function() {
                            var trigger = $(this);

                            //trigger position and size
                            var th = trigger.outerHeight(),
                                tw = trigger.outerWidth(),
                                tl = trigger.offset().left,
                                tt = trigger.offset().top;

                            //container position and size
                            var cw = container.outerWidth(),
                                ch = container.outerHeight(),
                                cl = container.offset().left,
                                ct = container.offset().top;

                            morph.css({ top: tt + 'px', left: tl + 'px', width: tw + 'px', height:th + 'px'});
                            setTimeout(function(){
                                morph.css({ top: ct + 'px', left: cl + 'px', width: cw + 'px', height:ch + 'px'})
                            }, time);

                        });

                        ng.element($window).on('resize', function () {
                            if(morph.hasClass(modifierClass)){
                                //container position and size
                                var cw = container.outerWidth(),
                                    ch = container.outerHeight(),
                                    cl = container.offset().left,
                                    ct = container.offset().top;

                                morph.css({ top: ct + 'px', left: cl + 'px', width: cw + 'px', height:ch + 'px', transition: 'none'})
                            }
                            else{
                                return false
                            }
                        });
                    }
                };
            }]
    );
}(window.angular));

(function (ng) {
    ng.module('app').directive('tabControl', [
        '$log',

        function ($log) {
            function createTabs(tabs, parent) {
                var elements = [];

                ng.forEach(tabs, function (tab, index) {
                    var el = document.createElement('div');
                    el.classList.add('tab-button');

                    if (index == 0) {
                        el.classList.add('active');
                        tab.style.display = '';
                    }
                    else {
                        tab.style.display = 'none';
                    }
                    el.innerHTML = tab.getAttribute('name');
                    parent.appendChild(el);
                    elements.push(el);
                });

                return elements;
            }

            function switchTo(index, tabButtons, tabs) {
                ng.forEach(tabButtons, function (button, i) {
                    if (i != index) {
                        if (button.classList.contains('active')) {
                            button.classList.remove('active');

                        }
                        tabs[i].style.display = 'none';
                    } else {
                        if (!button.classList.contains('active')) {
                            button.classList.add('active');
                            tabs[i].style.display = '';
                        }
                    }
                });
            }

            return {
                restrict: 'E',
                scope: {
                    onTabClick: '&',
                    activeTab: '='
                },
                link: function (scope, element, attrs) {
                    var el = element[0];

                    var tabs = el.querySelectorAll('tab-child');

                    var tabButtonsParent = el.querySelector('tab-control-header');
                    var tabButtons = createTabs(tabs, tabButtonsParent);

                    ng.forEach(tabButtons, function (button, index) {
                        $(button).click(function (e) {
                            scope.$apply(function () {
                                scope.activeTab = index;
                            });
                        });
                    });

                    scope.$watch('activeTab', function (cur, prev) {
                        switchTo(cur, tabButtons, tabs);
                        scope.onTabClick();
                    });
                }
            }
        }
    ]);
}(window.angular));

(function(ng) {

    ng.module('app').controller('modals.confirmItemDelete', ConfirmItemDelete);

    ConfirmItemDelete.$inject = ['$modalInstance', '$state', 'utils', 'item', 'model'];

    function ConfirmItemDelete($modalInstance, $state, utils, item, model) {

        var vm = this;

        utils.$rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams) {
            $modalInstance.dismiss();
        });

        vm.itemModel = item;

        vm.model = model;

        vm.selection = false;

        vm.CONFIRM_DELETION_TEXT = 'DELETE';
        vm.confirmInput = null;
        vm.errorMsg = null;

        vm.selectModalDissmisal = selectModalDissmisal;

        vm.confirmItemDelete = confirmItemDelete;

        //////////////////////////////////////

        function confirmItemDelete(device) {

            if (device) {

                vm.model.delete(vm.itemModel.device)
                    .then(function() {

                        $modalInstance.close();

                    });

            } else {

                vm.itemModel.delete().then(function() {
                    if (vm.itemModel.hasOwnProperty('device')) {
                        $state.go('main.groundDevices', {
                            id: vm.itemModel.groundId
                        });
                    } else if (vm.itemModel.hasOwnProperty('gateway')) {
                        $state.go('main.groundGateways', {
                            id: vm.itemModel.groundId
                        });
                    }
                });
            }
        }

        function selectModalDissmisal() {


            utils.preferences.rememberGlobal('DeleteDeviceModalStatus', vm.selection);

        }
    }

}(window.angular));

(function(ng) {
    ng.module('app').controller('modals.rule.Options', [
        '$modalInstance',
        '$state',
        'api.rulesService',
        'api.devicesService',
        'api.servicesService',
        'notifyService',
        'utility.common',
        '$q',
        'rule',
        'service.dayTime',
        '$rootScope',

        function($modalInstance, $state, rulesService, devicesService, servicesService, notifyService, common, $q, rule, dayTime, $rootScope) {

            var vm = this;
            $rootScope.$on('$stateChangeStart',
                function(event, toState, toParams, fromState, fromParams) {
                    $modalInstance.dismiss();

                });

            vm.rule = rule;
            vm.newRuleName = rule.name;
            vm.isRuleEditEnabled = true;
            vm.deleteOpen = true;

            vm.toggleRuleStatus = toggleRuleStatus;
            vm.updateRule = updateRule;
            vm.editRuleInJSON = editRuleInJSON;
            vm.editRuleInWizard = editRuleInWizard;
            vm.viewRuleHistory = viewRuleHistory;
            vm.deleteRule = deleteRule;
            vm.isEnabled = isEnabled();
            vm.isDefinitionLoaded = false;
            vm.hasIssues = false;
            vm.isRuleSimple = null;

            vm.definitionModel = {
                when: [],
                then: [],
                else: []
            };

            vm.definitionModel.else.isSectionLoaded = false;

            var devices = null;
            var services = null;
            var ruleDefinition = null;

            if (vm.rule.definition) {
                ruleDefinition = JSON.parse(vm.rule.definition);
            }

            activate();

            //////////////////////////////////////////////////////

            function activate() {

                var promises = [];

                promises.push(devicesService.getAll());
                promises.push(servicesService.getAll());

                if (!rule.definition) {
                    promises.push(rulesService.get(rule.id));
                }

                $q.all(promises)
                    .then(function(responses) {
                        devices = responses[0].data;
                        services = responses[1].data;
                        if (responses[2]) {
                            vm.rule.definition = responses[2].data.definition;

                            if (vm.rule.definition) {
                                ruleDefinition = JSON.parse(rule.definition);

                            }
                        }

                        if (ruleDefinition) {
                            vm.isRuleSimple = isRuleSimple(ruleDefinition);
                            map('when', ruleDefinition);
                            map('then', ruleDefinition);
                            map('else', ruleDefinition);

                            if (hasMissingDependables()) {

                                notifyService.error('Error: ', 'Rule ' + vm.rule.name + ' has issues with missing assets or devices.', null, true);
                                vm.hasIssues = true;
                            }
                        }

                        vm.isDefinitionLoaded = true;
                    })
                    .catch(function(error) {
                        var errorMessage = 'There was an error contacting server. ';
                        if (error.data && error.data.message) {
                            errorMessage += error.data.message;
                        }

                        notifyService.error('Error: ', errorMessage, null, true);
                    });

            }

            function map(sectionName, ruleDefinition) {

                var sectionViewModel = vm.definitionModel[sectionName];

                sectionViewModel.isSectionLoaded = common.mapRulePreviewToViewModel(ruleDefinition, sectionName, sectionViewModel, devices, services);
            }

            function hasMissingDependables() {

                return hasSectionMissingDependables('when') || hasSectionMissingDependables('then') || hasSectionMissingDependables('else');
            }

            function hasSectionMissingDependables(sectionName) {
                var sectionViewModel = vm.definitionModel[sectionName];

                if (sectionViewModel.misingLeftDevice || sectionViewModel.missingLeftAsset || sectionViewModel.missingRightDevice || sectionViewModel.missingRightAsset) {
                    return true;
                }

                return false;
            }

            function toggleRuleStatus() {

                if (vm.isEnabled) {

                    vm.isEnabled = false;
                    rulesService.enabled(vm.rule.id, false)
                        .then(function(data) {
                            notifyService.success('Success: ', 'Rule is Idle');
                            rule.status = 2;
                            $rootScope.$emit('rootScope:rule:statusChanged', {status: rule.status, id: rule.id});
                        })
                        .catch(function(error) {
                            notifyService.error('Error: ', 'There was a problem disabling the Rule.', null, true);
                        });
                } else {
                    vm.isEnabled = true;
                    rulesService.enabled(vm.rule.id, true)
                        .then(function(data) {
                            notifyService.success('Success: ', 'Rule is Running');
                            rule.status = 1;
                            $rootScope.$emit('rootScope:rule:statusChanged', {status: rule.status, id: rule.id});
                        })
                        .catch(function(error) {
                            notifyService.error('Error: ', 'There was a problem enabling the Rule.', null, true);
                        });
                }
            }

            function updateRule() {

                rulesService.update(vm.rule.id, vm.newRuleName, vm.rule.description, JSON.parse(vm.rule.definition))
                    .then(function() {
                        notifyService.success('Success: ', 'Rule Updated');
                        $state.reload();

                    })
                    .catch(function(error) {
                        notifyService.error('Error: ', 'There was an error updating the rule.', null, true);
                    });
            }

            function editRuleInJSON() {

                var ruleDefinition = vm.rule.definition;

                if (vm.rule.definition) {
                    ruleDefinition = JSON.parse(vm.rule.definition);
                }

                $state.go('main.ruleEditJSON', {
                    id: vm.rule.id
                });

                $modalInstance.close();
            }

            function editRuleInWizard() {

                var ruleDefinition = vm.rule.definition;

                if (vm.rule.definition) {
                    ruleDefinition = JSON.parse(vm.rule.definition);
                }

                $state.go('main.ruleEditWizard', {
                    id: vm.rule.id
                });

                $modalInstance.close();
            }

            function viewRuleHistory() {

                $state.go('main.ruleHistory', {
                    id: vm.rule.id
                });

                $modalInstance.close();
            }

            function deleteRule() {

                rulesService.delete(vm.rule.id)
                    .then(function(response) {
                        notifyService.success('Success: ', 'Rule is deleted.');
                        $modalInstance.close();
                        $state.reload();
                    })
                    .catch(function(error) {
                        notifyService.error('Error: ', 'Error while deleting the rule.', null, true);
                    });
            }

            function isEnabled() {
                return rule.status == 1;
            }

            function isRuleSimple(ruleDefinition) {

                var isSimple = true;

                angular.forEach(ruleDefinition, function(ruleSection) {
                    if (ruleSection.hasOwnProperty('when')) {
                        if (ruleSection.when.length > 1) {
                            isSimple = false;
                        }
                    }

                    if (ruleSection.hasOwnProperty('then')) {
                        if (ruleSection.then.length > 1) {
                            isSimple = false;
                        }
                    }

                    if (ruleSection.hasOwnProperty('else')) {
                        if (ruleSection.else.length > 1) {
                            isSimple = false;
                        }
                    }

                });

                return isSimple;

            }
        }

    ]);
}(window.angular));

(function(ng) {

    ng.module('app').controller('modals.rulesAttached', RulesAttached);

    RulesAttached.$inject = ['$modalInstance', '$rootScope', 'device', 'api.rulesService', 'session'];

    function RulesAttached($modalInstance, $rootScope, device, rulesService, session) {

        var vm = this;

        $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams) {
            $modalInstance.dismiss();
        });

        vm.deviceModel = device;
        vm.deviceRules = null;
        vm.currentUser = null;
        vm.quantity = 3;
        vm.page = 0;
        vm.showLoadMore = false;

        vm.loadMore = loadMore;
        vm.subscribe = subscribe;

        activate();

        //////////////////////////////////////

        function activate() {

            vm.currentUser = session.getUserDetails();

            rulesService.getDeviceRules(vm.deviceModel.id, vm.quantity)
                .then(function(data) {
                    vm.deviceRules = data.items;

                    if (vm.deviceRules.length === vm.quantity) {
                        vm.showLoadMore = true;
                    }

                    angular.forEach(vm.deviceRules, function(deviceRule) {
                        deviceRule.isCurrentUserSubscribed = false;

                        if (deviceRule.stepDefinitions.then.users) {
                            angular.forEach(deviceRule.stepDefinitions.then.users, function(user) {
                                if (user.id === vm.currentUser.id) {
                                    deviceRule.isCurrentUserSubscribed = true;
                                }
                            });
                        }

                        if (deviceRule.stepDefinitions.else) {
                            angular.forEach(deviceRule.stepDefinitions.else.users, function(user) {
                                if (user.id === vm.currentUser.id) {
                                    deviceRule.isCurrentUserSubscribed = true;
                                }
                            });
                        }
                    });
                });

        }

        function subscribe(deviceRule) {
            deviceRule.isCurrentUserSubscribed = !deviceRule.isCurrentUserSubscribed;

            var activeNotificationRulesExist = false;
            angular.forEach(vm.deviceRules, function(deviceRule) {

                if (deviceRule.isCurrentUserSubscribed) {
                    activeNotificationRulesExist = true;
                }
            });

            $rootScope.$emit('isUserSubscribedOnRule', {
                isCurrentUserSubscribed: activeNotificationRulesExist,
                deviceId: vm.deviceModel.id
            });

            if (deviceRule.isCurrentUserSubscribed) {
                rulesService.subscribeOnRuleNotifications(deviceRule.id);
            } else {
                rulesService.unsubscribeFromRuleNotifications(deviceRule.id);
            }
        }

        function loadMore() {
            vm.page++;
            return rulesService.getDeviceRules(vm.deviceModel.id, vm.quantity, vm.page)
                .then(function(data) {

                    if (data.items.length < vm.quantity) {
                        vm.showLoadMore = false;
                    }

                    angular.forEach(data.items, function(deviceRule) {
                        deviceRule.isCurrentUserSubscribed = false;

                        if (deviceRule.stepDefinitions.then.users) {
                            angular.forEach(deviceRule.stepDefinitions.then.users, function(user) {
                                if (user.id === vm.currentUser.id) {
                                    deviceRule.isCurrentUserSubscribed = true;
                                }
                            });
                        }

                        if (deviceRule.stepDefinitions.else) {
                            angular.forEach(deviceRule.stepDefinitions.else.users, function(user) {
                                if (user.id === vm.currentUser.id) {
                                    deviceRule.isCurrentUserSubscribed = true;
                                }
                            });
                        }
                    });

                    vm.deviceRules = vm.deviceRules.concat(data.items);
                });
        }
    }

}(window.angular));

(function() {
    'use strict';

    angular
        .module('app')
        .controller('LoginController', LoginController);

    LoginController.$inject = [
        '$state',
        '$rootScope',
        'notifyService',
        'session'
    ];

    function LoginController($state, $rootScope, notifyService, session) {

        var vm = this;

        vm.login = login;

        vm.loginData = {
            deviceId: null,
            ticket: null
        };

        activate();

        ////////////////////////

        function activate() {


        }

        function login() {

            if (isInputIncomplete()) {

                notifyService.error('Login: ', 'deviceId and/or ticket must not be empty', null, true);

            } else {

                $rootScope.deviceId = vm.loginData.deviceId;

                $rootScope.ticket = vm.loginData.ticket;

                $state.go('main.quickDemo');

            }
        }

        function isInputIncomplete() {

            return vm.loginData.deviceId === '' || !vm.loginData.deviceId || vm.loginData.ticket === '' || !vm.loginData.ticket;

        }

    }

}());
(function() {
    'use strict';

    angular
        .module('app')
        .factory('HeaderItemModel', HeaderItemModelFactory);

    HeaderItemModelFactory.$inject = ['$state', '$modal', 'userContext', 'pinRepository'];

    function HeaderItemModelFactory($state, $modal, userContext, pinRepository) {

        function HeaderItemModel() {

            this.showDetails = false;
            this.icon = null;
            this.tagIcons = [];
            this.titleLetterIconClass = null;
            this.useTitleLetterAsIcon = false;
            this.id = null;
            this.title = null;
            this.hasDetails = false;
            this.details = null;
            this.detailsActive = false;
            this.tags = [];
            this.info = [];
            this.boxActions = [];
            this.visibility = null;
            this.showSubscribeIndicator = false;

        }

        HeaderItemModel.prototype.update = function(title, details) {

            this.details = details;
            this.title = title;

            if (this.details) {
                this.hasDetails = true;
            } else {
                this.hasDetails = false;
            }
        };

        HeaderItemModel.prototype.toggleDetails = function() {

            this.detailsActive = !this.detailsActive;

        };

        HeaderItemModel.prototype.replaceInfo = function(key, value) {

            for (var i = 0; i < this.info.length; i++) {

                if (this.info[i].name === key) {

                    this.info[i].value = value;

                }

            }
        };

        HeaderItemModel.fromDevice = function(device) {

            var model = new HeaderItemModel();

            model.title = device.getTitle();

            model.id = device.id;

            model.device = device;

            if (device.ground) {

                model.visibility = device.ground.visibility;

            }

            if (device.type !== 'quick-demo') {
                model.showSetup = true;
                model.showStatus = true;
            } else {
                model.showSetup = true;
                model.showStatus = true;
            }

            model.backText = 'Back to Devices';
            model.stateControlIdentifier = 'device-details';

            model.backRoute = {
                name: model.visibility === 'personal' ? 'main.devices' : 'main.groundDevices',
                data: {
                    id: device.groundId
                }
            };

            model.icon = device.getIcon();
            model.hasDetails = device.description ? true : false;
            model.details = device.description;
            model.notificationsActive = device.hasNotificationRules;
            model.attachedRules = device.hasRules;

            if (model.attachedRules === true) {

                model.tagIcons.push({
                    class: 'sl-pen-outline clickable',
                    title: 'Click to view rules associated to this device',
                    clickHandler: function() {
                        var modalInstance = $modal.open({
                            templateUrl: '/assets/js/app/modals/rules_attached/view.html',
                            controller: 'modals.rulesAttached',
                            controllerAs: 'vm',
                            resolve: {
                                device: function() {
                                    return device;
                                }
                            }
                        });
                    }
                });

            }

            return model;
        };

        HeaderItemModel.fromGround = function(ground) {

            var model = new HeaderItemModel();
            model.title = ground.title;
            model.id = ground.id;
            model.backText = 'Back to Grounds';
            model.backRoute = {
                name: 'main.environment'
            };

            model.useTitleLetterAsIcon = true;
            model.titleLetterIconClass = ground.color;

            model.hasDetails = ground.description ? true : false;
            model.details = ground.description;
            model.showSubscribeIndicator = true;
            model.memberCount = ground.memberCount;
            model.deviceCount = ground.deviceCount;
            model.gatewayCount = ground.gatewayCount;

            if (model.hasDetails) {
                model.detailsActive = true;
            }

            model.showSetup = false;
            model.showStatus = false;

            var userId = userContext.user.id;

            if (ground.ownerId === userId) {
                model.tagIcons.push({
                    class: 'sl-face',
                    title: 'You are owner of this ground'
                });
            }

            if (model.gatewayCount > 0) {
                model.tagIcons.push({
                    class: 'sl-gateway-fill clickable',
                    title: model.gatewayCount + ((model.gatewayCount === 1) ? ' gateway ' : ' gateways ') + 'in this ground',
                    count: model.gatewayCount,
                    clickHandler: function() {
                        $state.go('main.groundGateways', {
                            id: model.id
                        });
                    }
                });
            }

            if (model.deviceCount >= 0) {
                model.tagIcons.push({
                    class: 'sl-devices-fill clickable',
                    title: model.deviceCount + ((model.deviceCount === 1) ? ' device ' : ' devices ') + 'in this ground',
                    count: model.deviceCount,
                    clickHandler: function() {
                        $state.go('main.groundDevices', {
                            id: model.id
                        });
                    }
                });
            }

            if (model.memberCount >= 0) {
                model.tagIcons.push({
                    class: 'sl-members-fill clickable',
                    title: model.memberCount + ((model.memberCount === 1) ? ' member ' : ' members ') + 'contributing this ground',
                    count: model.memberCount,
                    clickHandler: function() {
                        $state.go('main.groundMembers', {
                            id: model.id
                        });
                    }
                });
            }

            return model;
        };

        HeaderItemModel.fromAsset = function(asset, owner, ownerType, ground) {
            var model = new HeaderItemModel();

            model.header = 'asset';
            model.title = asset.title;
            model.id = asset.id;
            model.backText = 'Back to ' + owner.title;
            model.backRoute = {
                name: ownerType === 'Device' ? 'main.device' : 'main.gateway',
                data: {
                    id: owner.id
                }
            };
            model.icon = asset.getIcon();
            model.hasDetails = false;
            model.info.push({
                name: 'state',
                value: asset.state ? asset.state.value : null
            });
            model.tags.push({
                cssClass: 'tag-' + asset.is,
                text: asset.is
            });
            model.tags.push({
                cssClass: 'tag-light-gray',
                text: asset.profile.type
            });

            model.showSetup = false;
            model.showStatus = false;

            if (ground) {

                var isPinned = pinRepository.isPinned(owner.groundId, asset.id);

                var pinToGroundAction = {
                    handler: function() {

                        if (isPinned) {

                            pinRepository.unpin(owner.groundId, asset);
                            pinToGroundAction.title = 'Pin to ' + ground.title + ' board';
                            pinToGroundAction.cssClass = 'grid-box-btn sl-pin-outline secondary-action';
                            isPinned = false;

                        } else {

                            pinRepository.pin(owner.groundId, asset);
                            pinToGroundAction.title = 'Pinned to ' + ground.title + ' board';
                            pinToGroundAction.cssClass = 'grid-box-btn sl-pin secondary-action visible';
                            isPinned = true;
                        }
                    },

                    title: isPinned ? 'Pinned to ' + ground.title + ' board' : 'Pin to ' + ground.title + ' board',
                    cssClass: isPinned ? 'grid-box-btn sl-pin secondary-action visible' : 'grid-box-btn sl-pin-outline secondary-action'
                };

                model.boxActions.push(pinToGroundAction);

            }

            return model;
        };

        HeaderItemModel.fromGateway = function(gateway) {

            var model = new HeaderItemModel();
            model.title = gateway.getTitle();
            model.id = gateway.id;
            model.backText = 'Back to Gateways';
            model.backRoute = {
                name: 'main.groundGateways',
                data: {
                    id: gateway.groundId
                }
            };
            model.icon = gateway.getIcon();
            model.hasDetails = gateway.description ? true : false;
            model.details = gateway.description;
            model.info.push({
                name: 'id',
                value: gateway.id
            });

            if (model.hasDetails) {
                model.detailsActive = true;
            }

            model.showSetup = false;
            model.showStatus = false;

            model.boxActions.push({
                handler: function() {
                    $state.go('main.gateway_devices', {
                        id: gateway.id
                    });
                },

                text: 'view devices',

                cssClass: 'main-button light-btn'
            });

            return model;
        };

        return HeaderItemModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('slHeaderItem', slHeaderItem);

    function slHeaderItem() {

        var directive = {
            templateUrl: '/assets/js/app/widgets/item_header/item-header.html',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            transclude: true,
            restrict: 'E',
            scope: {
                model: '=',
                toggleAction: '&',
                isActive: '&',
                config: '@',
                color: '='
            }
        };
        return directive;
    }

    Controller.$inject = ['$state', '$parse'];

    function Controller($state, $parse) {

        var vm = this;

        vm.goBack = goBack;

        vm.configuration = {
            hideActions: false
        };

        if (vm.config) {

            vm.configuration = $parse(vm.config)();

        }

        function goBack() {

            if (vm.model.visibility === 'personal') {

                $state.go('main.devices');

            } else {

                $state.go(vm.model.backRoute.name, vm.model.backRoute.data);

            }
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('sl.listHeader', ListHeaderViewModelFactory);

    ListHeaderViewModelFactory.$inject = [];

    function ListHeaderViewModelFactory() {

        function ListHeaderViewModel(headerTitle, headerImage, headerSubTitle) {

            this.headerTitle = headerTitle;
            this.headerImage = headerImage;
            this.headerSubTitle = headerSubTitle;
            this.showHeaderSubtitle = false;
            this.headerMode = 'colapsed';
        }

        ListHeaderViewModel.prototype.setHeaderMode = function(mode) {

            this.headerMode = mode;
        };

        return ListHeaderViewModel;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('listHeader', listHeader);

    listHeader.$inject = [];

    function listHeader() {

        var directive = {
            transclude: true,
            templateUrl: '/assets/js/app/widgets/list_header/list-header.html',
            link: link,
            restrict: 'E',
            scope: {
                viewModel: '='
            }
        };

        return directive;

        function link() {

        }
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('sl.listItem', ListItemViewModelFactory);

    ListItemViewModelFactory.$inject = ['$rootScope', '$state', '$timeout', '$modal', 'utility.common', 'userContext'];

    function ListItemViewModelFactory($rootScope, $state, $timeout, $modal, common, userContext) {

        function ListItemViewModel() {

            this.itemTitle = null;
            this.itemIcons = [];
            this.itemIcon = null;
            this.tagIcons = [];
            this.itemId = null;
            this.itemDetails = null;
            this.hasItemDetails = false;
            this.itemDetailsBoxActive = false;
            this.clickHandler = false;
            this.itemIsDeleted = false;
            this.createdOn = false;
            this.info = false;
            this.tag = false;
            this.useTitleLetterAsIcon = false;
            this.groundId = null;
            this.groundName = null;
            this.showSubscribeIndicator = false;
            this.clickable = true;
        }

        ListItemViewModel.prototype.toggleItemDetailsBox = function() {
            this.itemDetailsBoxActive = !this.itemDetailsBoxActive;
        };

        ListItemViewModel.prototype.setDeleted = function() {
            this.itemIsDeleted = true;
        };

        ListItemViewModel.fromDevice = function(deviceModel) {
            var viewModel = new ListItemViewModel();

            viewModel.device = deviceModel;

            viewModel.showDeviceStatus = true;

            viewModel.itemTitle = deviceModel.getTitle();
            viewModel.itemIcon = deviceModel.getIcon();
            viewModel.itemDetails = deviceModel.description;
            viewModel.hasItemDetails = deviceModel.description ? true : false;
            viewModel.itemId = deviceModel.id;
            viewModel.itemIsDeleted = deviceModel._deleted;
            viewModel.createdOn = deviceModel.createdOn;
            viewModel.groundId = deviceModel.groundId;

            if (deviceModel.ground) {
                viewModel.groundTitle = deviceModel.ground.title;
            }

            if (deviceModel.hasOwnProperty('rulesMeta')) {
                viewModel.notificationsActive = deviceModel.rulesMeta.hasNotificationRules;
                viewModel.attachedRules = deviceModel.rulesMeta.hasRules;

                $rootScope.$on('isUserSubscribedOnRule', function(event, data) {
                    if (viewModel.itemId === data.deviceId) {
                        viewModel.notificationsActive = data.isCurrentUserSubscribed;
                    }
                });
            }

            viewModel.info = {
                multipleIcons: false,
                isNew: deviceModel.$isNew
            };

            if (viewModel.info.isNew === true) {
                $timeout(function() {
                    viewModel.info.isNew = false;
                }, 2000);
            }

            viewModel.clickHandler = function() {
                if (viewModel.itemIsDeleted) {
                    return;
                }

                $state.go('main.device', {
                    id: viewModel.itemId
                });
            };

            if (viewModel.attachedRules === true) {
                viewModel.tagIcons.push({
                    class: 'sl-pen-outline clickable',
                    title: 'View rules associated to this device',
                    clickHandler: function() {
                        var modalInstance = $modal.open({
                            templateUrl: '/assets/js/app/modals/rules_attached/view.html',
                            controller: 'modals.rulesAttached',
                            controllerAs: 'vm',
                            resolve: {
                                device: function() {
                                    return deviceModel;
                                }
                            }
                        });
                    }
                });
            }

            return viewModel;
        };

        ListItemViewModel.fromMember = function(memberModel) {
            var viewModel = new ListItemViewModel();

            viewModel.itemTitle = memberModel.username;
            viewModel.itemId = memberModel.id;
            viewModel.useTitleLetterAsIcon = true;
            viewModel.isGroundOwner = memberModel.isGroundOwner;
            viewModel.clickable = false;

            viewModel.info = {
                multipleIcons: false
            };

            if (viewModel.isGroundOwner) {
                viewModel.tagIcons.push({
                    class: 'sl-face',
                    title: 'Owner of this ground'
                });
            }

            return viewModel;
        };

        ListItemViewModel.fromGround = function(ground) {

            var viewModel = new ListItemViewModel();

            viewModel.itemTitle = ground.title;
            viewModel.itemDetails = ground.description;
            viewModel.hasItemDetails = ground.description ? true : false;
            viewModel.itemId = ground.id;
            viewModel.itemIcon = '';
            viewModel.itemIsDeleted = ground._deleted;
            viewModel.createdOn = ground.createdOn;

            if (ground.visibility == 'personal') {
                viewModel.useTitleLetterAsIcon = true;
                viewModel.titleLetterIconClass = 'ground-personal';
            } else {
                viewModel.useTitleLetterAsIcon = true;
                viewModel.titleLetterIconClass = ground.color;
            }

            viewModel.showSubscribeIndicator = true;
            viewModel.memberCount = ground.memberCount;
            viewModel.deviceCount = ground.deviceCount;
            viewModel.gatewayCount = ground.gatewayCount;

            var userId = userContext.user.id;

            viewModel.info = {
                multipleIcons: false,
                isNew: ground.$isNew
            };

            if (ground.ownerId === userId) {
                viewModel.tagIcons.push({
                    class: 'sl-face',
                    title: 'You are owner of this ground'
                });
            }

            if (viewModel.gatewayCount > 0) {
                viewModel.tagIcons.push({
                    class: 'sl-gateway-fill clickable',
                    title: viewModel.gatewayCount + ((viewModel.gatewayCount === 1) ? ' gateway ' : ' gateways ') + 'in this ground',
                    count: viewModel.gatewayCount,
                    clickHandler: function() {
                        $state.go('main.groundGateways', {
                            id: viewModel.itemId
                        });
                    }
                });
            }

            if (viewModel.deviceCount >= 0) {
                viewModel.tagIcons.push({
                    class: 'sl-devices-fill clickable',
                    title: viewModel.deviceCount + ((viewModel.deviceCount === 1) ? ' device ' : ' devices ') + 'in this ground',
                    count: viewModel.deviceCount,
                    clickHandler: function() {
                        $state.go('main.groundDevices', {
                            id: viewModel.itemId
                        });
                    }
                });
            }

            if (viewModel.memberCount >= 0) {
                viewModel.tagIcons.push({
                    class: 'sl-members-fill clickable',
                    title: viewModel.memberCount + ((viewModel.memberCount === 1) ? ' member ' : ' members ') + 'contributing this ground',
                    count: viewModel.memberCount,
                    clickHandler: function() {
                        $state.go('main.groundMembers', {
                            id: viewModel.itemId
                        });
                    }
                });
            }

            if (viewModel.info.isNew === true) {
                $timeout(function() {
                    viewModel.info.isNew = false;
                }, 2000);
            }

            viewModel.clickHandler = function() {

                if (viewModel.itemIsDeleted) {
                    return;
                }

                $state.go('main.ground', {
                    id: viewModel.itemId
                });
            };

            return viewModel;
        };

        ListItemViewModel.fromGateway = function(gatewayModel) {
            var viewModel = new ListItemViewModel();

            viewModel.itemTitle = gatewayModel.getTitle();
            viewModel.itemIcon = gatewayModel.getIcon();
            viewModel.itemDetails = gatewayModel.description;
            viewModel.hasItemDetails = gatewayModel.description ? true : false;
            viewModel.itemId = gatewayModel.id;
            viewModel.itemIsDeleted = gatewayModel._deleted;
            viewModel.createdOn = gatewayModel.createdOn;
            viewModel.groundId = gatewayModel.groundId;

            if (gatewayModel.ground) {
                viewModel.groundTitle = gatewayModel.ground.title;
            }

            viewModel.info = {
                multipleIcons: false,
                isNew: gatewayModel.$isNew
            };

            if (viewModel.info.isNew === true) {
                $timeout(function() {
                    viewModel.info.isNew = false;
                }, 2000);
            }

            viewModel.clickHandler = function() {

                if (viewModel.itemIsDeleted) {
                    return;
                }

                $state.go('main.gateway', {
                    id: viewModel.itemId
                });
            };

            return viewModel;
        };

        ListItemViewModel.fromRule = function(ruleModel, ruleDefinition) {

            var viewModel = new ListItemViewModel();
            viewModel.itemTitle = ruleModel.name;
            viewModel.itemId = ruleModel.id;

            viewModel.itemIcons.push({
                icon: getIcon(ruleModel, 'when'),
                arrow: true
            });

            viewModel.itemIcons.push({
                icon: getIcon(ruleModel, 'then'),
                arrow: elseExists(ruleDefinition)
            });

            viewModel.itemIcons.push({
                icon: getIcon(ruleModel, 'else')
            });

            viewModel.info = {
                multipleIcons: true,
                actionAvailible: true
            };

            viewModel.tag = getTagInfo(ruleModel.status);

            $rootScope.$on('rootScope:rule:statusChanged', function(event, data) {
                if (viewModel.itemId === data.id) {
                    viewModel.tag = getTagInfo(data.status);
                }
            });

            viewModel.clickHandler = function() {
                var modalInstance = $modal.open({
                    templateUrl: '/assets/js/app/modals/rule_options/view.html',
                    controller: 'modals.rule.Options',
                    controllerAs: 'vm',
                    resolve: {
                        rule: function() {
                            return ruleModel;
                        }
                    }
                });
            };

            function getIcon(ruleModel, section) {
                var targetedSection = null;

                if (section === 'when') {
                    targetedSection = getSection(section, 0, ruleDefinition);
                    if (targetedSection) {
                        if (targetedSection.left && targetedSection.left.device) {
                            return 'sl-device-custom';
                        } else {
                            if (targetedSection.device) {
                                return 'sl-device-custom';
                            }

                            return 'sl-service-calendar';
                        }
                    }
                } else if (section === 'then') {
                    targetedSection = getSection(section, 1, ruleDefinition);
                    if (targetedSection) {
                        if (targetedSection.left && targetedSection.left.device) {
                            return 'sl-device-custom';
                        } else {
                            if (targetedSection.device) {
                                return 'sl-device-custom';
                            }

                            return 'sl-service-email';
                        }
                    }
                } else if (section === 'else') {
                    if (elseExists(ruleDefinition)) {
                        targetedSection = getSection(section, 2, ruleDefinition);
                        if (targetedSection) {
                            if (targetedSection.left && targetedSection.left.device) {
                                return 'sl-device-custom';
                            } else {
                                if (targetedSection.device) {
                                    return 'sl-device-custom';
                                }

                                return 'sl-service-email';
                            }
                        }
                    }
                }
            }

            function getSection(sectionName, index, rule) {
                var sectionContainer = rule.definition[index][sectionName];
                if (!sectionContainer) {
                    sectionContainer = rule.definition[index][common.toPascalCase(sectionName)];
                }

                if (!sectionContainer) {
                    return null;
                }

                return sectionContainer[0];
            }

            function elseExists(rule) {
                var isElseInRule = rule.definition[2];

                if (isElseInRule) {
                    return true;
                }
            }

            function getTagInfo(ruleStatus) {
                switch (ruleStatus) {
                    case 0:
                        return {
                            tagClass: 'tag-light-gray',
                            tagText: 'undefined'
                        };
                    case 1:
                        return {
                            tagClass: 'tag-green',
                            tagText: 'running'
                        };
                    case 2:
                        return {
                            tagClass: 'tag-yellow',
                            tagText: 'idle'
                        };
                    case 3:
                        return {
                            tagClass: 'tag-red',
                            tagText: 'compilation error'
                        };
                    case 4:
                        return {
                            tagClass: 'tag-red',
                            tagText: 'missing assets'
                        };

                }
            }

            return viewModel;
        };

        return ListItemViewModel;

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('listItem', listItem);

    listItem.$inject = [];

    function listItem() {

        var directive = {
            transclude: true,
            templateUrl: '/assets/js/app/widgets/list_item/list-item.html',
            restrict: 'E',
            scope: {
                viewModel: '=',
                groundTag: '=',
                color: '='
            }
        };

        return directive;
    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('areaRangeChartDeviceControl', AreaRangeChartDirective);

    AreaRangeChartDirective.$inject = [];

    function AreaRangeChartDirective() {

        var directive = {
            bindToController: true,
            controller: AreaRangeChartDeviceControlController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/area-range-chart/area-range-chart-device-control.html',
            restrict: 'E',
            scope: {
                device: '='
            }
        };
        return directive;
    }

    AreaRangeChartDeviceControlController.$inject = [];

    function AreaRangeChartDeviceControlController() {

        var vm = this;

        vm.controlConfiguration = {
            type: 'area-range-chart'
        };

        activate();

        // ////////////////

        function activate() {
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('barChartDeviceControl', BarChartDirective);

    BarChartDirective.$inject = [];

    function BarChartDirective() {

        var directive = {
            bindToController: true,
            controller: BarChartDeviceControlController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/bar-chart/bar-chart-device-control.html',
            restrict: 'E',
            scope: {
                device: '='
            }
        };
        return directive;
    }

    BarChartDeviceControlController.$inject = [];

    function BarChartDeviceControlController() {

        var vm = this;

        vm.controlConfiguration = {
            type: 'bar-chart'
        };

        activate();

        // ////////////////

        function activate() {
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('enrollDemoDeviceControl', enrollDemoControl);

    enrollDemoControl.$inject = [];

    function enrollDemoControl() {

        var directive = {
            bindToController: true,
            controller: enrollDemoControlController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/enroll-demo/enroll-demo-control.html',
            restrict: 'E',
            scope: {
                device: '='
            }
        };
        return directive;
    }

    enrollDemoControlController.$inject = ['urlShortenerService', 'session', 'origin'];

    function enrollDemoControlController(urlShortenerService, session, origin) {

        var vm = this;

        var sessionData = session.authentication();
        var gameToken = sessionData.accessToken;
        var gameTicket = vm.device.authorizations[0];

        vm.qrText = null;

        activate();

        // ////////////////

        function activate() {

            var longUrl = getQRCodeUrl(vm.device.name, gameTicket);
            urlShortenerService.shortenUrl(longUrl)
                .then(function(shortUrl) {
                    vm.qrText = shortUrl;
                });
        }

        function getQRCodeUrl(deviceName, gameToken) {

            return '{0}/apps/quick-demo-launcher?deviceName={1}&token={2}'.format(origin, deviceName, gameToken);
        }

    }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .directive('lineChartDeviceControl', LineChartDirective);

    LineChartDirective.$inject = [];

    function LineChartDirective() {

        var directive = {
            bindToController: true,
            controller: LineChartDeviceControlController,
            controllerAs: 'vm',
            templateUrl: '/assets/js/app/devices/controls/line-chart/line-chart-device-control.html',
            restrict: 'E',
            scope: {
                device: '='
            }
        };
        return directive;
    }

    LineChartDeviceControlController.$inject = [];

    function LineChartDeviceControlController() {

        var vm = this;

        vm.controlConfiguration = {
            type: 'line-chart'
        };

        activate();

        // ////////////////

        function activate() {

        }

    }
})();

(function(ng) {

    ng.module('app').directive('assetComparator', ['$log',

        function($log) {

            var linker = function(scope, element, attrs) {

                function getComparators(type) {
                    var comparators = [];

                    if (type == 'bool' || type == 'boolean' || type == 'text' || type == 'string' || type == 'object') {
                        comparators.push({
                            name: 'Equal to',
                            id: '=='
                        });
                        comparators.push({
                            name: 'Not Equal to',
                            id: '!='
                        });
                    }

                    if (type == 'integer' || type == 'int' || type == 'number' || type == 'num' || type == 'date' || type == 'timespan' || type == 'double') {
                        comparators.push({
                            name: 'Equal to',
                            id: '=='
                        });
                        comparators.push({
                            name: 'Not Equal to',
                            id: '!='
                        });
                        comparators.push({
                            name: 'Less than',
                            id: '<'
                        });
                        comparators.push({
                            name: 'Less or equal than',
                            id: '<='
                        });
                        comparators.push({
                            name: 'Greater than',
                            id: '>'
                        });
                        comparators.push({
                            name: 'Greater or equal than',
                            id: '=>'
                        });

                    }

                    return comparators;
                }

                scope.comparatorSelected = function(item, model) {
                    scope.comparatorValue = item.id;
                };

                scope.$watch('profile', function(newProfile, oldProfile) {

                    if (newProfile) {
                        scope.comparators = getComparators(newProfile.type);
                    }
                });
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/asset-comparator/view.html',
                scope: {
                    profile: '=',
                    comparatorValue: '='
                },
                link: linker
            };
        }

    ]);
}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('slAssetProfileDescriptor', slAssetProfileDescriptor);

    function slAssetProfileDescriptor() {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/asset-profile-descriptor/view.html',
            scope: {
                profile: '='
            },
            link: linker
        };

        return directive;

        function linker(scope) {

            scope.expectsType = null;
            scope.unit = null;
            scope.constraints = null;

            scope.$watch('profile', function(newProfile) {

                if (!newProfile) {
                    scope.expectsType = null;
                    scope.unit = null;
                    scope.constraints = null;
                } else {
                    if (newProfile.type) {
                    	scope.expectsType = 'expects type: '+newProfile.type;
                    }

                    if(newProfile.unit){
                    	scope.unit = 'unit: '+newProfile.unit;
                    }

                    if(newProfile.min && newProfile.max){
                    	scope.constraints = 'with values between: ' + newProfile.min + ' and ' + newProfile.max;
                    } else if(newProfile.min){
                    	scope.constraints = 'with values bigger then: ' + newProfile.min;
                    } else if(newProfile.max){
                    	scope.constraints = 'with values smaller then: ' + newProfile.max;
                    }
                }
            });

        }

    }

}(window.angular));

(function(ng) {

    ng.module('app').directive('assetValueEditor', assetValueEditor);

    assetValueEditor.$inject = ['$compile'];

    function assetValueEditor($compile) {

        var defaultTemplate = '<text-setter text-value="operation.value"</text-setter>';
        var assetProfileDescriptorTemplate = '<sl-asset-profile-descriptor profile="profile"></sl-asset-profile-descriptor>';

        var directive = {
            restrict: 'E',
            link: linker,
            scope: {
                operation: '=',
                profile: '=',
                isEditMode: '='
            }
        };

        return directive;

        ///////////////////

        function linker(scope, element, attrs) {

            scope.$watch('profile', function(newValue) {

                if (newValue) {
                    element.html(getTemplate(scope.profile)).show();
                    $compile(element.contents())(scope);
                }
            });
        }

        function getTemplate(profile) {

            var template = defaultTemplate;

            if (!profile) {
                return template;
            }

            if (!profile.type) {
                return template;
            }

            if (isEmailService(profile)) {
                return template;
            }

            if (profile.labels) {
                template = '<label-setter value="operation.value" profile="profile"></label-setter>';
                return template;
            }

            if (profile.type == 'cron') {
                return '<day-time cron = "operation.value" is-edit-mode = "isEditMode"> </day-time> ';
            }

            if (profile.type == 'bool' || profile.type == 'boolean') {
                template = '<bool-setter bool-value="operation.value"></bool-setter>';
            }

            if (profile.type == 'int' || profile.type == 'integer' || profile.type == 'decimal' || profile.type == 'float' || profile.type == 'number' || profile.type == 'double') {
                template = '<number-setter num-value="operation.value"></number-setter>';
            }

            if (profile.type == 'date' || profile.type == 'datetime' || profile.type == 'time') {
                template = '<date-setter date-value="operation.value"></date-setter>';
            }

            if (profile.type == 'timespan' || profile.type == 'timerange' || profile.type == 'duration') {
                template = '<timespan-setter timespan-value="operation.value"></timespan-setter>';
            }

            if (profile.type == 'string' || profile.type == 'text') {
                template = '<text-setter text-value="operation.value"></text-setter>';
            }

            template += assetProfileDescriptorTemplate;

            return template;
        }

        function isEmailService(profile) {

            if (!profile) {
                return false;
            }

            if (!profile.type) {
                return false;
            }

            if (profile.type.subject == 'string') {
                return true;
            }

            return false;
        }
    }

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('slRuleSectionDetail', slRuleSectionDetail);

    slRuleSectionDetail.$inject = ['$filter', 'userContext'];

    function slRuleSectionDetail($filter, userContext) {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/rule-section-detail/view.html',
            scope: {
                sectionData: '=',
                sectionName: '@',
                sectionTitle: '@',
                currentStep: '=',
                currentSection: '=',
                isSectionReady: '&',
                isEditMode: '=?'
            },
            link: linker
        };

        return directive;
        ///////////////
        function linker(scope) {

            scope.steps = [];

            initSteps();

            scope.isReady = function() {
                return scope.isSectionReady(scope.sectionName);
            };

            scope.getHeaderText = function() {
                if (scope.sectionData.selectedDevice) {
                    return scope.sectionData.selectedDevice.name;
                }

                if (scope.sectionData.selectedService) {

                    if (scope.sectionData.selectedService.type == 'emailMe') {
                        var email = userContext.user.email;
                        return scope.sectionData.selectedService.name + ' to ' + email;
                    }

                    if (scope.sectionData.selectedService.type == 'notify') {
                        var user = userContext.user.name;
                        return 'Send ' + scope.sectionData.selectedService.name + ' to ' + user;
                    }

                    return scope.sectionData.selectedService.name;
                }
            };

            scope.getDetails = function() {

                var detailsText = '';

                if (scope.sectionData.selectedAsset) {
                    detailsText += scope.sectionData.selectedAsset.title;
                    detailsText += getCompareText();
                } else if (scope.sectionData.selectedService) {
                    detailsText += getCompareText();
                }

                return detailsText;
            };

            function getCompareText() {

                var text = '';

                if (scope.sectionData.selectedCompareType == 'constant' || scope.sectionData.selectedCompareType == null) {

                    if (scope.sectionData.constantCompareOperation.op && scope.sectionData.selectedAsset) {

                        text += scope.sectionData.constantCompareOperation.op;

                    }

                    if (scope.sectionData.constantCompareOperation.value) {

                        var profile = scope.sectionData.selectedAsset ? scope.sectionData.selectedAsset.profile : null;
                        if (!profile) {
                            profile = scope.sectionData.selectedService.profile;
                        }

                        var formattedValue = $filter('assetValueFormat')(scope.sectionData.constantCompareOperation.value, profile);

                        text += formattedValue;
                    }
                }

                if (scope.sectionData.selectedCompareType == 'reference') {

                    if (scope.sectionData.referenceCompareOperation.op) {
                        text += ' ' + scope.sectionData.referenceCompareOperation.op + ' ';
                    }

                    if (scope.sectionData.referenceCompareOperation.device) {
                        text += scope.sectionData.referenceCompareOperation.device.name;
                    }

                    if (scope.sectionData.referenceCompareOperation.asset) {
                        text += ' / ' + scope.sectionData.referenceCompareOperation.asset.title;
                    }
                }

                if (scope.sectionData.selectedCompareType == 'onEveryChange') {

                    if (scope.sectionData.constantCompareOperation.op == 'OEC') {
                        text += ' - On Every Change';
                    }
                }

                return text;
            }

            scope.isSubstepActive = function(stepName) {

                if (scope.currentSection != scope.sectionName)
                    return false;

                if (scope.currentStep.name == stepName)
                    return true;

                return false;
            };

            scope.isSubstepVisible = function(stepName) {

                if (stepName == 'deviceOrServiceStep') {
                    if (scope.isEditMode) {
                        return false;
                    }
                    return true;
                }

                if (stepName == 'dayTimeDefineStep') {
                    if (scope.sectionData.selectedService) {
                        if (scope.sectionData.selectedService.type == 'dayTime') {
                            return true;
                        }

                    }
                    return false;
                }

                if (stepName == 'deviceDefineStep') {
                    if (scope.sectionData.selectedService) {
                        return false;
                    }
                    return true;
                }

                if (stepName == 'eMailMeDefineStep') {
                    if (scope.sectionData.selectedService) {
                        if (scope.sectionData.selectedService.type == 'emailMe') {
                            return true;
                        }

                    }
                    return false;
                }


            };

            function initSteps() {

                scope.steps.push({
                    name: 'deviceOrServiceStep'
                });

                scope.steps.push({
                    name: 'dayTimeDefineStep'
                });

                scope.steps.push({
                    name: 'deviceDefineStep'
                });

                scope.steps.push({
                    name: 'eMailMeDefineStep'
                });

                return scope.steps;
            };
        }
    }

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('slRuleSectionPreview', slRuleSectionPreview);

    slRuleSectionPreview.$inject = ['$filter'];

    function slRuleSectionPreview($filter) {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/rule-section-preview/view.html',
            scope: {
                sectionData: '=',
                sectionName: '@'
            },
            link: linker
        };

        return directive;

        //////////////////

        function linker(scope) {

            scope.sectionDataApplied = [];

            scope.$watch('sectionData', function(newValue, oldValue) {
                if (newValue.constructor === Array) {
                    scope.sectionDataApplied = scope.sectionData;
                } else {
                    scope.sectionDataApplied.push(newValue);
                }
            });

            scope.getHeaderText = function(sectionData) {
                if (sectionData.selectedDevice) {
                    return sectionData.selectedDevice.title;
                }

                if (sectionData.selectedService) {
                    return sectionData.selectedService.name;
                }
            };

            scope.getLeftName = function(sectionData) {

                var leftName = '';
                if (sectionData.selectedAsset) {
                    leftName = sectionData.selectedAsset.title;
                }

                if (sectionData.selectedService) {
                    leftName = 'is';
                }

                return leftName;
            };

            scope.getComparatorName = function(sectionData) {

                var comparatorName = '';

                if (sectionData.selectedCompareType == 'constant' || sectionData.selectedCompareType == null) {
                    if (sectionData.constantCompareOperation.op && sectionData.selectedAsset) {
                        comparatorName = translateOperator(sectionData.constantCompareOperation.op);
                    }
                }

                if (sectionData.selectedCompareType == 'reference') {
                    if (sectionData.referenceCompareOperation.op && sectionData.referenceCompareOperation.asset) {
                        comparatorName = translateOperator(sectionData.referenceCompareOperation.op);
                    }
                }

                if (sectionData.selectedCompareType === 'onEveryChange') {

                    if (sectionData.constantCompareOperation.op && sectionData.selectedAsset) {
                        comparatorName = translateOperator(sectionData.constantCompareOperation.op);
                    }

                }

                return comparatorName;
            };

            scope.getValue = function(sectionData) {

                var value = '';

                if (sectionData.selectedCompareType == 'constant') {
                    if (sectionData.constantCompareOperation.value) {

                        var profile = sectionData.selectedAsset ? sectionData.selectedAsset.profile : null;

                        if (!profile) {
                            profile = sectionData.selectedService.profile;
                        }

                        value = $filter('assetValueFormat')(sectionData.constantCompareOperation.value, profile);
                    }
                }

                if (sectionData.selectedCompareType == 'reference') {
                    value = sectionData.referenceCompareOperation.device.title + ' / ' + sectionData.referenceCompareOperation.asset.title;
                }

                return value;

            };

            function translateOperator(rawOperator) {

                var realComparatorName = rawOperator;

                if (rawOperator === 'OEC') {
                    realComparatorName = 'value is changed';
                }

                if (rawOperator === '>') {
                    realComparatorName = 'is greater than';
                }

                if (rawOperator === '<') {
                    realComparatorName = 'is lower than';
                }

                if (rawOperator === '==') {
                    realComparatorName = 'equals to';
                }

                if (rawOperator === '=') {
                    realComparatorName = 'set to';
                }

                return realComparatorName;

            }
        }
    }

}(window.angular));

(function (ng) {
    ng.module('app').controller('modals.passwordRecovery.SuccessDialog', [
        '$scope',
        '$modalInstance',
        function ($scope, $modalInstance) {
            $scope.login = function () {
                $modalInstance.close();
            }
        }
    ]);
}(window.angular));
(function(ng) {
    ng
        .module('app')
        .controller('NewDeviceController', NewDeviceController);

    NewDeviceController.$inject = [
        '$state',
        '$rootScope',
        '$scope',
        'device.repository',
        'asset.repository',
        'GroundContext',
        'utils'
    ];

    function NewDeviceController($state, $rootScope, $scope, DeviceRepository, AssetRepository, GroundContext, utils) {

        var vm = this;

        vm.groundId = null;
        vm.isIntroOnDevicesHidden = false;

        vm.hasMobileDevice = false;
        vm.hasKitDevice = false;
        vm.hasCustomDevice = false;
        vm.deviceType = null;

        vm.isOnGround = $state.$current.self.name === 'main.ground' ? true : false;

        vm.createDevice = createDevice;
        vm.createKitDevice = createKitDevice;
        vm.createMobileDevice = createMobileDevice;
        vm.toggleIntroOnDevices = toggleIntroOnDevices;

        activate();

        function activate() {

            vm.groundId = GroundContext.currentId;

            vm.isIntroOnDevicesHidden = utils.preferences.readPage('IntroOnDeviceStatus');

            if (vm.isIntroOnDevicesHidden) {

                vm.isIntroOnDevicesHidden = vm.isIntroOnDevicesHidden === 'true';

            }

            DeviceRepository.findAllInGround(vm.groundId)
                .then(function(devices) {

                    for (var i = 0; i < devices.length; i++) {

                        if (devices[i].type === 'quick-demo') {
                            vm.hasMobileDevice = true;
                        }

                        if (devices[i].type === 'arduino' || devices[i].type === 'rpi' || devices[i].type === 'intel-edison' || devices[i].type === 'proximus-lora') {
                            vm.hasKitDevice = true;
                        }

                        if (devices[i].type === 'custom') {
                            vm.hasCustomDevice = true;
                        }

                    }

                });

            $rootScope.$on('IntroOnDeviceStatusToggled', function(event, args) {

                vm.isIntroOnDevicesHidden = args;

            });
        }

        function createKitDevice(name, type) {

            vm.data = {
                name: name,
                type: type
            };


            DeviceRepository.createInGround(vm.data, vm.groundId)
                .then(function(device) {

                    if (type !== 'custom') {
                        createAssets(device);
                    } else {
                        $state.go('main.device', {
                            id: device.id
                        }).then(function() {
                            triggerStateControl('device-details');
                        });
                    }
                });

        }

        function createAssets(device) {

            var ledPromise = null;
            var knobPromise = null;

            if (vm.isOnGround) {
                $rootScope.$broadcast('user.onboarded.kitDevice', device);
            } else {
                $rootScope.$broadcast('user.created.device', device);
            }

            if (vm.data.type === 'arduino') {

                ledPromise = AssetRepository.create(device.id, '4', 'LED', 'actuator', 'boolean', 'toggle');

                knobPromise = AssetRepository.create(device.id, '0', 'Rotary knob', 'sensor', { type: 'integer', minimum: 0, maximum: 1024 }, 'circle-progress');

            } else if (vm.data.type === 'intel-edison') {

                ledPromise = AssetRepository.create(device.id, '4', 'LED', 'actuator', 'boolean', 'toggle');

                knobPromise = AssetRepository.create(device.id, '0', 'Rotary knob', 'sensor', { type: 'integer', minimum: 0, maximum: 1024 }, 'circle-progress');

            } else {

                ledPromise = AssetRepository.create(device.id, 'led', 'LED', 'actuator', 'boolean', 'toggle');

                knobPromise = AssetRepository.create(device.id, 'rotary_knob', 'Rotary knob', 'sensor', { type: 'integer', minimum: 0, maximum: 1024 }, 'circle-progress');

            }

            return utils.$q.all([ledPromise, knobPromise])
                .then(function(data) {
                    $state.go('main.device', {
                            id: device.id
                        })
                        .then(function() {

                            triggerStateControl('device-details');

                        });
                });
        }

        function createDevice(name, type) {

            var data = {
                name: name,
                type: type
            };

            DeviceRepository.createInGround(data, vm.groundId)
                .then(function(device) {

                    $state.go('main.device', {
                            id: device.id
                        })
                        .then(function() {

                            triggerStateControl('device-details');

                        });

                    if (vm.isOnGround) {
                        $rootScope.$broadcast('user.onboarded.customDevice', device);
                    } else {
                        $rootScope.$broadcast('user.created.device', device);
                    }
                });
        }

        function createMobileDevice(deviceName) {

            var data = {

                name: null,
                type: 'quick-demo'

            };

            if (deviceName) {

                data.name = deviceName;

            } else {

                data.name = 'Your smartphone';
            }

            DeviceRepository.createInGround(data, vm.groundId)
                .then(function(device) {

                    $state.go('main.device', {
                            id: device.id
                        })
                        .then(function() {

                            triggerStateControl('device-details');

                            if (vm.isOnGround) {

                                $rootScope.$broadcast('user.onboarded.mobile', device);

                            } else {

                                $rootScope.$broadcast('user.created.device', device);

                            }
                        });
                });

        }

        function triggerStateControl(triggerId) {

            setTimeout(function() {
                var triggers = angular.element('[state-control-button]');

                for (var i = 0; i < triggers.length; i++) {

                    if (triggers[i].attributes['identifier'].value == triggerId) {

                        angular.element(triggers[i]).trigger('click');

                        setTimeout(clickOnTab('custom'), 400);
                    }

                }
            }, 600);
        }

        function clickOnTab(tabName) {

            angular.element(document.getElementById(tabName)).trigger('click');

        }

        function toggleIntroOnDevices() {

            vm.isIntroOnDevicesHidden = !vm.isIntroOnDevicesHidden;

            $rootScope.$broadcast('IntroOnDeviceStatusToggled', vm.isIntroOnDevicesHidden);

            utils.preferences.rememberPage('IntroOnDeviceStatus', vm.isIntroOnDevicesHidden);
        }

    }

}(window.angular));

(function(ng){

	ng.module('app').directive('boolSetter', ['$log',

        function($log) {

            var linker = function(scope, element, attrs) {
               
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/constant/bool/bool-setter.html',
                scope: {
                    boolValue: '='
                },
                link: linker
            };
        }
    ]);
}(window.angular));
(function(ng){

	ng.module('app').directive('dateSetter', ['$log',

        function($log) {

            var linker = function(scope, element, attrs) {
               
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/constant/date/date-setter.html',
                scope: {
                    dateValue: '='
                },
                link: linker
            };
        }
    ]);
}(window.angular));
(function(ng) {

    ng
        .module('app')
        .directive('labelSetter', labelSetter);

    function labelSetter() {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/constant/label/view.html',
            scope: {
                value: '=',
                profile: '='
            },
            link: linker
        };

        return directive;

        function linker(scope, element, attrs) {

            scope.labels = [];

            scope.onValueSelected = function(item, model) {
                scope.value = item.value;
            };

            scope.$watch('profile', function(newProfile) {
                
                if (!newProfile || !newProfile.labels) {
                    scope.labels = [];
                } else {

                    for (var i = 0; i < newProfile.labels.length; i++) {

                        var lbl = newProfile.labels[i];

                        if (lbl.value) {
                            scope.labels.push({
                                name: lbl.label,
                                value: lbl.value
                            });
                        } else if (lbl.from && lbl.to) {

                            for (var iterator = lbl.from; iterator < lbl.to; iterator++) {
                                scope.labels.push({
                                    name: lbl.label + ' ' + iterator,
                                    value: iterator
                                });
                            }
                        }
                    }
                }

            });
        };
    };

}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('numberSetter', numberSetter);

    function numberSetter() {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/constant/number/number-setter.html',
            scope: {
                numValue: '='
            }
        };

        return directive;
    };

}(window.angular));

(function(ng){

	ng.module('app').directive('textSetter', ['$log',

        function($log) {

            var linker = function(scope, element, attrs) {
               
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/constant/text/text-setter.html',
                scope: {
                    textValue: '='
                },
                link: linker
            };
        }
    ]);




}(window.angular));
(function(ng) {

    ng.module('app').directive('timespanSetter', ['$log',

        function($log) {

            var linker = function(scope, element, attrs) {
               
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/constant/timespan/timespan-setter.html',
                scope: {
                    timespanValue: '='
                },
                link: linker
            };
        }
    ]);

}(window.angular));
(function(ng) {

    ng.module('app').directive('assetStep', ['$filter', 'utility.deviceIcons',

        function($filter, icons) {

            var linker = function(scope) {

                scope.getIcon = function(iconKey) {
                    return icons.getIcon(iconKey);
                };

                scope.onAssetSelected = function(item, model) {
                    scope.selectedAsset = item;
                };
            };

            return {
                restrict: 'E',
                templateUrl: '/assets/js/app/directives/rule-steps/steps/asset-step/view.html',
                scope: {
                    assets: '=',
                    title: '@',
                    selectedAsset: '=',
                    filterByType: '@'
                },
                link: linker
            };
        }
    ]);

}(window.angular));

(function(ng) {

    ng.module('app').directive('compareTypeStep',
        function() {

        	return {
        		restrict:'E',
        		templateUrl:'/assets/js/app/directives/rule-steps/steps/compare-type-step/view.html',
        		scope:{
        			selectedCompareType:'=',
                    forCompare:'@'
        		}
        	};
        });

}(window.angular));

(function(ng) {
    ng
        .module('app')
        .directive('dayTime', dayTime);

    dayTime.$inject = ['service.dayTime'];

    function dayTime(dayTime) {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/steps/day-time/day-time.html',
            scope: {
                cron: '=',
                isEditMode: '='
            },
            link: linker
        };

        return directive;

        /////////////////////////////

        function linker(scope) {

            scope.days = [{
                name: "MON",
                isSelected: false
            }, {
                name: "TUE",
                isSelected: false
            }, {
                name: "WED",
                isSelected: false
            }, {
                name: "THU",
                isSelected: false
            }, {
                name: "FRI",
                isSelected: false
            }, {
                name: "SAT",
                isSelected: false,
            }, {
                name: "SUN",
                isSelected: false
            }];

            scope.amPmHours = "00";

            scope.dayClicked = function(day) {
                for (var i = 0; i < scope.days.length; i++) {
                    if (scope.days[i].name === day.name) {
                        scope.days[i].isSelected = !scope.days[i].isSelected;
                        scope.cron = generateCron();
                    }
                };
            }

            scope.interfaceClicked = function() {
                scope.cron = generateCron();
            }

            scope.changeTime = function() {
                if (scope.partOfDay) {
                    scope.amPmHours = "12";
                } else {
                    scope.amPmHours = "00";
                }
            }

            scope.$watch('hours', function() {

                scope.cron = generateCron();
            });

            scope.$watch('minutes', function() {
                scope.cron = generateCron();
            })

            function setUpView() {
                if (scope.isEditMode) {
                    disectCron(scope.cron);

                } else {
                    scope.partOfDay = false;
                    scope.hours = "6";
                    scope.minutes = "0";
                    scope.cron = generateCron();
                }
            }

            function generateCron() {
                var cron = '0 ';
                var daysSelected = 0;

                cron += scope.minutes + ' ';


                if (!scope.partOfDay) {
                    var amHours = scope.hours;
                    cron += amHours + ' ';
                } else {
                    var pmHours = (parseInt(scope.hours) + 12).toString();
                    cron += pmHours + ' ';
                }

                cron += '? * ';

                for (var i = 0; i < scope.days.length; i++) {
                    if (scope.days[i].isSelected == true) {
                        daysSelected++;
                        cron += scope.days[i].name + ',';
                    }
                };


                if (daysSelected == 0) {
                    cron += '*';
                } else {
                    cron = cron.slice(0, -1);
                }

                return cron;
            }

            function disectCron(cronSting) {

                var cronElements = cronSting.split(' ');
                var cronMinutes = cronElements[1];
                var cronHours = cronElements[2];
                var cronDaysOfWeek = cronElements[5];

                if (cronDaysOfWeek) {
                    separatedDays = cronDaysOfWeek.split(',');

                    for (var i = 0; i < separatedDays.length; i++) {
                        for (var j = 0; j < scope.days.length; j++) {
                            if (separatedDays[i] == scope.days[j].name) {
                                scope.days[j].isSelected = true;
                            }
                        }
                    }
                }

                if (cronHours >= 0 && cronHours < 12) {
                    scope.partOfDay = false;
                    scope.hours = cronHours;
                }

                if (cronHours >= 12 && cronHours < 24) {
                    scope.partOfDay = true;
                    scope.hours = (cronHours - 12).toString();
                };

                scope.minutes = cronMinutes;

            }

            setUpView();

        };
    }
}(window.angular));

(function(ng) {

    ng
        .module('app')
        .directive('deviceOrServiceStep', deviceOrServiceStep);

    deviceOrServiceStep.$inject = ['$filter', 'utility.deviceIcons'];

    function deviceOrServiceStep($filter, icons) {

        return {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/steps/device-or-service-step/view.html',
            scope: {
                title: '@',
                assetTypeFilter: '@',
                choiceType: '=',
                services: '=?',
                devices: '=?',
                deviceBoxTitle: '@',
                deviceBoxSubtext: '@',
                showNotify: '='
            },
            link: linker
        };

        function linker(scope) {

            scope.actionOrTrigger = null;
            scope.deviceTextAppend = null;

            scope.getIcon = function(iconKey) {
                return icons.getIcon(iconKey);
            };

            scope.onDeviceSelected = function() {
                scope.choiceType = 'device';
            };

            scope.onServiceSelected = function() {
                scope.choiceType = 'service';
            };

            scope.hasAvailableDevices = function() {

                var filteredDevices = $filter('devicesWithAssetFilter')(scope.devices, scope.assetTypeFilter);

                return filteredDevices.length > 0;
            };
        }
    }
}(window.angular));

(function(ng) {
    ng
        .module('app')
        .directive('deviceStep', deviceStep);

    deviceStep.$inject = ['utility.deviceIcons'];

    function deviceStep(icons) {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/steps/device-step/view.html',
            scope: {
                devices: '=',
                title: '@',
                selectedDevice: '=',
                assetTypeFilter: '@'

            },
            link: linker
        };

        return directive;

        ////////////////////////////////////

        function linker(scope) {

            scope.getIcon = function(iconKey) {
                return icons.getIcon(iconKey);
            };

            scope.onDeviceSelected = function(item, model) {
                scope.selectedDevice = item;
            };
        }
    }
}(window.angular));
(function(ng) {
    ng
        .module('app')
        .directive('selectNotificationType', selectNotificationType);

    selectNotificationType.$inject = [];

    function selectNotificationType() {

        var directive = {
            restrict: 'E',
            templateUrl: '/assets/js/app/directives/rule-steps/steps/select-notification-type/view.html',
            scope: {
                selectedNotifications: '='
            },
            link: linker
        };

        return directive;

        ////////////////////////////////////

        function linker(scope) {

            scope.onWebItemClick = function() {
                scope.selectedNotifications.web = !scope.selectedNotifications.web;
            };

            scope.onPushItemClick = function() {
                scope.selectedNotifications.push = !scope.selectedNotifications.push;
            };

            scope.onEmailItemClick = function() {
                scope.selectedNotifications.email = !scope.selectedNotifications.email;
            };

        }
    }
}(window.angular));

/*!
 * Smartliving Widgets for Angular
 * https://github.com/allthingstalsk/smartliving-widgets
 * @license MIT
 * v0.7
 */


if (!String.prototype.format) {
    String.prototype.format = function() {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function(match, number) {
            return typeof args[number] != 'undefined' ? args[number] : match;
        });
    };
}

(function() {
    'use strict';

    angular.module('ngSmartlivingWidgets', [
        'ngAnimate',
        'ui.select',
        'ngMaterial',
        'ui.knob',
        'jsonFormatter',
        'angularSpectrumColorpicker',
        'leaflet-directive',
        'nvd3',
        'ngTouch'
    ]);
})();

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .factory('widgetsCommon', factory);

    factory.$inject = [];

    function factory() {
        var defaultControls = {
            boolean: {
                sensor: function(assetProfile) {
                    return 'onoff';
                },

                actuator: function(assetProfile) {
                    return 'toggle';
                },

                virtual: function(assetProfile) {
                    return 'onoff';
                },

                config: function(assetProfile) {
                    return 'onoff';
                }
            },
            string: {
                sensor: function(assetProfile) {
                    return 'label';
                },

                actuator: function(assetProfile) {
                    return 'input';
                },

                virtual: function(assetProfile) {
                    return 'label';
                },

                config: function(assetProfile) {
                    return 'label';
                }
            },
            integer: {
                sensor: function(assetProfile) {
                    return 'label';
                },

                actuator: function(assetProfile) {
                    if ((assetProfile.minimum || assetProfile.minimum === 0) && (assetProfile.maximum || assetProfile.maximum === 0)) {
                        return 'slider';
                    } else {
                        return 'input';
                    }
                },

                virtual: function(assetProfile) {
                    return 'label';
                },

                config: function(assetProfile) {
                    return 'label';
                }
            },
            number: {
                sensor: function(assetProfile) {
                    return 'label';
                },

                actuator: function(assetProfile) {
                    if ((assetProfile.minimum || assetProfile.minimum === 0) && (assetProfile.maximum || assetProfile.maximum === 0)) {
                        return 'slider';
                    } else {
                        return 'input';
                    }
                },

                virtual: function(assetProfile) {
                    return 'label';
                },

                config: function(assetProfile) {
                    return 'label';
                }
            },
            object: {
                sensor: function(assetProfile) {
                    return 'json';
                },

                actuator: function(assetProfile) {
                    return 'text-editor';
                },

                virtual: function(assetProfile) {
                    return 'json';
                },

                config: function(assetProfile) {
                    return 'json';
                }
            },
            default: {
                sensor: function(assetProfile) {
                    return 'label';
                },

                actuator: function(assetProfile) {
                    return 'input';
                },

                virtual: function(assetProfile) {
                    return 'label';
                },

                config: function(assetProfile) {
                    return 'label';
                }
            }
        };

        var service = {
            findDefaultControl: findDefaultControl
        };
        return service;

        ////////////////

        function findDefaultControl(asset) {

            var control = null;
            var config = defaultControls[asset.profile.type];

            if (!config) {
                config = defaultControls['default'];
            }

            control = config[asset.is](asset.profile);

            return control;
        }
    }
})();

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .factory('config', factory);

    factory.$inject = [];

    function factory() {

        var config = {
            defaultMinimum: 0,
            defaultMaximum: 100,
            outOfBoundsMessage: 'Value is out of bounds. To see {0} control adjust the bounds in asset profile.',
            invalidBoundsMessage: 'Minimum bound is greater than maximum bound. Check asset profile.'
        };
        return config;
    }
})();

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('dynamicControl', dynamicControl);

    dynamicControl.$inject = ['$compile', 'widgetsCommon'];

    function dynamicControl($compile, widgetsCommon) {

        var directive = {
            restrict: 'E',
            link: linker,
            scope: {
                asset: '=',
                onChange: '&',
                enabled: '=',
                configuration: '='
            }
        };

        return directive;

        ///////////////////////////

        function getControl(asset) {

            var controlName = null;

            if (asset.control) {
                if (typeof(asset.control) == 'object' && asset.control.name) {
                    controlName = asset.control.name;
                } else if (typeof(asset.control) == 'string') {
                    controlName = asset.control;
                }
            }

            if (!controlName) {
                controlName = widgetsCommon.findDefaultControl(asset);
            }

            return controlName;
        }

        function generateTemplate(controlName) {

            var template = '<{0}-control value="asset.state.value" profile="asset.profile" id="asset.id" on-change="publish(val)" enabled="enabled" asset="asset" configuration="configuration"></{0}-control>'.format(controlName);

            return template;
        }

        function linker(scope, element, attrs) {

            scope.$watch('asset', function(newAsset) {

                if (scope.asset) {

                    var controlName = getControl(scope.asset);

                    element.html(generateTemplate(controlName));

                    $compile(element.contents())(scope);
                }
            });

            scope.publish = function(val) {
                if (scope.onChange) {
                    scope.onChange({
                        val: val
                    });
                }
            };

        }

    }
})();

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('assetChart', assetChart);

    var _defaultLoadFrom = 'past-24h';
    var _chartRefreshRate = 1000;

    function assetChart() {

        var directive = {
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            template: '<div class=chart width-change-detect><nvd3 ng-class="{zoom: vm.hovered}" class=linechart data=vm.chartData options=vm.options id=linechart></nvd3></div>',
            restrict: 'E',
            scope: {
                assets: '=',
                config: '='
            }
        };

        return directive;

    }

    Controller.$inject = ['$scope', '$rootScope', '$q', '$interval', 'history.service'];

    function Controller($scope, $rootScope, $q, $interval, historyService) {

        var vm = this;
        vm.colors = d3.scale.ordinal().range(['#56646D', '#2670E0', '#25C2D5', '#43C399', '#A8C14D', '#F4C45B', '#FF855A', '#FF6458', '#ED4D73', '#9068C8']);

        vm.redrawTrigger = false;

        // Data for chart. Every object in array must contain { values: [ {x: ,y: }, {x: ,y: }, ...]}
        vm.chartData = [{
            values: [{
                x: 0,
                y: 0
            }]
        }];

        vm.data = [];

        vm.assetHistories = [];
        vm.configAssets = [];

        vm.hovered = false;

        var realTimeInterval;

        activate();

        //////////////////////////////////////////

        function activate() {

            $scope.$watchCollection('vm.assets', initializeHistory);

            $scope.$watch('vm.config.refreshChart', function(newValue, oldValue) {
                if (newValue === true) {
                    initializeHistory();
                    vm.config.refreshChart = false;
                }
            });

            $scope.$watch('__width', function(newWidth, oldWidth) {

                //alert('detected!' + newWidth);
                if (!!newWidth) {
                    vm.redrawTrigger = !vm.redrawTrigger;
                }

            });

            $scope.$watch('vm.config.timeScale', function(newValue, oldValue) {

                if (newValue === '60m') {
                    if (angular.isDefined(realTimeInterval)) {
                        return;
                    }

                    realTimeInterval = $interval(initializeHistory, 60000);

                } else {

                    destroyTimer();

                }

            });

            $scope.$on('destroy', function() {

                destroyTimer();

            });

        }

        function destroyTimer() {
            if (angular.isDefined(realTimeInterval)) {
                $interval.cancel(realTimeInterval);
                realTimeInterval = undefined;
            }
        }

        function initializeHistory() {

            vm.data = [];

            if (vm.config === null || vm.config === undefined) {

                if (vm.assets.length === 1) {

                    var tempAsset = vm.assets[0];

                    if (tempAsset.control) {

                        if (tempAsset.control.extras) {

                            vm.config = tempAsset.control.extras;
                        } else {

                            vm.config = {

                                type: 'line-chart',
                                timeScale: '60m'

                            };
                        }
                    }
                }
            }

            var timeSet = null;

            if (vm.config.type === 'bar-chart') {

                vm.options = generateBarChartOptions();

            } else if (vm.config.type === 'line-chart') {

                vm.options = generateLineChartOptions();

            } else if (vm.config.type === 'area-range-chart') {

                vm.options = generateAreaRangeChartOptions();

            }

            if (vm.config.timeScale) {

                timeSet = generateTimeSet(vm.config.timeScale, vm.config.page);

            } else {

                timeSet = generateTimeSet('60m', vm.config.page);

            }

            if (vm.assets && vm.assets.length) {

                var historyDataPromises = [];

                for (var i = 0; i < vm.assets.length; i++) {

                    var asset = null;

                    if (vm.assets[i]._showAsset) {

                        asset = vm.assets[i];

                        if (asset.is !== 'config') {
                            var promise = historyService.getAssetHistory(asset.id, timeSet.from, timeSet.to, timeSet.resolution)
                                .then(getHistoryLoadedHandler(asset));

                            historyDataPromises
                                .push(promise);
                        } else {
                            vm.configAssets.push(asset);
                        }

                    }
                }

                $q.all(historyDataPromises)
                    .then(function() {
                        for (var i = 0; i < vm.configAssets.length; i++) {
                            var asset = vm.configAssets[i];

                            constantDataMapper(asset, vm.assetHistories);
                        }

                        vm.configAssets = [];
                        vm.assetHistories = [];

                        vm.chartData = angular.copy(vm.data);
                    });
            }
        }

        function generateTimeSet(time, page) {

            var timeSet = {
                from: null,
                to: null,
                resolution: null
            };

            if (page === null || page === undefined) {

                page = 0;
            }

            var frameStart = null;
            var frameEnd = null;

            if (time === '30d') {

                frameStart = 30 * (page + 1);
                frameEnd = 30 * page;

                timeSet.resolution = 'day';

                timeSet.from = moment().subtract(frameStart, 'days');

                timeSet.from = timeSet.from.format();

                vm.config.from = timeSet.from;

                timeSet.to = moment().subtract(frameEnd, 'days');

                timeSet.to = timeSet.to.format();

                vm.config.to = timeSet.to;

            }

            if (time === '7d') {

                frameStart = 7 * (page + 1);
                frameEnd = 7 * page;

                timeSet.resolution = 'hour';

                timeSet.from = moment().subtract(frameStart, 'days');

                timeSet.from = timeSet.from.format();

                vm.config.from = timeSet.from;

                timeSet.to = moment().subtract(frameEnd, 'days');

                timeSet.to = timeSet.to.format();

                vm.config.to = timeSet.to;

            }

            if (time === '24h') {

                frameStart = 24 * (page + 1);
                frameEnd = 24 * page;

                timeSet.resolution = 'minute';

                timeSet.from = moment().subtract(frameStart, 'hours');

                timeSet.from = timeSet.from.format();

                vm.config.from = timeSet.from;

                timeSet.to = moment().subtract(frameEnd, 'hours');

                timeSet.to = timeSet.to.format();

                vm.config.to = timeSet.to;

            }

            if (time === '60m') {

                frameStart = 60 * (page + 1);
                frameEnd = 60 * page;

                timeSet.resolution = 'minute';

                timeSet.from = moment().subtract(frameStart, 'minutes');

                timeSet.from = timeSet.from.format();

                vm.config.from = timeSet.from;

                timeSet.to = moment().subtract(frameEnd, 'minutes');

                timeSet.to = timeSet.to.format();

                vm.config.to = timeSet.to;

            }

            return timeSet;
        }

        function getHistoryLoadedHandler(asset) {

            return function(history) {

                if (vm.config.type === 'area-range-chart') {

                    vm.assetHistories.push(history);

                    areaRangeDataMapper(history, asset);

                } else {

                    vm.assetHistories.push(history);

                    dataMapper(history, asset, 'average');

                }

            };
        }

        function generateLineChartOptions() {

            var options = {
                chart: {}
            };

            options.chart.type = 'lineChart';
            options.chart.useInteractiveGuideline = false;
            options.chart.interpolate = 'monotone';
            options.chart.pointSize = 10;
            options.chart.duration = 0;

            options.chart.x = function(d) {
                return d.x;
            };

            options.chart.y = function(d) {
                if (d.y === null) {
                    return d.y;
                }

                return Math.round(d.y * 100) / 100;
            };

            options.chart.xAxis = {
                tickFormat: tickFormater,
                tickValues: tickValues
            };

            options.chart.yAxis = {
                tickFormat: function(d) {

                    return d3.format(',.1f')(d);
                }
            };

            options.chart.showLegend = false;
            options.chart.margin = {
                top: 40,
                left: 40,
                right: 40,
                bottom: 40
            };

            options.chart.lines = {
                dispatch: {

                    elementClick: function(e) {

                        clickHandler(e);

                    },

                    elementMouseover: hoverEvent

                }
            };

            return options;

        }

        function generateBarChartOptions() {

            var options = {
                chart: {}
            };

            options.chart.x = function(d) {
                return d.x;
            };

            options.chart.y = function(d) {
                if (d.y === null) {
                    return d.y;
                }

                return Math.round(d.y * 100) / 100;
            };

            options.chart.duration = 0;

            options.chart.xAxis = {
                tickFormat: tickFormater,
                tickValues: tickValues
            };

            options.chart.yAxis1 = {
                tickFormat: function(d) {
                    if (!isNaN(d)) {
                        return d3.format(',.1f')(d);
                    }
                }
            };

            options.chart.showLegend = false;
            options.chart.stacked = true;
            options.chart.margin = {
                top: 40,
                left: 40,
                right: 40,
                bottom: 40
            };

            options.chart.bars1 = {
                dispatch: {

                    elementClick: function(e) {

                        clickHandler(e);

                    },

                    elementMouseover: hoverEvent

                }
            };

            options.chart.type = 'multiChart';
            options.chart.showControls = false;

            return options;
        }

        function generateAreaRangeChartOptions() {

            var options = {
                chart: {}
            };

            options.chart.type = 'lineChart';
            options.chart.useInteractiveGuideline = false;
            options.chart.interpolate = 'monotone';
            options.chart.pointSize = 10;
            options.chart.duration = 0;

            options.chart.x = function(d) {
                return d.x;
            };

            options.chart.y = function(d) {

                if (d.y === null) {
                    return d.y;
                }

                return Math.round(d.y * 100) / 100;
            };

            options.chart.xAxis = {
                tickFormat: tickFormater,
                tickValues: tickValues
            };

            options.chart.yAxis = {
                tickFormat: function(d) {

                    return d3.format(',.1f')(d);
                }
            };

            options.chart.showLegend = false;
            options.chart.margin = {
                top: 40,
                left: 40,
                right: 40,
                bottom: 40
            };

            options.chart.lines = {
                dispatch: {

                    elementClick: function(e) {

                        clickHandler(e);

                    },

                    elementMouseover: hoverEvent

                }
            };

            return options;

        }

        function clickHandler(event) {

            var timeToZoom = null;
            var page = 0;

            if (event.data && event.data.x !== null) {

                timeToZoom = event.data.x;

            } else if (event.length && event.length > 0) {

                timeToZoom = event[0].point.x;

            } else {

                timeToZoom = event.point.x;

            }

            if (vm.config.timeScale === '30d') {

                vm.config.page = moment(new Date()).diff(timeToZoom, 'days');

                vm.config.timeScale = '24h';

                $rootScope.$broadcast('timeScaleUpdated', vm.config.timeScale);

                initializeHistory();

                return;

            }

            if (vm.config.timeScale === '7d') {

                vm.config.page = moment(new Date()).diff(timeToZoom, 'days');

                vm.config.timeScale = '24h';

                $rootScope.$broadcast('timeScaleUpdated', vm.config.timeScale);

                initializeHistory();

                return;
            }

            if (vm.config.timeScale === '24h') {

                vm.config.page = moment(new Date()).diff(timeToZoom, 'hours');

                vm.config.timeScale = '60m';

                $rootScope.$broadcast('timeScaleUpdated', vm.config.timeScale);

                initializeHistory();

                return;
            }


        }

        function hoverEvent(e) {

            if (vm.config.timeScale === '60m') {
                vm.hovered = false;
            } else {
                vm.hovered = true;
            }

        }

        function tickFormater(d) {
            if (vm.config.timeScale === '7d') {

                var daysDate = new Date(d);
                return d3.time.format('%A')(daysDate);

            } else if (vm.config.timeScale === '30d') {

                var monthDate = new Date(d);

                return d3.time.format('%d %b')(monthDate);

            } else {
                var hoursDate = new Date(d);
                return d3.time.format('%H:%M')(hoursDate);
            }
        }

        function tickValues(d) {

            var firstTime = d[0].values[0].x;
            var size = d[0].values.length;
            var lastTime = d[0].values[size - 1].x;
            var timeFormat = null;

            if (vm.config.timeScale === '60m') {
                timeFormat = d3.time.minute.range(new Date(firstTime), new Date(lastTime), 10);
            }

            if (vm.config.timeScale === '24h') {
                timeFormat = d3.time.hour.range(new Date(firstTime), new Date(lastTime), 4);
            }

            if (vm.config.timeScale === '7d') {
                timeFormat = d3.time.day.range(new Date(firstTime), new Date(lastTime), 1);
            }

            if (vm.config.timeScale === '30d') {

                timeFormat = d3.time.day.range(new Date(firstTime), new Date(lastTime), 4);
            }

            return timeFormat;

        }

        function addData(series, time, value) {

            var d = {
                x: time,
                y: value
            };
            series.values.push(d);
        }

        function dataMapper(history, asset, dataPoint) {

            var series = {
                values: [],
                key: asset.title
            };

            for (var i = 0; i < history.data.length; i++) {

                var hd = history.data[i];

                if (hd.data) {
                    if (!dataPoint) {
                        addData(series, new Date(hd.at), hd.data.avg);
                    }

                    if (dataPoint === 'average') {
                        addData(series, new Date(hd.at), hd.data.avg);
                    }

                    if (dataPoint === 'minimum') {
                        addData(series, new Date(hd.at), hd.data.min);
                    }

                    if (dataPoint === 'maximum') {
                        addData(series, new Date(hd.at), hd.data.max);
                    }

                } else {
                    addData(series, new Date(hd.at), null);
                }
            }

            if (asset._assetColor) {
                series.color = asset._assetColor;
            } else {
                series.color = vm.colors(0);
            }

            series.values = sortData(series.values);

            if (vm.config.type === 'bar-chart') {

                series.type = 'bar';
                series.yAxis = 1;

            }

            vm.data.push(series);
        }

        function constantDataMapper(asset, assetHistories) {

            var series = {
                values: [],
                key: asset.title
            };

            var numberOfPoints = 0;
            var timeFormat = 'h';

            if (vm.config.timeScale === '60m') {
                numberOfPoints = 60;
                timeFormat = 'm';
            }

            if (vm.config.timeScale === '24h') {
                numberOfPoints = 24;
            }

            if (vm.config.timeScale === '7d') {
                numberOfPoints = 7;
                timeFormat = 'd';
            }

            if (vm.config.timeScale === '30d') {

                numberOfPoints = 30;
                timeFormat = 'd';

            }

            if (assetHistories.length > 0) {

                var history = assetHistories[0].data;

                for (var i = 0; i < history.length; i++) {

                    if (asset.state && asset.state.value) {
                        addData(series, new Date(history[i].at), asset.state.value);
                    } else {
                        addData(series, new Date(history[i].at), null);
                    }

                }

            } else {
                for (var j = 0; j < numberOfPoints; j++) {

                    var time = moment().subtract(j, timeFormat);

                    if (asset.state && asset.state.value) {
                        addData(series, time, asset.state.value);
                    } else {
                        addData(series, time, null);
                    }

                }
            }

            if (asset._assetColor) {
                series.color = asset._assetColor;
            } else {
                series.color = vm.colors(0);
            }

            series.values = sortData(series.values);

            if (vm.config.type === 'bar-chart') {

                series.type = 'line';
                series.yAxis = 1;

            }

            vm.data.push(series);
        }

        function areaRangeDataMapper(history, asset) {

            var series1 = {
                values: [],
                key: asset.title + ' Maximum'
            };

            var series2 = {
                values: [],
                key: asset.title + ' Average'
            };

            var series3 = {
                values: [],
                key: asset.title + ' Minimum'
            };

            for (var i = 0; i < history.data.length; i++) {

                var hd = history.data[i];

                if (hd.data) {

                    addData(series1, new Date(hd.at), hd.data.max);
                    addData(series2, new Date(hd.at), hd.data.avg);
                    addData(series3, new Date(hd.at), hd.data.min);

                } else {
                    addData(series1, new Date(hd.at), null);
                    addData(series2, new Date(hd.at), null);
                    addData(series3, new Date(hd.at), null);
                }
            }

            if (asset._assetColor) {
                series1.color = asset._assetColor;
                series2.color = asset._assetColor;
                series3.color = asset._assetColor;
            } else {

                series1.color = vm.colors(0);
                series2.color = vm.colors(0);
                series3.color = vm.colors(0);

            }

            series1.values = sortData(series1.values);
            series2.values = sortData(series2.values);
            series3.values = sortData(series3.values);

            series1.classed = 'dashed';
            series2.strokeWidth = 2;
            series3.classed = 'dashed';

            vm.data.push(series1);
            vm.data.push(series2);
            vm.data.push(series3);

        }

        function sortData(array) {
            array.sort(function(a, b) {
                var keyA = a.x;
                var keyB = b.x;
                var result = 0;

                if (keyA < keyB) {
                    result = -1;
                }
                if (keyA > keyB) {
                    result = 1;
                }
                return result;

            });
            return array;
        }
    }
})();
(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('chartControl', chartControl);

    function chartControl() {

        var directive = {
            template: '<asset-chart assets=assets config=configuration></asset-chart>',
            link: link,
            restrict: 'E',
            scope: {
                asset: '='
            }
        };

        return directive;

        function link(scope, element, attrs) {

            scope.assets = [];

            scope.$watch('asset', function() {

                scope.assets = [];

                scope.asset._showAsset = true;

                scope.assets.push(scope.asset);

            });

        }
    }

})();

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('circleProgressControl', circleProgressControl);

    circleProgressControl.$inject = ['config'];

    function circleProgressControl(config) {

        var directive = {
            restrict: 'E',
            template: '<div class=control-knob ng-if=!blocked><knob knob-data=value knob-options=options data-width=229 data-height=229></knob><span class=knob-unit>{{profile.unit}}</span></div><div class=control-fallback ng-if=blocked><div class=value-unit><span class=value>{{value}}</span> <span class=unit>{{profile.unit}}</span></div><p>{{message}}</p></div>',
            link: linker,
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            var assetValueOutOfBoundsMessage = config.outOfBoundsMessage.format('Circle progress');
            var invalidMinMaxConfigurationMessage = config.invalidBoundsMessage;

            scope.blocked = null;

            scope.options = {
                readOnly: true,
                thickness: 0.30,
                min: config.defaultMinimum,
                max: config.defaultMaximum,
                step: 1,
                displayPrevious: true,
                angleOffset: 180,
                font: '',
                fontWeight: 900,
                fontSize: 50,
                inputColor: '#55636c',
                fgColor: 'transparent',
                bgColor: 'transparent',
                lineCap: 'round',
                draw: function() {

                    var e = this.i;
                    var l = e.val().length;
                    var w = e.width();
                    var c;
                    var a;
                    var fontSize;

                    var foregroundCircleStroke;
                    var foregroundCircleFill;
                    var backgroundCircleSize;

                    c = this.g; // context
                    a = this.arc(this.cv); // Arc

                    if (typeof window.orientation == 'undefined' || window.innerWidth > 750) {
                        foregroundCircleFill = 16;
                        foregroundCircleStroke = 20;
                        backgroundCircleSize = 2;
                    } else {
                        foregroundCircleStroke = 50;
                        foregroundCircleFill = 38;
                        backgroundCircleSize = 6;
                    }

                    //draw background circle

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, 0, 2 * Math.PI, false);
                    c.strokeStyle = '#55636c';
                    c.lineWidth = backgroundCircleSize;
                    c.stroke();

                    //draw foreground fill circle

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, a.s, a.e, a.d);
                    c.strokeStyle = '#55636c';
                    c.lineCap = 'square';
                    c.lineWidth = foregroundCircleStroke;
                    c.stroke();

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, a.s, a.e, a.d);
                    c.strokeStyle = '#f0f0f0';
                    c.lineCap = '';
                    c.lineWidth = foregroundCircleFill;
                    c.stroke();

                    if (scope.value === undefined || scope.value === null) {
                        e.val('no value');
                    }

                    if (l < 8) {
                        fontSize = '35px';
                    } else {
                        fontSize = w / l * 2.3;
                    }

                    e.css({
                        'height': fontSize,
                        'line-height': fontSize,
                        'font-size': fontSize,
                        'margin-top': '90px',
                        'width': '173px',
                        'margin-left': '-202px'
                    });
                }
            };

            scope.$watch('value', function() {

                if (scope.value < scope.options.min || scope.value > scope.options.max) {
                    scope.blocked = true;
                    scope.message = assetValueOutOfBoundsMessage;
                } else {
                    scope.blocked = false;
                }
            });

            scope.$watch('profile', function() {

                if (scope.profile) {

                    if (angular.isNumber(scope.profile.minimum) && angular.isNumber(scope.profile.maximum)) {
                        scope.options.min = scope.profile.minimum;
                        scope.options.max = scope.profile.maximum;
                    } else {
                        scope.options.min = config.defaultMinimum;
                        scope.options.max = config.defaultMaximum;
                    }

                    if (scope.options.min > scope.options.max) {
                        scope.message = invalidMinMaxConfigurationMessage;
                    }

                    //value is out of bounds
                    if (scope.options.min > scope.value || scope.options.max < scope.value) {
                        scope.blocked = true;
                        scope.message = assetValueOutOfBoundsMessage;
                    } else {
                        scope.blocked = false;
                    }

                    if (scope.profile.type == 'number') {
                        scope.options.step = 0.1;
                    }
                }
            });
        }
    }
}());

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('colorControl', colorControl);

    function colorControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-color><svg version=1.1 id=Layer_1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=150px height=150px viewbox=\"75 0 150 150\" enable-background=\"new 75 0 150 150\" xml:space=preserve><path fill=#EDEDED d=\"M150,0c-41.421,0-75,33.579-75,75c0,0.377,0.023,0.749,0.028,1.124C75.021,76.219,75,76.31,75,76.406v69.771 c0,2.111,1.712,3.823,3.823,3.823h69.771c0.097,0,0.187-0.021,0.282-0.028c0.376,0.006,0.747,0.028,1.124,0.028 c41.421,0,75-33.579,75-75C225,33.579,191.421,0,150,0z M88.62,143.999c-4.208,0-7.62-3.412-7.62-7.62c0-4.208,3.412-7.62,7.62-7.62 c4.208,0,7.62,3.412,7.62,7.62C96.24,140.588,92.829,143.999,88.62,143.999z\"></path><circle id=colorsvgtwo fill=#25E8A2 cx=150 cy=75 r=56.826></circle><path opacity=0.06 d=\"M150,16.141c32.507,0,58.859,26.352,58.859,58.859S182.507,133.859,150,133.859S91.141,107.507,91.141,75 S117.493,16.141,150,16.141z M101.917,75c0,26.556,21.528,48.083,48.083,48.083S198.083,101.556,198.083,75 S176.556,26.917,150,26.917S101.917,48.444,101.917,75z\"></path></svg></div>',
            link: linker,
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };
        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            scope.$watch('value', function() {
                if (typeof(scope.value) === 'object') {
                    if (scope.value.r !== null && scope.value.g !== null && scope.value.b !== null) {
                        var hexRed = scope.value.r.toString(16);
                        hexRed = normaliseHex(hexRed);
                        var hexGreen = scope.value.g.toString(16);
                        hexGreen = normaliseHex(hexGreen);
                        var hexBlue = scope.value.b.toString(16);
                        hexBlue = normaliseHex(hexBlue);
                        scope.color = '#' + hexRed + hexGreen + hexBlue;

                        var element = $('#colorsvgtwo');
                        element.attr('fill', scope.color);
                    }
                } else if (typeof(scope.value) === 'string') {
                    if (isHexColor(scope.value)) {
                        var colorsvg = $('#colorsvgtwo');
                        colorsvg.attr('fill', scope.value);
                    }
                }
            });

            function isHexColor(colorString) {
                if (colorString[0] === '#') {
                    if (colorString.length === 7 || colorString.length === 4) {
                        var validationString = new RegExp('^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$');
                        return validationString.test(colorString);
                    } else {
                        return false;
                    }
                } else {
                    return false;
                }
            }

            function normaliseHex(hexValue) {
                if (hexValue.length == 1) {
                    var normalisedValue = '0' + hexValue;
                    return normalisedValue;
                } else {
                    return hexValue;
                }
            }
        }
    }
}());

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('colorPickerControl', colorPickerControl);

    colorPickerControl.$inject = [];

    function colorPickerControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=color-picker-disabler ng-if=!enabled></div><div class=control-color-picker ng-if=mode ng-class=\"{disabled: !enabled}\"><spectrum-colorpicker on-change=colorChange(color) ng-model=color on-move=onMove(color) options=\"{ showInput: true, preferredFormat:\'rgb\', flat: true, chooseText: \'\' }\"></spectrum-colorpicker></div><div class=control-color-picker ng-if=!mode><spectrum-colorpicker on-change=colorChange(color) ng-model=color on-move=onMove(color) options=\"{ showInput: true, preferredFormat:\'hex\', flat: true, chooseText: \'\' }\"></spectrum-colorpicker></div>',
            link: linker,
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                is: '=',
                onChange: '&'
            }
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            var defaultState = 'rgb(0,0,0)';

            scope.firstTimePass = false;

            function prepareValue(valueObject) {

                if (valueObject === null || valueObject === undefined) {

                    return defaultState;

                }

                if (valueObject.r !== null && valueObject.g !== null && valueObject.b !== null) {

                    var rgbString = 'rgb(' + valueObject.r + ',' + valueObject.g + ',' + valueObject.b + ')';

                    return rgbString;

                } else if (isHexColor(valueObject)) {

                    return valueObject;

                } else {

                    return defaultState;

                }
            }

            scope.colorChange = function(color) {

                if (scope.firstTimePass) {

                    var rgb = colorToObject(color);

                    if (scope.profile.type === 'object' && (typeof rgb === 'object')) {

                        if (!scope.value || rgb.r !== scope.value.r || rgb.g !== scope.value.g || rgb.b !== scope.value.b) {

                            publishValue(rgb);

                        }

                    } else if (scope.profile.type === 'string' && (typeof color === 'string')) {

                        if (color !== scope.value) {

                            publishValue(color);

                        }

                    }
                } else {

                    scope.firstTimePass = true;

                }
            };

            scope.onMove = function(color) {

                element.find('.spectrum-color-preview').css({
                    'background-color': color
                });

            };

            scope.$watch('value', function() {

                scope.color = prepareValue(scope.value);

                element.find('.spectrum-initialColor-preview, .spectrum-color-preview').css({
                    'background-color': scope.color
                });

            });

            scope.$watch('profile', function() {

                if (scope.profile) {

                    if (scope.profile.type === 'object') {

                        scope.mode = true;

                    } else if (scope.profile.type === 'string') {

                        scope.mode = false;

                    }
                }
            });

            function colorToObject(color) {

                var colorString = color.slice(4, color.length);
                colorString = colorString.substring(0, colorString.length - 1);
                var colorValues = colorString.split(',');
                var red = colorValues[0].replace(' ', '');
                var green = colorValues[1].replace(' ', '');
                var blue = colorValues[2].replace(' ', '');
                var colorObject = {};
                colorObject.r = parseInt(red);
                colorObject.g = parseInt(green);
                colorObject.b = parseInt(blue);

                return colorObject;
            }

            function isHexColor(colorString) {

                if (colorString[0] === '#') {

                    if (colorString.length === 7 || colorString.length === 4) {

                        var validationString = new RegExp('^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$');

                        return validationString.test(colorString);

                    } else {

                        return false;

                    }
                } else {

                    return false;

                }
            }

            function publishValue(value) {

                if (scope.enabled) {

                    if (scope.onChange) {

                        scope.onChange({
                            val: value
                        });

                    }
                }
            }
        }
    }
}());

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('labelControl', directive);

    function directive() {

        var directive = {
            template: '<div class=control-label ng-class=\"{\'no-color\' : vm.currentColor == undefined || vm.currentColor == null || vm.currentColor == vm.defaultColor}\"><label style=background-color:{{vm.currentColor}}><span ng-if=\"vm.value !== undefined && vm.value !== null\">{{vm.currentLabel}}</span> <span class=empty ng-if=\"vm.value === undefined || vm.value === null\"><i>no value</i></span><aside style=\"border-color:{{vm.currentColor}} transparent transparent transparent\"></aside></label></div>',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                profile: '=',
                asset: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

    }

    var DEFAULT_COLOR = '#ffffff';
    var DEFAULT_LABEL = 'no value';

    Controller.$inject = ['$scope'];

    function Controller($scope) {

        var vm = this;

        vm.options = [];

        vm.currentColor = null;

        vm.defaultColor = DEFAULT_COLOR;

        vm.currentLabel = null;

        $scope.$watch('vm.asset.control', controlWatcher, true);
        $scope.$watch('vm.value', valueWatcher);

        function controlWatcher(controlSettings) {

            var options = extractValues(controlSettings);

            extractColors(options, controlSettings);

            extractLabels(options, controlSettings);

            vm.options = options;
        }

        function valueWatcher(newValue) {

            var foundOption = null;

            angular.forEach(vm.options, function(option) {

                if (option.value === newValue) {

                    foundOption = option;

                }

            });

            if (foundOption) {

                vm.currentLabel = foundOption.label;

                vm.currentColor = foundOption.color;

            } else {

                vm.currentLabel = newValue;

                vm.currentColor = DEFAULT_COLOR;

            }
        }

        function extractValues(controlSettings) {

            var options = [];

            if (controlSettings && controlSettings.extras && controlSettings.extras.values) {

                angular.forEach(controlSettings.extras.values, function(option) {

                    options.push({
                        value: option
                    });

                });

            }

            return options;
        }

        function extractColors(options, controlSettings) {

            if (!controlSettings) {

                return;

            }

            angular.forEach(options, function(option, index) {

                //first, read from settings.[optionValue], as this is priority
                if (controlSettings.extras[option.value]) {

                    option.color = controlSettings.extras[option.value];

                    return;

                }

                if (!controlSettings.extras.colors) {

                    option.color = DEFAULT_COLOR;

                    return;

                }

                if (typeof controlSettings.extras.colors[index] === 'undefined') {

                    option.color = DEFAULT_COLOR;

                    return;

                }

                option.color = controlSettings.extras.colors[index];

            });
        }

        function extractLabels(options, controlSettings) {

            if (!controlSettings) {

                return;

            }

            angular.forEach(options, function(option, index) {

                if (!controlSettings.extras.labels) {

                    option.label = option.value;

                    return;

                }

                if (typeof controlSettings.extras.labels[index] === 'undefined') {

                    option.label = option.value;

                    return;

                }

                option.label = controlSettings.extras.labels[index];

            });
        }

    }
})();

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('dropdownControl', dropdownControl);

    dropdownControl.$inject = [];

    function dropdownControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-dropdown ng-class=\"{disabled: !enabled}\"><ui-select ng-disabled=!enabled theme=selectize ng-model=selectedValue on-select=onItemSelected($item,$model) search-enabled=false><ui-select-match placeholder=\"select option\">{{$select.selected.name}} {{profile.unit}}</ui-select-match><ui-select-choices repeat=\"item in listElements\"><aside>{{item.name}} {{profile.unit}}</aside></ui-select-choices></ui-select></div>',
            link: linker,
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                is: '=',
                onChange: '&'
            }
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            scope.listElements = [];
            scope.selectedValue = null;
            scope.onItemSelected = onItemSelected;
            scope.$watch('profile', watchProfile);
            scope.$watch('value', watchValue);

            function onItemSelected(item, model) {
                publishValue(item.value);
            }

            function publishValue(value) {

                if (scope.onChange) {

                    scope.onChange({
                        val: value
                    });

                }
            }

            function watchProfile() {

                scope.listElements = [];

                if (scope.profile) {

                    scope.listElements = extractOptionsFromProfile(scope.profile);

                    scope.selectedValue = getSelectedOption();

                }
            }

            function watchValue() {

                scope.selectedValue = getSelectedOption();

            }

            function extractOptionsFromProfile(profile) {

                var options = [];

                if (profile.enum) {

                    angular.forEach(profile.enum, function(val) {
                        options.push({
                            name: val,
                            value: val
                        });
                    });

                    return options;
                }

                if (profile.labels) {

                    angular.forEach(profile.labels, function(val) {

                        options.push({
                            name: val.name,
                            value: val.value
                        });
                    });

                    return options;
                }

                if (profile.type == 'boolean') {

                    options.push({
                        name: 'true',
                        value: true
                    });

                    options.push({
                        name: 'false',
                        value: false
                    });

                    return options;
                }
            }

            function getSelectedOption() {

                var selOption = null;

                angular.forEach(scope.listElements, function(option) {

                    if (option.value === scope.value) {

                        selOption = option;

                    }

                });

                return selOption;
            }
        }
    }

}());

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('inputControl', inputControl);

    inputControl.$inject = [];

    function inputControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-input ng-class=\"{disabled: !enabled}\"><input type=text ng-model=localValue placeholder=\"Enter value\" ng-disabled=!enabled> <button class=input-control-btn ng-click=sendValue(localValue) ng-disabled=!enabled></button></div>',
            link: linker,
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                onChange: '&'
            }
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            scope.$watch('value', function(newValue) {
                scope.localValue = newValue;
            });

            element.bind('keydown keypress', function(event) {
                if (event.which === 13) {
                    scope.sendValue(scope.localValue);
                    event.preventDefault();
                }
            });

            scope.sendValue = function(value) {
                var normalisedValue = normaliseData(value);
                if (validateInputData(normalisedValue)) {
                    publishValue(normalisedValue);
                }
            };

            function validateInputData(value) {
                if (scope.profile.type == 'integer') {
                    if (isInteger(value)) {
                        if (isInBounds(value)) {
                            return true;
                        }
                    }
                } else if (scope.profile.type == 'number') {
                    if (typeof(value) == 'number') {
                        if (isInBounds(value)) {
                            return true;
                        }
                    }
                } else if (scope.profile.type == 'string') {
                    if (typeof(value) == 'string') {
                        return true;
                    }
                } else {
                    return false;
                }
            }

            function normaliseData(value) {
                if (scope.profile.type === 'number' || scope.profile.type === 'integer') {
                    var data = Number(value);
                    if (typeof(data) == 'number') {
                        if (!isNaN(data)) {
                            return data;
                        }
                    }
                } else {
                    return value;
                }
            }

            function isInteger(value) {
                if (value % 1 === 0) {
                    return true;
                } else {
                    return false;
                }
            }

            function isNumber(value) {
                if (value % 1 !== 0 || value % 1 === 0) {
                    return true;
                } else {
                    return false;
                }
            }

            function isInBounds(value) {
                if (value < scope.profile.minimum || value > scope.profile.maximum) {
                    return false;
                } else {
                    return true;
                }
            }

            function publishValue(value) {

                if (scope.onChange) {
                    scope.onChange({
                        val: value
                    });
                }
            }
        }
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('jsonControl', jsonControl);

    jsonControl.$inject = [];

    function jsonControl() {

        var directive = {
            restrict: 'E',
            template: '<div class=control-json><json-formatter json=value open=2></json-formatter></div>',
            scope: {
                profile: '=',
                value: '=?',
                id: '='
            },
            link: linker
        };

        return directive;

        //////////////////////

        function linker(scope, element, attrs) {

            if (scope.value === undefined) {
                scope.value = null;
            }

            scope.$watch('value', function(newValue) {
                scope.value = newValue;
            });
        }
    }
}());

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('knobControl', knobControl);

    knobControl.$inject = ['$interval', 'config'];

    function knobControl($interval, config) {

        var directive = {
            restrict: 'E',
            template: '<div class=control-knob ng-if=!blocked ng-class=\"{disabled: !enabled}\"><knob knob-data=value knob-options=options data-width=229 data-height=229></knob><span class=knob-unit>{{profile.unit}}</span></div><div class=control-fallback ng-if=blocked><div class=value-unit><span class=value>{{value}}</span> <span class=unit>{{profile.unit}}</span></div><p>{{message}}</p></div>',
            link: linker,
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                onChange: '&'
            }
        };

        return directive;

        /////////////////////////

        function linker(scope, element, attrs) {

            var assetValueOutOfBoundsMessage = config.outOfBoundsMessage.format('Knob');

            var invalidMinMaxConfigurationMessage = config.invalidBoundsMessage;

            var valueToPublish = null;

            var publishInterval = null;

            scope.blocked = null;

            scope.message = null;

            scope.options = {
                readOnly: !scope.enabled,
                min: config.defaultMinimum,
                max: config.defaultMaximum,
                step: 1,
                thickness: 0.30,
                displayPrevious: true,
                angleOffset: 180,
                font: '',
                fontWeight: 900,
                inputColor: '#55636c',
                fgColor: 'transparent',
                bgColor: 'transparent',
                lineCap: 'round',
                mouseWheel: false,
                release: function(newValue) {

                    if (scope.value !== newValue) {

                        valueToPublish = newValue;

                    }
                },

                draw: function() {
                    var e = this.i;
                    var l = e.val().length;
                    var w = e.width();

                    var fontSize = w / l * 2.5;
                    if (l < 8) {
                        fontSize = '35px';
                    }

                    e.css({
                        'height': fontSize,
                        'line-height': fontSize,
                        'font-size': fontSize,
                        'margin-top': '90px',
                        'width': '173px',
                        'margin-left': '-202px'
                    });

                    var c = this.g; // context
                    var a = this.arc(this.cv); // Arc

                    var handleSize = 40; // radius of knob handle
                    var foregroundCircleStroke = 50;
                    var foregroundCircleFill = 38;
                    var handleLineSize = 6;
                    var backgroundCircleSize = 6;

                    if (typeof window.orientation == 'undefined' || window.innerWidth > 750) {
                        handleSize = 15; // radius of knob handle
                        foregroundCircleStroke = 20;
                        foregroundCircleFill = 16;
                        handleLineSize = 2;
                        backgroundCircleSize = 2;
                    }

                    c.canvas.addEventListener('mousemove', function(event) {
                        var mousePos = getMousePos(c.canvas, event);
                        var distance = Math.sqrt(Math.pow((mousePos.x - x), 2) + Math.pow((mousePos.y - y), 2));
                        if (distance < handleSize) {
                            $(this).css({
                                'cursor': 'move'
                            });
                        } else {
                            $(this).css({
                                'cursor': 'default'
                            });
                        }
                    }, false);

                    function getMousePos(canvas, event) {
                        var rect = canvas.getBoundingClientRect();
                        return {
                            x: event.clientX - rect.left,
                            y: event.clientY - rect.top
                        };
                    }

                    //draw background circle

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, 0, 2 * Math.PI, false);
                    c.strokeStyle = '#55636c';
                    c.lineWidth = backgroundCircleSize;
                    c.stroke();

                    //draw foreground fill circle

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, a.s, a.e, a.d);
                    c.strokeStyle = '#55636c';
                    c.lineCap = 'square';
                    c.lineWidth = foregroundCircleStroke;
                    c.stroke();

                    c.beginPath();
                    c.arc(this.xy, this.xy, this.radius, a.s, a.e, a.d);
                    if (scope.enabled) {
                        c.strokeStyle = '#fff';
                    } else {
                        c.strokeStyle = '#f0f0f0';
                    }

                    c.lineCap = '';
                    c.lineWidth = foregroundCircleFill;
                    c.stroke();

                    //draw handle
                    // get the end angle coordinates. found it here: http://stackoverflow.com/questions/18342216/how-to-get-an-array-of-coordinates-that-make-up-a-circle-in-canvas
                    if (scope.enabled) {
                        var radians = a.e - Math.PI / 180;
                        var x = this.xy + this.radius * Math.cos(radians);
                        var y = this.xy + this.radius * Math.sin(radians);

                        // your custom dot
                        c.beginPath();
                        c.arc(x, y, handleSize, 0, 2 * Math.PI, false);
                        c.fillStyle = '#fff';
                        c.strokeStyle = '#55636c';
                        c.lineCap = 'round';
                        c.lineWidth = handleLineSize;
                        c.fill();
                        c.stroke();
                    }
                }
            };

            publishInterval = $interval(publishIntervalHandler, 1000);

            scope.$watch('profile', profileWatcher);

            scope.$watch('value', valueWatcher);

            scope.$watch('enabled', enableWatcher);

            scope.$on('$destroy', destroyHandler);

            function profileWatcher() {

                if (scope.profile) {

                    if (angular.isNumber(scope.profile.minimum) && angular.isNumber(scope.profile.maximum)) {

                        scope.options.min = scope.profile.minimum;
                        scope.options.max = scope.profile.maximum;

                    } else {

                        scope.options.min = config.defaultMinimum;
                        scope.options.max = config.defaultMaximum;

                    }

                    if (scope.options.min > scope.options.max) {

                        scope.message = invalidMinMaxConfigurationMessage;

                    }

                    if (scope.options.min > scope.value || scope.options.max < scope.value) {

                        scope.blocked = true;
                        scope.message = assetValueOutOfBoundsMessage;

                    } else {

                        scope.blocked = false;

                    }

                    if (scope.profile.type == 'number') {

                        scope.options.step = 0.1;

                    }

                }
            }

            function enableWatcher() {

                scope.options.readOnly = !scope.enabled;

            }

            function valueWatcher() {

                if (scope.value < scope.options.min || scope.value > scope.options.max) {

                    scope.blocked = true;

                    scope.message = assetValueOutOfBoundsMessage;

                } else {

                    scope.blocked = false;

                }
            }

            function publishIntervalHandler() {

                if (valueToPublish) {

                    publishValue(valueToPublish);

                    valueToPublish = null;

                }
            }

            function destroyHandler() {

                $interval.cancel(publishInterval);

                publishInterval = null;

            }

            function publishValue(value) {

                if (scope.onChange) {

                    scope.onChange({
                        val: value
                    });

                }
            }
        }
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('lineProgressControl', lineProgressControl);

    lineProgressControl.$inject = ['config'];

    function lineProgressControl(config) {

        var directive = {
            restrict: 'E',
            template: '<div class=control-slider ng-show=!blocked><article class=slider-val><span class=slider-value>{{value}}</span> <span class=slider-unit>{{profile.unit}}</span></article><div><md-slider ng-if=sliderSettingsAreReady aria-label=lineProgress ng-disabled=true ng-model=value min=\"{{ sliderSettings.minimum }}\" max=\"{{ sliderSettings.maximum }}\" step=1></md-slider></div></div><div class=control-fallback ng-show=blocked><div class=value-unit><span class=value>{{value}}</span> <span class=unit>{{profile.unit}}</span></div><p>{{message}}</p></div>',
            link: linker,
            scope: {
                value: '=',
                profile: '=',
                id: '='
            }
        };
        return directive;

        /////////////////////////////////

        function linker(scope, element, attrs) {

            var assetValueOutOfBoundsMessage = config.outOfBoundsMessage.format('Line progress');
            var invalidMinMaxConfigurationMessage = config.invalidBoundsMessage;

            scope.blocked = null;
            scope.message = null;
            scope.sliderSettings = {
                minimum: config.defaultMinimum,
                maximum: config.defaultMaximum
            };

            scope.$watch('value', function(newValue) {
                if (scope.value > scope.sliderSettings.maximum || scope.value < scope.sliderSettings.minimum) {
                    scope.blocked = true;
                    scope.message = assetValueOutOfBoundsMessage;
                } else {
                    scope.blocked = false;
                    scope.value = newValue;
                }
            });

            scope.$watch('profile', function() {
                if (scope.profile) {

                    if (angular.isNumber(scope.profile.minimum) && angular.isNumber(scope.profile.maximum)) {

                        scope.sliderSettings.minimum = scope.profile.minimum;
                        scope.sliderSettings.maximum = scope.profile.maximum;

                    } else {
                        scope.sliderSettings.minimum = config.defaultMinimum;
                        scope.sliderSettings.maximum = config.defaultMaximum;
                    }

                    if (scope.sliderSettings.minimum > scope.sliderSettings.maximum) {
                        scope.blocked = true;
                        scope.message = invalidMinMaxConfigurationMessage;
                    } else if (scope.sliderSettings.minimum > scope.value || scope.sliderSettings.maximum < scope.value) {
                        scope.blocked = true;
                        scope.message = assetValueOutOfBoundsMessage;
                    } else {
                        scope.blocked = false;
                    }
                }
            });

            //Hack because of the problem with ngMaterial slider
            scope.sliderSettingsAreReady = true;
        }
    }
}());

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('lockUnlockControl', lockUnlockControl);

    lockUnlockControl.$inject = [];

    function lockUnlockControl() {

        var directive = {
            template: '<div class=control-lock-unlock ng-click=onClick() ng-class=\"{disabled: !enabled}\"><button ng-disabled=!enabled ng-class=\"{ locked: locked }\"></button></div>',
            link: link,
            restrict: 'E',
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                onChange: '&'
            }
        };
        return directive;

        function link(scope, element, attrs) {

            //Default controls state:
            scope.unlockedValue = false;
            scope.lockedValue = true;
            scope.locked = false;

            scope.$watch('profile', function() {

                if (scope.profile) {
                    if (scope.profile.enum) {
                        scope.unlockedValue = scope.profile.enum[0];
                        scope.lockedValue = scope.profile.enum[1];
                    } else {
                        if (scope.profile.type == 'boolean') {
                            scope.unlockedValue = false;
                            scope.lockedValue = true;
                        }

                        if (scope.profile.type == 'integer') {
                            scope.unlockedValue = 0;
                            scope.lockedValue = scope.value;
                        }
                    }

                    update();
                }
            });

            scope.$watch('value', function(newValue) {
                update();
            });

            scope.onClick = function() {

                //if not locked -> lock
                if (scope.enabled) {
                    if (!scope.locked) {
                        publishValue(scope.lockedValue);
                        scope.locked = true;
                    } else if (scope.locked) { //if locked -> unlock
                        publishValue(scope.unlockedValue);
                        scope.locked = false;
                    }
                }
            };

            function publishValue(value) {

                if (scope.onChange) {
                    scope.onChange({
                        val: value
                    });
                }
            }

            function update() {
                if (scope.value === scope.lockedValue) {
                    scope.locked = true;
                } else if (scope.value === scope.unlockedValue) {
                    scope.locked = false;
                }
            }

        }
    }

})();

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('mapControl', mapControl);

    mapControl.$inject = [];

    function mapControl() {
        var directive = {
            template: '<leaflet id={{vm.id}} class=control-map markers=vm.markers center=vm.center defaults=vm.defaults paths=vm.paths></leaflet>',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '='
            }
        };
        return directive;
    }

    Controller.$inject = ['$scope', '$interval', 'leafletData'];

    function Controller($scope, $interval, leafletData) {

        var mapDefaults = {
            icon: {
                image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAwCAYAAAAGlsrkAAAACXBIWXMAAAsTAAALEwEAmpwYAAA5lGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMjEgNzkuMTU0OTExLCAyMDEzLzEwLzI5LTExOjQ3OjE2ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+QWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNS0xMC0yMlQxMjo0ODowOCswMjowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE1LTEwLTIyVDEzOjUyOjE2KzAyOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNS0xMC0yMlQxMzo1MjoxNiswMjowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDpkNzU1MTY4OC05ZDhhLWQyNGUtODVhZi1hOTAxMDNmMjM1MTU8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPnhtcC5kaWQ6OTIxRTQ4OTI3OEE5MTFFNUIzODBCNjU4QTE5NDdEQkY8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6OTIxRTQ4OEY3OEE5MTFFNUIzODBCNjU4QTE5NDdEQkY8L3N0UmVmOmluc3RhbmNlSUQ+CiAgICAgICAgICAgIDxzdFJlZjpkb2N1bWVudElEPnhtcC5kaWQ6OTIxRTQ4OTA3OEE5MTFFNUIzODBCNjU4QTE5NDdEQkY8L3N0UmVmOmRvY3VtZW50SUQ+CiAgICAgICAgIDwveG1wTU06RGVyaXZlZEZyb20+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5MjFFNDg5Mjc4QTkxMUU1QjM4MEI2NThBMTk0N0RCRjwveG1wTU06T3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6ZDc1NTE2ODgtOWQ4YS1kMjRlLTg1YWYtYTkwMTAzZjIzNTE1PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE1LTEwLTIyVDEzOjUyOjE2KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjY1NTM1PC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4zMDwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj40ODwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+ZnhexAAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAEY0lEQVR42ryYS2gkRRjHf1XdPclMkkki+wKX1Si7q7IsCB72IB4XRMGjggdRTx4UBfGFqJcoooJ6cteDB8GDLxSMIqj4AkUkK2QPK7uuiRGjyT4yeU/PVH0eqkYn0510z0yS/2Ho6e6v/vW9v2p16OFJcuA64DhwDLgR2NfyfAYYB34EPgfOZi0YZjw/CjwJ3AEUN3lvCLgeuBtYBj4BXgRObSSgN1lsFPgFuCuDtBV9wJ3eAi8BhbzEu4EvgKcARXd4FPgSuDLL1GXga+CG1GWUBqVRKmjakyBiQQyITZO6GfjOx8dsGnEBGNuIVAUFRCwSL2HjRbAxIKAjVDSAKvS7d0zN3V+PEb/2LcBqK/Go310TBFQIOsSsXkAWp7HVCtgaIgIISmnQIaowgO7fjy7tASzYequnbvIB9xCA8ul0BJhIkkagwFTOY+Z/c0Q6cqHxv6Xdj99MUD5AMHzYucXGaWFyFJjQTdq22ha0xlz6FXvpLEqHqKDo7ivlF1TuWmkIelBBAbswhbl4GoWATs3WlxtRfRC4rVVbFUTYxWnM4hSEPY4w6btk8IVFzNJf1CvnnZuSOA4c0cCtQLB+gQgbr2Aqv6MI3IJtQOkIu/AHEldAR2mv3K59mLcIBtjVWaS2DEHUfvbqCDFV7PKsd0XCz8c0cHg9q0JsHalW2tZ0nat06DQ2qQF2UAN7E8VM6lBf84WiU2iktpqWVgB7dWotFQFMd8VS4SuZpJm6oIE4XSrojlgA7UqsU2Qdqtr30iZYV4nCEmK70dqgwpJPqQTxjE5ULHGBoXqHnIBIZwpbg+4dRgWFtOYxoYFvk0I1dGk3uqeMpJe9DNIaKiyhSns2str32neNlfWSBhUUCQav9f/r+cnFNYhgcAQVDYDUEv4FPtLAHHCiNbjEVFF9+wiHDrmUyKO51BETEw5eQ1A+sJHMm8BMozvtAqaAUrLxB9ilPzHz56BeBR00NQqfemLAGtARwdAIuny171gJS1V9b55pVPELvkONJswGBOWrUL1XuPpbvYzU16DR8FWICouonmH0wH50z7CLCzFp2r7RyCLVNN4WgDN+R6n1F6WgvobUlv6bNJSOUFEfRCWXNba2URe77MvzXOsEEgOPAe+lElsfJDpEFXehvTaCODObOCvsnmuQpk2Z7wOfZUatiRFTRUzVEUpmoRkHXs8ab+8F5tk6GOCePHP1P8ATW0j8PHA670niBPDVFpBOAM+0e4S5H1jrkvi+Ts5Ok8DTXZC+AvzcCXFDeLwD0kng8c3nk2w80AHxg1kjTB7in4CTbZCO+fMx3RLjfb2S891H8o2C+TAHvJDjvZN5PkO0QwzwanOtTcEK8Gz+4Tc/loDXNnn+FvD3dhA3+mlaHY+9Rdgu4ovA2yn3PwDObSdxY2ZKCyq2m3gC+KHp/xngm50gBnin6frd7BP71hF/3HT9YWdnyc4w7U28kPxokw8hneOU34DdaeJP/ZdAdpp4DOjvVPjfAQAj1Hyq7g5auQAAAABJRU5ErkJggg==',
                shadowImage: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAdCAYAAADoxT9SAAAACXBIWXMAAAsTAAALEwEAmpwYAAA5lGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMjEgNzkuMTU0OTExLCAyMDEzLzEwLzI5LTExOjQ3OjE2ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+QWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxNS0xMC0yMlQxMjo0ODowOCswMjowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE1LTEwLTIyVDEzOjUyOjI5KzAyOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpNZXRhZGF0YURhdGU+MjAxNS0xMC0yMlQxMzo1MjoyOSswMjowMDwveG1wOk1ldGFkYXRhRGF0ZT4KICAgICAgICAgPHhtcE1NOkluc3RhbmNlSUQ+eG1wLmlpZDphNTg0ZmY4MC03YTE2LTBmNDgtOTUwYS03NzgzMzY1MGQ5Nzg8L3htcE1NOkluc3RhbmNlSUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPnhtcC5kaWQ6ODhDNzNFMUI3OEE5MTFFNUFCMDJCM0I3NkQ3RTM3Rjc8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgIDxzdFJlZjppbnN0YW5jZUlEPnhtcC5paWQ6ODhDNzNFMTg3OEE5MTFFNUFCMDJCM0I3NkQ3RTM3Rjc8L3N0UmVmOmluc3RhbmNlSUQ+CiAgICAgICAgICAgIDxzdFJlZjpkb2N1bWVudElEPnhtcC5kaWQ6ODhDNzNFMTk3OEE5MTFFNUFCMDJCM0I3NkQ3RTM3Rjc8L3N0UmVmOmRvY3VtZW50SUQ+CiAgICAgICAgIDwveG1wTU06RGVyaXZlZEZyb20+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo4OEM3M0UxQjc4QTkxMUU1QUIwMkIzQjc2RDdFMzdGNzwveG1wTU06T3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6YWN0aW9uPnNhdmVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6YTU4NGZmODAtN2ExNi0wZjQ4LTk1MGEtNzc4MzM2NTBkOTc4PC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE1LTEwLTIyVDEzOjUyOjI5KzAyOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICAgICA8c3RFdnQ6Y2hhbmdlZD4vPC9zdEV2dDpjaGFuZ2VkPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjY1NTM1PC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj41MDwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4yOTwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAo8P3hwYWNrZXQgZW5kPSJ3Ij8+1iOTFQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAACI0lEQVR42tyY607DMAyFT9qwsQ14//dEoNJLwg+OpYOV0a43BpWsBpCoP/s4dhJyzvgPTwSAEMKe3wzufe3JtNEn5/wFspPTAUDl3qEAZACJluWdf8zIRgAVgJoWZW1WglGnB1oHoKfZ7/KWIOZMDeCB//vI9cHBGKiXmDmYxDraB4AWQMOfv2UorghhAEcAj3wbQHSS+qlW8hWJtYR5p31odtYAMek8ArgIRJToTy3wEmBNZ6MEp+bfGpNiXJiFwCxcaGf5UJjo+C0Zt4wm1kzH9eKMGMSLQKwJUALSzBjY7IwEkdOzQFQ79qFvz9wPV4zK084QoKRaWlpS7JaNE+1hJwjrLQ13rWbprmXZOFNa9cYAiW/rJW8AXrlOc/tIRRmdCBE3KmxtjNbdG+khje/wccYWeCTI2nWRXRPspR4asY4Qs0eUivWwZjZ0GPSzVSvdvJNZKy8ZGi0bpxt3qeA+nNzYYc73MlN1hUExjY30U0FqN4LUE6Wijg9XJlpda9RHnb8VpGYGntx266OdC4Ne76zkdHJnj1lH1jgBwhrfheu6oO+STAZqXPXdFw5Kq5y148hAeCDAs0hKHU9O06pxczxt4fhUkKoAESSynewmvji9VPa7fCgcUQ8ymkeRibdrUf+dW5QCxJn1EKQJtaL5we1I93EdJBBRzhSdQPhdBr8V+Vuk1bs9f7inyE8F8Xv73UV+DKQU8T91lxr+y93v5wCV/Qp4dygmBQAAAABJRU5ErkJggg==',
                iconSize: [30, 48],
                shadowSize: [50, 29],
                iconAnchor: [15, 48],
                shadowAnchor: [3, 29]
            },
            behavior: {
                drawLineBetweenLocations: true,
                lineColor: '#3D91CE',
                lineWeight: 6,
                lineOpacity: 0.4
            },
            controls: {
                scrollWheelZoom: false,
                doubleClickZoom: true,
                attributionControl: true,
                zoomControl: true,
                dragging: true,
                tileLayer: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
            },
            center: {}
        };

        var pendingStateLocation = null;
        var pendingPaths = [];
        var mapInitialized = false;

        //map is not update every time state changes, but every in interval specified
        var mapUpdateInterval = 3000;

        var vm = this;
        vm.center = mapDefaults.center;
        vm.markers = [];
        vm.defaults = mapDefaults.controls;

        vm.paths = {
            movement: {
                color: mapDefaults.behavior.lineColor,
                weight: mapDefaults.behavior.lineWeight,
                opacity: mapDefaults.behavior.lineOpacity,
                latlngs: []
            }
        };

        $scope.$watch('vm.value', function() {

            if (!isUndefinedOrNull(vm.value)) {

                //setup for next map update
                pendingStateLocation = extractStateLocation(vm.value);
                pendingPaths.push(angular.copy(pendingStateLocation.location));

                //on inital state change, update map immediately
                if (!mapInitialized) {
                    updateMap();
                    mapInitialized = true;
                }
            }
        });

        $interval(updateMap, mapUpdateInterval);

        function updateMap() {

            if (pendingStateLocation) {

                vm.center = angular.copy(pendingStateLocation.location);

                //set map.zoom only if there is only one relevant point on the map
                //if there is more then one point, fit to bound will be applied.
                if (vm.paths.movement.latlngs.length === 0) {
                    vm.center.zoom = pendingStateLocation.zoom;
                }

                vm.markers = [getMarker(pendingStateLocation.location)];

                if (mapDefaults.behavior.drawLineBetweenLocations) {

                    angular.forEach(pendingPaths, function(p) {
                        vm.paths.movement.latlngs.push(p);
                    });

                    //do fit to bounds only if there is more the one point
                    //if there one or none, leave the default zoom
                    if (vm.paths.movement.latlngs.length > 1) {

                        leafletData.getMap(vm.id).then(function(map) {

                            map.fitBounds(vm.paths.movement.latlngs);
                        });
                    }
                }

                pendingStateLocation = null;
                pendingPaths = [];
            }
        }

        function extractStateLocation(state) {

            if (isUndefinedOrNull(state)) {
                throw 'Smartliving Widgets - Map Control - Invalid location';
            }

            var stateLocation = {
                location: {
                    lat: 0,
                    lng: 0
                },
                zoom: 11
            };

            if (angular.isArray(state)) {

                if (state.length === 2 && angular.isNumber(state[0]) && angular.isNumber(state[1])) {
                    stateLocation.location.lat = state[0];
                    stateLocation.location.lng = state[1];
                    return stateLocation;
                }
            }

            if (angular.isNumber(state.lat) && angular.isNumber(state.lng)) {
                stateLocation.location.lat = state.lat;
                stateLocation.location.lng = state.lng;
                return stateLocation;
            }

            if (angular.isNumber(state.latitude) && angular.isNumber(state.longitude)) {
                stateLocation.location.lat = state.latitude;
                stateLocation.location.lng = state.longitude;
                return stateLocation;
            }

            if (angular.isNumber(state.lat) && angular.isNumber(state.long)) {
                stateLocation.location.lat = state.lat;
                stateLocation.location.lng = state.long;
                return stateLocation;
            }

            throw 'Smartliving Widgets - Map Control - Invalid location';
        }

        function getMarker(location) {
            var marker = {
                lat: location.lat,
                lng: location.lng,
                icon: {
                    iconUrl: mapDefaults.icon.image,
                    shadowUrl: mapDefaults.icon.shadowImage,
                    iconSize: mapDefaults.icon.iconSize,
                    shadowSize: mapDefaults.icon.shadowSize,
                    iconAnchor: mapDefaults.icon.iconAnchor,
                    shadowAnchor: mapDefaults.icon.shadowAnchor
                }
            };
            return marker;
        }

        function isUndefinedOrNull(v) {
            return angular.isUndefined(v) || v === null;
        }
    }
})();

(function() {
    angular
        .module('ngSmartlivingWidgets')
        .directive('onoffControl', onoffControl);

    onoffControl.$inject = [];

    function onoffControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-onoff><div class=indicator ng-class=\"{ on: turnOn}\"></div></div>',
            link: linker,
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

        //////////////////////////

        function linker(scope, element, attrs) {

            scope.turnOn = false;

            scope.$watch('value', function() {

                if (scope.profile) {

                    if (scope.profile.enum) {

                        if (scope.value === scope.profile.enum[1]) {
                            scope.turnOn = true;
                        } else if (scope.value === scope.profile.enum[0]) {
                            scope.turnOn = false;
                        }
                    } else if (scope.profile.type === 'integer' || scope.profile.type === 'number') {
                        if (scope.value !== 0 && scope.value > 0) {
                            scope.turnOn = true;
                        } else {
                            scope.turnOn = false;
                        }
                    } else if (scope.profile.type === 'boolean') {
                        if (scope.value === true) {
                            scope.turnOn = true;
                        } else {
                            scope.turnOn = false;
                        }
                    } else if (scope.profile.type == 'string') {
                        if (scope.value === '' || scope.value === undefined || scope.value === null) {
                            scope.turnOn = false;
                        } else {
                            scope.turnOn = true;
                        }
                    } else if (scope.profile.type == 'object') {
                        if (isEmptyObject(scope.value)) {
                            scope.turnOn = false;
                        } else {
                            scope.turnOn = true;
                        }
                    }
                }
            });
        }

        function isEmptyObject(obj) {
            return JSON.stringify(obj) === '{}';
        }
    }
}());

(function() {
    'use strict';

    var PushButtonStatus = {
        profileValid: 0,
        profileInvalid: 1
    };

    var PUBLISH_INTERVAL_TIMEOUT = 1000;

    angular
        .module('ngSmartlivingWidgets')
        .directive('pushButtonControl', directive);

    function directive() {

        var directive = {
            template: '<div class=control-push-button ng-class=\"{disabled: !vm.enabled}\"><button ng-disabled=!vm.enabled ng-mousedown=vm.onPress() ng-touchstart=vm.onPress() ng-mouseup=vm.onRelease() ng-touchend=vm.onRelease()></button></div>',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                asset: '=',
                onChange: '&'
            }
        };

        return directive;

    }

    Controller.$inject = ['$scope', '$timeout', '$interval'];

    function Controller($scope, $timeout, $interval) {

        var vm = this;

        vm.status = PushButtonStatus.profileValid;
        vm.onPress = onPress;
        vm.onRelease = onRelease;

        var publishInterval = null;
        var pressValue = true;
        var releaseValue = false;

        var buttonConfiguration = {
            type: 'push-to-make',
            interval: false,
            break: true
        };

        $scope.$watch('vm.asset.control', controlWatcher, true);
        $scope.$watch('vm.asset.profile', profileWatcher);
        $scope.$on('$destroy', onDestroy);

        function profileWatcher(profile) {

            if (!validateProfile(profile)) {

                vm.status = PushButtonStatus.profileInvalid;

                return;

            }

            configurePressAndReleaseValues();
        }

        function controlWatcher(controlSettings) {

            if (controlSettings && controlSettings.extras) {

                if (controlSettings.extras.type) {

                    buttonConfiguration.type = controlSettings.extras.type;

                }

                if (controlSettings.extras.behavior === 'continuous' || controlSettings.extras.behavior === 'continuous-break') {

                    buttonConfiguration.interval = true;

                }

                if (controlSettings.extras.behavior === 'continuous') {

                    buttonConfiguration.break = false;

                }

                configurePressAndReleaseValues();

            }
        }

        function configurePressAndReleaseValues() {

            if (vm.profile.enum) {

                if (buttonConfiguration.type === 'push-to-make') {

                    pressValue = vm.profile.enum[0];

                    releaseValue = vm.profile.enum[1];

                } else {

                    pressValue = vm.profile.enum[1];

                    releaseValue = vm.profile.enum[0];

                }

                //if profile.enum is configured, then there is no sense to check if 
                //profile.type is boolean or whatever because first value will always be used
                //to actuate onPush and onRelease will be used to actuate onRelease
                return;

            }

            if (vm.profile.type === 'boolean') {

                if (buttonConfiguration.type === 'push-to-make') {

                    pressValue = true;

                    releaseValue = false;

                } else {

                    pressValue = false;

                    releaseValue = true;

                }

            }

        }

        function validateProfile(profile) {

            if (profile.type === 'boolean') {

                return true;

            }

            if (profile.enum && profile.enum.length === 2) {

                return true;

            }

            return false;

        }

        function onPress() {

            if (buttonConfiguration.interval) {

                if (publishInterval) {

                    $interval.cancel(publishInterval);

                    publishInterval = null;

                }

                publish(pressValue);

                publishInterval = $interval(function() {

                    publish(pressValue);

                }, PUBLISH_INTERVAL_TIMEOUT);

            } else {

                publish(pressValue);

            }

        }

        function onRelease() {

            if (publishInterval) {

                $interval.cancel(publishInterval);

                publishInterval = null;

            }


            if (buttonConfiguration.break) {

                //make a short delay before publishing release to make sure
                //press event has reached server
                $timeout(function() {

                    publish(releaseValue);

                }, 10);

            }

        }

        function publish(commandValue) {

            if (vm.onChange) {

                vm.onChange({
                    val: commandValue
                });

            }

        }

        function onDestroy() {

            if (publishInterval) {

                $interval.cancel(publishInterval);

                publishInterval = null;

            }

        }
    }


})();

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('sliderControl', sliderControl);

    sliderControl.$inject = ['$interval', 'config'];

    function sliderControl($interval, config) {

        var directive = {
            link: linker,
            restrict: 'E',
            template: '<div class=control-slider ng-show=!blocked ng-class=\"{disabled: !enabled}\"><article class=slider-val><span class=slider-value>{{value}}</span> <span class=slider-unit>{{profile.unit}}</span></article><div><md-slider ng-if=sliderSettingsAreReady ng-disabled=!enabled aria-label=slider ng-model=slider.value min=\"{{ sliderSettings.minimum }}\" max=\"{{ sliderSettings.maximum }}\" step=1></md-slider></div></div><div class=control-fallback ng-show=blocked><div class=value-unit><span class=value>{{value}}</span> <span class=unit>{{profile.unit}}</span></div><p>{{message}}</p></div>',
            scope: {
                enabled: '=',
                value: '=',
                profile: '=',
                id: '=',
                onChange: '&'
            }
        };

        return directive;

        /////////////////////////////////

        function linker(scope, element, attrs) {

            var assetValueOutOfBoundsMessage = config.outOfBoundsMessage.format('Slider');

            var invalidMinMaxConfigurationMessage = config.invalidBoundsMessage;

            var valueToPublish = null;

            var publishInterval = null;

            scope.blocked = null;

            scope.message = null;

            scope.slider = {
                value: null
            };

            scope.sliderSettings = {
                minimum: config.defaultMinimum,
                maximum: config.defaultMaximum
            };

            //Hack because of the problem with ngMaterial slider
            scope.sliderSettingsAreReady = false;

            publishInterval = $interval(publishIntervalHandler, 1000);
            scope.$on('$destroy', destroyHandler);
            scope.$watch('value', valueWatcher);
            scope.$watch('slider.value', sliderValueWatcher);
            scope.$watch('profile', profileWatcher);

            //Hack because of the problem with ngMaterial slider
            scope.sliderSettingsAreReady = true;

            function publishIntervalHandler() {

                if (valueToPublish) {

                    publishValue(valueToPublish);

                    valueToPublish = null;

                }
            }

            function destroyHandler() {

                $interval.cancel(publishInterval);

                publishInterval = null;

            }

            function valueWatcher(newValue) {

                if (scope.value > scope.sliderSettings.maximum || scope.value < scope.sliderSettings.minimum) {

                    scope.blocked = true;

                    scope.message = assetValueOutOfBoundsMessage;

                } else {

                    scope.slider.value = newValue;

                    scope.blocked = false;

                }
            }

            function sliderValueWatcher(newValue, oldValue) {

                //Setup value to publish only if slider.value is different then current value
                if (scope.slider.value !== scope.value) {

                    valueToPublish = newValue;

                }
            }

            function profileWatcher() {

                if (scope.profile) {

                    if (angular.isNumber(scope.profile.minimum) && angular.isNumber(scope.profile.maximum)) {

                        scope.sliderSettings.minimum = scope.profile.minimum;
                        scope.sliderSettings.maximum = scope.profile.maximum;

                    } else {

                        scope.sliderSettings.minimum = config.defaultMinimum;
                        scope.sliderSettings.maximum = config.defaultMaximum;

                    }

                    if (scope.sliderSettings.minimum > scope.sliderSettings.maximum) {

                        scope.blocked = true;
                        scope.message = invalidMinMaxConfigurationMessage;

                    } else if (scope.sliderSettings.minimum > scope.value || scope.sliderSettings.maximum < scope.value) {

                        scope.blocked = true;

                        scope.message = assetValueOutOfBoundsMessage;

                    } else {

                        scope.blocked = false;

                    }
                }
            }

            function publishValue(value) {

                if (scope.onChange) {
                    scope.onChange({
                        val: value
                    });
                }
            }
        }
    }
}());

(function() {
    'use strict';

    angular
        .module('ngSmartlivingWidgets')
        .directive('spinnerControl', directive);

    function directive() {

        var directive = {
            template: '<div class=control-spinner ng-class=\"{disabled: !vm.spinerStatus.enabled}\"><div ng-if=!sInt(vm.step)><button class=\"spinner-btn plus\" ng-click=vm.increase() ng-disabled=!vm.spinerStatus.enabled angular-ripple></button><p class=spinner-value>{{ vm.asset.state.value }}</p><button class=\"spinner-btn minus\" ng-click=vm.decrease() ng-disabled=!vm.spinerStatus.enabled angular-ripple></button></div><div class=control-fallback ng-if=isInt(vm.step)><div class=value-unit><h1><b>Mismatch!</b></h1></div><p>{{ vm.spinerStatus.message}}</p></div></div>',
            bindToController: true,
            controller: Controller,
            controllerAs: 'vm',
            restrict: 'E',
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                asset: '=',
                onChange: '&'
            }
        };

        return directive;

    }

    Controller.$inject = ['$scope'];

    function Controller($scope) {

        var vm = this;

        vm.increase = increase;
        vm.decrease = decrease;

        vm.spinerStatus = {
            enabled: true,
            message: null
        };

        vm.step = null;

        $scope.$watch('vm.asset.control', controlWatcher, true);
        $scope.$watch('vm.asset.profile', profileWatcher);

        function profileWatcher(profile) {

            compareStepWithProfile(profile);

        }

        function controlWatcher(controlSettings) {

            if (controlSettings && controlSettings.extras) {

                if (controlSettings.extras.step) {

                    vm.step = controlSettings.extras.step;

                    compareStepWithProfile(vm.asset.profile);

                }

            } else {

                if (vm.profile.type === 'number') {

                    vm.step = 0.1;

                } else if (vm.profile.type === 'integer') {

                    vm.step = 1;

                }
            }
        }

        function compareStepWithProfile(profile) {

            if (profile.type === 'integer') {

                if (isInt(vm.step)) {

                    vm.spinerStatus.enabled = true;
                    vm.spinerStatus.message = null;

                } else {

                    vm.spinerStatus.enabled = false;
                    vm.spinerStatus.message = 'Step does not match asset profile type.';

                }

            } else if (profile.type === 'number') {

                if (typeof(vm.step) === 'number') {

                    vm.spinerStatus.enabled = true;
                    vm.spinerStatus.message = null;

                } else {

                    vm.spinerStatus.enabled = false;
                    vm.spinerStatus.message = 'Step does not match asset profile type.';

                }

            } else {

                vm.spinerStatus.enabled = false;
                vm.spinerStatus.message = 'Asset profile should be integer or number';

            }
        }

        function isInt(value) {

            return !isNaN(value) && parseInt(Number(value)) == value && !isNaN(parseInt(value, 10));
        }

        function increase() {

            var valueToSend = null;

            if (vm.asset.state && vm.asset.state.value) {

                valueToSend = prepareValue(vm.asset.state.value);

            } else {

                valueToSend = prepareValue(null);

            }

            valueToSend += vm.step;

            publish(valueToSend);

        }

        function decrease() {

            var valueToSend = null;

            if (vm.asset.state && vm.asset.state.value) {

                valueToSend = prepareValue(vm.asset.state.value);

            } else {

                valueToSend = prepareValue(null);

            }

            valueToSend -= vm.step;

            publish(valueToSend);

        }

        function prepareValue(value) {

            var valueToSend = value;

            if (valueToSend === null || valueToSend === undefined) {
                valueToSend = 0;
            }

            if (vm.asset.profile.type === 'integer' && typeof(valueToSend) === 'number') {

                valueToSend = ~~valueToSend;

            }

            return valueToSend;

        }


        function publish(commandValue) {

            if (vm.onChange) {

                vm.onChange({
                    val: commandValue
                });

            }

        }

    }


})();

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('textControl', textControl);

    textControl.$inject = [];

    function textControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-text><div class=text-content>{{value}} <span class=empty ng-if=\"value === undefined || value === null\"><i>no value to display</i></span></div></div>',
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('textEditorControl', textEditorControl);

    textEditorControl.$inject = [];

    function textEditorControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-text-editor ng-class=\"{disabled: !enabled}\"><textarea ng-model=textValue ng-disabled=!enabled placeholder=\"enter text\"></textarea> <button class=text-editor-control-btn ng-click=sendText(textValue) ng-disabled=!enabled></button></div>',
            link: linker,
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                is: '=',
                onChange: '&'
            }
        };
        return directive;

        //////////////////////////

        function linker(scope, element, attrs) {

            scope.$watch('value', function(newValue) {
                scope.textValue = newValue;
            });

            scope.sendText = function(value) {

                if (scope.profile.type === 'object') {
                    var object = JSON.parse(value);
                    publishValue(object);
                } else {
                    publishValue(value);
                }

            };

            function publishValue(value) {

                if (scope.onChange) {
                    scope.onChange({
                        val: value
                    });
                }
            }
        }
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('toggleControl', toggleControl);

    toggleControl.$inject = [];

    function toggleControl() {
        var directive = {
            restrict: 'E',
            template: '<div class=control-toggle ng-class=\"{disabled: !enabled}\"><span class=left-value>{{leftValue}}</span><md-switch aria-label=toggle_control ng-model=toggle ng-click=onClick() ng-disabled=!enabled></md-switch><span class=right-value>{{rightValue}}</span></div>',
            scope: {
                enabled: '=',
                profile: '=',
                value: '=',
                id: '=',
                onChange: '&'
            },
            link: linker
        };

        return directive;

        //////////////////////

        function linker(scope, element, attrs) {
            scope.leftValue = false;
            scope.rightValue = true;
            scope.toggle = false;

            scope.$watch('profile', function() {
                if (scope.profile) {
                    if (scope.profile.enum) {
                        scope.leftValue = scope.profile.enum[0];
                        scope.rightValue = scope.profile.enum[1];
                    } else {
                        if (scope.profile.type == 'boolean') {
                            scope.leftValue = false;
                            scope.rightValue = true;
                        }

                        if (scope.profile.type == 'integer') {
                            scope.leftValue = 0;
                            scope.rightValue = scope.value;
                        }
                    }
                }
            });

            scope.$watch('value', function(newValue) {
                if (scope.value == scope.rightValue) {
                    scope.toggle = true;
                } else if (scope.value == scope.leftValue) {
                    scope.toggle = false;
                }
            });

            scope.onClick = function() {
                if (scope.enabled) {
                    if (scope.toggle === true) {
                        publishValue(scope.leftValue);
                    } else if (scope.toggle === false) {
                        publishValue(scope.rightValue);
                    }
                }
            };

            function publishValue(value) {

                if (scope.onChange) {
                    scope.onChange({
                        val: value
                    });
                }
            }
        }
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('ontableControl', ontableControl);

    ontableControl.$inject = ['$interval', 'config'];

    function ontableControl($interval, config) {

        var directive = {
            link: linker,
            restrict: 'E',
            template: '<div class=sl-control-ontable><div class=indicator ng-class=\"{ ontable: ontable === true }\"><span class=phone></span> <span class=shadow></span></div></div>',
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

        /////////////////////////////////

        function linker(scope, element, attrs) {

            scope.ontable = false;

            scope.$watch('value', function(newValue) {

                if (newValue === 'ontable') {

                    scope.ontable = true;

                } else if (newValue === 'notontable') {

                    scope.ontable = false;
                }

            });
        }
    }
}());

(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('rotateControl', rotateControl);

    rotateControl.$inject = ['$interval', 'config'];

    function rotateControl($interval, config) {

        var directive = {
            link: linker,
            restrict: 'E',
            template: '<div class=sl-control-rotation><div class=indicator ng-class=\"{ left: rotateLeft === true, right: rotateLeft === false }\"></div></div>',
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

        /////////////////////////////////

        function linker(scope, element, attrs) {

            scope.rotateLeft = null;

            scope.$watch('value', function(newValue) {

                if (newValue === 'rightRotation') {

                    scope.rotateLeft = false;

                } else if (newValue === 'leftRotation') {

                    scope.rotateLeft = true;
                }

            });
        }
    }
}());
(function() {

    angular
        .module('ngSmartlivingWidgets')
        .directive('shakeControl', shakeControl);

    shakeControl.$inject = ['$interval', 'config'];

    function shakeControl($interval, config) {

        var directive = {
            link: linker,
            restrict: 'E',
            template: '<div class=sl-control-shake><div class=indicator ng-class=\"{ shaking: shaking === true}\"></div></div>',
            scope: {
                profile: '=',
                value: '=',
                id: '='
            }
        };

        return directive;

        /////////////////////////////////

        function linker(scope, element, attrs) {

            scope.shaking = false;

            scope.$watch('value', function(newValue) {

                if (newValue === 'shaking') {

                    scope.shaking = true;

                } else if (newValue === 'still') {

                    scope.shaking = false;
                }

            });
        }
    }
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC9hY3Rpdml0eS9hY3Rpdml0eS5yZXBvc2l0b3J5LmpzIiwiYXBwL2FjdGl2aXR5L2FjdGl2aXR5LnNlcnZpY2UuanMiLCJhcHAvYWN0aXZpdHkvdXNlci1jb250ZXh0LmpzIiwiYXBwL2JyYW5kaW5nL2JyYW5kLmpzIiwiYXBwL2NvbnRyb2xsZXJzL01haW5QYWdlQ29udHJvbGxlci5qcyIsImFwcC9jb250cm9sbGVycy9OYXZpZ2F0aW9uQ29udHJvbGxlci5qcyIsImFwcC9jb3JlL25vdGlmeS5qcyIsImFwcC9jb3JlL3ByZWZlcmVuY2VzLmpzIiwiYXBwL2NvcmUvdXRpbHMuanMiLCJhcHAvZGVtb19kZXZpY2UvYWRvcHRTZXJ2aWNlLmpzIiwiYXBwL2RlbW9fZGV2aWNlL2NvbmZpZy5qcyIsImFwcC9kZW1vX2RldmljZS9nYW1lLmpzIiwiYXBwL2RlbW9fZGV2aWNlL21vYmlsZV9icm93c2VyLmpzIiwiYXBwL2RlbW9fZGV2aWNlL3FyY29kZURldmljZUNvbnRyb2wuanMiLCJhcHAvZGV2aWNlcy9hc3NldC5qcyIsImFwcC9kZXZpY2VzL2Fzc2V0LnZpZXdtb2RlbC5qcyIsImFwcC9kZXZpY2VzL2RldmljZS5qcyIsImFwcC9kZXZpY2VzL2RldmljZS52aWV3bW9kZWwuanMiLCJhcHAvZGV2aWNlcy9kZXZpY2VMaXN0LmpzIiwiYXBwL2RldmljZXMvZGV2aWNlTGlzdC52aWV3TW9kZWwuanMiLCJhcHAvZGV2aWNlcy95b3VyZGV2aWNlcy5qcyIsImFwcC9kZXZpY2VzL3lvdXJkZXZpY2VzLnZpZXdtb2RlbC5qcyIsImFwcC9kaXJlY3RpdmVzL2JhbGxvb24tZXJyb3IuanMiLCJhcHAvZGlyZWN0aXZlcy9jb3VudGVyLWlucHV0LmpzIiwiYXBwL2RpcmVjdGl2ZXMvZGV2aWNlLXN0YXR1cy5qcyIsImFwcC9kaXJlY3RpdmVzL2RyYWcuanMiLCJhcHAvZGlyZWN0aXZlcy9mcm9tLW5vdy5qcyIsImFwcC9kaXJlY3RpdmVzL2Z1bGwtaGVpZ2h0LmpzIiwiYXBwL2RpcmVjdGl2ZXMvaW5saW5lLWNvbnRyb2wuanMiLCJhcHAvZGlyZWN0aXZlcy9tZW51LWl0ZW0uanMiLCJhcHAvZGlyZWN0aXZlcy9tb2RhbC1oZWlnaHQuanMiLCJhcHAvZGlyZWN0aXZlcy9yYW5kb20tY29sb3IuanMiLCJhcHAvZGlyZWN0aXZlcy9zY3JvbGwtdG8uanMiLCJhcHAvZmFjdG9yaWVzL2NvbW1vbi5qcyIsImFwcC9mYWN0b3JpZXMvZGF5VGltZVNlcnZpY2UuanMiLCJhcHAvZmFjdG9yaWVzL2RldmljZUljb25zLmpzIiwiYXBwL2ZhY3Rvcmllcy9nZW9Mb2NhdGlvbi5qcyIsImFwcC9mYWN0b3JpZXMvZ29vZ2xlTWFwcy5qcyIsImFwcC9mYWN0b3JpZXMvaHR0cFRva2VuSW50ZXJjZXB0b3IuanMiLCJhcHAvZmFjdG9yaWVzL2lucHV0U3RhdGVWYWxpZGF0b3IuanMiLCJhcHAvZmFjdG9yaWVzL3Nlc3Npb24uanMiLCJhcHAvZmFjdG9yaWVzL3R5cGVDb252ZXJ0ZXIuanMiLCJhcHAvZmFjdG9yaWVzL3ZhbGlkYXRvckhlbHBlci5qcyIsImFwcC9mYWN0b3JpZXMvdmlld0NvbmZpZ3MuanMiLCJhcHAvZmlsdGVycy9hc3NldC10eXBlLWZpbHRlci5qcyIsImFwcC9maWx0ZXJzL2Fzc2V0LXZhbHVlLWZvcm1hdC1maWx0ZXIuanMiLCJhcHAvZmlsdGVycy9jYXBpdGFsaXplLmpzIiwiYXBwL2ZpbHRlcnMvY3Jvbi1maWx0ZXIuanMiLCJhcHAvZmlsdGVycy9kZXZpY2VzLXdpdGgtYXNzZXQtdHlwZS5qcyIsImFwcC90ZXJtc19vZl91c2UvdGVybXNPZlVzZS5qcyIsImFwcC90ZXJtc19vZl91c2UvdGVybXNPZlVzZUludGVyY2VwdG9yLmpzIiwiYXBwL3Rlcm1zX29mX3VzZS90ZXJtc09mVXNlUmVwb3NpdG9yeS5qcyIsImFwcC93aWRnZXRzL2F3YWl0aW5nQ29udGVudC5qcyIsImFwcC93aWRnZXRzL2J1dHRvbi1sb2FkLW1vcmUuanMiLCJhcHAvd2lkZ2V0cy9jb250cm9sLWhhbmRsZXIuanMiLCJhcHAvd2lkZ2V0cy9mbGV4LXRleHRhcmVhLmpzIiwiYXBwL3dpZGdldHMvZm9jdXMtaWYuanMiLCJhcHAvd2lkZ2V0cy9wYWdlLWxvYWRlci5qcyIsImFwcC93aWRnZXRzL3Njcm9sbC1pZi5qcyIsImFwcC93aWRnZXRzL3N1YnNjcmliZWQtaW5kaWNhdG9yLmpzIiwiYXBwL3dpZGdldHMvdGFicy5qcyIsImFwcC9ibG9ja3MvY29uZmlnL2FwcENvbmZpZy5qcyIsImFwcC9ibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImFwcC9ibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5wcm92aWRlci5qcyIsImFwcC9ibG9ja3MvbG9nZ2VyL2xvZ2dlci5qcyIsImFwcC9jb3JlL21lc3NhZ2luZy9nYXRld2F5LmpzIiwiYXBwL2NvcmUvbWVzc2FnaW5nL3BhcnNlci5qcyIsImFwcC9jb3JlL21lc3NhZ2luZy9yZWxheS5qcyIsImFwcC9jb3JlL25vdGlmaWNhdGlvbnMvYWxsLW5vdGlmaWNhdGlvbnMuanMiLCJhcHAvY29yZS9ub3RpZmljYXRpb25zL2FsbC1ub3RpZmljYXRpb25zLnZpZXdtb2RlbC5qcyIsImFwcC9jb3JlL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9uLmNvbnRleHQuanMiLCJhcHAvY29yZS9ub3RpZmljYXRpb25zL25vdGlmaWNhdGlvbi5qcyIsImFwcC9jb3JlL25vdGlmaWNhdGlvbnMvbm90aWZpY2F0aW9uLm1vZGVsLmpzIiwiYXBwL2NvcmUvbm90aWZpY2F0aW9ucy9ub3RpZmljYXRpb25zLnJlcG9zaXRvcnkuanMiLCJhcHAvY29yZS9vZmZsaW5lL29mZmxpbmUuZGlyZWN0aXZlLmpzIiwiYXBwL2NvcmUvb2ZmbGluZS9vZmZsaW5lLmpzIiwiYXBwL2NvcmUvcm9sZXMvcGVybWlzc2lvbi5kaXJlY3RpdmUuanMiLCJhcHAvY29yZS9yb2xlcy9yb2xlcy5pbml0aWFsaXphdG9yLmpzIiwiYXBwL2NvcmUvcm9sZXMvcm9sZXMubWFuYWdlci5qcyIsImFwcC9jb3JlL3dpZGdldHMvYXNzZXQtbmFtZS5qcyIsImFwcC9jb3JlL3dpZGdldHMvZGV2aWNlLW5hbWUuanMiLCJhcHAvY29yZS93aWRnZXRzL2dyb3VuZC1uYW1lLmpzIiwiYXBwL2NvcmUvd2lkZ2V0cy9uYW1lLWNhY2hlLmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9hY2NvdW50LmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9hc3NldHMuanMiLCJhcHAvZGF0YS9hdHRfYXBpX3YxL2F1dGhIZWxwZXIuanMiLCJhcHAvZGF0YS9hdHRfYXBpX3YxL2F1dGhTZXJ2aWNlLmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9jbGllbnRBdXRob3JpemF0aW9uLmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9jb250cm9scy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvZGV2aWNlLWFjdGl2aXR5LmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9kZXZpY2VzLmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS9nYXRld2F5cy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvZ3JvdW5kcy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvbWVtYmVycy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvbWV0cmljcy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvbm90aWZpY2F0aW9ucy5qcyIsImFwcC9kYXRhL2F0dF9hcGlfdjEvcnVsZXMuanMiLCJhcHAvZGF0YS9hdHRfYXBpX3YxL3NlcnZpY2VzLmpzIiwiYXBwL2RhdGEvYXR0X2FwaV92MS91cmwuanMiLCJhcHAvZGF0YS9hdHRfYXBpX3YxL3VybFNob3J0ZW5lclNlcnZpY2UuanMiLCJhcHAvZGF0YS9hdHRfYXBpX3YxL3VzZXJzLmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9hc3NldC5yZXBvc2l0b3J5LmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9jYXBwbGl2ZS5zZXJ2aWNlLmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9jb250cm9scy5yZXBvc2l0b3J5LmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9kZXZpY2UucmVwb3NpdG9yeS5qcyIsImFwcC9kYXRhL3JlcG9zaXRvcnkvZ2F0ZXdheS5yZXBvc2l0b3J5LmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9ncm91bmQucmVwb3NpdG9yeS5qcyIsImFwcC9kYXRhL3JlcG9zaXRvcnkvaGlzdG9yeS5zZXJ2aWNlLmpzIiwiYXBwL2RhdGEvcmVwb3NpdG9yeS9tZW1iZXIucmVwb3NpdG9yeS5qcyIsImFwcC9kZW1vX2RldmljZS9tb2RlbHMvZ2FtZS5qcyIsImFwcC9kZW1vX2RldmljZS9tb2RlbHMvbGV2ZWwuanMiLCJhcHAvZGVtb19kZXZpY2Uvc2Vuc29ycy9tb3Rpb24uanMiLCJhcHAvZGVtb19kZXZpY2Uvc2Vuc29ycy9vcmllbnRhdGlvbi5qcyIsImFwcC9kZW1vX2RldmljZS9zZW5zb3JzL3BhZ2VfdmlzaWJpbGl0eS5qcyIsImFwcC9kZW1vX2RldmljZS9zZW5zb3JzL3Bvc2l0aW9uLmpzIiwiYXBwL2RlbW9fZGV2aWNlL3NlbnNvcnMvcm90YXRpb24uanMiLCJhcHAvZGVtb19kZXZpY2Uvc2Vuc29ycy9zZW5zb3JzLmpzIiwiYXBwL2RlbW9fZGV2aWNlL3NlbnNvcnMvc2hha2UuanMiLCJhcHAvZGVtb19kZXZpY2Uvc2Vuc29ycy92aWJyYXRpb24uanMiLCJhcHAvZGV2aWNlcy9jb250cm9scy9hY3Rpdml0eS5qcyIsImFwcC9kZXZpY2VzL2NvbnRyb2xzL2NvbnRyb2xncmlkLmpzIiwiYXBwL2RldmljZXMvY29udHJvbHMvZGV2aWNlY29udHJvbC5qcyIsImFwcC9kZXZpY2VzL2NvbnRyb2xzL2dyaWQuanMiLCJhcHAvZGV2aWNlcy9maXJzX2FwcF9zY3JpcHRzL2ZpcnN0X2FwcF9kaWN0aW9uYXJ5LmpzIiwiYXBwL2RldmljZXMvZmlyc19hcHBfc2NyaXB0cy9maXJzdF9hcHBfcmVwb3NpdG9yeS5qcyIsImFwcC9kZXZpY2VzL21vZGVscy9hc3NldC5qcyIsImFwcC9kZXZpY2VzL21vZGVscy9jcmVhdGVBc3NldC5qcyIsImFwcC9kZXZpY2VzL21vZGVscy9kZXZpY2UuanMiLCJhcHAvZGV2aWNlcy9tb2RlbHMvZWRpdERldmljZS5qcyIsImFwcC9kaXJlY3RpdmVzL2RldmljZS1ob2xkZXIvZGV2aWNlLWhvbGRlci5qcyIsImFwcC9kaXJlY3RpdmVzL2dvb2dsZS1tYXAvZ29vZ2xlLW1hcC5qcyIsImFwcC9kaXJlY3RpdmVzL2dvb2dsZS1tYXAvcmFuZG9tLWJhY2tncm91bmQuanMiLCJhcHAvZGlyZWN0aXZlcy9pbmxpbmUtZWRpdC9pbmxpbmUtZWRpdC5qcyIsImFwcC9kaXJlY3RpdmVzL25ldy1kZXZpY2UvbmV3LWRldmljZS5qcyIsImFwcC9kaXJlY3RpdmVzL25vdGlmeS1jb250cm9sL25vdGlmeS1jb250cm9sLmpzIiwiYXBwL2RpcmVjdGl2ZXMvc3RhdGUtY29udHJvbC9zdGF0ZS1jb250cm9sLWJ1dHRvbi5qcyIsImFwcC9kaXJlY3RpdmVzL3N0YXRlLWNvbnRyb2wvc3RhdGUtY29udHJvbC1jb250cm9sbGVyLmpzIiwiYXBwL2RpcmVjdGl2ZXMvc3RhdGUtY29udHJvbC9zdGF0ZS1jb250cm9sLW1hbmFnZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9zdGF0ZS1jb250cm9sL3N0YXRlLWNvbnRyb2wtdHlwZS5qcyIsImFwcC9kaXJlY3RpdmVzL3N0YXRlLWNvbnRyb2wvc3RhdGUtY29udHJvbC5qcyIsImFwcC9kaXJlY3RpdmVzL3N0YXRlLWNvbnRyb2wvc3RhdGUtbW9ycGguanMiLCJhcHAvZGlyZWN0aXZlcy90YWItY29udHJvbC90YWItY29udHJvbC5qcyIsImFwcC9tb2RhbHMvY29uZmlybV9pdGVtX2RlbGV0ZS9jb250cm9sbGVyLmpzIiwiYXBwL21vZGFscy9ydWxlX29wdGlvbnMvY29udHJvbGxlci5qcyIsImFwcC9tb2RhbHMvcnVsZXNfYXR0YWNoZWQvY29udHJvbGxlci5qcyIsImFwcC9wYWdlcy9sb2dpbi9jb250cm9sbGVyLmpzIiwiYXBwL3dpZGdldHMvaXRlbV9oZWFkZXIvaXRlbS1oZWFkZXItbW9kZWwuanMiLCJhcHAvd2lkZ2V0cy9pdGVtX2hlYWRlci9pdGVtLWhlYWRlci5qcyIsImFwcC93aWRnZXRzL2xpc3RfaGVhZGVyL2xpc3QtaGVhZGVyLW1vZGVsLmpzIiwiYXBwL3dpZGdldHMvbGlzdF9oZWFkZXIvbGlzdC1oZWFkZXIuanMiLCJhcHAvd2lkZ2V0cy9saXN0X2l0ZW0vbGlzdC1pdGVtLW1vZGVsLmpzIiwiYXBwL3dpZGdldHMvbGlzdF9pdGVtL2xpc3QtaXRlbS5qcyIsImFwcC9kZXZpY2VzL2NvbnRyb2xzL2FyZWEtcmFuZ2UtY2hhcnQvYXJlYS1yYW5nZS1jaGFydC1kZXZpY2UtY29udHJvbC5qcyIsImFwcC9kZXZpY2VzL2NvbnRyb2xzL2Jhci1jaGFydC9iYXItY2hhcnQtZGV2aWNlLWNvbnRyb2wuanMiLCJhcHAvZGV2aWNlcy9jb250cm9scy9lbnJvbGwtZGVtby9lbnJvbGwtZGVtby1jb250cm9sLmpzIiwiYXBwL2RldmljZXMvY29udHJvbHMvbGluZS1jaGFydC9saW5lLWNoYXJ0LWRldmljZS1jb250cm9sLmpzIiwiYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9hc3NldC1jb21wYXJhdG9yL2RpcmVjdGl2ZS5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvYXNzZXQtcHJvZmlsZS1kZXNjcmlwdG9yL2RpcmVjdGl2ZS5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvYXNzZXQtdmFsdWUtZWRpdG9yL2RpcmVjdGl2ZS5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvcnVsZS1zZWN0aW9uLWRldGFpbC9kaXJlY3RpdmUuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL3J1bGUtc2VjdGlvbi1wcmV2aWV3L2RpcmVjdGl2ZS5qcyIsImFwcC9tb2RhbHMvcGFzc3dvcmRfcmVjb3Zlcnkvc3VjY2Vzcy9jb250cm9sbGVyLmpzIiwiYXBwL3BhcnRpYWxzL2FkZC1uZXcvbmV3LWRldmljZS9uZXctZGV2aWNlLmNvbnRyb2xsZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L2Jvb2wvYm9vbC1zZXR0ZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L2RhdGUvZGF0ZS1zZXR0ZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L2xhYmVsL2RpcmVjdGl2ZS5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvY29uc3RhbnQvbnVtYmVyL251bWJlci1zZXR0ZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L3RleHQvdGV4dC1zZXR0ZXIuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L3RpbWVzcGFuL3RpbWVzcGFuLXNldHRlci5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvc3RlcHMvYXNzZXQtc3RlcC9kaXJlY3RpdmUuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL3N0ZXBzL2NvbXBhcmUtdHlwZS1zdGVwL2RpcmVjdGl2ZS5qcyIsImFwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvc3RlcHMvZGF5LXRpbWUvZGF5LXRpbWUuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL3N0ZXBzL2RldmljZS1vci1zZXJ2aWNlLXN0ZXAvZGlyZWN0aXZlLmpzIiwiYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9zdGVwcy9kZXZpY2Utc3RlcC9kaXJlY3RpdmUuanMiLCJhcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL3N0ZXBzL3NlbGVjdC1ub3RpZmljYXRpb24tdHlwZS9kaXJlY3RpdmUuanMiLCJzbWFydGxpdmluZy53aWRnZXRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4YkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3YUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25KQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25KQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3YUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbihuZykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhcHAgPSBuZy5tb2R1bGUoJ2FwcCcsIFtcbiAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICdMb2NhbFN0b3JhZ2VNb2R1bGUnLFxuICAgICAgICAndWkuYm9vdHN0cmFwLm1vZGFsJyxcbiAgICAgICAgJ2FuZ3VsYXJNb21lbnQnLFxuICAgICAgICAndWkuc2VsZWN0JyxcbiAgICAgICAgJ25nTWF0ZXJpYWwnLFxuICAgICAgICAndWkua25vYicsXG4gICAgICAgICdqc29uRm9ybWF0dGVyJyxcbiAgICAgICAgJ2FuZ3VsYXJTcGVjdHJ1bUNvbG9ycGlja2VyJyxcbiAgICAgICAgJ2phLnFyJyxcbiAgICAgICAgJ252ZDMnLFxuICAgICAgICAnYnRmb3JkLm1hcmtkb3duJyxcbiAgICAgICAgJ2FuZ3VsYXJSaXBwbGUnLFxuICAgICAgICAnZG5kTGlzdHMnLFxuICAgICAgICAnbmdTbWFydGxpdmluZ1dpZGdldHMnLFxuICAgICAgICAnNzIwa2IudG9vbHRpcHMnXG4gICAgXSk7XG5cbiAgICBhcHAuY29uZmlnKFtcbiAgICAgICAgJyRzdGF0ZVByb3ZpZGVyJyxcbiAgICAgICAgJyR1cmxSb3V0ZXJQcm92aWRlcicsXG4gICAgICAgICckbG9jYXRpb25Qcm92aWRlcicsXG4gICAgICAgICckc2NlUHJvdmlkZXInLFxuICAgICAgICBmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJHNjZVByb3ZpZGVyKSB7XG5cbiAgICAgICAgICAgICRzY2VQcm92aWRlci5lbmFibGVkKGZhbHNlKTtcblxuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL3NpZ25pbicpO1xuXG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9zaWduaW4nLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL3BhZ2VzL2xvZ2luL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ21haW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL3BhcnRpYWxzL21haW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVMb2dpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb246ICdkZXZpY2VzJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy8nLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL3BhZ2VzL2xvZ2luL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ21haW4ucXVpY2tEZW1vJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBwcy9ndWVzc2luZy1nYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kZW1vX2RldmljZS9nYW1lLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7fVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdxdWlja0RlbW9MYXVuY2hlcicsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwcHMvcXVpY2stZGVtby1sYXVuY2hlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGVtb19kZXZpY2UvbW9iaWxlX2Jyb3dzZXIuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuICAgICAgICB9XG5cbiAgICBdKTtcblxuICAgIGFwcC5ydW4oW1xuICAgICAgICAnJG1vZGFsU3RhY2snLFxuICAgICAgICAnJHJvb3RTY29wZScsXG4gICAgICAgICdzZXNzaW9uJyxcbiAgICAgICAgJ21lc3NhZ2luZy5yZWxheScsXG4gICAgICAgICdicmFuZENvbmZpZycsXG5cbiAgICAgICAgZnVuY3Rpb24oXG4gICAgICAgICAgICAkbW9kYWxTdGFjayxcbiAgICAgICAgICAgICRyb290U2NvcGUsXG4gICAgICAgICAgICBzZXNzaW9uLFxuICAgICAgICAgICAgbWVzc2FnZVJlbGF5LFxuICAgICAgICAgICAgYnJhbmRDb25maWcpIHtcblxuICAgICAgICAgICAgc2Vzc2lvbi5pbml0KCk7XG4gICAgICAgICAgICBtZXNzYWdlUmVsYXkuaW5pdCgpO1xuICAgICAgICAgICAgYnJhbmRDb25maWcuaW5pdCgpO1xuXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIHZhciB0b3AgPSAkbW9kYWxTdGFjay5nZXRUb3AoKTtcbiAgICAgICAgICAgICAgICBpZiAodG9wKSB7XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbFN0YWNrLmRpc21pc3NBbGwoJ3JvdXRlQ2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIF0pO1xuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnYWN0aXZpdHlSZXBvc2l0b3J5JywgYWN0aXZpdHlSZXBvc2l0b3J5KTtcblxuICAgIGFjdGl2aXR5UmVwb3NpdG9yeS4kaW5qZWN0ID0gWydhY3Rpdml0eVNlcnZpY2UnLCAndXRpbHMnLCAnZXhjZXB0aW9uJ107XG5cbiAgICBmdW5jdGlvbiBhY3Rpdml0eVJlcG9zaXRvcnkoYWN0aXZpdHlTZXJ2aWNlLCB1dGlscywgZXhjZXB0aW9uKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBmaW5kR3JvdW5kQWN0aXZpdHk6IGZpbmRHcm91bmRBY3Rpdml0eSxcbiAgICAgICAgICAgIGdldFN1YnNjcmlwdGlvbnM6IGdldFN1YnNjcmlwdGlvbnMsXG4gICAgICAgICAgICB1bnN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHk6IHVuc3Vic2NyaWJlT25Hcm91bmRBY3Rpdml0eSxcbiAgICAgICAgICAgIHN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHk6IHN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRHcm91bmRBY3Rpdml0eShncm91bmRJZCwgcGFnZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHlTZXJ2aWNlLmdldEdyb3VuZEFjdGl2aXR5KGdyb3VuZElkLCBwYWdlKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGJvZHkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJvZHkuaXRlbXM7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbG9hZCBncm91bmQgYWN0aXZpdHkuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9ucygpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5U2VydmljZS5nZXRTdWJzY3JpcHRpb25zKClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihib2R5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBib2R5Lml0ZW1zO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGdldCBncm91bmQgc3Vic2NyaXB0aW9ucy4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1bnN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHkoZ3JvdW5kSWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFjdGl2aXR5U2VydmljZS51bnN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHkoZ3JvdW5kSWQpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIHVuc3Vic2NyaWJlIGZyb20gZ3JvdW5kIGFjdGl2aXR5LicpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlT25Hcm91bmRBY3Rpdml0eShncm91bmRJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHlTZXJ2aWNlLnN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHkoZ3JvdW5kSWQpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIHN1YnN1YnNjcmliZSB0byBncm91bmQgYWN0aXZpdHkuJykpO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnYWN0aXZpdHlTZXJ2aWNlJywgYWN0aXZpdHlTZXJ2aWNlKTtcblxuICAgIGFjdGl2aXR5U2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICdhcGkudXJsJ107XG5cbiAgICBmdW5jdGlvbiBhY3Rpdml0eVNlcnZpY2UoJGh0dHAsIGFwaVVybCkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZ2V0U3Vic2NyaXB0aW9uczogZ2V0U3Vic2NyaXB0aW9ucyxcbiAgICAgICAgICAgIHN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHk6IHN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHksXG4gICAgICAgICAgICB1bnN1YnNjcmliZU9uR3JvdW5kQWN0aXZpdHk6IHVuc3Vic2NyaWJlT25Hcm91bmRBY3Rpdml0eSxcbiAgICAgICAgICAgIGdldEdyb3VuZEFjdGl2aXR5OiBnZXRHcm91bmRBY3Rpdml0eVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R3JvdW5kQWN0aXZpdHkoZ3JvdW5kSWQsIHBhZ2UpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ3JvdW5kLycgKyBncm91bmRJZCArICcvYWN0aXZpdHknO1xuXG4gICAgICAgICAgICB1cmwgPSB1cmwgKyBnZXRRdWVyeShwYWdlKTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3Vic2NyaXB0aW9ucygpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnbWUvc3Vic2NyaXB0aW9ucyc7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlT25Hcm91bmRBY3Rpdml0eShncm91bmRJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdncm91bmQvJyArIGdyb3VuZElkICsgJy9zdWJzY3JpcHRpb24nO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdW5zdWJzY3JpYmVPbkdyb3VuZEFjdGl2aXR5KGdyb3VuZElkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2dyb3VuZC8nICsgZ3JvdW5kSWQgKyAnL3N1YnNjcmlwdGlvbic7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRRdWVyeShwYWdlKSB7XG4gICAgICAgICAgICBpZiAoIXBhZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBxdWVyeSA9ICc/cGFnZT0nICsgcGFnZTtcblxuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5O1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCd1c2VyQ29udGV4dCcsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gWyd1dGlscycsICdhY3Rpdml0eVJlcG9zaXRvcnknLCAnc2Vzc2lvbicsICdhcGkudXNlcnNTZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KHV0aWxzLCBhY3Rpdml0eVJlcG9zaXRvcnksIHNlc3Npb24sIHVzZXJzKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gVXNlckNvbnRleHQoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICAgICAgdGhpcy51c2VyID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFN1YnNjcmlwdGlvbnMoY29udGV4dCkge1xuXG4gICAgICAgICAgICByZXR1cm4gYWN0aXZpdHlSZXBvc2l0b3J5LmdldFN1YnNjcmlwdGlvbnMoKS50aGVuKGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0LnN1YnNjcmlwdGlvbnMgPSBzdWJzY3JpcHRpb25zO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyRGV0YWlscyhjb250ZXh0KSB7XG5cbiAgICAgICAgICAgIHJldHVybiB1c2Vycy5nZXRNZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odXNlckRhdGEpIHtcblxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnVzZXIgPSB1c2VyRGF0YTtcblxuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNldFVzZXJEZXRhaWxzKHVzZXJEYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckRhdGE7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgVXNlckNvbnRleHQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLmlzQXV0aCkge1xuXG4gICAgICAgICAgICAgICAgLy9nZXQgdXNlciBkZXRhaWxzIGZyb20gc2Vzc2lvblxuICAgICAgICAgICAgICAgIHRoYXQudXNlciA9IHNlc3Npb24uZ2V0VXNlckRldGFpbHMoKTtcblxuICAgICAgICAgICAgICAgIC8vY2FsbCBzZXJ2ZXIgdG8gcmVmcmVzaCB1c2VyIGRldGFpbHNcbiAgICAgICAgICAgICAgICBnZXRVc2VyRGV0YWlscyh0aGF0KTtcblxuICAgICAgICAgICAgICAgIC8vY2FsbCBzZXJ2ZXIgdG8gZ2V0IHVzZXIgc3Vic2NyaXB0aW9uc1xuICAgICAgICAgICAgICAgIGdldFN1YnNjcmlwdGlvbnModGhhdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuZ2V0Q3VycmVudFVzZXJEZXRhaWxzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudXNlcjtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgVXNlckNvbnRleHQucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVyZWQgPSB1dGlscy4kcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICBpZiAoc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLmlzQXV0aCkge1xuXG4gICAgICAgICAgICAgICAgZ2V0VXNlckRldGFpbHModGhhdCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kZW1pdCgndXNlci5sb2dpbicpO1xuICAgICAgICAgICAgICAgICAgICBkZWZlcmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJlZC5yZWplY3QoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbG9hZCB1c2VyIGluZm9ybWF0aW9uLicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZ2V0U3Vic2NyaXB0aW9ucyh0aGF0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVmZXJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcmVkLnByb21pc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgVXNlckNvbnRleHQucHJvdG90eXBlLnVubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgICAgICAgICB0aGlzLnVzZXIgPSBudWxsO1xuICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kZW1pdCgndXNlci5sb2dvdXQnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBVc2VyQ29udGV4dC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICBnZXRTdWJzY3JpcHRpb25zKHRoYXQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFVzZXJDb250ZXh0LnByb3RvdHlwZS5pc1N1YnNjcmliZWRUb0dyb3VuZCA9IGZ1bmN0aW9uKGdyb3VuZElkKSB7XG5cbiAgICAgICAgICAgIHZhciBncm91bmRTdWJzY3JpcHRpb25LZXkgPSAnZ3JvdW5kLycgKyBncm91bmRJZCArICcvYWN0aXZpdHknO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3Vic2NyaXB0aW9ucy5pbmRleE9mKGdyb3VuZFN1YnNjcmlwdGlvbktleSkgPj0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gbmV3IFVzZXJDb250ZXh0KCk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdicmFuZENvbmZpZycsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCRyb290U2NvcGUpIHtcblxuICAgICAgICB2YXIgYnJhbmRDb25maWcgPSB7XCJmYXZpY29uXCI6XCJhc3NldHMvaW1nL2JyYW5kL3NtYXJ0bGl2aW5nL2Zhdmljb24ucG5nXCIsXCJsb2dvSWNvblwiOlwiYXNzZXRzL2ltZy9icmFuZC9zbWFydGxpdmluZy9zbC1sb2dvLnN2Z1wiLFwibG9nb1R5cGVcIjpcImFzc2V0cy9pbWcvYnJhbmQvc21hcnRsaXZpbmcvc2wtdHlwby5zdmdcIixcImxvZ29BbHRcIjpcInNtYXJ0bGl2aW5nXCIsXCJicmFuZENvbG9yXCI6XCIjMjY3MGUwXCIsXCJuYW1lXCI6XCJTbWFydExpdmluZ1wiLFwibG9naW5CZ0NsYXNzXCI6XCJsb2dpbi1iZ1wifTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXG4gICAgICAgICAgICBjb25maWc6IGJyYW5kQ29uZmlnXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS5icmFuZCA9IGJyYW5kQ29uZmlnO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdNYWluUGFnZUNvbnRyb2xsZXInLCBNYWluUGFnZUNvbnRyb2xsZXIpO1xuXG4gICAgTWFpblBhZ2VDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJ3Nlc3Npb24nXTtcblxuICAgIGZ1bmN0aW9uIE1haW5QYWdlQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsIHNlc3Npb24pIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmlzTmF2aWdhdGlvblZpc2libGUgPSBpc05hdmlnYXRpb25WaXNpYmxlO1xuICAgICAgICB2bS5ncm91bmRNb2RlbCA9IG51bGw7XG4gICAgICAgIHZtLmdyb3VuZE1lbnVPcGVuID0gZmFsc2U7XG4gICAgICAgIHZtLmluR3JvdW5kID0gbnVsbDtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc05hdmlnYXRpb25WaXNpYmxlKCkge1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTmF2aWdhdGlvbkNvbnRyb2xsZXInLCBOYXZpZ2F0aW9uQ29udHJvbGxlcik7XG5cbiAgICBOYXZpZ2F0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJ3Nlc3Npb24nLCAnJHN0YXRlJywgJ2F1dGhTZXJ2aWNlJywgJ0dyb3VuZENvbnRleHQnLCAndXNlckNvbnRleHQnXTtcblxuICAgIGZ1bmN0aW9uIE5hdmlnYXRpb25Db250cm9sbGVyKCRyb290U2NvcGUsIHNlc3Npb24sICRzdGF0ZSwgYXV0aFNlcnZpY2UsIGdyb3VuZENvbnRleHQsIHVzZXJDb250ZXh0KSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5sb2dvdXQgPSBsb2dvdXQ7XG4gICAgICAgIHZtLmxvZ2dlZEluID0gZmFsc2U7XG4gICAgICAgIHZtLmdyb3VuZENvbnRleHQgPSBncm91bmRDb250ZXh0O1xuICAgICAgICB2bS51c2VyID0gc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnVzZXJOYW1lO1xuICAgICAgICB2bS5yb3V0ZSA9ICRzdGF0ZS5jdXJyZW50Lm5hbWU7XG4gICAgICAgIHZtLm1lbnVJdGVtcyA9IHtcbiAgICAgICAgICAgIHVzZXJzOiAnbWFpbi5hZG1pbicsXG4gICAgICAgICAgICBhY2NvdW50OiAnbWFpbi5hY2NvdW50U2V0dGluZ3MnLFxuICAgICAgICAgICAgYXV0aG9yaXplZENsaWVudHM6ICdtYWluLmF1dGhvcml6ZWRDbGllbnRzJyxcbiAgICAgICAgICAgIGRldmljZXM6ICdtYWluLmRldmljZXMnLFxuICAgICAgICAgICAgZ2F0ZXdheXM6ICdtYWluLmdhdGV3YXlzJyxcbiAgICAgICAgICAgIHJ1bGVzOiAnbWFpbi5ydWxlcydcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zZWxlY3RlZE1lbnVJdGVtID0gJyc7XG5cbiAgICAgICAgdm0uaXNBZG1pbiA9IGlzQWRtaW47XG4gICAgICAgIHZtLnNob3dTZWxlY3RlZE1lbnVJdGVtID0gc2hvd1NlbGVjdGVkSXRlbTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ2luJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5sb2dnZWRJbiA9IHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5pc0F1dGg7XG4gICAgICAgICAgICB2bS51c2VyID0gc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnVzZXJOYW1lO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbigndXNlci5sb2dvdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZtLmxvZ2dlZEluID0gc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLmlzQXV0aDtcbiAgICAgICAgICAgIHZtLnVzZXIgPSBudWxsO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICB2bS5yb3V0ZSA9IHRvU3RhdGUubmFtZTtcblxuICAgICAgICAgICAgaWYgKHZtLnJvdXRlID09IHZtLm1lbnVJdGVtcy51c2Vycykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTWVudUl0ZW0gPSAnR29kIG1vZGUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5yb3V0ZSA9PSB2bS5tZW51SXRlbXMuYWNjb3VudCkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTWVudUl0ZW0gPSAnQWNjb3VudCBzZXR0aW5ncyc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLnJvdXRlID09IHZtLm1lbnVJdGVtcy5hdXRob3JpemVkQ2xpZW50cykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTWVudUl0ZW0gPSAnQXV0aG9yaXplZCBjbGllbnRzJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ucm91dGUgPT0gdm0ubWVudUl0ZW1zLm1ldHJpY3MpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZE1lbnVJdGVtID0gJ01ldHJpY3MnO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5yb3V0ZSA9PSB2bS5tZW51SXRlbXMuZGV2aWNlcykge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTWVudUl0ZW0gPSAnWW91ciBkZXZpY2VzJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ucm91dGUgPT0gdm0ubWVudUl0ZW1zLmdhdGV3YXlzKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRNZW51SXRlbSA9ICdZb3VyIGdhdGV3YXlzJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ucm91dGUgPT0gdm0ubWVudUl0ZW1zLnJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRNZW51SXRlbSA9ICdZb3VyIHJ1bGVzJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdFNjb3BlLiR3YXRjaCgnaW5Hcm91bmQnLCBmdW5jdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdm0uaW5Hcm91bmQgPSBuZXdWYWx1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5pc0F1dGgpIHtcbiAgICAgICAgICAgIHZtLmxvZ2dlZEluID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNob3dNZW51KCkge1xuXG4gICAgICAgICAgICBpZiAoZ3JvdW5kQ29udGV4dC5jdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzQWRtaW4oKSB7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJDb250ZXh0LnVzZXI7XG4gICAgICAgICAgICBpZiAodXNlcikge1xuICAgICAgICAgICAgICAgIGlmICh1c2VyLnJvbGUgPT0gJ0FkbWluaXN0cmF0b3InKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2hvd1NlbGVjdGVkSXRlbSgpIHtcbiAgICAgICAgICAgIGlmICh2bS5yb3V0ZSA9PSB2bS5tZW51SXRlbXMudXNlcnMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ucm91dGUgPT0gdm0ubWVudUl0ZW1zLmFjY291bnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ucm91dGUgPT0gdm0ubWVudUl0ZW1zLmF1dGhvcml6ZWRDbGllbnRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLnJvdXRlID09IHZtLm1lbnVJdGVtcy5kZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLnJvdXRlID09IHZtLm1lbnVJdGVtcy5nYXRld2F5cykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5yb3V0ZSA9PSB2bS5tZW51SXRlbXMucnVsZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSgpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdub3RpZnlTZXJ2aWNlJywgTm90aWZ5U2VydmljZSk7XG5cbiAgICBOb3RpZnlTZXJ2aWNlLiRpbmplY3QgPSBbJyRmaWx0ZXInXTtcblxuICAgIGZ1bmN0aW9uIE5vdGlmeVNlcnZpY2UoJGZpbHRlcikge1xuXG4gICAgICAgIHZhciBzdWJzY3JpYmVycyA9IFtdO1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxuICAgICAgICAgICAgd2FybmluZzogd2FybmluZyxcbiAgICAgICAgICAgIGluZm86IGluZm8sXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxuICAgICAgICAgICAgb2ZmZXI6IG9mZmVyLFxuICAgICAgICAgICAgc3Vic2NyaWJlOiBzdWJzY3JpYmVcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IodGl0bGUsIG1zZywgYWN0aW9uLCBpc1Blcm1hbmVudCkge1xuICAgICAgICAgICAgcHVibGlzaCgnZXJyb3InLCB0aXRsZSwgbXNnLCBhY3Rpb24sIGlzUGVybWFuZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcodGl0bGUsIG1zZywgYWN0aW9uLCBpc1Blcm1hbmVudCwgYWN0aW9uSGFuZGxlciwgYWN0aW9uVGV4dCwgY2xvc2VIYW5kbGVyKSB7XG4gICAgICAgICAgICBwdWJsaXNoKCd3YXJuaW5nJywgdGl0bGUsIG1zZywgYWN0aW9uLCBpc1Blcm1hbmVudCwgYWN0aW9uSGFuZGxlciwgYWN0aW9uVGV4dCwgY2xvc2VIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluZm8odGl0bGUsIG1zZywgYWN0aW9uLCBpc1Blcm1hbmVudCkge1xuICAgICAgICAgICAgcHVibGlzaCgnaW5mbycsIHRpdGxlLCBtc2csIGFjdGlvbiwgaXNQZXJtYW5lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VjY2Vzcyh0aXRsZSwgbXNnLCBhY3Rpb24sIGlzUGVybWFuZW50KSB7XG4gICAgICAgICAgICBwdWJsaXNoKCdzdWNjZXNzJywgdGl0bGUsIG1zZywgYWN0aW9uLCBpc1Blcm1hbmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvZmZlcih0aXRsZSwgbXNnLCBhY3Rpb25IYW5kbGVyLCBhY3Rpb25UZXh0LCBjbG9zZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIHB1Ymxpc2goJ29mZmVyJywgdGl0bGUsIG1zZywgbnVsbCwgdHJ1ZSwgYWN0aW9uSGFuZGxlciwgYWN0aW9uVGV4dCwgY2xvc2VIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZShzdWJzY3JpYmVySWQsIHN1YnNjcmliZXJmbikge1xuXG4gICAgICAgICAgICB2YXIgZm91bmRTdWJzY3JpYmVyID0gJGZpbHRlcignZmlsdGVyJykoc3Vic2NyaWJlcnMsIHtcbiAgICAgICAgICAgICAgICBpZDogc3Vic2NyaWJlcklkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCEoZm91bmRTdWJzY3JpYmVyLmxlbmd0aCA+IDApKSB7XG5cbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHN1YnNjcmliZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgZm46IHN1YnNjcmliZXJmblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcHVibGlzaCh0eXBlLCB0aXRsZSwgbXNnLCBhY3Rpb24sIGlzUGVybWFuZW50LCBhY3Rpb25IYW5kbGVyLCBhY3Rpb25UZXh0LCBjbG9zZUhhbmRsZXIpIHtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHN1YnNjcmliZXJzW2ldLmZuKHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICAgICAgICBtc2c6IG1zZyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIGlzUGVybWFuZW50OiBpc1Blcm1hbmVudCxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGFuZGxlcjogYWN0aW9uSGFuZGxlcixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVGV4dDogYWN0aW9uVGV4dCxcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VIYW5kbGVyOiBjbG9zZUhhbmRsZXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCd1c2VyLnByZWZlcmVuY2VzJywgdXNlclByZWZlcmVuY2VzKTtcblxuICAgIHVzZXJQcmVmZXJlbmNlcy4kaW5qZWN0ID0gWydzZXNzaW9uJywgJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLCAnbG9jYWxTdG9yYWdlU2VydmljZSddO1xuXG4gICAgZnVuY3Rpb24gdXNlclByZWZlcmVuY2VzKHNlc3Npb24sICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCBsb2NhbFN0b3JhZ2UpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHJlbWVtYmVyUGFnZTogcmVtZW1iZXJQYWdlLFxuICAgICAgICAgICAgcmVhZFBhZ2U6IHJlYWRQYWdlLFxuICAgICAgICAgICAgcmVtZW1iZXJHbG9iYWw6IHJlbWVtYmVyR2xvYmFsLFxuICAgICAgICAgICAgcmVhZEdsb2JhbDogcmVhZEdsb2JhbFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gcmVtZW1iZXJQYWdlKGtleSwgdmFsdWUpIHtcblxuICAgICAgICAgICAgdmFyIHVuaXF1ZUtleSA9IGdlbmVyYXRlVW5pcXVlS2V5KGtleSwgZmFsc2UpO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0KHVuaXF1ZUtleSwgdmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVhZFBhZ2Uoa2V5KSB7XG5cbiAgICAgICAgICAgIHZhciB1bmlxdWVLZXkgPSBnZW5lcmF0ZVVuaXF1ZUtleShrZXksIGZhbHNlKTtcblxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXQodW5pcXVlS2V5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbWVtYmVyR2xvYmFsKGtleSwgdmFsdWUsIGlnbm9yZUxvZ2dlZFVzZXIpIHtcblxuICAgICAgICAgICAgdmFyIGlnbm9yZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoaWdub3JlTG9nZ2VkVXNlciAhPT0gdW5kZWZpbmVkICYmIGlnbm9yZUxvZ2dlZFVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZ25vcmUgPSBpZ25vcmVMb2dnZWRVc2VyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdW5pcXVlS2V5ID0gZ2VuZXJhdGVVbmlxdWVLZXkoa2V5LCB0cnVlLCBpZ25vcmUpO1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0KHVuaXF1ZUtleSwgdmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVhZEdsb2JhbChrZXksIGlnbm9yZUxvZ2dlZFVzZXIpIHtcblxuICAgICAgICAgICAgdmFyIGlnbm9yZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoaWdub3JlTG9nZ2VkVXNlciAhPT0gdW5kZWZpbmVkICYmIGlnbm9yZUxvZ2dlZFVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZ25vcmUgPSBpZ25vcmVMb2dnZWRVc2VyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdW5pcXVlS2V5ID0gZ2VuZXJhdGVVbmlxdWVLZXkoa2V5LCB0cnVlLCBpZ25vcmUpO1xuXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldCh1bmlxdWVLZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVVbmlxdWVLZXkoa2V5LCBpc0dsb2JhbCwgaWdub3JlTG9nZ2VkVXNlcikge1xuXG4gICAgICAgICAgICB2YXIgdXNlciA9ICdndWVzdCc7XG5cbiAgICAgICAgICAgIHZhciBhdXRoID0gc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpO1xuXG4gICAgICAgICAgICBpZiAoYXV0aC5pc0F1dGgpIHtcbiAgICAgICAgICAgICAgICB1c2VyID0gYXV0aC51c2VyTmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVuaXF1ZUtleSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChpc0dsb2JhbCkge1xuICAgICAgICAgICAgICAgIGlmIChpZ25vcmVMb2dnZWRVc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZUtleSA9ICdwcmVmZXJlbmNlX2dsb2JhbF97MH0nLmZvcm1hdChrZXkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZUtleSA9ICdwcmVmZXJlbmNlX2dsb2JhbF97MH1fezF9Jy5mb3JtYXQodXNlciwga2V5KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGlnbm9yZUxvZ2dlZFVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlS2V5ID0gJ3ByZWZlcmVuY2VfezB9X3sxfScuZm9ybWF0KGdldFN0YXRlS2V5KCksIGtleSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlS2V5ID0gJ3ByZWZlcmVuY2VfezB9X3sxfV97Mn0nLmZvcm1hdCh1c2VyLCBnZXRTdGF0ZUtleSgpLCBrZXkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdW5pcXVlS2V5O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3RhdGVLZXkoKSB7XG5cbiAgICAgICAgICAgIHZhciBzdGF0ZUtleSA9ICRzdGF0ZS5jdXJyZW50Lm5hbWU7XG5cbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5oYXNPd25Qcm9wZXJ0eShwKSkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZUtleSArPSAkc3RhdGVQYXJhbXNbcF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc3RhdGVLZXk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3V0aWxzJywgdXRpbHMpO1xuXG4gICAgdXRpbHMuJGluamVjdCA9IFsnJHEnLCAnJHRpbWVvdXQnLCAnJGludGVydmFsJywgJyRyb290U2NvcGUnLCAnJHN0YXRlJywgJ25vdGlmeVNlcnZpY2UnLCAndXNlci5wcmVmZXJlbmNlcycsICd1dGlsaXR5LnZpZXdDb25maWdzJ107XG5cbiAgICBmdW5jdGlvbiB1dGlscygkcSwgJHRpbWVvdXQsICRpbnRlcnZhbCwgJHJvb3RTY29wZSwgJHN0YXRlLCBub3RpZnlTZXJ2aWNlLCBwcmVmZXJlbmNlcywgdmlld0NvbmZpZ3MpIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICAvL2NvbW1vbiBhbmd1bGFyIGRlcGVuZGFlbmNpZXNcbiAgICAgICAgICAgICRxOiAkcSxcbiAgICAgICAgICAgICR0aW1lb3V0OiAkdGltZW91dCxcbiAgICAgICAgICAgICRpbnRlcnZhbDogJGludGVydmFsLFxuICAgICAgICAgICAgJHJvb3RTY29wZTogJHJvb3RTY29wZSxcblxuICAgICAgICAgICAgLy9jb21tb24gYXBwIGRlcGVuZGFlbmNpZXNcbiAgICAgICAgICAgIG5vdGlmeTogbm90aWZ5U2VydmljZSxcbiAgICAgICAgICAgIHByZWZlcmVuY2VzOiBwcmVmZXJlbmNlcyxcbiAgICAgICAgICAgIHZpZXdDb25maWdzOiB2aWV3Q29uZmlncyxcblxuICAgICAgICAgICAgLy9oZWxwZXJzXG4gICAgICAgICAgICBnZXREZXZpY2VJbmZvOiBnZXREZXZpY2VJbmZvLFxuICAgICAgICAgICAgZ2V0UmFuZG9tU3RyaW5nOiBnZXRSYW5kb21TdHJpbmcsXG4gICAgICAgICAgICBpc0JvdDogaXNCb3QsXG4gICAgICAgICAgICB0cnlQYXJzZUpTT046IHRyeVBhcnNlSlNPTixcbiAgICAgICAgICAgIHRyYW5zZm9ybVJlc3BvbnNlOiB0cmFuc2Zvcm1SZXNwb25zZSxcbiAgICAgICAgICAgIGhhbmRsZVZpZXdNb2RlbEluaXRpYWxpenRpb25FcnJvcjogaGFuZGxlVmlld01vZGVsSW5pdGlhbGl6dGlvbkVycm9yLFxuICAgICAgICAgICAgbm9ybWFsaXplQXNzZXROYW1lOiBub3JtYWxpemVBc3NldE5hbWUsXG4gICAgICAgICAgICBnZW5lcmF0ZVJhbmRvbVN0cmluZzogZ2VuZXJhdGVSYW5kb21TdHJpbmcsXG4gICAgICAgICAgICB0b0NhbWVsQ2FzZTogdG9DYW1lbENhc2UsXG5cbiAgICAgICAgICAgIHdoZW5BbGw6IHdoZW5BbGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBnZXREZXZpY2VJbmZvKCkge1xuICAgICAgICAgICAgdmFyIHVua25vd24gPSAnLSc7XG5cbiAgICAgICAgICAgIC8vIHNjcmVlblxuICAgICAgICAgICAgdmFyIHNjcmVlblNpemUgPSAnJztcbiAgICAgICAgICAgIGlmIChzY3JlZW4ud2lkdGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSAoc2NyZWVuLndpZHRoKSA/IHNjcmVlbi53aWR0aCA6ICcnO1xuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSAoc2NyZWVuLmhlaWdodCkgPyBzY3JlZW4uaGVpZ2h0IDogJyc7XG4gICAgICAgICAgICAgICAgc2NyZWVuU2l6ZSArPSAnJyArIHdpZHRoICsgJyB4ICcgKyBoZWlnaHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vYnJvd3NlclxuICAgICAgICAgICAgdmFyIG5WZXIgPSBuYXZpZ2F0b3IuYXBwVmVyc2lvbjtcbiAgICAgICAgICAgIHZhciBuQWd0ID0gbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgICAgICAgICAgIHZhciBicm93c2VyID0gbmF2aWdhdG9yLmFwcE5hbWU7XG4gICAgICAgICAgICB2YXIgdmVyc2lvbiA9ICcnICsgcGFyc2VGbG9hdChuYXZpZ2F0b3IuYXBwVmVyc2lvbik7XG4gICAgICAgICAgICB2YXIgbWFqb3JWZXJzaW9uID0gcGFyc2VJbnQobmF2aWdhdG9yLmFwcFZlcnNpb24sIDEwKTtcbiAgICAgICAgICAgIHZhciBuYW1lT2Zmc2V0O1xuICAgICAgICAgICAgdmFyIHZlck9mZnNldDtcbiAgICAgICAgICAgIHZhciBpeDtcblxuICAgICAgICAgICAgLy8gT3BlcmFcbiAgICAgICAgICAgIGlmICgodmVyT2Zmc2V0ID0gbkFndC5pbmRleE9mKCdPcGVyYScpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnT3BlcmEnO1xuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuQWd0LnN1YnN0cmluZyh2ZXJPZmZzZXQgKyA2KTtcbiAgICAgICAgICAgICAgICBpZiAoKHZlck9mZnNldCA9IG5BZ3QuaW5kZXhPZignVmVyc2lvbicpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uID0gbkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0ICsgOCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNU0lFXG4gICAgICAgICAgICBlbHNlIGlmICgodmVyT2Zmc2V0ID0gbkFndC5pbmRleE9mKCdNU0lFJykpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgYnJvd3NlciA9ICdNaWNyb3NvZnQgSW50ZXJuZXQgRXhwbG9yZXInO1xuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuQWd0LnN1YnN0cmluZyh2ZXJPZmZzZXQgKyA1KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hyb21lXG4gICAgICAgICAgICBlbHNlIGlmICgodmVyT2Zmc2V0ID0gbkFndC5pbmRleE9mKCdDaHJvbWUnKSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICBicm93c2VyID0gJ0Nocm9tZSc7XG4gICAgICAgICAgICAgICAgdmVyc2lvbiA9IG5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCArIDcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTYWZhcmlcbiAgICAgICAgICAgIGVsc2UgaWYgKCh2ZXJPZmZzZXQgPSBuQWd0LmluZGV4T2YoJ1NhZmFyaScpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnU2FmYXJpJztcbiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gbkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0ICsgNyk7XG4gICAgICAgICAgICAgICAgaWYgKCh2ZXJPZmZzZXQgPSBuQWd0LmluZGV4T2YoJ1ZlcnNpb24nKSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IG5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCArIDgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRmlyZWZveFxuICAgICAgICAgICAgZWxzZSBpZiAoKHZlck9mZnNldCA9IG5BZ3QuaW5kZXhPZignRmlyZWZveCcpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIGJyb3dzZXIgPSAnRmlyZWZveCc7XG4gICAgICAgICAgICAgICAgdmVyc2lvbiA9IG5BZ3Quc3Vic3RyaW5nKHZlck9mZnNldCArIDgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNU0lFIDExK1xuICAgICAgICAgICAgZWxzZSBpZiAobkFndC5pbmRleE9mKCdUcmlkZW50LycpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgYnJvd3NlciA9ICdNaWNyb3NvZnQgSW50ZXJuZXQgRXhwbG9yZXInO1xuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuQWd0LnN1YnN0cmluZyhuQWd0LmluZGV4T2YoJ3J2OicpICsgMyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIE90aGVyIGJyb3dzZXJzXG4gICAgICAgICAgICBlbHNlIGlmICgobmFtZU9mZnNldCA9IG5BZ3QubGFzdEluZGV4T2YoJyAnKSArIDEpIDwgKHZlck9mZnNldCA9IG5BZ3QubGFzdEluZGV4T2YoJy8nKSkpIHtcbiAgICAgICAgICAgICAgICBicm93c2VyID0gbkFndC5zdWJzdHJpbmcobmFtZU9mZnNldCwgdmVyT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gbkFndC5zdWJzdHJpbmcodmVyT2Zmc2V0ICsgMSk7XG4gICAgICAgICAgICAgICAgaWYgKGJyb3dzZXIudG9Mb3dlckNhc2UoKSA9PSBicm93c2VyLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJvd3NlciA9IG5hdmlnYXRvci5hcHBOYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdHJpbSB0aGUgdmVyc2lvbiBzdHJpbmdcbiAgICAgICAgICAgIGlmICgoaXggPSB2ZXJzaW9uLmluZGV4T2YoJzsnKSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gdmVyc2lvbi5zdWJzdHJpbmcoMCwgaXgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKGl4ID0gdmVyc2lvbi5pbmRleE9mKCcgJykpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24uc3Vic3RyaW5nKDAsIGl4KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKChpeCA9IHZlcnNpb24uaW5kZXhPZignKScpKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgIHZlcnNpb24gPSB2ZXJzaW9uLnN1YnN0cmluZygwLCBpeCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1ham9yVmVyc2lvbiA9IHBhcnNlSW50KCcnICsgdmVyc2lvbiwgMTApO1xuICAgICAgICAgICAgaWYgKGlzTmFOKG1ham9yVmVyc2lvbikpIHtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gJycgKyBwYXJzZUZsb2F0KG5hdmlnYXRvci5hcHBWZXJzaW9uKTtcbiAgICAgICAgICAgICAgICBtYWpvclZlcnNpb24gPSBwYXJzZUludChuYXZpZ2F0b3IuYXBwVmVyc2lvbiwgMTApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBtb2JpbGUgdmVyc2lvblxuICAgICAgICAgICAgdmFyIG1vYmlsZSA9IC9Nb2JpbGV8bWluaXxGZW5uZWN8V1BEZXNrdG9wfEFuZHJvaWR8aVAoYWR8b2R8aG9uZSkvLnRlc3QoblZlcik7XG5cbiAgICAgICAgICAgIC8vIGNvb2tpZVxuICAgICAgICAgICAgdmFyIGNvb2tpZUVuYWJsZWQgPSAobmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQpID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvci5jb29raWVFbmFibGVkID09ICd1bmRlZmluZWQnICYmICFjb29raWVFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ3Rlc3Rjb29raWUnO1xuICAgICAgICAgICAgICAgIGNvb2tpZUVuYWJsZWQgPSAoZG9jdW1lbnQuY29va2llLmluZGV4T2YoJ3Rlc3Rjb29raWUnKSAhPSAtMSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHN5c3RlbVxuICAgICAgICAgICAgdmFyIG9zID0gdW5rbm93bjtcbiAgICAgICAgICAgIHZhciBjbGllbnRTdHJpbmdzID0gW3tcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyAzLjExJyxcbiAgICAgICAgICAgICAgICByOiAvV2luMTYvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1dpbmRvd3MgOTUnLFxuICAgICAgICAgICAgICAgIHI6IC8oV2luZG93cyA5NXxXaW45NXxXaW5kb3dzXzk1KS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyBNRScsXG4gICAgICAgICAgICAgICAgcjogLyhXaW4gOXggNC45MHxXaW5kb3dzIE1FKS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyA5OCcsXG4gICAgICAgICAgICAgICAgcjogLyhXaW5kb3dzIDk4fFdpbjk4KS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyBDRScsXG4gICAgICAgICAgICAgICAgcjogL1dpbmRvd3MgQ0UvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1dpbmRvd3MgMjAwMCcsXG4gICAgICAgICAgICAgICAgcjogLyhXaW5kb3dzIE5UIDUuMHxXaW5kb3dzIDIwMDApL1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHM6ICdXaW5kb3dzIFhQJyxcbiAgICAgICAgICAgICAgICByOiAvKFdpbmRvd3MgTlQgNS4xfFdpbmRvd3MgWFApL1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHM6ICdXaW5kb3dzIFNlcnZlciAyMDAzJyxcbiAgICAgICAgICAgICAgICByOiAvV2luZG93cyBOVCA1LjIvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1dpbmRvd3MgVmlzdGEnLFxuICAgICAgICAgICAgICAgIHI6IC9XaW5kb3dzIE5UIDYuMC9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyA3JyxcbiAgICAgICAgICAgICAgICByOiAvKFdpbmRvd3MgN3xXaW5kb3dzIE5UIDYuMSkvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1dpbmRvd3MgOC4xJyxcbiAgICAgICAgICAgICAgICByOiAvKFdpbmRvd3MgOC4xfFdpbmRvd3MgTlQgNi4zKS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnV2luZG93cyA4JyxcbiAgICAgICAgICAgICAgICByOiAvKFdpbmRvd3MgOHxXaW5kb3dzIE5UIDYuMikvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1dpbmRvd3MgTlQgNC4wJyxcbiAgICAgICAgICAgICAgICByOiAvKFdpbmRvd3MgTlQgNC4wfFdpbk5UNC4wfFdpbk5UfFdpbmRvd3MgTlQpL1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHM6ICdXaW5kb3dzIE1FJyxcbiAgICAgICAgICAgICAgICByOiAvV2luZG93cyBNRS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnQW5kcm9pZCcsXG4gICAgICAgICAgICAgICAgcjogL0FuZHJvaWQvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ09wZW4gQlNEJyxcbiAgICAgICAgICAgICAgICByOiAvT3BlbkJTRC9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnU3VuIE9TJyxcbiAgICAgICAgICAgICAgICByOiAvU3VuT1MvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ0xpbnV4JyxcbiAgICAgICAgICAgICAgICByOiAvKExpbnV4fFgxMSkvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ2lPUycsXG4gICAgICAgICAgICAgICAgcjogLyhpUGhvbmV8aVBhZHxpUG9kKS9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnTWFjIE9TIFgnLFxuICAgICAgICAgICAgICAgIHI6IC9NYWMgT1MgWC9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnTWFjIE9TJyxcbiAgICAgICAgICAgICAgICByOiAvKE1hY1BQQ3xNYWNJbnRlbHxNYWNfUG93ZXJQQ3xNYWNpbnRvc2gpL1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHM6ICdRTlgnLFxuICAgICAgICAgICAgICAgIHI6IC9RTlgvXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgczogJ1VOSVgnLFxuICAgICAgICAgICAgICAgIHI6IC9VTklYL1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHM6ICdCZU9TJyxcbiAgICAgICAgICAgICAgICByOiAvQmVPUy9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnT1MvMicsXG4gICAgICAgICAgICAgICAgcjogL09TXFwvMi9cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBzOiAnU2VhcmNoIEJvdCcsXG4gICAgICAgICAgICAgICAgcjogLyhudWhrfEdvb2dsZWJvdHxZYW1teWJvdHxPcGVuYm90fFNsdXJwfE1TTkJvdHxBc2sgSmVldmVzXFwvVGVvbWF8aWFfYXJjaGl2ZXIpL1xuICAgICAgICAgICAgfV07XG4gICAgICAgICAgICBmb3IgKHZhciBpZCBpbiBjbGllbnRTdHJpbmdzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNzID0gY2xpZW50U3RyaW5nc1tpZF07XG4gICAgICAgICAgICAgICAgaWYgKGNzLnIudGVzdChuQWd0KSkge1xuICAgICAgICAgICAgICAgICAgICBvcyA9IGNzLnM7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9zVmVyc2lvbiA9IHVua25vd247XG5cbiAgICAgICAgICAgIGlmICgvV2luZG93cy8udGVzdChvcykpIHtcbiAgICAgICAgICAgICAgICBvc1ZlcnNpb24gPSAvV2luZG93cyAoLiopLy5leGVjKG9zKVsxXTtcbiAgICAgICAgICAgICAgICBvcyA9ICdXaW5kb3dzJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChvcykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ01hYyBPUyBYJzpcbiAgICAgICAgICAgICAgICAgICAgb3NWZXJzaW9uID0gL01hYyBPUyBYICgxMFtcXC5cXF9cXGRdKykvLmV4ZWMobkFndClbMV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnQW5kcm9pZCc6XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFuZHJvaWRWZXJzaW9uID0gL0FuZHJvaWQgKFtcXC5cXF9cXGRdKykvLmV4ZWMobkFndCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmRyb2lkVmVyc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3NWZXJzaW9uID0gYW5kcm9pZFZlcnNpb25bMV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2lPUyc6XG4gICAgICAgICAgICAgICAgICAgIG9zVmVyc2lvbiA9IC9PUyAoXFxkKylfKFxcZCspXz8oXFxkKyk/Ly5leGVjKG5WZXIpO1xuICAgICAgICAgICAgICAgICAgICBvc1ZlcnNpb24gPSBvc1ZlcnNpb25bMV0gKyAnLicgKyBvc1ZlcnNpb25bMl0gKyAnLicgKyAob3NWZXJzaW9uWzNdIHwgMCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBmbGFzaCAoeW91J2xsIG5lZWQgdG8gaW5jbHVkZSBzd2ZvYmplY3QpXG4gICAgICAgICAgICAvKiBzY3JpcHQgc3JjPVwiLy9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9zd2ZvYmplY3QvMi4yL3N3Zm9iamVjdC5qc1wiICovXG4gICAgICAgICAgICB2YXIgZmxhc2hWZXJzaW9uID0gJ25vIGNoZWNrJztcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3dmb2JqZWN0ICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZ2ID0gc3dmb2JqZWN0LmdldEZsYXNoUGxheWVyVmVyc2lvbigpO1xuICAgICAgICAgICAgICAgIGlmIChmdi5tYWpvciA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZmxhc2hWZXJzaW9uID0gZnYubWFqb3IgKyAnLicgKyBmdi5taW5vciArICcgcicgKyBmdi5yZWxlYXNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZsYXNoVmVyc2lvbiA9IHVua25vd247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNjcmVlblNpemU6IHNjcmVlblNpemUsXG4gICAgICAgICAgICAgICAgYnJvd3NlcjogYnJvd3NlcixcbiAgICAgICAgICAgICAgICBicm93c2VyVmVyc2lvbjogdmVyc2lvbixcbiAgICAgICAgICAgICAgICBtb2JpbGU6IG1vYmlsZSxcbiAgICAgICAgICAgICAgICBvczogb3MsXG4gICAgICAgICAgICAgICAgb3NWZXJzaW9uOiBvc1ZlcnNpb24sXG4gICAgICAgICAgICAgICAgY29va2llczogY29va2llRW5hYmxlZCxcbiAgICAgICAgICAgICAgICBmbGFzaFZlcnNpb246IGZsYXNoVmVyc2lvbixcbiAgICAgICAgICAgICAgICBuVmVyOiBuVmVyXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UmFuZG9tU3RyaW5nKGxlbmd0aCkge1xuXG4gICAgICAgICAgICB2YXIgbCA9IDEwO1xuICAgICAgICAgICAgaWYgKGxlbmd0aCAmJiBhbmd1bGFyLmlzTnVtYmVyKGxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICBsID0gbGVuZ3RoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaGFzaCA9ICcnO1xuICAgICAgICAgICAgdmFyIHBvc3NpYmxlID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5JztcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaGFzaCArPSBwb3NzaWJsZS5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGUubGVuZ3RoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBoYXNoO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNCb3QoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAvYm90fGdvb2dsZWJvdHxjcmF3bGVyfHNwaWRlcnxyb2JvdHxjcmF3bGluZy9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB0cnlQYXJzZUpTT04oc3RyKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IEpTT04ucGFyc2Uoc3RyKTtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKG9iaik7XG5cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybVJlc3BvbnNlKE1vZGVsQ29uc3RydWN0b3IpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlc3BvbnNlRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRGF0YSA9PT0gbnVsbCB8fCByZXNwb25zZURhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRGF0YS5pdGVtcyAmJiByZXNwb25zZURhdGEuaXRlbXMuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzQXJyYXkocmVzcG9uc2VEYXRhLml0ZW1zLCBNb2RlbENvbnN0cnVjdG9yKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlRGF0YS5kYXRhICYmIHJlc3BvbnNlRGF0YS5kYXRhLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc0FycmF5KHJlc3BvbnNlRGF0YS5kYXRhLCBNb2RlbENvbnN0cnVjdG9yKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlRGF0YS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NBcnJheShyZXNwb25zZURhdGEsIE1vZGVsQ29uc3RydWN0b3IpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2VEYXRhLmRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNb2RlbENvbnN0cnVjdG9yKHJlc3BvbnNlRGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1vZGVsQ29uc3RydWN0b3IocmVzcG9uc2VEYXRhKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQXJyYXkoaXRlbXMsIE1vZGVsQ29uc3RydWN0b3IpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBNb2RlbENvbnN0cnVjdG9yKGl0ZW1zW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVZpZXdNb2RlbEluaXRpYWxpenRpb25FcnJvcihlcnIpIHtcblxuICAgICAgICAgICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlcnJvcicsIHt9LCB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9SZXR1cm5zIGEgc2luZ2xlIHByb21pc2UgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggYW4gYXJyYXkvaGFzaCBvZiB2YWx1ZXMsXG4gICAgICAgIC8vZWFjaCB2YWx1ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm9taXNlIGF0IHRoZSBzYW1lIGluZGV4L2tleSBpbiB0aGUgcHJvbWlzZXMgYXJyYXkvaGFzaC4gVW5saWtlIGFuZ3VsYXIgJHEuYWxsLCB0aGlzIG1ldGhvZCB3aWxsXG4gICAgICAgIC8vcmVzb2x2ZSBldmVuIGlmIHNvbWUgb2YgdGhlIHByb21pc2VzIGluIGFycmF5L2hhc2ggYXJlIHJlamVjdGVkOlxuICAgICAgICAvL1Byb21pc2VzIHJlc2xvdmVkIHdpdGggc3VjY2VzcyB3aWxsIGJlIGluY2x1ZGVkIGluIHJlc3VsdGluZyBwcm9taXNlcyB3aXRoIHsgaXNTdWNjZXNzOnRydWUsIGRhdGE6IGRhdGFSZXR1cm5lZCB9XG4gICAgICAgIC8vUHJvbWlzZXMgcmVzb2x2ZWQgd2l0aCBhIHJlamVjdGlvbiB3aWxsIGFsc28gYmUgaW5jbHVkZWQgaW4gcmVzdWx0aW5nIHByb21pc2VzIHdpdGggeyBpc1N1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IgfVxuICAgICAgICBmdW5jdGlvbiB3aGVuQWxsKHByb21pc2VzKSB7XG5cbiAgICAgICAgICAgIHZhciB3cmFwcGVkUHJvbWlzZXMgPSBbXTtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHByb21pc2VzLCBmdW5jdGlvbihwcm9taXNlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgd3JhcHBlZFByb21pc2UgPSBwcm9taXNlXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVyclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHdyYXBwZWRQcm9taXNlcy5wdXNoKHdyYXBwZWRQcm9taXNlKTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiAkcS5hbGwod3JhcHBlZFByb21pc2VzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUFzc2V0TmFtZShhc3NldFRpdGxlKSB7XG5cbiAgICAgICAgICAgIHZhciBnZW5lcmF0ZWROYW1lID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gL1teYS16MC05XSsvZ2k7XG5cbiAgICAgICAgICAgIGlmIChhc3NldFRpdGxlID09PSBudWxsIHx8IGFzc2V0VGl0bGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnZW5lcmF0ZWROYW1lID0gYXNzZXRUaXRsZS5yZXBsYWNlKHBhdHRlcm4sICdfJykucmVwbGFjZSgvXl8rLywgJycpLnJlcGxhY2UoL18rJC8sICcnKTtcblxuICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlZE5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbVN0cmluZyhsZW5ndGgsIGNoYXJzKSB7XG5cbiAgICAgICAgICAgIHZhciBtYXNrID0gJyc7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChjaGFycy5pbmRleE9mKCdhJykgPiAtMSkge1xuICAgICAgICAgICAgICAgIG1hc2sgKz0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNoYXJzLmluZGV4T2YoJ0EnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgbWFzayArPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY2hhcnMuaW5kZXhPZignIycpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBtYXNrICs9ICcwMTIzNDU2Nzg5JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNoYXJzLmluZGV4T2YoJyEnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgbWFzayArPSAnfmAhQCMkJV4mKigpXystPXt9W106XCI7XFwnPD4/LC4vfFxcXFwnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gbGVuZ3RoOyBpID4gMDsgLS1pKSB7XG5cbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gbWFza1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXNrLmxlbmd0aCldO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB0b0NhbWVsQ2FzZShzdHIpIHtcbiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvKD86Xlxcd3xbQS1aXXxcXGJcXHcpL2csIGZ1bmN0aW9uKGxldHRlciwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXggPT0gMCA/IGxldHRlci50b0xvd2VyQ2FzZSgpIDogbGV0dGVyLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICB9KS5yZXBsYWNlKC9cXHMrL2csICcnKTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLmFkb3B0U2VydmljZScsIGFkb3B0U2VydmljZSk7XG5cbiAgICBhZG9wdFNlcnZpY2UuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICd1dGlscycsICdkZW1vLmNvbmZpZ3VyYXRpb24nLCAnYXBpLmRldmljZXNTZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBhZG9wdFNlcnZpY2UoJHJvb3RTY29wZSwgdXRpbHMsIGdhbWVDb25maWd1cmF0aW9uLCBkZXZpY2VzU2VydmljZSkge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGluaXQ6IGluaXRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJ3VzZXIubG9naW4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGV2aWNlSWQgPSB1dGlscy5wcmVmZXJlbmNlcy5yZWFkR2xvYmFsKGdhbWVDb25maWd1cmF0aW9uLmRldmljZUlkS2V5LCB0cnVlKTtcbiAgICAgICAgICAgICAgICBpZiAoZGV2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRvcHREZXZpY2UoZGV2aWNlSWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRvcHREZXZpY2UoZGV2aWNlSWQpIHtcblxuICAgICAgICAgICAgZGV2aWNlc1NlcnZpY2UuYWRvcHQoZGV2aWNlSWQpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXRpbHMucHJlZmVyZW5jZXMucmVtZW1iZXJHbG9iYWwoZ2FtZUNvbmZpZ3VyYXRpb24uZGV2aWNlSWRLZXksIG51bGwsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnZGVtby5kZXZpY2VBZG9wdGVkJywgZGV2aWNlSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLmNvbmZpZ3VyYXRpb24nLCBjb25maWd1cmF0aW9uKTtcblxuICAgIGZ1bmN0aW9uIGNvbmZpZ3VyYXRpb24oKSB7XG5cbiAgICAgICAgdmFyIHRvdGFsQXNzZXRzID0gNztcbiAgICAgICAgdmFyIGFzc2V0Q29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgICAgIHNoYWtlOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnc2hha2UnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnb250YWJsZSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmlzaWJpbGl0eToge1xuICAgICAgICAgICAgICAgIHByb2ZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgICAgICAgICAgICAgICBzdXBwb3J0ZWQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb250cm9sOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdvbm9mZidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgIHByb2ZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgICAgIHN1cHBvcnRlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbGFiZWwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhbmRzaGFrZToge1xuICAgICAgICAgICAgICAgIHByb2ZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICAgICAgICAgIHN1cHBvcnRlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbGFiZWwnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJvdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAncm90YXRlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXZpY2VJbmZvOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZToge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydGVkOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb250cm9sOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGRldmljZVR5cGU6ICdxdWljay1kZW1vJyxcbiAgICAgICAgICAgIHNlc3Npb25LZXk6ICdxdWljay1kZW1vLWRldmljZS1uYW1lJyxcbiAgICAgICAgICAgIGRldmljZUlkS2V5OiAncXVpY2stZGVtby1kZXZpY2UtaWQnLFxuICAgICAgICAgICAgZGV2aWNlRGVzY3JpcHRpb246ICdyZWFkeScsXG4gICAgICAgICAgICBkZXZpY2VOYW1lUHJlZml4OiAnR2FtZS0nLFxuICAgICAgICAgICAgcHVibGljVXNlcjogJ2dnJyxcbiAgICAgICAgICAgIHB1YmxpY1VzZXJQYXNzd29yZDogJ2dhbWUxMjM0JyxcbiAgICAgICAgICAgIGRldmljZUNvbnRyb2xOYW1lOiAncXJjb2RlJyxcbiAgICAgICAgICAgIGFzc2V0Q29uZmlndXJhdGlvbjogYXNzZXRDb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgdG90YWxBc3NldHM6IHRvdGFsQXNzZXRzXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdHdWVzc2luZ0dhbWVDb250cm9sbGVyJywgR3Vlc3NpbmdHYW1lQ29udHJvbGxlcik7XG5cbiAgICBHdWVzc2luZ0dhbWVDb250cm9sbGVyLiRpbmplY3QgPSBbXG4gICAgICAgICckc2NvcGUnLFxuICAgICAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAgICAgJ3V0aWxzJyxcbiAgICAgICAgJ2RldmljZS5yZXBvc2l0b3J5JyxcbiAgICAgICAgJ2RlbW8uZ2FtZScsXG4gICAgICAgICckd2luZG93J1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBHdWVzc2luZ0dhbWVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlUGFyYW1zLCB1dGlscywgZGV2aWNlUmVwb3NpdG9yeSwgR2FtZSwgJHdpbmRvdykge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uZ2FtZURldmljZSA9IG51bGw7XG5cbiAgICAgICAgdm0uc3RhdHVzID0gJ3BsYXlpbmcnO1xuXG4gICAgICAgIHZtLmVycm9yTWVzc2FnZSA9IG51bGw7XG5cbiAgICAgICAgdm0uZ2FtZSA9IG5ldyBHYW1lKCk7XG5cbiAgICAgICAgdm0uc2ltdWxhdGUgPSBzaW11bGF0ZTtcbiAgICAgICAgdm0uc3VzcGVuZCA9IHN1c3BlbmQ7XG4gICAgICAgIHZtLnJlc2V0R2FtZSA9IHJlc2V0R2FtZTtcbiAgICAgICAgdm0ucmVsb2FkID0gcmVsb2FkO1xuICAgICAgICB2bS5nZXRDb25uZWN0ZWREZXZpY2VJbmZvID0gZ2V0Q29ubmVjdGVkRGV2aWNlSW5mbztcbiAgICAgICAgdm0uY29ubmVjdGVkRGV2aWNlID0gbnVsbDtcblxuICAgICAgICB2bS5kaXNjb25uZWN0RGV2aWNlID0gZGlzY29ubmVjdERldmljZTtcblxuICAgICAgICB2YXIgZGV2aWNlSWQgPSB1dGlscy4kcm9vdFNjb3BlLmRldmljZUlkO1xuXG4gICAgICAgIHZhciBkZXZpY2VUaWNrZXQgPSB1dGlscy4kcm9vdFNjb3BlLnRpY2tldDtcblxuICAgICAgICB2YXIgSEFORFNIQUtFX0ZBSUxfVEhSRVNIT0xEID0gMzAwMDA7XG4gICAgICAgIHZhciBpc1N1YnNjcmliZWRUb0Fzc2V0cyA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBoYW5kc2hha2VGYWlsVGltZXIgPSBudWxsO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuXG4gICAgICAgICAgICBsb2FkR2FtZURldmljZShkZXZpY2VUaWNrZXQpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5nYW1lRGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdhbWVEZXZpY2UudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRHYW1lRGV2aWNlKGlkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VSZXBvc2l0b3J5LmZpbmRBbGxVc2luZ1Rva2VuKCAnWW91ciBzbWFydHBob25lJyxpZCkudGhlbihmdW5jdGlvbihkZXZpY2UpIHtcblxuICAgICAgICAgICAgICAgIHZtLmdhbWVEZXZpY2UgPSBkZXZpY2U7XG4gICAgICAgICAgICAgICAgdm0uZ2FtZURldmljZS5zdWJzY3JpYmUodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNldEVycm9yKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG5cbiAgICAgICAgICAgIHZhciBlbmdhZ2VyQWN0aXZlQXNzZXQgPSB2bS5nYW1lRGV2aWNlLmdldEFzc2V0KCdzZW5kaW5nZGF0YScpO1xuXG4gICAgICAgICAgICBpZiAoZW5nYWdlckFjdGl2ZUFzc2V0LnN0YXRlICYmIGVuZ2FnZXJBY3RpdmVBc3NldC5zdGF0ZS52YWx1ZSA9PT0gZmFsc2UpIHtcblxuICAgICAgICAgICAgICAgIHZtLmdhbWUuc3VzcGVuZCgpO1xuXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0dhbWUoKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHN0YXJ0R2FtZSgpO1xuXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0dhbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NHYW1lKCkge1xuXG4gICAgICAgICAgICB2YXIgZW5nYWdlckFjdGl2ZUFzc2V0ID0gdm0uZ2FtZURldmljZS5nZXRBc3NldCgnc2VuZGluZ2RhdGEnKTtcblxuICAgICAgICAgICAgaWYgKHZtLmdhbWUuc3RhdHVzID09PSAnc3VzcGVuZGVkJykge1xuXG4gICAgICAgICAgICAgICAgdmFyIGlzU3RpbGxTdXNwZW5kZWQgPSBlbmdhZ2VyQWN0aXZlQXNzZXQuc3RhdGUgJiYgZW5nYWdlckFjdGl2ZUFzc2V0LnN0YXRlLnZhbHVlID09PSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmICghaXNTdGlsbFN1c3BlbmRlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLmdhbWUudW5zdXNwZW5kKCk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2bS5zdGF0dXMgPT09ICdwbGF5aW5nJykge1xuXG4gICAgICAgICAgICAgICAgaWYgKGVuZ2FnZXJBY3RpdmVBc3NldC5zdGF0ZSAmJiBlbmdhZ2VyQWN0aXZlQXNzZXQuc3RhdGUudmFsdWUgPT09IHRydWUpIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS5nYW1lLnVuc3VzcGVuZCgpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS5nYW1lLnN1c3BlbmQoKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc1N1YnNjcmliZWRUb0Fzc2V0cykge1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmdhbWVEZXZpY2UuYXNzZXRzLCBmdW5jdGlvbihhc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldC5uYW1lID09PSAnc2VuZGluZ2RhdGEnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0Lm9uKCdzdGF0ZScsIGlzRW5hZ2VyQWN0aXZlU3RhdGVDaGFuZ2VIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5vbignc3RhdGUnLCBmdW5jdGlvbihzdGF0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZ2FtZS5wbGF5KGFzc2V0Lm5hbWUsIHN0YXRlLlZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpc1N1YnNjcmliZWRUb0Fzc2V0cyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRDb25uZWN0ZWREZXZpY2VJbmZvKCkge1xuXG4gICAgICAgICAgICB2YXIgZGV2aWNlSW5mbyA9IHtcbiAgICAgICAgICAgICAgICBvczogJycsXG4gICAgICAgICAgICAgICAgYnJvd3NlcjogJydcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkZXZpY2VJbmZvQXNzZXQgPSB2bS5nYW1lRGV2aWNlLmdldEFzc2V0KCdkZXZpY2VpbmZvYXNzZXQnKTtcblxuICAgICAgICAgICAgaWYgKGRldmljZUluZm9Bc3NldC5zdGF0ZSkge1xuXG4gICAgICAgICAgICAgICAgZGV2aWNlSW5mbyA9IGRldmljZUluZm9Bc3NldC5zdGF0ZS52YWx1ZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlSW5mbztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNpbXVsYXRlKGEsIHYpIHtcblxuICAgICAgICAgICAgdm0uZ2FtZS5wbGF5KGEsIHYpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRFcnJvcihtZXNzYWdlKSB7XG5cbiAgICAgICAgICAgIHZtLnN0YXR1cyA9ICdlcnJvcic7XG5cbiAgICAgICAgICAgIHZtLmVycm9yTWVzc2FnZSA9IG1lc3NhZ2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbG9hZCgpIHtcblxuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1c3BlbmQocykge1xuXG4gICAgICAgICAgICBpZiAocykge1xuXG4gICAgICAgICAgICAgICAgdm0uZ2FtZS5zdXNwZW5kKCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB2bS5nYW1lLnVuc3VzcGVuZCgpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0VuYWdlckFjdGl2ZVN0YXRlQ2hhbmdlSGFuZGxlcihzdGF0ZSkge1xuXG4gICAgICAgICAgICBpZiAoc3RhdGUuVmFsdWUgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5nYW1lLnN1c3BlbmQoKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZtLmdhbWUudW5zdXNwZW5kKCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xuXG4gICAgICAgICAgICB2bS5nYW1lLnN0YXJ0KCk7XG5cbiAgICAgICAgICAgIHZtLnN0YXR1cyA9ICdwbGF5aW5nJztcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzZXRHYW1lKCkge1xuXG4gICAgICAgICAgICB2bS5nYW1lLnJlc2V0KCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRpc2Nvbm5lY3REZXZpY2UoKSB7XG5cbiAgICAgICAgICAgIHZhciBjb250cm9sQXNzZXQgPSB2bS5nYW1lRGV2aWNlLmdldEFzc2V0KCdjb250cm9sYXNzZXQnKTtcblxuICAgICAgICAgICAgY29udHJvbEFzc2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIFZhbHVlOiAnZGlzY29ubmVjdCdcbiAgICAgICAgICAgIH0pKTtcblxuICAgICAgICAgICAgdm0uc3RhdHVzID0gJ2F3YWl0aW5nJztcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTW9iaWxlQnJvd3NlckRldmljZUNvbnRyb2xsZXInLCBNb2JpbGVCcm93c2VyRGV2aWNlQ29udHJvbGxlcik7XG5cbiAgICBNb2JpbGVCcm93c2VyRGV2aWNlQ29udHJvbGxlci4kaW5qZWN0ID0gW1xuICAgICAgICAnZGV2aWNlLnJlcG9zaXRvcnknLFxuICAgICAgICAnYXNzZXQucmVwb3NpdG9yeScsXG4gICAgICAgICdkZW1vLnNlbnNvcnMnLFxuICAgICAgICAnZGVtby5jb25maWd1cmF0aW9uJyxcbiAgICAgICAgJyRsb2NhdGlvbicsXG4gICAgICAgICdtZXNzYWdpbmcuZ2F0ZXdheScsXG4gICAgICAgICd1dGlscydcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gTW9iaWxlQnJvd3NlckRldmljZUNvbnRyb2xsZXIoZGV2aWNlUmVwb3NpdG9yeSwgYXNzZXRSZXBvc2l0b3J5LCBzZW5zb3JzLCBnYW1lQ29uZmlndXJhdGlvbiwgJGxvY2F0aW9uLCBtZXNzYWdpbmdHYXRld2F5LCB1dGlscykge1xuXG4gICAgICAgIHZhciBkZXZpY2VJbmZvID0gdXRpbHMuZ2V0RGV2aWNlSW5mbygpO1xuXG4gICAgICAgIHZhciBkZXZpY2VOYW1lID0gJGxvY2F0aW9uLnNlYXJjaCgpLmRldmljZU5hbWU7XG4gICAgICAgIHZhciB0b2tlbiA9ICRsb2NhdGlvbi5zZWFyY2goKS50b2tlbjtcblxuICAgICAgICB2YXIgZGV2aWNlVGl0bGUgPSBkZXZpY2VJbmZvLm9zICsgJyAnICsgZGV2aWNlSW5mby5icm93c2VyO1xuXG4gICAgICAgIHZhciBkZXZpY2VEZXNjcmlwdGlvbiA9ICcjIFwiUXVpY2sgZGVtb1wiIGRldmljZVxcbic7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5nYW1lRGV2aWNlID0gbnVsbDtcbiAgICAgICAgdm0uc2hvd0xvZyA9IGZhbHNlO1xuICAgICAgICB2bS5sb2dzID0gW107XG4gICAgICAgIHZtLnN0YXR1cyA9ICdjb25uZWN0aW5nJztcbiAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgdm0uZGlzY29ubmVjdCA9IG51bGw7XG5cbiAgICAgICAgdm0ucmVsb2FkID0gcmVsb2FkO1xuICAgICAgICB2bS5yZXN0YXJ0ID0gcmVzdGFydEdhbWU7XG4gICAgICAgIHZtLnBsYXkgPSBwbGF5R2FtZTtcbiAgICAgICAgdm0udG9nZ2xlU2hvd0xvZyA9IHRvZ2dsZVNob3dMb2c7XG4gICAgICAgIHZtLmRldmljZUluZm8gPSBkZXZpY2VJbmZvO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuXG4gICAgICAgICAgICBpZiAoIXRva2VuIHx8ICFkZXZpY2VOYW1lKSB7XG4gICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LmVycm9yKCdHYW1lIEluaXRpYWxpemF0aW9uJywgJ0dhbWUgcGFyYW10ZXJlcyBhcmUgbWlzc2luZy4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghZGV2aWNlSW5mby5tb2JpbGUpIHtcbiAgICAgICAgICAgICAgICB2bS5zdGF0dXMgPSAnbm90bW9iaWxlJztcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbmZpZ3VyZVNlbnNvclByb2ZpbGVzKCk7XG5cbiAgICAgICAgICAgIGdldERldmljZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oaW5pdGlhbGl6ZURldmljZSlcbiAgICAgICAgICAgICAgICAudGhlbihjb25uZWN0KVxuICAgICAgICAgICAgICAgIC50aGVuKGluaXRpYWxpemVBc3NldHMpXG4gICAgICAgICAgICAgICAgLnRoZW4oc2V0dXBGb3JHYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVNlbnNvclByb2ZpbGVzKCkge1xuXG4gICAgICAgICAgICBpZiAoc2Vuc29ycy5zaGFrZS5pc1N1cHBvcnRlZCgpKSB7XG5cbiAgICAgICAgICAgICAgICBnYW1lQ29uZmlndXJhdGlvbi5hc3NldENvbmZpZ3VyYXRpb24uc2hha2UucHJvZmlsZS5zdXBwb3J0ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZW5zb3JzLnBvc2l0aW9uLmlzU3VwcG9ydGVkKCkpIHtcblxuICAgICAgICAgICAgICAgIGdhbWVDb25maWd1cmF0aW9uLmFzc2V0Q29uZmlndXJhdGlvbi5wb3NpdGlvbi5wcm9maWxlLnN1cHBvcnRlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbnNvcnMucm90YXRpb24uaXNTdXBwb3J0ZWQoKSkge1xuXG4gICAgICAgICAgICAgICAgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRDb25maWd1cmF0aW9uLnJvdGF0aW9uLnByb2ZpbGUuc3VwcG9ydGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBnYW1lQ29uZmlndXJhdGlvbi5hc3NldENvbmZpZ3VyYXRpb24udmlzaWJpbGl0eS5wcm9maWxlLnN1cHBvcnRlZCA9IHRydWU7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldERldmljZSgpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZVJlcG9zaXRvcnkuZmluZFNlbGZVc2luZ1RpY2tldCh0b2tlbikuY2F0Y2goZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBzZXRFcnJvcignRXJyb3IgY29udGFjdGluZyBzZXJ2ZXIsIHRyeSByZWxvYWRpbmcgdGhlIHBhZ2UuJyk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZURldmljZShkZXZpY2UpIHtcblxuICAgICAgICAgICAgdm0uZ2FtZURldmljZSA9IGRldmljZTtcblxuICAgICAgICAgICAgcmV0dXJuIHV0aWxzLiRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkZXZpY2UpO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbm5lY3QoZGV2aWNlKSB7XG5cbiAgICAgICAgICAgIHZhciBjbGllbnQgPSBkZXZpY2UuY2xpZW50O1xuXG4gICAgICAgICAgICBpZiAoIW1lc3NhZ2luZ0dhdGV3YXkuaXNDb25uZWN0ZWQpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdpbmdHYXRld2F5LmNvbm5lY3QoY2xpZW50LmNsaWVudElkLCBjbGllbnQuY2xpZW50U2VjcmV0KS5jYXRjaChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICBzZXRFcnJvcignTG9va3MgbGlrZSBzb21ldGhpbmcgd2VudCB3cm9uZyB3aGlsZSBjb25uZWN0aW5nIHRvIHRoZSBzZXJ2ZXIuIFRyeSByZWxvYWRpbmcgeW91ciBwYWdlLicpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHV0aWxzLiRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldERlc2NyaXB0aW9uKGRldmljZSkge1xuXG4gICAgICAgICAgICBkZXZpY2VEZXNjcmlwdGlvbiA9IGRldmljZURlc2NyaXB0aW9uLmZvcm1hdChkZXZpY2UuaWQpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlUmVwb3NpdG9yeS51cGRhdGVVc2luZ1Rva2VuKHtcbiAgICAgICAgICAgICAgICBpZDogdm0uZ2FtZURldmljZS5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBkZXZpY2VOYW1lLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXZpY2VEZXNjcmlwdGlvblxuICAgICAgICAgICAgfSwgdG9rZW4pLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZGV2aWNlO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVBc3NldHMoKSB7XG5cbiAgICAgICAgICAgIHZhciBnYW1lQXNzZXRzID0gZ2V0R2FtZUFzc2V0cygpO1xuXG4gICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQXNzZXRDcmVhdGVkKGNyZWF0ZWRBc3NldCkge1xuXG4gICAgICAgICAgICAgICAgdm0uZ2FtZURldmljZS5hc3NldHMucHVzaChjcmVhdGVkQXNzZXQpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWRBc3NldDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhbWVBc3NldHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIHZhciBhc3NldCA9IGdhbWVBc3NldHNbaV07XG4gICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nQXNzZXQgPSB2bS5nYW1lRGV2aWNlLmdldEFzc2V0KGFzc2V0Lm5hbWUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZ0Fzc2V0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYXNzZXQuZGV2aWNlSWQgPSB2bS5nYW1lRGV2aWNlLmlkO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldENyZWF0ZVByb21pc2UgPSBhc3NldFJlcG9zaXRvcnkuY3JlYXRlVXNpbmdUaWNrZXQodG9rZW4sIGFzc2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlQXNzZXRDcmVhdGVkKTtcblxuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGFzc2V0Q3JlYXRlUHJvbWlzZSk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1dGlscy4kcS5hbGwocHJvbWlzZXMpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRHYW1lQXNzZXRzKCkge1xuXG4gICAgICAgICAgICB2YXIgZ2FtZUFzc2V0cyA9IFtdO1xuXG4gICAgICAgICAgICBnYW1lQXNzZXRzLnB1c2goY3JlYXRlQXNzZXREZWZpbml0aW9uKCdhbWlzaGFraW5nJywgJ1NoYWtpbmcnLCAnc2Vuc29yJywgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRDb25maWd1cmF0aW9uLnNoYWtlLnByb2ZpbGUsIGdhbWVDb25maWd1cmF0aW9uLmFzc2V0Q29uZmlndXJhdGlvbi5zaGFrZS5jb250cm9sKSk7XG5cbiAgICAgICAgICAgIGdhbWVBc3NldHMucHVzaChjcmVhdGVBc3NldERlZmluaXRpb24oJ3Bvc2l0aW9uJywgJ1Bvc2l0aW9uJywgJ3NlbnNvcicsIGdhbWVDb25maWd1cmF0aW9uLmFzc2V0Q29uZmlndXJhdGlvbi5wb3NpdGlvbi5wcm9maWxlLCBnYW1lQ29uZmlndXJhdGlvbi5hc3NldENvbmZpZ3VyYXRpb24ucG9zaXRpb24uY29udHJvbCkpO1xuXG4gICAgICAgICAgICBnYW1lQXNzZXRzLnB1c2goY3JlYXRlQXNzZXREZWZpbml0aW9uKCdzZW5kaW5nZGF0YScsICdTZW5kaW5nIGRhdGEnLCAnc2Vuc29yJywgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRDb25maWd1cmF0aW9uLnZpc2liaWxpdHkucHJvZmlsZSwgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRDb25maWd1cmF0aW9uLnZpc2liaWxpdHkuY29udHJvbCkpO1xuXG4gICAgICAgICAgICBnYW1lQXNzZXRzLnB1c2goY3JlYXRlQXNzZXREZWZpbml0aW9uKCdyb3RhdGlvbicsICdSb3RhdGlvbicsICdzZW5zb3InLCBnYW1lQ29uZmlndXJhdGlvbi5hc3NldENvbmZpZ3VyYXRpb24ucm90YXRpb24ucHJvZmlsZSwgZ2FtZUNvbmZpZ3VyYXRpb24uYXNzZXRDb25maWd1cmF0aW9uLnJvdGF0aW9uLmNvbnRyb2wpKTtcblxuICAgICAgICAgICAgcmV0dXJuIGdhbWVBc3NldHM7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVBc3NldERlZmluaXRpb24obmFtZSwgdGl0bGUsIGlzLCBwcm9maWxlLCBjb250cm9sLCBzdHlsZSkge1xuXG4gICAgICAgICAgICB2YXIgYXNzZXRPYmplY3QgPSB7fTtcblxuICAgICAgICAgICAgaWYgKG5hbWUpIHtcblxuICAgICAgICAgICAgICAgIGFzc2V0T2JqZWN0Lm5hbWUgPSBuYW1lO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aXRsZSkge1xuXG4gICAgICAgICAgICAgICAgYXNzZXRPYmplY3QudGl0bGUgPSB0aXRsZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXMpIHtcblxuICAgICAgICAgICAgICAgIGFzc2V0T2JqZWN0LmlzID0gaXM7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgIGFzc2V0T2JqZWN0LnByb2ZpbGUgPSBwcm9maWxlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb250cm9sKSB7XG5cbiAgICAgICAgICAgICAgICBhc3NldE9iamVjdC5jb250cm9sID0gY29udHJvbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3R5bGUpIHtcblxuICAgICAgICAgICAgICAgIGFzc2V0T2JqZWN0LnN0eWxlID0gc3R5bGU7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0T2JqZWN0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlVG9IdG1sNVNlbnNvcnMoKSB7XG5cbiAgICAgICAgICAgIGlmIChzZW5zb3JzLnNoYWtlLmlzU3VwcG9ydGVkKCkpIHtcblxuICAgICAgICAgICAgICAgIHNlbnNvcnMuc2hha2Uuc3Vic2NyaWJlT25TaGFrZUNoYW5nZShmdW5jdGlvbihpc1NoYWtpbikge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaGFrZUFzc2V0ID0gdm0uZ2FtZURldmljZS5nZXRBc3NldCgnYW1pc2hha2luZycpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge307XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU2hha2luKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuVmFsdWUgPSAnc2hha2luZyc7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5WYWx1ZSA9ICdzdGlsbCc7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHNoYWtlQXNzZXQuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbG9nTWVzc2FnZShkYXRhLlZhbHVlKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2Vuc29ycy5wb3NpdGlvbi5pc1N1cHBvcnRlZCgpKSB7XG5cbiAgICAgICAgICAgICAgICBzZW5zb3JzLnBvc2l0aW9uLnN1YnNjcmliZU9uUG9zaXRpb25DaGFuZ2UoZnVuY3Rpb24ocG9zaXRpb24pIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb25Bc3NldCA9IHZtLmdhbWVEZXZpY2UuZ2V0QXNzZXQoJ3Bvc2l0aW9uJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5WYWx1ZSA9ICdvbnRhYmxlJztcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLlZhbHVlID0gJ25vdG9udGFibGUnO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbkFzc2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2UoZGF0YS5WYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNlbnNvcnMucm90YXRpb24uaXNTdXBwb3J0ZWQoKSkge1xuXG4gICAgICAgICAgICAgICAgc2Vuc29ycy5yb3RhdGlvbi5zdWJzY3JpYmVPblJvdGF0aW9uKGZ1bmN0aW9uKHJvdGF0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uQXNzZXQgPSB2bS5nYW1lRGV2aWNlLmdldEFzc2V0KCdyb3RhdGlvbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uQXNzZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZTogcm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGxvZ01lc3NhZ2Uocm90YXRpb24pO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbnNvcnMucGFnZVZpc2liaWxpdHkuc3Vic2NyaWJlT25QYWdlVmlzaWJpbGl0eShmdW5jdGlvbihtZXNzYWdlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdmlzaWJpbGl0eUFzc2V0ID0gdm0uZ2FtZURldmljZS5nZXRBc3NldCgnc2VuZGluZ2RhdGEnKTtcblxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eUFzc2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6IG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXR1cyA9ICdwbGF5aW5nJztcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmlzaWJpbGl0eUFzc2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWU6IG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXR1cEZvckdhbWUoKSB7XG5cbiAgICAgICAgICAgIHZtLnN0YXR1cyA9ICdyZWFkeSc7XG5cbiAgICAgICAgICAgIHBsYXlHYW1lKCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNlbmRJbml0aWFsU3RhdGVzQW5kU3Vic2NyaWJlKCkge1xuXG4gICAgICAgICAgICB2YXIgZGV2aWNlSW5mb0Fzc2V0ID0gdm0uZ2FtZURldmljZS5nZXRBc3NldCgnZGV2aWNlaW5mb2Fzc2V0Jyk7XG5cbiAgICAgICAgICAgIGRldmljZUluZm9Bc3NldC5zZW5kKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBWYWx1ZTogZGV2aWNlSW5mb1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzdGFydEdhbWUoKSB7XG5cbiAgICAgICAgICAgIHZhciBhY3Rpdml0eUFzc2V0ID0gdm0uZ2FtZURldmljZS5nZXRBc3NldCgnY29udHJvbGFzc2V0Jyk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIFZhbHVlOiAncmVzdGFydCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGFjdGl2aXR5QXNzZXQuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldEVycm9yKG1lc3NhZ2UpIHtcblxuICAgICAgICAgICAgdm0uc3RhdHVzID0gJ2Vycm9yJztcblxuICAgICAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gbWVzc2FnZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVsb2FkKCkge1xuXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB0b2dnbGVTaG93TG9nKCkge1xuXG4gICAgICAgICAgICB2bS5zaG93TG9nID0gIXZtLnNob3dMb2c7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHBsYXlHYW1lKCkge1xuXG4gICAgICAgICAgICBzdWJzY3JpYmVUb0h0bWw1U2Vuc29ycygpO1xuXG4gICAgICAgICAgICB2bS5zdGF0dXMgPSAncGxheWluZyc7XG5cbiAgICAgICAgICAgIHV0aWxzLiR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHZpc2liaWxpdHlBc3NldCA9IHZtLmdhbWVEZXZpY2UuZ2V0QXNzZXQoJ3NlbmRpbmdkYXRhJyk7XG5cbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5QXNzZXQuc2VuZChKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIFZhbHVlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgICB9LCA1MDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dNZXNzYWdlKG1lc3NhZ2UsIGRhdGEpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGV0aW1lID0gZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICB2bS5sb2dzLnB1c2goe1xuICAgICAgICAgICAgICAgIHRpbWU6IGRhdGV0aW1lLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRpbWUoKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50ZGF0ZSA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIHZhciBkYXRldGltZSA9IGN1cnJlbnRkYXRlLmdldERhdGUoKSArICcvJyArIChjdXJyZW50ZGF0ZS5nZXRNb250aCgpICsgMSkgKyAnLycgKyBjdXJyZW50ZGF0ZS5nZXRGdWxsWWVhcigpICsgJyBAICcgKyBjdXJyZW50ZGF0ZS5nZXRIb3VycygpICsgJzonICsgY3VycmVudGRhdGUuZ2V0TWludXRlcygpICsgJzonICsgY3VycmVudGRhdGUuZ2V0U2Vjb25kcygpICsgJyAnICsgY3VycmVudGRhdGUuZ2V0TWlsbGlzZWNvbmRzKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRldGltZTtcblxuICAgICAgICB9XG4gICAgfVxufSgpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3FyY29kZURldmljZUNvbnRyb2wnLCBxcmNvZGVEZXZpY2VDb250cm9sKTtcblxuICAgIGZ1bmN0aW9uIHFyY29kZURldmljZUNvbnRyb2woKSB7XG4gICAgICAgIC8vIFVzYWdlOlxuICAgICAgICAvL1xuICAgICAgICAvLyBDcmVhdGVzOlxuICAgICAgICAvL1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RlbW9fZGV2aWNlL3FyY29kZURldmljZUNvbnRyb2wuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGV2aWNlOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge31cbiAgICB9XG5cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbJ3Nlc3Npb24nLCAndXJsU2hvcnRlbmVyU2VydmljZScsICdvcmlnaW4nXTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoc2Vzc2lvbiwgdXJsU2hvcnRlbmVyU2VydmljZSwgb3JpZ2luKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdmFyIHNlc3Npb25EYXRhID0gc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpO1xuICAgICAgICB2YXIgZ2FtZVRva2VuID0gbnVsbDtcblxuICAgICAgICB2bS5xckNvZGVVcmwgPSAnJztcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cbiAgICAgICAgICAgIGlmIChzZXNzaW9uRGF0YS5pc0F1dGgpIHtcbiAgICAgICAgICAgICAgICBnYW1lVG9rZW4gPSBzZXNzaW9uRGF0YS5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2FtZVRva2VuID0gcHVibGljVG9rZW47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBsb25nVXJsID0gZ2V0UVJDb2RlVXJsKHZtLmRldmljZS5uYW1lLCBnYW1lVG9rZW4pO1xuICAgICAgICAgICAgdXJsU2hvcnRlbmVyU2VydmljZS5zaG9ydGVuVXJsKGxvbmdVcmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oc2hvcnRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucXJDb2RlVXJsID0gc2hvcnRVcmw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRRUkNvZGVVcmwoZGV2aWNlTmFtZSwgdG9rZW4pIHtcblxuICAgICAgICAgICAgcmV0dXJuICd7MH0vbW9iaWxlYnJvd3NlcmRldmljZT9kZXZpY2VOYW1lPXsxfSZ0b2tlbj17Mn0nLmZvcm1hdChvcmlnaW4sIGRldmljZU5hbWUsIHRva2VuKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdBc3NldENvbnRyb2xsZXInLCBBc3NldENvbnRyb2xsZXIpO1xuXG4gICAgQXNzZXRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGVQYXJhbXMnLCAnJHN0YXRlJywgJ3Nlc3Npb24nLCAndXRpbHMnLCAnbW9kZWwnXTtcblxuICAgIGZ1bmN0aW9uIEFzc2V0Q29udHJvbGxlcigkc2NvcGUsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCBzZXNzaW9uLCB1dGlscywgbW9kZWwpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm1vZGVsID0gbnVsbDtcbiAgICAgICAgdm0uZ29CYWNrID0gZ29CYWNrO1xuICAgICAgICB2bS5kZWxldGVBc3NldCA9IGRlbGV0ZUFzc2V0O1xuXG4gICAgICAgIHZtLmNsaWVudCA9IHtcbiAgICAgICAgICAgIGNsaWVudElkOiBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudElkLFxuICAgICAgICAgICAgY2xpZW50S2V5OiBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudEtleVxuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdm0ubW9kZWwgPSBtb2RlbDtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubW9kZWwuYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubW9kZWwuYXNzZXQudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdvQmFjaygpIHtcblxuICAgICAgICAgICAgaWYgKHZtLm1vZGVsLm9yaWdpbiA9PSAnRGV2aWNlJykge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5kZXZpY2UnLCB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB2bS5tb2RlbC5hc3NldC5kZXZpY2VJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZ2F0ZXdheScsIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHZtLm1vZGVsLmFzc2V0LmRldmljZUlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZWxldGVBc3NldCgpIHtcblxuICAgICAgICAgICAgdm0ubW9kZWwuZGVsZXRlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBnb0JhY2soKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnQXNzZXRWaWV3TW9kZWwnLCBmYWN0b3J5KTtcblxuICAgIGZhY3RvcnkuJGluamVjdCA9IFtcbiAgICAgICAgJ3V0aWxzJyxcbiAgICAgICAgJ2RldmljZS5yZXBvc2l0b3J5JyxcbiAgICAgICAgJ2Fzc2V0LnJlcG9zaXRvcnknLFxuICAgICAgICAnZ3JvdW5kLnJlcG9zaXRvcnknLFxuICAgICAgICAnZ2F0ZXdheS5yZXBvc2l0b3J5JyxcbiAgICAgICAgJ0hlYWRlckl0ZW1Nb2RlbCcsXG4gICAgICAgICdhcGkuY29udHJvbHNTZXJ2aWNlJyxcbiAgICAgICAgJ3JvbGVzLm1hbmFnZXInXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIGZhY3RvcnkodXRpbHMsIGRldmljZVJlcG9zaXRvcnksIGFzc2V0UmVwb3NpdG9yeSwgZ3JvdW5kUmVwb3NpdG9yeSwgZ2F0ZXdheVJlcG9zaXRvcnksIEhlYWRlckl0ZW1Nb2RlbCwgY3RybHNTZXJ2aWNlLCByb2xlc01hbmFnZXIpIHtcblxuICAgICAgICBmdW5jdGlvbiBBc3NldFZpZXdNb2RlbChhc3NldCwgcGFyZW50LCBvcmlnaW4sIGNvbnRyb2xzLCBncm91bmQpIHtcblxuICAgICAgICAgICAgdGhpcy5jb25maWdPcGVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChncm91bmQpIHtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdW5kSWQgPSBncm91bmQuaWQ7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmdyb3VuZCA9IGdyb3VuZDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmRyYXdlckFjdGl2ZVRhYiA9IDA7XG4gICAgICAgICAgICB0aGlzLmVkaXRvck9wdGlvbnMgPSB1dGlscy52aWV3Q29uZmlncy5nZXRKc29uRWRpdG9yT3B0aW9ucygpO1xuXG4gICAgICAgICAgICAvL1RlbXBvcmFyeSBzb2x1dGlvbiB0byBzaG93IEpTT04gZWRpdG9ycyBpbiByZWFkLW9ubHkgbW9kZS5cbiAgICAgICAgICAgIC8vRWFjaCBlZGl0b3IgKFN0YXRlLCBDb21tYW5kLCBQcm9maWxlKSBzaG91bGQgaGF2ZSBpdCdzIG93biBlZGl0b3IgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgLy9iZWNhdXNlIGl0IHdpbGwgYmUgcG9zc2libGUgdXNlcnMgbm90IHRvIGhhdmUgcGVybWlzc2lvbiB0byB1cGRhdGUgYXNzZXQgc3RhdGUsIGJ1dFxuICAgICAgICAgICAgLy9kbyBoYXZlIHBlcm1pc3Npb24gdG8gY2hhbmdlIHByb2ZpbGUuXG4gICAgICAgICAgICB0aGlzLmVkaXRvck9wdGlvbnMucmVhZE9ubHkgPSByb2xlc01hbmFnZXIuYXV0aG9yaXplKCdkZXZpY2UtYXNzZXQtc3RhdGUnKSA/IGZhbHNlIDogJ25vY3Vyc29yJztcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yUmVmcmVzaCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnB1Ymxpc2hDb21tYW5kSnNvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnB1Ymxpc2hGZWVkSnNvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmpzb25FZGl0b3JSZWZyZXNoID0gbnVsbDtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgYXNzZXQub24oJ3N0YXRlJywgZnVuY3Rpb24oc3RhdGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5oZWFkZXJNb2RlbC5yZXBsYWNlSW5mbygnc3RhdGUnLCBzdGF0ZURhdGEuVmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdChhc3NldCwgcGFyZW50LCBvcmlnaW4sIGNvbnRyb2xzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIEFzc2V0Vmlld01vZGVsLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oYXNzZXQsIHBhcmVudCwgb3JpZ2luLCBjb250cm9scykge1xuXG4gICAgICAgICAgICB0aGlzLmFzc2V0ID0gYXNzZXQ7XG5cbiAgICAgICAgICAgIHRoaXMubmV3QXNzZXRUaXRsZSA9IGFzc2V0LnRpdGxlO1xuXG4gICAgICAgICAgICB0aGlzLnByb2ZpbGVKc29uID0gSlNPTi5zdHJpbmdpZnkoYXNzZXQucHJvZmlsZSwgbnVsbCwgdGhpcy5lZGl0b3JPcHRpb25zLnRhYlNpemUpO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xKc29uID0gSlNPTi5zdHJpbmdpZnkoYXNzZXQuY29udHJvbCwgbnVsbCwgdGhpcy5lZGl0b3JPcHRpb25zLnRhYlNpemUpO1xuXG4gICAgICAgICAgICB0aGlzLmhlYWRlck1vZGVsID0gSGVhZGVySXRlbU1vZGVsLmZyb21Bc3NldChhc3NldCwgcGFyZW50LCBvcmlnaW4sIHRoaXMuZ3JvdW5kKTtcblxuICAgICAgICAgICAgdGhpcy5jb250cm9scyA9IGNvbnRyb2xzO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hc3NldC5jb250cm9sICYmIHRoaXMuYXNzZXQuY29udHJvbC5uYW1lKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xOYW1lID0gdGhpcy5hc3NldC5jb250cm9sLm5hbWU7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jb250cm9sID0gdGhpcy5nZXRDb250cm9sTGFiZWwoKTtcblxuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG5cbiAgICAgICAgICAgIHRoaXMub3JpZ2luID0gb3JpZ2luO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucHJvdG90eXBlLnRvZ2dsZUNvbmZpZyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoYXQuY29uZmlnT3BlbiA9ICF0aGF0LmNvbmZpZ09wZW47XG5cbiAgICAgICAgICAgIGlmICh0aGF0LmNvbmZpZ09wZW4pIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLiR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZWRpdG9yUmVmcmVzaCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdGhhdC5lZGl0b3JSZWZyZXNoID0gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldFZpZXdNb2RlbC5wcm90b3R5cGUuaXNDb25maWdPcGVuID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZ09wZW47XG5cbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldFZpZXdNb2RlbC5wcm90b3R5cGUuZ2V0Q29udHJvbExhYmVsID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBsYmwgPSAnU2VsZWN0IGNvbnRyb2wuLi4nO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hc3NldC5jb250cm9sICYmIHRoaXMuYXNzZXQuY29udHJvbC5uYW1lKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29udHJvbHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb250cm9sc1tpXS5uYW1lID09IHRoaXMuYXNzZXQuY29udHJvbC5uYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxibCA9IHRoaXMuY29udHJvbHNbaV0udGl0bGU7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGxibDtcbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldFZpZXdNb2RlbC5wcm90b3R5cGUucHVibGlzaEZlZWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICByZXR1cm4gdXRpbHMudHJ5UGFyc2VKU09OKHRoYXQucHVibGlzaEZlZWRKc29uKVxuICAgICAgICAgICAgICAgIC50aGVuKHBhcnNlU3VjY2Vzc0hhbmRsZXIsIHBhcnNlRmFpbEhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYXJzZVN1Y2Nlc3NIYW5kbGVyKG9iaikge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzc2V0UmVwb3NpdG9yeS5wdWJsaXNoU3RhdGUodGhhdC5hc3NldC5pZCwgb2JqKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3M6ICcsICdBc3NldCBmZWVkIGhhcyBiZWVuIHB1Ymxpc2hlZC4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VGYWlsSGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS5lcnJvcignSlNPTjogJywgJ0pTT04gbm90IHZhbGlkLicpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucHJvdG90eXBlLnB1Ymxpc2hDb21tYW5kID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgcmV0dXJuIHV0aWxzLnRyeVBhcnNlSlNPTih0aGF0LnB1Ymxpc2hDb21tYW5kSnNvbilcbiAgICAgICAgICAgICAgICAudGhlbihwYXJzZVN1Y2Nlc3NIYW5kbGVyLCBwYXJzZUZhaWxIYW5kbGVyKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VTdWNjZXNzSGFuZGxlcihvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRSZXBvc2l0b3J5LnB1Ymxpc2hDb21tYW5kKHRoYXQuYXNzZXQuaWQsIG9iailcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlRmFpbEhhbmRsZXIoKSB7XG5cbiAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuZXJyb3IoJ0pTT046ICcsICdKU09OIG5vdCB2YWxpZC4nKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIEFzc2V0Vmlld01vZGVsLnByb3RvdHlwZS5yZXBsYWNlUHJvZmlsZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJldHVybiB1dGlscy50cnlQYXJzZUpTT04odGhhdC5wcm9maWxlSnNvbilcbiAgICAgICAgICAgICAgICAudGhlbihwYXJzZVN1Y2Nlc3NIYW5kbGVyLCBwYXJzZUZhaWxIYW5kbGVyKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VTdWNjZXNzSGFuZGxlcihvYmopIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBhc3NldFJlcG9zaXRvcnkucmVwbGFjZVByb2ZpbGUodGhhdC5hc3NldC5kZXZpY2VJZCwgdGhhdC5hc3NldC5uYW1lLCBvYmopXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2VzczogJywgJ0Fzc2V0IHByb2ZpbGUgaGFzIGJlZW4gcmVwbGFjZWQuJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0UmVwb3NpdG9yeS5maW5kKHRoYXQuYXNzZXQuaWQpLnRoZW4oZnVuY3Rpb24oYXNzZXQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3NldDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihhc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybHNTZXJ2aWNlLmdldENvbnRyb2xzRm9yQXNzZXQodGhhdC5hc3NldC5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY29udHJvbHMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5pbml0KGFzc2V0LCB0aGF0LnBhcmVudCwgdGhhdC5vcmlnaW4sIGNvbnRyb2xzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcGFyc2VGYWlsSGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS5lcnJvcignSlNPTjogJywgJ0pTT04gbm90IHZhbGlkLicpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucHJvdG90eXBlLnJlcGxhY2VDb250cm9sID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgcmV0dXJuIHV0aWxzLnRyeVBhcnNlSlNPTih0aGF0LmNvbnRyb2xKc29uKVxuICAgICAgICAgICAgICAgIC50aGVuKHBhcnNlU3VjY2Vzc0hhbmRsZXIsIHBhcnNlRmFpbEhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYXJzZVN1Y2Nlc3NIYW5kbGVyKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBhc3NldFJlcG9zaXRvcnkucmVwbGFjZUNvbnRyb2wodGhhdC5hc3NldC5kZXZpY2VJZCwgdGhhdC5hc3NldC5uYW1lLCBvYmopXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2VzczogJywgJ0Fzc2V0IGNvbnRyb2wgaGFzIGJlZW4gcmVwbGFjZWQuJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0UmVwb3NpdG9yeS5maW5kKHRoYXQuYXNzZXQuaWQpLnRoZW4oZnVuY3Rpb24oYXNzZXQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaW5pdChhc3NldCwgdGhhdC5wYXJlbnQsIHRoYXQub3JpZ2luLCB0aGF0LmNvbnRyb2xzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwYXJzZUZhaWxIYW5kbGVyKCkge1xuXG4gICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LmVycm9yKCdKU09OOiAnLCAnSlNPTiBub3QgdmFsaWQuJyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldFZpZXdNb2RlbC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBhc3NldFJlcG9zaXRvcnkucmVtb3ZlKHRoaXMuYXNzZXQuZGV2aWNlSWQsIHRoaXMuYXNzZXQubmFtZSkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS5zdWNjZXNzKCdTdWNjZXNzOiAnLCAnQXNzZXQgaXMgZGVsZXRlZC4nKTtcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJldHVybiBhc3NldFJlcG9zaXRvcnkudXBkYXRlKHRoYXQuYXNzZXQuZGV2aWNlSWQsIHRoYXQuYXNzZXQuaWQsIHRoYXQuYXNzZXQubmFtZSwgdGhhdC5hc3NldC5pcywgdGhhdC5uZXdBc3NldFRpdGxlKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGEpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmFzc2V0LnRpdGxlID0gYS50aXRsZTtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2VzczogJywgJ0Fzc2V0IGlzIHVwZGF0ZWQnKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmhlYWRlck1vZGVsLnVwZGF0ZSh0aGF0LmFzc2V0LnRpdGxlKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEFzc2V0Vmlld01vZGVsLnByb3RvdHlwZS5zZXRDb250cm9sID0gZnVuY3Rpb24oaXRlbSkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBhc3NldENvbnRyb2wgPSB0aGF0LmFzc2V0LmNvbnRyb2w7XG5cbiAgICAgICAgICAgIGlmICghYXNzZXRDb250cm9sKSB7XG5cbiAgICAgICAgICAgICAgICBhc3NldENvbnRyb2wgPSB7fTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhc3NldENvbnRyb2wubmFtZSA9IGl0ZW0ubmFtZTtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0UmVwb3NpdG9yeS5yZXBsYWNlQ29udHJvbCh0aGF0LmFzc2V0LmRldmljZUlkLCB0aGF0LmFzc2V0Lm5hbWUsIGFzc2V0Q29udHJvbClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmluaXQodGhhdC5hc3NldCwgdGhhdC5wYXJlbnQsIHRoYXQub3JpZ2luLCB0aGF0LmNvbnRyb2xzKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucHJvdG90eXBlLnJlZnJlc2hFZGl0b3JzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhhdC5lZGl0b3JSZWZyZXNoID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHV0aWxzLiR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdGhhdC5lZGl0b3JSZWZyZXNoID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygpO1xuXG4gICAgICAgICAgICB9LCAxMDApO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRWaWV3TW9kZWwucmVzb2x2ZSA9IGZ1bmN0aW9uKGFzc2V0SWQpIHtcblxuICAgICAgICAgICAgdmFyIGZvdW5kQXNzZXQgPSBudWxsO1xuICAgICAgICAgICAgdmFyIGZvdW5kUGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBmb3VuZENvbnRyb2xzID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBmb3VuZE9yaWdpbiA9IG51bGw7XG4gICAgICAgICAgICB2YXIgZm91bmRHcm91bmQgPSBudWxsO1xuXG4gICAgICAgICAgICByZXR1cm4gZ2V0QXNzZXQoYXNzZXRJZClcbiAgICAgICAgICAgICAgICAudGhlbihnZXRQYXJlbnQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZ2V0R3JvdW5kKVxuICAgICAgICAgICAgICAgIC50aGVuKGdldENvbnRyb2xzKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFzc2V0Vmlld01vZGVsKGZvdW5kQXNzZXQsIGZvdW5kUGFyZW50LCBmb3VuZE9yaWdpbiwgZm91bmRDb250cm9scywgZm91bmRHcm91bmQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRBc3NldChhc3NldElkKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRSZXBvc2l0b3J5LmZpbmQoYXNzZXRJZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oYXNzZXQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRBc3NldCA9IGFzc2V0O1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQYXJlbnQoKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmluZERldmljZShmb3VuZEFzc2V0LmRldmljZUlkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihudWxsLCBmaW5kR2F0ZXdheSk7XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kRGV2aWNlKGRldmljZUlkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZVJlcG9zaXRvcnkuZmluZChmb3VuZEFzc2V0LmRldmljZUlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRPcmlnaW4gPSAnRGV2aWNlJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZFBhcmVudCA9IGRldmljZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBmaW5kR2F0ZXdheShyZWplY3QpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2F0ZXdheVJlcG9zaXRvcnkuZmluZChmb3VuZEFzc2V0LmRldmljZUlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZ2F0ZXdheSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhdGV3YXkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE9yaWdpbiA9ICdHYXRld2F5JztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZFBhcmVudCA9IGdhdGV3YXk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2F0ZXdheTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRDb250cm9scygpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBjdHJsc1NlcnZpY2UuZ2V0Q29udHJvbHNGb3JBc3NldChmb3VuZEFzc2V0LmlkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb250cm9scykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZENvbnRyb2xzID0gY29udHJvbHM7XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEdyb3VuZChkZXZpY2UpIHtcblxuICAgICAgICAgICAgICAgIGlmIChkZXZpY2UuZ3JvdW5kSWQpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ3JvdW5kUmVwb3NpdG9yeS5maW5kKGRldmljZS5ncm91bmRJZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGdyb3VuZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRHcm91bmQgPSBncm91bmQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ3JvdW5kO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB1dGlscy4kcS53aGVuKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gQXNzZXRWaWV3TW9kZWw7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0RldmljZUNvbnRyb2xsZXInLCBEZXZpY2VDb250cm9sbGVyKTtcblxuICAgIERldmljZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICckc3RhdGUnLFxuICAgICAgICAnJHN0YXRlUGFyYW1zJyxcbiAgICAgICAgJyRtb2RhbCcsXG4gICAgICAgICdzZXNzaW9uJyxcbiAgICAgICAgJ3V0aWxzJyxcbiAgICAgICAgJ21vZGVsJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBEZXZpY2VDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICRtb2RhbCwgc2Vzc2lvbiwgdXRpbHMsIG1vZGVsKSB7XG5cbiAgICAgICAgdmFyIFBSRUZFUkVOQ0VfQ09OVFJPTF9LRVkgPSAnZGV2aWNlX3RhYic7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5tb2RlbCA9IG51bGw7XG4gICAgICAgIHZtLmdvVG9Bc3NldCA9IGdvVG9Bc3NldDtcbiAgICAgICAgdm0ub3BlbkRlbGV0ZURldmljZU1vZGFsID0gb3BlbkRlbGV0ZURldmljZU1vZGFsO1xuICAgICAgICB2bS5zZXRDb250cm9sID0gc2V0Q29udHJvbDtcbiAgICAgICAgdm0ucXJDb250cm9sID0gJ2Vucm9sbC1kZW1vJztcblxuICAgICAgICB2bS5tb2RhbFN0YXR1cyA9IHV0aWxzLnByZWZlcmVuY2VzLnJlYWRHbG9iYWwoJ0RlbGV0ZURldmljZU1vZGFsU3RhdHVzJyk7XG5cbiAgICAgICAgLy9UT0RPOiByZWZhY3RvciB0byAkcm9vdFxuICAgICAgICB2bS5jbGllbnQgPSB7XG4gICAgICAgICAgICBjbGllbnRJZDogc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRJZCxcbiAgICAgICAgICAgIGNsaWVudEtleTogc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRLZXlcbiAgICAgICAgfTtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdm0ubW9kZWwgPSBtb2RlbDtcblxuICAgICAgICAgICAgdmFyIGNvbnRyb2xUb1Nob3cgPSBnZXRDb250cm9sVG9TaG93KCk7XG5cbiAgICAgICAgICAgIGlmIChjb250cm9sVG9TaG93ID09PSAnZGV2aWNlLWNvbnRyb2wnICYmICghdm0ubW9kZWwuZGV2aWNlLmNvbnRyb2wgfHwgIXZtLm1vZGVsLmRldmljZS5jb250cm9sLm5hbWUpKSB7XG5cbiAgICAgICAgICAgICAgICBjb250cm9sVG9TaG93ID0gJ2RldmljZS1jb250cm9sJztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2bS5tb2RlbC5zZXRDb250cm9sKGNvbnRyb2xUb1Nob3cpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHZtLm1vZGVsLmRldmljZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLm1vZGVsLmRldmljZS51bnN1YnNjcmliZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ubW9kZWwuZGV2aWNlLmFzc2V0cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5tb2RlbC5kZXZpY2UuYXNzZXRzW2ldLnVuc3Vic2NyaWJlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29udHJvbFRvU2hvdygpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmF1bHRDb250cm9sID0gJ2Fzc2V0LWNvbnRyb2xzJztcblxuICAgICAgICAgICAgdmFyIHN1cHBvcnRlZENvbnRyb2xzID0gWydhc3NldC1jb250cm9scycsICdhc3NldC1saXN0JywgJ2FjdGl2aXR5JywgJ2RldmljZS1jb250cm9sJ107XG5cbiAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuYXNzZXRDdHJsICYmIHN1cHBvcnRlZENvbnRyb2xzLmluZGV4T2YoJHN0YXRlUGFyYW1zLmFzc2V0Q3RybCkgPj0gMCkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5hc3NldEN0cmw7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXNlclByZWYgPSB1dGlscy5wcmVmZXJlbmNlcy5yZWFkUGFnZShQUkVGRVJFTkNFX0NPTlRST0xfS0VZKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdXBwb3J0ZWRDb250cm9scy5pbmRleE9mKHVzZXJQcmVmKSA+PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJQcmVmO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGVmYXVsdENvbnRyb2w7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRDb250cm9sKGN0cmwpIHtcblxuICAgICAgICAgICAgdm0ubW9kZWwuc2V0Q29udHJvbChjdHJsKTtcblxuICAgICAgICAgICAgdXRpbHMucHJlZmVyZW5jZXMucmVtZW1iZXJQYWdlKFBSRUZFUkVOQ0VfQ09OVFJPTF9LRVksIGN0cmwpO1xuXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZGV2aWNlT3B0Jywge1xuICAgICAgICAgICAgICAgIGlkOiB2bS5tb2RlbC5kZXZpY2UuaWQsXG4gICAgICAgICAgICAgICAgYXNzZXRDdHJsOiBjdHJsXG5cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBub3RpZnk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJlbG9hZDogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29Ub0Fzc2V0KGFzc2V0SWQpIHtcblxuICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmFzc2V0Jywge1xuICAgICAgICAgICAgICAgIGlkOiBhc3NldElkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlbkRlbGV0ZURldmljZU1vZGFsKCkge1xuXG4gICAgICAgICAgICBpZiAodm0ubW9kYWxTdGF0dXMgIT09ICd0cnVlJykge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvbW9kYWxzL2NvbmZpcm1faXRlbV9kZWxldGUvdmlldy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21vZGFscy5jb25maXJtSXRlbURlbGV0ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZtLm1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZtLm1vZGVsLmRlbGV0ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlbC5oYXNPd25Qcm9wZXJ0eSgnZGV2aWNlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5ncm91bmREZXZpY2VzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2bS5tb2RlbC5ncm91bmRJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0ubW9kZWwuaGFzT3duUHJvcGVydHkoJ2dhdGV3YXknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmdyb3VuZEdhdGV3YXlzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2bS5tb2RlbC5ncm91bmRJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0RldmljZVZpZXdNb2RlbCcsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gW1xuICAgICAgICAndXRpbHMnLFxuICAgICAgICAnQ3JlYXRlQXNzZXRNb2RlbCcsXG4gICAgICAgICdFZGl0RGV2aWNlTW9kZWwnLFxuICAgICAgICAnZGV2aWNlLnJlcG9zaXRvcnknLFxuICAgICAgICAnYXNzZXQucmVwb3NpdG9yeScsXG4gICAgICAgICdIZWFkZXJJdGVtTW9kZWwnLFxuICAgICAgICAncm9sZXMubWFuYWdlcicsXG4gICAgICAgICdhcGkucnVsZXNTZXJ2aWNlJyxcbiAgICAgICAgJ3V0aWxpdHkuY29tbW9uJyxcbiAgICAgICAgJ3Nlc3Npb24nLFxuICAgICAgICAnY29udHJvbHMucmVwb3NpdG9yeScsXG4gICAgICAgICdGaXJzdEFwcERpY3Rpb25hcnknXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIGZhY3RvcnkodXRpbHMsIENyZWF0ZUFzc2V0TW9kZWwsIEVkaXREZXZpY2VNb2RlbCwgZGV2aWNlUmVwb3NpdG9yeSwgYXNzZXRSZXBvc2l0b3J5LCBIZWFkZXJJdGVtTW9kZWwsIHJvbGVzTWFuYWdlciwgcnVsZXNTZXJ2aWNlLCBjb21tb24sIHNlc3Npb24sIGNvbnRyb2xzUmVwb3NpdG9yeSwgRmlyc3RBcHBEaWN0aW9uYXJ5KSB7XG5cbiAgICAgICAgZnVuY3Rpb24gRGV2aWNlVmlld01vZGVsKGRldmljZSwgZ3JvdW5kSWQpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGF0LnNldHRpbmdzID0ge307XG5cbiAgICAgICAgICAgIHRoYXQuc2VsZWN0ZWRDb250cm9sID0gbnVsbDtcblxuICAgICAgICAgICAgdGhhdC5jbGllbnQgPSB7XG4gICAgICAgICAgICAgICAgY2xpZW50SWQ6IHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5ybXEuY2xpZW50SWQsXG4gICAgICAgICAgICAgICAgY2xpZW50S2V5OiBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudEtleVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhhdC5pc09wZW4gPSBudWxsO1xuXG4gICAgICAgICAgICB0aGF0LmNvbmZpZ09wZW4gPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhhdC5ndWlkZU9wZW4gPSBmYWxzZTtcblxuICAgICAgICAgICAgdGhhdC5ncm91bmRJZCA9IGdyb3VuZElkO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvck9wdGlvbnMgPSB1dGlscy52aWV3Q29uZmlncy5nZXRKc29uRWRpdG9yT3B0aW9ucygpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvck9wdGlvbnMucmVhZE9ubHkgPSByb2xlc01hbmFnZXIuYXV0aG9yaXplKCdkZXZpY2UtY29udHJvbC1zYXZlJywge1xuICAgICAgICAgICAgICAgIGdyb3VuZElkOiBncm91bmRJZFxuICAgICAgICAgICAgfSkgPyBmYWxzZSA6ICdub2N1cnNvcic7XG5cbiAgICAgICAgICAgIHRoYXQuYWN0aXZlQ29udHJvbCA9ICdjb250cm9scyc7XG5cbiAgICAgICAgICAgIHRoYXQuY3JlYXRlQXNzZXREaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0cnkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGlzRmlsZVNhdmVyU3VwcG9ydGVkID0gISFuZXcgQmxvYjtcblxuICAgICAgICAgICAgICAgIHRoYXQuaXNEb3dubG9hZFN1cHBvcnRlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgICAgICAgICAgIHRoYXQuaXNEb3dubG9hZFN1cHBvcnRlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoYXQuaW5pdChkZXZpY2UpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvck9wdGlvbnMgPSB1dGlscy52aWV3Q29uZmlncy5nZXRKc29uRWRpdG9yT3B0aW9ucygpO1xuICAgICAgICAgICAgdGhhdC5lZGl0b3JNb2RlbCA9ICcnO1xuICAgICAgICAgICAgdGhhdC5zdGVwc1VybCA9IGdldFN0ZXBzVXJsKGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgdmFyIGRpY3Rpb25hcnkgPSBuZXcgRmlyc3RBcHBEaWN0aW9uYXJ5KCk7XG5cbiAgICAgICAgICAgIHRoYXQuZWRpdG9yTW9kZWwgPSBkaWN0aW9uYXJ5LmdlbmVyYXRlU2NyaXB0KGRldmljZSwgeyBpZDogZGV2aWNlLmlkLCBjbGllbnRJZDogdGhhdC5jbGllbnQuY2xpZW50SWQsIGNsaWVudEtleTogdGhhdC5jbGllbnQuY2xpZW50S2V5IH0pO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXRvclJlZnJlc2ggPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKGRldmljZSkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoYXQuZGV2aWNlID0gZGV2aWNlO1xuXG4gICAgICAgICAgICB0aGF0LmFzc2V0TW9kZWwgPSBuZXcgQ3JlYXRlQXNzZXRNb2RlbCgpO1xuXG4gICAgICAgICAgICB0aGF0LmVkaXREZXZpY2VNb2RlbCA9IG5ldyBFZGl0RGV2aWNlTW9kZWwoZGV2aWNlLm5hbWUsIGRldmljZS5kZXNjcmlwdGlvbiwgZGV2aWNlLnRpdGxlKTtcblxuICAgICAgICAgICAgdGhhdC5lZGl0b3JDb250cm9sID0gSlNPTi5zdHJpbmdpZnkoZGV2aWNlLmNvbnRyb2wsIG51bGwsIHRoYXQuZWRpdG9yT3B0aW9ucy50YWJTaXplKTtcblxuICAgICAgICAgICAgaWYgKGRldmljZS50eXBlID09PSAnaW50ZWwtZWRpc29uJykge1xuXG4gICAgICAgICAgICAgICAgLy9mb3IgRWRpc29uIGRldmljZSAnY3JlZGVudGlhbHMuanNvbidcbiAgICAgICAgICAgICAgICBzZXR1cEludGVsRWRpc29uQ3JlZGVudGlhbHNGaWxlKHRoYXQsIHRoYXQuZGV2aWNlLCB0aGF0LmNsaWVudCk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZS50eXBlID09PSAncHJveGltdXMtbG9yYScpIHtcblxuICAgICAgICAgICAgICAgIC8vZm9yIExvUmEgZGV2aWNlICdrZXlzLmgnXG4gICAgICAgICAgICAgICAgdmFyIGtleXNGaWxlSXNSZWFkeSA9IHNldHVwUHJveGltdXNMb3JhS2V5c0ZpbGUodGhhdCwgdGhhdC5kZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFrZXlzRmlsZUlzUmVhZHkpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzRG93bmxvYWRTdXBwb3J0ZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcnVsZXNTZXJ2aWNlLmdldERldmljZVJ1bGVzQ291bnQoZGV2aWNlLmlkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5kZXZpY2UuaGFzUnVsZXMgPSByZXNwb25zZS5kYXRhLmhhc1J1bGVzO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZGV2aWNlLmhhc05vdGlmaWNhdGlvblJ1bGVzID0gcmVzcG9uc2UuZGF0YS5oYXNOb3RpZmljYXRpb25SdWxlcztcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmhlYWRlck1vZGVsID0gSGVhZGVySXRlbU1vZGVsLmZyb21EZXZpY2UoZGV2aWNlKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChkZXZpY2VSZXBvc2l0b3J5LmdldERldmljZVNldHRpbmdzKGRldmljZS5pZCkpO1xuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChjb250cm9sc1JlcG9zaXRvcnkuZmluZEFsbERldmljZUNvbnRyb2xzKCkpO1xuXG4gICAgICAgICAgICB1dGlscy4kcS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0cykge1xuXG4gICAgICAgICAgICAgICAgdGhhdC5zZXR0aW5ncyA9IHJlc3VsdHNbMF07XG5cbiAgICAgICAgICAgICAgICB0aGF0LmNvbnRyb2xzID0gcmVzdWx0c1sxXTtcblxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGF0LmNvbnRyb2xzLCBmdW5jdGlvbihjb250cm9sKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyb2wubmFtZSA9PT0gdGhhdC5zZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc2VsZWN0ZWRDb250cm9sID0gY29udHJvbDtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUuZG93bmxvYWRLZXlzRmlsZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFt0aGlzLmtleXNUZXh0XSwge1xuXG4gICAgICAgICAgICAgICAgdHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCdcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNhdmVBcyhibG9iLCAna2V5cy5oJyk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucHJvdG90eXBlLmRvd25sb2FkQ3JlZGVudGlhbHNGaWxlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW3RoaXMuY3JlZGVudGlhbHNKc29uVGV4dF0sIHtcblxuICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTgnXG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzYXZlQXMoYmxvYiwgJ2NyZWRlbnRpYWxzLmpzb24nKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUudG9nZ2xlQ29uZmlnID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuY29uZmlnT3BlbiA9ICF0aGlzLmNvbmZpZ09wZW47XG5cbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucHJvdG90eXBlLnRvZ2dsZUd1aWRlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZ3VpZGVPcGVuID0gIXRoaXMuZ3VpZGVPcGVuO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlVmlld01vZGVsLnByb3RvdHlwZS5pc0NvbmZpZ09wZW4gPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnT3BlbjtcblxuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUuc2V0Q29udHJvbCA9IGZ1bmN0aW9uKGNvbnRyb2wpIHtcblxuICAgICAgICAgICAgdGhpcy5hY3RpdmVDb250cm9sID0gY29udHJvbDtcbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucHJvdG90eXBlLmNyZWF0ZUFzc2V0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhhdC5jcmVhdGVBc3NldERpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0UmVwb3NpdG9yeS5jcmVhdGUodGhhdC5kZXZpY2UuaWQsIHV0aWxzLm5vcm1hbGl6ZUFzc2V0TmFtZSh0aGF0LmFzc2V0TW9kZWwubmFtZSksIHRoYXQuYXNzZXRNb2RlbC5uYW1lLCB0aGF0LmFzc2V0TW9kZWwudHlwZSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihhc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbW1vbi5tYXJrTmV3KHRoYXQuZGV2aWNlLmFzc2V0cywgW2Fzc2V0XSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3M6ICcsICdBc3NldCBpcyBjcmVhdGVkLicpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZGV2aWNlLmFzc2V0cy5wdXNoKGFzc2V0KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmFzc2V0TW9kZWwubmFtZSA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaXNPcGVuID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuY3JlYXRlQXNzZXREaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlVmlld01vZGVsLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZVJlcG9zaXRvcnkucmVtb3ZlKHRoaXMuZGV2aWNlLmlkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3M6ICcsICdEZXZpY2UgaXMgZGVsZXRlZC4nKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUudXBkYXRlQ29udHJvbCA9IGZ1bmN0aW9uKGN0cmwpIHtcblxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jb250cm9sID0gY3RybC5uYW1lO1xuXG4gICAgICAgICAgICBkZXZpY2VSZXBvc2l0b3J5LnNhdmVEZXZpY2VTZXR0aW5ncyh0aGlzLmRldmljZS5pZCwgdGhpcy5zZXR0aW5ncyk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZVRpdGxlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZVJlcG9zaXRvcnkudXBkYXRlKHRoYXQuZGV2aWNlLmlkLCB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoYXQuZGV2aWNlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGF0LmVkaXREZXZpY2VNb2RlbC50aXRsZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZGV2aWNlLnRpdGxlID0gZC50aXRsZTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmRldmljZS5kZXNjcmlwdGlvbiA9IGQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3M6ICcsICdEZXZpY2UgVXBkYXRlZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwudXBkYXRlKHRoYXQuZGV2aWNlLnRpdGxlLCB0aGF0LmRldmljZS5kZXNjcmlwdGlvbik7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZURlc2NyaXB0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdGhhdC5lZGl0RGV2aWNlTW9kZWwuc2F2ZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlUmVwb3NpdG9yeS51cGRhdGUodGhhdC5kZXZpY2UuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhhdC5kZXZpY2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHRoYXQuZWRpdERldmljZU1vZGVsLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5kZXZpY2UubmFtZSA9IGQubmFtZTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmRldmljZS5kZXNjcmlwdGlvbiA9IGQuZGVzY3JpcHRpb247XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5LnN1Y2Nlc3MoJ1N1Y2Nlc3M6ICcsICdEZXZpY2UgVXBkYXRlZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwudXBkYXRlKHRoYXQuZGV2aWNlLm5hbWUsIHRoYXQuZGV2aWNlLmRlc2NyaXB0aW9uKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlVmlld01vZGVsLnByb3RvdHlwZS5lbmFibGVBY3Rpdml0eSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VSZXBvc2l0b3J5LnVwZGF0ZSh0aGF0LmRldmljZS5pZCwge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoYXQuZGV2aWNlLm5hbWUsXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbmFibGVkOiB0cnVlXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2VzczogJywgJ0FjdGl2aXR5IExvZyBlbmFibGVkLicpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5kZXZpY2UuYWN0aXZpdHlFbmFibGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlVmlld01vZGVsLnByb3RvdHlwZS5kaXNhYmxlQWN0aXZpdHkgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlUmVwb3NpdG9yeS51cGRhdGUodGhhdC5kZXZpY2UuaWQsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGF0LmRldmljZS5uYW1lLFxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RW5hYmxlZDogZmFsc2VcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS5zdWNjZXNzKCdTdWNjZXNzOiAnLCAnQWN0aXZpdHkgTG9nIGRpc2FibGVkLicpO1xuXG4gICAgICAgICAgICAgICAgdGhhdC5kZXZpY2UuYWN0aXZpdHlFbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZVZpZXdNb2RlbC5wcm90b3R5cGUuYWxsb3dBc3NldFR5cGVDcmVhdGlvbiA9IGZ1bmN0aW9uKGFzc2V0VHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgcGVybWlzc2lvbiA9IHRydWU7XG5cbiAgICAgICAgICAgIGlmICh0aGF0LmRldmljZS50eXBlID09PSAncHJveGltdXMtbG9yYScgJiYgYXNzZXRUeXBlID09PSAnYWN0dWF0b3InKSB7XG5cbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uID0gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb247XG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlVmlld01vZGVsLnByb3RvdHlwZS5kb3dubG9hZFNjcmlwdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBibG9iID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKHRoYXQuZGV2aWNlLnR5cGUgPT09ICdycGknKSB7XG5cbiAgICAgICAgICAgICAgICBibG9iID0gbmV3IEJsb2IoW3RoaXMuZWRpdG9yTW9kZWxdLCB7XG5cbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQvcGxhaW47Y2hhcnNldD11dGYtOCdcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2F2ZUFzKGJsb2IsICdmaXJzdF9hcHAucHknKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGF0LmRldmljZS50eXBlID09PSAnYXJkdWlubycpIHtcblxuICAgICAgICAgICAgICAgIGJsb2IgPSBuZXcgQmxvYihbdGhpcy5lZGl0b3JNb2RlbF0sIHtcblxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dC9wbGFpbidcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2F2ZUFzKGJsb2IsICdmaXJzdF9hcHAuaW5vJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhhdC5kZXZpY2UudHlwZSA9PT0gJ2ludGVsLWVkaXNvbicpIHtcblxuICAgICAgICAgICAgICAgIGJsb2IgPSBuZXcgQmxvYihbdGhpcy5lZGl0b3JNb2RlbF0sIHtcblxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dC9wbGFpbidcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2F2ZUFzKGJsb2IsICdtYWluLmpzJyk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VWaWV3TW9kZWwucmVzb2x2ZSA9IGZ1bmN0aW9uKGRldmljZUlkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VSZXBvc2l0b3J5LmZpbmQoZGV2aWNlSWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXdNb2RlbCA9IG5ldyBEZXZpY2VWaWV3TW9kZWwoZGV2aWNlLCBkZXZpY2UuZ3JvdW5kSWQpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3TW9kZWw7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBzZXR1cEludGVsRWRpc29uQ3JlZGVudGlhbHNGaWxlKG1vZGVsLCBkZXZpY2UsIGNsaWVudCkge1xuXG4gICAgICAgICAgICBtb2RlbC5jcmVkZW50aWFsc0pzb25UZXh0ID0gJ3tcXHJcXG4nICtcbiAgICAgICAgICAgICAgICAnICAgXCJkZXZpY2VJZFwiOiBcIicgKyBkZXZpY2UuaWQgKyAnXCIsXFxyXFxuJyArXG4gICAgICAgICAgICAgICAgJyAgIFwiY2xpZW50SWRcIjogXCInICsgY2xpZW50LmNsaWVudElkICsgJ1wiLFxcclxcbicgK1xuICAgICAgICAgICAgICAgICcgICBcImNsaWVudEtleVwiOiBcIicgKyBjbGllbnQuY2xpZW50S2V5ICsgJ1wiXFxyXFxuJyArXG4gICAgICAgICAgICAgICAgJ30nO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXR1cFByb3hpbXVzTG9yYUtleXNGaWxlKG1vZGVsLCBkZXZpY2UpIHtcblxuICAgICAgICAgICAgaWYgKGRldmljZS5tZXRhICYmIGRldmljZS5tZXRhLmtleXMgJiYgZGV2aWNlLm1ldGEua2V5cy5ERVZfQUREUiAmJiBkZXZpY2UubWV0YS5rZXlzLkFQUFNLRVkgJiYgZGV2aWNlLm1ldGEua2V5cy5OV0tTS0VZKSB7XG5cbiAgICAgICAgICAgICAgICBtb2RlbC5rZXlzVGV4dCA9ICcjaWZuZGVmIEtFWVNfaFxcclxcbicgK1xuICAgICAgICAgICAgICAgICAgICAnI2RlZmluZSBLRVlTX2hcXHJcXG5cXHJcXG4nICtcblxuICAgICAgICAgICAgICAgICAgICAndWludDhfdCBERVZfQUREUls0XSA9ICcgKyBkZXZpY2UubWV0YS5rZXlzLkRFVl9BRERSICsgJztcXHJcXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJ3VpbnQ4X3QgQVBQU0tFWVsxNl0gPSAnICsgZGV2aWNlLm1ldGEua2V5cy5BUFBTS0VZICsgJztcXHJcXG4nICtcbiAgICAgICAgICAgICAgICAgICAgJ3VpbnQ4X3QgTldLU0tFWVsxNl0gPSAnICsgZGV2aWNlLm1ldGEua2V5cy5OV0tTS0VZICsgJztcXHJcXG5cXHJcXG4nICtcblxuICAgICAgICAgICAgICAgICAgICAnI2VuZGlmJztcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgbW9kZWwua2V5c1RleHQgPSAnTG9va3MgbGlrZSBkYXRhIGZvciBrZXlzLmggZmlsZSBpcyBub3QgYXZhaWxhYmxlLic7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRTdGVwc1VybChkZXZpY2VUeXBlKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSAnL2Fzc2V0cy9qcy9hcHAvZGV2aWNlcy9zZXR1cC1zdGVwcy8nO1xuXG4gICAgICAgICAgICB1cmwgKz0gZGV2aWNlVHlwZSArICctc3RlcHMuaHRtbCc7XG5cbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gRGV2aWNlVmlld01vZGVsO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignRGV2aWNlc0NvbnRyb2xsZXInLCBEZXZpY2VzQ29udHJvbGxlcik7XG5cbiAgICBEZXZpY2VzQ29udHJvbGxlci4kaW5qZWN0ID0gW1xuICAgICAgICAnJHN0YXRlJyxcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICckbW9kYWwnLFxuICAgICAgICAnbW9kZWwnLFxuICAgICAgICAndXRpbHMnXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIERldmljZXNDb250cm9sbGVyKCRzdGF0ZSwgJHNjb3BlLCAkbW9kYWwsIG1vZGVsLCB1dGlscykge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdm0uY3JlYXRlRGV2aWNlID0gY3JlYXRlRGV2aWNlO1xuICAgICAgICB2bS5vcGVuRGVsZXRlRGV2aWNlTW9kYWwgPSBvcGVuRGVsZXRlRGV2aWNlTW9kYWw7XG5cbiAgICAgICAgdmFyIHN0YXR1cyA9IHV0aWxzLnByZWZlcmVuY2VzLnJlYWRHbG9iYWwoJ0RlbGV0ZURldmljZU1vZGFsU3RhdHVzJyk7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLm1vZGVsLmRldmljZXMsIGZ1bmN0aW9uKGRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBkZXZpY2UudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlRGV2aWNlKG5hbWUsIHR5cGUpIHtcblxuICAgICAgICAgICAgdm0ubW9kZWwuY3JlYXRlRGV2aWNlKG5hbWUsIHR5cGUpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmRldmljZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBkZXZpY2UuaWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuRGVsZXRlRGV2aWNlTW9kYWwoZGV2aWNlKSB7XG5cbiAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICd0cnVlJykge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvbW9kYWxzL2NvbmZpcm1faXRlbV9kZWxldGUvdmlldy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21vZGFscy5jb25maXJtSXRlbURlbGV0ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZtLm1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB2bS5tb2RlbC5kZWxldGUoZGV2aWNlLmRldmljZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0RldmljZUxpc3RWaWV3TW9kZWwnLCBEZXZpY2VMaXN0Vmlld01vZGVsRmFjdG9yeSk7XG5cbiAgICBEZXZpY2VMaXN0Vmlld01vZGVsRmFjdG9yeS4kaW5qZWN0ID0gW1xuICAgICAgICAnJHN0YXRlJyxcbiAgICAgICAgJ2RldmljZS5yZXBvc2l0b3J5JyxcbiAgICAgICAgJ3V0aWxzJyxcbiAgICAgICAgJ2RlbW8uY29uZmlndXJhdGlvbicsXG4gICAgICAgICdzbC5saXN0SGVhZGVyJyxcbiAgICAgICAgJ3NsLmxpc3RJdGVtJyxcbiAgICAgICAgJ2FwaS5ydWxlc1NlcnZpY2UnLFxuICAgICAgICAnR3JvdW5kQ29udGV4dCdcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gRGV2aWNlTGlzdFZpZXdNb2RlbEZhY3RvcnkoJHN0YXRlLCBkZXZpY2VzUmVwb3NpdG9yeSwgdXRpbHMsIGdhbWVDb25maWd1cmF0aW9uLCBMaXN0SGVhZGVyVmlld01vZGVsLCBMaXN0SXRlbVZpZXdNb2RlbCwgcnVsZXNTZXJ2aWNlLCBncm91bmRDb250ZXh0KSB7XG5cbiAgICAgICAgZnVuY3Rpb24gRGV2aWNlTGlzdFZpZXdNb2RlbChkZXZpY2VzLCBncm91bmRJZCkge1xuXG4gICAgICAgICAgICB0aGlzLmRldmljZXMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuZ3JvdW5kSWQgPSBncm91bmRJZDtcbiAgICAgICAgICAgIHRoaXMuZ3JvdW5kcyA9IGdyb3VuZENvbnRleHQuZ3JvdW5kcztcbiAgICAgICAgICAgIHRoaXMuaW5pdChkZXZpY2VzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIERldmljZUxpc3RWaWV3TW9kZWwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihkZXZpY2VzKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKGRldmljZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJNb2RlbCA9IG5ldyBMaXN0SGVhZGVyVmlld01vZGVsKCdEZXZpY2VzJywgJ2Fzc2V0cy9pbWcvZGV2aWNlcy1oZWFkZXIuc3ZnJywgJ092ZXJ2aWV3IG9mIGFsbCBkZXZpY2VzIHNlcnZpbmcgdGhpcyBncm91bmQuIEN1cnJlbnRseSB5b3UgZG9uXFwndCBoYXZlIGFueSBkZXZpY2VzLicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWRlck1vZGVsID0gbmV3IExpc3RIZWFkZXJWaWV3TW9kZWwoJ0RldmljZXMnLCAnYXNzZXRzL2ltZy9kZXZpY2VzLWhlYWRlci5zdmcnLCAnT3ZlcnZpZXcgb2YgYWxsIGRldmljZXMgc2VydmluZyB0aGlzIGdyb3VuZC4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHRoYXQuZ3JvdW5kcywgZnVuY3Rpb24oZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgaWYgKGdyb3VuZC5pZCA9PT0gdGhhdC5ncm91bmRJZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRHcm91bmRWaXNpYmlsaXR5ID0gZ3JvdW5kLnZpc2liaWxpdHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkZXZpY2VzLCBmdW5jdGlvbihkZXZpY2UpIHtcblxuICAgICAgICAgICAgICAgIGRldmljZS5zdWJzY3JpYmUoKTtcblxuICAgICAgICAgICAgICAgIHJ1bGVzU2VydmljZS5nZXREZXZpY2VSdWxlc0NvdW50KGRldmljZS5pZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5ydWxlc01ldGEgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kZXZpY2VzLnB1c2goTGlzdEl0ZW1WaWV3TW9kZWwuZnJvbURldmljZShkZXZpY2UpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGRldmljZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwuc2V0SGVhZGVyTW9kZSgnY29sYXBzZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhhdC5oZWFkZXJNb2RlbC5zZXRIZWFkZXJNb2RlKCdleHBhbmRlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignJG1lc3NhZ2luZy5kZXZpY2UuY3JlYXRlZCcsIGZ1bmN0aW9uKGUsIGV2ZW50RGF0YSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGRldmljZUV4aXN0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGF0LmRldmljZXMsIGZ1bmN0aW9uKGRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlLml0ZW1JZCA9PT0gZXZlbnREYXRhLmRldmljZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VFeGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRldmljZUV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICBkZXZpY2VzUmVwb3NpdG9yeS5maW5kKGV2ZW50RGF0YS5kZXZpY2VJZCkudGhlbihmdW5jdGlvbihkZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldi4kaXNOZXcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV2LnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kZXZpY2VzLnB1c2goTGlzdEl0ZW1WaWV3TW9kZWwuZnJvbURldmljZShkZXYpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmRldmljZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwuc2V0SGVhZGVyTW9kZSgnY29sYXBzZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5oZWFkZXJNb2RlbC5zZXRIZWFkZXJNb2RlKCdleHBhbmRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignJG1lc3NhZ2luZy5kZXZpY2UuZGVsZXRlZCcsIGZ1bmN0aW9uKGUsIGV2ZW50RGF0YSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGRlbGV0ZWREZXZpY2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGF0LmRldmljZXMsIGZ1bmN0aW9uKGRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlLml0ZW1JZCA9PT0gZXZlbnREYXRhLmRldmljZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkRGV2aWNlID0gZGV2aWNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlZERldmljZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGVkRGV2aWNlLnNldERlbGV0ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignZGVtby5kZXZpY2VBZG9wdGVkJywgZnVuY3Rpb24oZSwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGRldmljZXNSZXBvc2l0b3J5LmZpbmQoZGF0YSkudGhlbihmdW5jdGlvbihkZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV2LiRpc05ldyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZGV2aWNlcy5wdXNoKExpc3RJdGVtVmlld01vZGVsLmZyb21EZXZpY2UoZGV2KSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZUxpc3RWaWV3TW9kZWwucHJvdG90eXBlLmNyZWF0ZURldmljZSA9IGZ1bmN0aW9uKG5hbWUsIHR5cGUpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gbnVsbCB8fCBuYW1lID09PSAnJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1JlcG9zaXRvcnkuY3JlYXRlSW5Hcm91bmQoZGF0YSwgdGhhdC5ncm91bmRJZCkudGhlbihmdW5jdGlvbihkZXZpY2UpIHtcblxuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS5zdWNjZXNzKCdTdWNjZXNzLicsICdOZXcgZGV2aWNlIGlzIGNyZWF0ZWQnKTtcblxuICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGVtaXQoJ3VzZXIuY3JlYXRlZC5kZXZpY2UnLCBkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZUxpc3RWaWV3TW9kZWwucHJvdG90eXBlLnJlbW92ZURldmljZSA9IGZ1bmN0aW9uKGRlbGV0ZWREZXZpY2UpIHtcblxuICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5kZXZpY2VzLmluZGV4T2YoZGVsZXRlZERldmljZSk7XG4gICAgICAgICAgICB0aGlzLmRldmljZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VMaXN0Vmlld01vZGVsLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbihkZXZpY2UpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGRldmljZURlbGV0ZWQgPSBkZXZpY2U7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VzUmVwb3NpdG9yeS5yZW1vdmUoZGV2aWNlRGVsZXRlZC5pZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2Vzcy4nLCAnRGV2aWNlIGlzIGRlbGV0ZWQnKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXQuZGV2aWNlcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhhdC5kZXZpY2VzW2ldLmRldmljZSA9PT0gZGV2aWNlRGVsZXRlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5kZXZpY2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VMaXN0Vmlld01vZGVsLnJlc29sdmUgPSBmdW5jdGlvbihncm91bmRJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1JlcG9zaXRvcnkuZmluZEFsbEluR3JvdW5kKGdyb3VuZElkKS50aGVuKGZ1bmN0aW9uKGRldmljZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERldmljZUxpc3RWaWV3TW9kZWwoZGV2aWNlcywgZ3JvdW5kSWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIERldmljZUxpc3RWaWV3TW9kZWw7XG4gICAgfVxufSgpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdZb3VyRGV2aWNlc0NvbnRyb2xsZXInLCBZb3VyRGV2aWNlc0NvbnRyb2xsZXIpO1xuXG4gICAgWW91ckRldmljZXNDb250cm9sbGVyLiRpbmplY3QgPSBbXG4gICAgICAgICckc3RhdGUnLFxuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJ1lvdXJEZXZpY2VzVmlld01vZGVsJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBZb3VyRGV2aWNlc0NvbnRyb2xsZXIoJHN0YXRlLCAkc2NvcGUsIFlvdXJEZXZpY2VzVmlld01vZGVsKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5tb2RlbCA9IG51bGw7XG4gICAgICAgIHZtLmdvVG9FbnZpcm9ubWVudCA9IGdvVG9FbnZpcm9ubWVudDtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuXG4gICAgICAgICAgICBZb3VyRGV2aWNlc1ZpZXdNb2RlbC5yZXNvbHZlKCkudGhlbihmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLm1vZGVsID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29Ub0Vudmlyb25tZW50KCkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmVudmlyb25tZW50Jyk7XG4gICAgICAgIH1cblxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ1lvdXJEZXZpY2VzVmlld01vZGVsJywgWW91ckRldmljZXNWaWV3TW9kZWxGYWN0b3J5KTtcblxuICAgIFlvdXJEZXZpY2VzVmlld01vZGVsRmFjdG9yeS4kaW5qZWN0ID0gW1xuICAgICAgICAnZGV2aWNlLnJlcG9zaXRvcnknLFxuICAgICAgICAndXRpbHMnLFxuICAgICAgICAnc2wubGlzdEhlYWRlcicsXG4gICAgICAgICdzbC5saXN0SXRlbSdcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gWW91ckRldmljZXNWaWV3TW9kZWxGYWN0b3J5KGRldmljZXNSZXBvc2l0b3J5LCB1dGlscywgTGlzdEhlYWRlclZpZXdNb2RlbCwgTGlzdEl0ZW1WaWV3TW9kZWwpIHtcblxuICAgICAgICBmdW5jdGlvbiBZb3VyRGV2aWNlc1ZpZXdNb2RlbChkZXZpY2VzKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZGV2aWNlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJNb2RlbCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNhbGxUb0FjdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pbml0KGRldmljZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgWW91ckRldmljZXNWaWV3TW9kZWwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbihkZXZpY2VzKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkZXZpY2VzLCBmdW5jdGlvbihkZXZpY2UpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmRldmljZXMucHVzaChMaXN0SXRlbVZpZXdNb2RlbC5mcm9tRGV2aWNlKGRldmljZSkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGF0LmhlYWRlck1vZGVsID0gbmV3IExpc3RIZWFkZXJWaWV3TW9kZWwoJ1lvdXIgZGV2aWNlcycsICdhc3NldHMvaW1nL2RldmljZXMtaGVhZGVyLnN2ZycsICdPdmVydmlldyBvZiBhbGwgZGV2aWNlcyB0aGF0IHlvdSBvd24uJyk7XG4gICAgICAgICAgICAgICAgdGhhdC5oZWFkZXJNb2RlbC5zZXRIZWFkZXJNb2RlKCdjb2xhcHNlZCcpO1xuICAgICAgICAgICAgICAgIHRoYXQuY2FsbFRvQWN0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwgPSBuZXcgTGlzdEhlYWRlclZpZXdNb2RlbCgnWW91ciBEZXZpY2VzJywgJ2Fzc2V0cy9pbWcvZGV2aWNlcy1oZWFkZXIuc3ZnJywgJ092ZXJ2aWV3IG9mIGFsbCBkZXZpY2VzIHRoYXQgeW91IG93bi4uIEN1cnJlbnRseSB5b3UgZG9uXFwndCBoYXZlIGFueSBkZXZpY2VzLiBUbyBjcmVhdGUgZ3JvdW5kcyBhbmQgZGV2aWNlcyBuYXZpZ2F0ZSB0byBlbnZpcm9ubWVudCcpO1xuICAgICAgICAgICAgICAgIHRoYXQuaGVhZGVyTW9kZWwuc2V0SGVhZGVyTW9kZSgnZXhwYW5kZWQnKTtcbiAgICAgICAgICAgICAgICB0aGF0LmNhbGxUb0FjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICBZb3VyRGV2aWNlc1ZpZXdNb2RlbC5yZXNvbHZlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VzUmVwb3NpdG9yeS5maW5kQWxsKClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgWW91ckRldmljZXNWaWV3TW9kZWwoZGV2aWNlcyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gWW91ckRldmljZXNWaWV3TW9kZWw7XG4gICAgfVxufSgpKTtcbiIsIiAgICAoZnVuY3Rpb24gKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2JhbGxvb25FcnJvcicsIFtcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIFJJR0hUX09GRlNFVCA9IDYyO1xuICAgICAgICAgICAgLy92YXIgQkFMTE9OID0gJ2JhbGxvb24nO1xuICAgICAgICAgICAgdmFyIEJBTExPT05fRVJST1IgPSAnYmFsbG9vbi1lcnJvcic7XG4gICAgICAgICAgICB2YXIgU0FEX1NNSUxFX0lDT04gPSAnc2wtZW1vdGlvbi1zYWQnO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBCYWxsb29uRXJyb3IocGFyZW50RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0RWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50ID0gcGFyZW50RWxlbWVudCBpbnN0YW5jZW9mIG5nLmVsZW1lbnQgPyBwYXJlbnRFbGVtZW50WzBdIDogcGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQmFsbG9vbkVycm9yLnByb3RvdHlwZS5nZXRUb3BSaWdodFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjbGllbnRSZWN0ID0gdGhpcy5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgICAgIHZhciB4ID0gTWF0aC5yb3VuZChjbGllbnRSZWN0LndpZHRoICsgY2xpZW50UmVjdC5sZWZ0KSAtIFJJR0hUX09GRlNFVDtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IE1hdGgucm91bmQoY2xpZW50UmVjdC50b3ApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHt4OiB4LCB5OiB5fTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEJhbGxvb25FcnJvci5wcm90b3R5cGUuc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoYmFsbG9vbikge1xuICAgICAgICAgICAgICAgIGlmIChiYWxsb29uKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHRoaXMuZ2V0VG9wUmlnaHRQb3NpdGlvbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIGJhbGxvb24uc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICAgICAgICAgICAgICBiYWxsb29uLnN0eWxlLnRvcCA9IHBvc2l0aW9uLnkgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICBiYWxsb29uLnN0eWxlLmxlZnQgPSBwb3NpdGlvbi54ICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBCYWxsb29uRXJyb3IucHJvdG90eXBlLmNyZWF0ZUVycm9yT2JqZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBiYWxsb29uID0gdGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgdmFyIGFycm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcblxuICAgICAgICAgICAgICAgIC8vYmFsbG9vbi5jbGFzc0xpc3QuYWRkKEJBTExPTik7XG4gICAgICAgICAgICAgICAgYmFsbG9vbi5jbGFzc0xpc3QuYWRkKEJBTExPT05fRVJST1IpO1xuICAgICAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZChTQURfU01JTEVfSUNPTik7XG4gICAgICAgICAgICAgICAgYXJyb3cuY2xhc3NMaXN0LmFkZCgnYXJyb3cnKTtcblxuICAgICAgICAgICAgICAgIGJhbGxvb24uYXBwZW5kQ2hpbGQoYXJyb3cpO1xuICAgICAgICAgICAgICAgIGJhbGxvb24uYXBwZW5kQ2hpbGQoaWNvbik7XG4gICAgICAgICAgICAgICAgYmFsbG9vbi5hcHBlbmRDaGlsZCh0aGlzLnRleHRFbGVtZW50KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oYmFsbG9vbik7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoYmFsbG9vbik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBCYWxsb29uRXJyb3IucHJvdG90eXBlLmRlc3Ryb3lFcnJvck9iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudEVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy50ZXh0RWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBCYWxsb29uRXJyb3IucHJvdG90eXBlLnNldEVycm9yTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudCAmJiBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dEVsZW1lbnQuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBCYWxsb29uRXJyb3IucHJvdG90eXBlLmNsZWFyRXJyb3JNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dEVsZW1lbnQuaW5uZXJIVE1MID0gbnVsbDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnPWJhbGxvb25FcnJvcidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJhbGxvb24gPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnbWVzc2FnZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFiYWxsb29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvb24gPSBuZXcgQmFsbG9vbkVycm9yKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWxsb29uLmNyZWF0ZUVycm9yT2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbG9vbi5zZXRFcnJvck1lc3NhZ2UodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhbGxvb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbG9vbi5kZXN0cm95RXJyb3JPYmplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbG9vbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXRCYWxsb25Qb3NpdGlvbk9uRXZlbnQoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFsbG9vbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvb24uc2V0UG9zaXRpb24oYmFsbG9vbi5lbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBzZXRCYWxsb25Qb3NpdGlvbk9uRXZlbnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB3aW5kb3cuZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKFwiLmdyaWQtY29sLWNvbnRhaW5lclwiKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc2V0QmFsbG9uUG9zaXRpb25PbkV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFsbG9vbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxvb24uZGVzdHJveUVycm9yT2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBzZXRCYWxsb25Qb3NpdGlvbk9uRXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHNldEJhbGxvblBvc2l0aW9uT25FdmVudCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTsiLCIoZnVuY3Rpb24obmcpIHtcbiAgICAgICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2NvdW50ZXJJbnB1dCcsIFtcbiAgICAgICAgICAgICckcm9vdFNjb3BlJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCRyb290U2NvcGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogJz0nXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBlbGVtZW50WzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoID0gZWxlbWVudC5jaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmNoaWxkcmVuKCkuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRlbnRpZnlDbGFzcyA9ICd0aGlzJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd0aW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2gubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbmVFbGVtZW50ID0gY2hbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChjaFtpXSkuaGFzQ2xhc3MoaWRlbnRpZnlDbGFzcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGNoW2ldKS5yZW1vdmVDbGFzcyhpZGVudGlmeUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJykgPT0gc2NvcGUudGltZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoY2hbaV0pLmFkZENsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IChpIC0gMSkgKiB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UG9zaXRpb24gPSBwb3NpdGlvbiArIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLnRvcCA9ICctJyArIG5ld1Bvc2l0aW9uICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cblxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0Q291bnRlclRvcCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLnRvcCA9ICcwcHgnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2gucmVtb3ZlQ2xhc3MoaWRlbnRpZnlDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaC5maXJzdCgpLmFkZENsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnRpbWUgPSBjaC5maXJzdCgpLmF0dHIoXCJkYXRhLXZhbHVlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0Q291bnRlckJvdHRvbSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnN0eWxlLnRvcCA9ICctJyArIChoZWlnaHQgLSB2YWx1ZSkgKyAncHgnO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2gucmVtb3ZlQ2xhc3MoaWRlbnRpZnlDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaC5sYXN0KCkuYWRkQ2xhc3MoaWRlbnRpZnlDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudGltZSA9IGNoLmxhc3QoKS5hdHRyKFwiZGF0YS12YWx1ZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb3VudEZvcndhcmQoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGVsZW1lbnQuZmluZCgnLicgKyBpZGVudGlmeUNsYXNzICsgJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnRpbWUgPSBjdXJyZW50Lm5leHQoKS5hdHRyKFwiZGF0YS12YWx1ZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGN1cnJlbnQuaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UG9zaXRpb24gPSBpbmRleCAqIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdmUgPSBjdXJyZW50UG9zaXRpb24gKyB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZUNvdW50Rm9yd2FyZCgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS50b3AgPSAnLScgKyBtb3ZlICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQubmV4dCgpLmFkZENsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZSA8IGhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGVDb3VudEZvcndhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRDb3VudGVyVG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvdW50QmFjaygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZWxlbWVudC5maW5kKCcuJyArIGlkZW50aWZ5Q2xhc3MgKyAnJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudGltZSA9IGN1cnJlbnQucHJldigpLmF0dHIoXCJkYXRhLXZhbHVlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGN1cnJlbnQuaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UG9zaXRpb24gPSBpbmRleCAqIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdmUgPSBjdXJyZW50UG9zaXRpb24gLSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZUNvdW50QmFjaygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS50b3AgPSAnLScgKyBtb3ZlICsgJ3B4JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnQucHJldigpLmFkZENsYXNzKGlkZW50aWZ5Q2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZUNvdW50QmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldENvdW50ZXJCb3R0b20oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbmcuZWxlbWVudChjaCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGVsZW1lbnQuY2hpbGRyZW4oKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudEZvcndhcmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIG5nLmVsZW1lbnQoY2gpLm9uKCdtb3VzZXdoZWVsJywgZnVuY3Rpb24oZSwgZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGVsZW1lbnQuY2hpbGRyZW4oKS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Rm9yd2FyZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudEJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7IiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdkZXZpY2VTdGF0dXMnLCBkZXZpY2VTdGF0dXMpO1xuXG4gICAgZGV2aWNlU3RhdHVzLiRpbmplY3QgPSBbJyRyb290U2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIGRldmljZVN0YXR1cygkcm9vdFNjb3BlKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkZXZpY2U6ICc9J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRyaWJ1dGUpIHtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkZXZpY2UuZGV2aWNlQWN0aXZlQXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zZXRTdGF0dXNMYWJlbChzY29wZS5kZXZpY2UubGFzdEFjdGl2ZUF0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS5pc0ZpcnN0VGltZSA9IHRydWU7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckbWVzc2FnaW5nLmFzc2V0LnN0YXRlJywgZnVuY3Rpb24oZXZlbnQsIHBheWxvYWQpIHtcblxuICAgICAgICAgICAgICAgIHZhciBpc0Fzc2V0RnJvbVRoaXNEZXZpY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgYXNzZXQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY29wZS5kZXZpY2UuYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBheWxvYWQuYXNzZXRJZCA9PT0gc2NvcGUuZGV2aWNlLmFzc2V0c1tpXS5pZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0Fzc2V0RnJvbVRoaXNEZXZpY2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQgPSBzY29wZS5kZXZpY2UuYXNzZXRzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChhc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldC5uYW1lID09PSAnc2VuZGluZ2RhdGEnICYmIHNjb3BlLmlzRmlyc3RUaW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndXNlci5wbGF5aW5nLnF1aWNrLWRlbW8nLCBhc3NldC5zdGF0ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzRmlyc3RUaW1lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc0Fzc2V0RnJvbVRoaXNEZXZpY2UgJiYgYXNzZXQuaXMgPT09ICdzZW5zb3InKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2V0U3RhdHVzTGFiZWwocGF5bG9hZC5wYXlsb2FkLlN0YXRlLkF0KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLnNldFN0YXR1c0xhYmVsID0gZnVuY3Rpb24odGltZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBpZiAodGltZSAhPT0gbnVsbCAmJiB0aW1lICE9PSB1bmRlZmluZWQgJiYgdGltZSAhPT0gJycpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0VGltZSA9IG1vbWVudCh0aW1lKS5hZGQoLTQsICdzJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lRWRpdGVkID0gbW9tZW50KG9mZnNldFRpbWUsIG1vbWVudC5JU09fODYwMSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbFRpbWUgPSB0aW1lRWRpdGVkLmZyb21Ob3coKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5pbm5lckhUTUwgPSAnYWN0aXZlICcgKyBmaW5hbFRpbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50WzBdKS5hdHRyKCd0aXRsZScsIHRpbWVFZGl0ZWQuZm9ybWF0KCdERC5NTS5ZWVlZLiBbYXRdIEhIOk1NJykpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RyYWcnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGVsZW1lbnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgJChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodCkubW91c2Vkb3duKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2Rvd24nLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgneCcsIGV2ZW50LnBhZ2VYKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgneScsIGV2ZW50LnBhZ2VZKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgnc2Nyb2xsTGVmdCcsIHRoaXMuc2Nyb2xsTGVmdClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ3Njcm9sbFRvcCcsIHRoaXMuc2Nyb2xsVG9wKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3NzKCdjdXJzb3InLCAnbW92ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHQpLm1vdXNldXAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCdkb3duJywgZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodCkubW91c2Vtb3ZlKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0KS5kYXRhKCdkb3duJykgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gJCh0KS5kYXRhKCdzY3JvbGxMZWZ0JykgKyAkKHQpLmRhdGEoJ3gnKSAtIGV2ZW50LnBhZ2VYO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQodCkuZGF0YSgnZG93bicpID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gJCh0KS5kYXRhKCdzY3JvbGxUb3AnKSArICQodCkuZGF0YSgneScpIC0gZXZlbnQucGFnZVk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG5cblxuXG5cblxuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnZnJvbU5vdycsIGZyb21Ob3cpO1xuXG4gICAgZnJvbU5vdy4kaW5qZWN0ID0gWyckaW50ZXJ2YWwnXTtcblxuICAgIGZ1bmN0aW9uIGZyb21Ob3coJGludGVydmFsKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmcm9tTm93OiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZnJvbU5vdycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNldFRpbWVMYWJlbChzY29wZS5mcm9tTm93KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgcmVmcmVzaFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNldFRpbWVMYWJlbChzY29wZS5mcm9tTm93KTtcbiAgICAgICAgICAgIH0sIDMwMDAwKTtcblxuICAgICAgICAgICAgc2NvcGUuc2V0VGltZUxhYmVsID0gZnVuY3Rpb24odGltZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvZmZzZXRUaW1lID0gbW9tZW50KHRpbWUpLmFkZCgtNCwgJ3MnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVFZGl0ZWQgPSBtb21lbnQob2Zmc2V0VGltZSwgbW9tZW50LklTT184NjAxKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmFsVGltZSA9IHRpbWVFZGl0ZWQuZnJvbU5vdygpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLmlubmVySFRNTCA9IGZpbmFsVGltZTtcblxuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnRbMF0pLmF0dHIoJ3RpdGxlJywgdGltZUVkaXRlZC5mb3JtYXQoJ0RELk1NLllZWVkuIFthdF0gSEg6TU0nKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwocmVmcmVzaFRpbWVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiLy8oZnVuY3Rpb24gKG5nKSB7XG4vLyAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnZnVsbEhlaWdodCcsXG4vLyAgICAgICAgWyckd2luZG93Jyxcbi8vICAgICAgICAgICAgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbi8vICAgICAgICAgICAgICAgIHJldHVybiB7XG4vLyAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbi8vICAgICAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGVsZW1lbnRbMF07XG4vL1xuLy8gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUVsZW1lbnQoKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgfTtcbi8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2l6ZUVsZW1lbnQoKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZS5oZWlnaHQgPSAod2luZG93LmlubmVySGVpZ2h0IC0gZWwub2Zmc2V0VG9wKSArICdweCc7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIH1cbi8vXG4vLyAgICAgICAgICAgICAgICAgICAgICAgIG5nLmVsZW1lbnQoJHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9uUmVzaXplKCk7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuLy9cbi8vICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplRWxlbWVudCgpO1xuLy8gICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgIH07XG4vLyAgICAgICAgICAgIH1dXG4vLyAgICApO1xuLy99KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnaW5saW5lQ29udHJvbCcsIFtcbiAgICAgICAgJyRsb2cnLFxuICAgICAgICAnJGNvbXBpbGUnLFxuICAgICAgICBmdW5jdGlvbigkbG9nLCAkY29tcGlsZSkge1xuICAgICAgICAgICAgZnVuY3Rpb24gYWRkQXJyYXlUb0VsZW1lbnQoYXJyYXksIGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDAgJiYgZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbC5jbGFzc0xpc3QuY29udGFpbnMoYXJyYXlbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZChhcnJheVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlbW92ZUFycmF5RnJvbUVsZW1lbnQoYXJyYXksIGVsKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IDAgJiYgZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhhcnJheVtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGFycmF5W2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaGlkZUNoaWxkcmVuKGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gZWwucXVlcnlTZWxlY3RvckFsbChcImFydGljbGVcIik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50c1tpXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2hvd0NoaWxkcmVuKGVsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gZWwucXVlcnlTZWxlY3RvckFsbChcImFydGljbGVcIik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50c1tpXS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdFN0YXRlOiAnQCcsIC8vIGNzcyBjbGFzc2VzIHRoYXQgYXJlIGFsd2F5cyBcImFjdGl2ZVwiIG9uIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kU3RhdGU6ICdAJywgLy8gY3NzIGNsYXNzZXMgdGhhdCBhcmUgYWRkZWQgYW5kIHJlbW92ZWQgYWNjb3JkaW5nIHRvIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1FbGVtZW50SWQ6ICdAJyxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbjogJyYnLFxuICAgICAgICAgICAgICAgICAgICBkZWNsaW5lRWxlbWVudElkOiAnQCcsXG4gICAgICAgICAgICAgICAgICAgIGRlY2xpbmVBY3Rpb246ICcmJyxcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJEYXRhOiAnJicsXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlOiAnPT8nXG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBlbGVtZW50WzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaXJzdFN0YXRlQ2xhc3NlcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWNvbmRTdGF0ZUNsYXNzZXMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zdGF0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpcnN0U3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0U3RhdGVDbGFzc2VzID0gc2NvcGUuZmlyc3RTdGF0ZS5zcGxpdCgnICcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY29uZFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRTdGF0ZUNsYXNzZXMgPSBzY29wZS5zZWNvbmRTdGF0ZS5zcGxpdCgnICcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmNvbmZpcm1FbGVtZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtRWxlbWVudCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJyMnICsgc2NvcGUuY29uZmlybUVsZW1lbnRJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlybUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGNvbmZpcm1FbGVtZW50KS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbmZpcm1BY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kZWNsaW5lRWxlbWVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVjbGluZUVsZW1lbnQgPSBlbC5xdWVyeVNlbGVjdG9yKCcjJyArIHNjb3BlLmRlY2xpbmVFbGVtZW50SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlY2xpbmVFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChkZWNsaW5lRWxlbWVudElkKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGVjbGluZUFjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0cyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGlucHV0c1tpXSkuY2xpY2soZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaW5wdXRzW2ldKS5rZXlwcmVzcyhmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUud2hpY2ggPT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29uZmlybUFjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYWRkQXJyYXlUb0VsZW1lbnQoZmlyc3RTdGF0ZUNsYXNzZXMsIGVsKTtcblxuICAgICAgICAgICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xpY2spO1xuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9uQ2xpY2soZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc3RhdGUgPSAhc2NvcGUuc3RhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VTdGF0ZShzY29wZS5zdGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBmaXJzdFN0YXRlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkQXJyYXlUb0VsZW1lbnQoc2Vjb25kU3RhdGVDbGFzc2VzLCBlbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNlY29uZFN0YXRlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXJyYXlGcm9tRWxlbWVudChzZWNvbmRTdGF0ZUNsYXNzZXMsIGVsKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xlYXJEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjaGFuZ2VTdGF0ZShuZXdTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0U3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnc3RhdGUnLCBmdW5jdGlvbihuZXdTdGF0ZSwgb2xkU3RhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVN0YXRlKG5ld1N0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkub2ZmKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChpbnB1dHNbaV0pLm9mZigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25maXJtRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoY29uZmlybUVsZW1lbnQpLm9mZigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVjbGluZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGRlY2xpbmVFbGVtZW50KS5vZmYoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbWVudUl0ZW0nLCBtZW51SXRlbSk7XG5cbiAgICBtZW51SXRlbS4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHN0YXRlJywgJyRyb290U2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIG1lbnVJdGVtKCRsb2NhdGlvbiwgJHN0YXRlLCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgdmFyIG1lbnVQYXRoID0gZWxlbWVudC5hdHRyKCdtZW51LXBhdGgnKSB8fCBlbGVtZW50LmZpbmQoJ2EnKS5hdHRyKCdtZW51LXBhdGgnKTtcblxuICAgICAgICAgICAgdmFyIGFjdGl2ZUNsYXNzID0gYXR0cnMuYWN0aXZlQ2xhc3MgfHwgJ2FjdGl2ZSc7XG5cbiAgICAgICAgICAgIHZhciBjdXJyZW50U3RhdGUgPSAkc3RhdGUuY3VycmVudDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaXNBY3RpdmUodG9TdGF0ZSwgZnJvbVN0YXRlKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbGluayA9ICcvJyArIG1lbnVQYXRoO1xuXG4gICAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gJGxvY2F0aW9uLiQkcGF0aDtcblxuICAgICAgICAgICAgICAgIHZhciBhc3NldCA9ICcvYXNzZXQnO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1lbnVQYXRoID09PSB0b1N0YXRlLmRhdGEuc2VjdGlvbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZS5kYXRhICYmIGN1cnJlbnRTdGF0ZS5kYXRhLnNlY3Rpb24pIHtcblxuICAgICAgICAgICAgICAgIGlzQWN0aXZlKGN1cnJlbnRTdGF0ZSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEuc2VjdGlvbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlzQWN0aXZlKHRvU3RhdGUpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiBmcm9tU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEuc2VjdGlvbiAmJiB0b1N0YXRlLmRhdGEuc2VjdGlvbikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlzQWN0aXZlKHRvU3RhdGUsIGZyb21TdGF0ZSk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uIChuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdtb2RhbEhlaWdodCcsXG4gICAgICAgIFsnJHdpbmRvdycsXG4gICAgICAgICAgICBmdW5jdGlvbiAoJHdpbmRvdywgJG1vZGFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBlbGVtZW50WzBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiByZXNpemVFbGVtZW50KCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhndCA9IGVsLm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwub2Zmc2V0SGVpZ2h0IDwgd2luZG93LmlubmVySGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnY2VudGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkuY3NzKHt0b3A6JzUwJScsICdtYXJnaW4tdG9wJzogJy0nICtoZ3QvMisgJ3B4J30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSgnY2VudGVyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG5nLmVsZW1lbnQoJHdpbmRvdykub24oJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNpemVFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBuZy5lbGVtZW50KCRtb2RhbCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUVsZW1lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWwub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUVsZW1lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfV1cbiAgICApO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ3JhbmRvbUNvbG9yJywgW1xuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJhbmRvbUNvbG9yKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIiNcIiArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIsIDgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuY29sb3IgPSBnZXRSYW5kb21Db2xvcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdzY3JvbGxUbycsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMuc2Nyb2xsVG8sIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3MgPSAkKGVsZW1lbnQpLnBvc2l0aW9uKCkudG9wICsgJChlbGVtZW50KS5jbG9zZXN0KCcuZ3JpZC1jb2wtY29udGFpbmVyJykuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuY2xvc2VzdCgnLmdyaWQtY29sLWNvbnRhaW5lcicpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBwb3NcbiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3V0aWxpdHkuY29tbW9uJywgdXRpbGl0eUNvbW1vbik7XG5cbiAgICB1dGlsaXR5Q29tbW9uLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHRpbWVvdXQnLCAnJGZpbHRlcicsICdzZXJ2aWNlLmRheVRpbWUnXTtcblxuICAgIGZ1bmN0aW9uIHV0aWxpdHlDb21tb24oJHJvb3RTY29wZSwgJHRpbWVvdXQsICRmaWx0ZXIsIGRheVRpbWUpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHRyeVBhcnNlSlNPTjogdHJ5UGFyc2VKU09OLFxuICAgICAgICAgICAgbWFya05ldzogbWFya05ldyxcbiAgICAgICAgICAgIG1hcmtOZXdEZXZpY2VzOiBtYXJrTmV3RGV2aWNlcyxcbiAgICAgICAgICAgIGZpbmREZXZpY2U6IGZpbmREZXZpY2UsXG4gICAgICAgICAgICBmaW5kQXNzZXQ6IGZpbmRBc3NldCxcbiAgICAgICAgICAgIG1hcFJ1bGVTZWN0aW9uRGVmaW5pdGlvblRvVmlld01vZGVsOiBtYXBSdWxlU2VjdGlvbixcbiAgICAgICAgICAgIGNyZWF0ZVJ1bGVTZWN0aW9uVmlld01vZGVsOiBjcmVhdGVSdWxlU2VjdGlvblZpZXdNb2RlbCxcbiAgICAgICAgICAgIHJlc2V0UnVsZVNlY3Rpb25WaWV3TW9kZWw6IHJlc2V0UnVsZVNlY3Rpb25WaWV3TW9kZWwsXG4gICAgICAgICAgICB0b1Bhc2NhbENhc2U6IHRvUGFzY2FsQ2FzZSxcbiAgICAgICAgICAgIGxpbWl0U3RyaW5nTGVuZ3RoOiBsaW1pdFN0cmluZ0xlbmd0aCxcbiAgICAgICAgICAgIG1hcFJ1bGVQcmV2aWV3VG9WaWV3TW9kZWw6IG1hcFJ1bGVQcmV2aWV3XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIHRyeVBhcnNlSlNPTihzdHIsIHN1Y2Nlc3NIYW5kbGVyLCBmYWlsSGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIG9iajtcbiAgICAgICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgICAgICBvYmogPSBKU09OLnBhcnNlKHN0cik7XG4gICAgICAgICAgICAgICAgaWYgKHN1Y2Nlc3NIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NIYW5kbGVyKG9iaik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoZmFpbEhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZmFpbEhhbmRsZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsaW1pdFN0cmluZ0xlbmd0aChzdHJpbmdUb0xpbWl0LCBzaXplVG9MaW1pdCkge1xuXG4gICAgICAgICAgICBpZiAoc3RyaW5nVG9MaW1pdCAhPSBudWxsIHx8IHN0cmluZ1RvTGltaXQgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RyaW5nVG9MaW1pdC5sZW5ndGggPiBzaXplVG9MaW1pdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nVG9MaW1pdC5zbGljZSgwLCBzaXplVG9MaW1pdCkgKyAnLi4uJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nVG9MaW1pdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYXJrTmV3RGV2aWNlcyhhLCBiKSB7XG4gICAgICAgICAgICB2YXIgYUlkcyA9IHt9O1xuXG4gICAgICAgICAgICBuZy5mb3JFYWNoKGEsIGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgIGFJZHNbb2JqLmlkXSA9IG9iajtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBuZy5mb3JFYWNoKGIsIGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgIGlmICghYUlkcy5oYXNPd25Qcm9wZXJ0eShvYmouaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai4kaXNOZXcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai4kaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1hcmtOZXcoYSwgYikge1xuICAgICAgICAgICAgdmFyIGFJZHMgPSB7fTtcblxuICAgICAgICAgICAgbmcuZm9yRWFjaChhLCBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgICAgICBhSWRzW29iai5pZF0gPSBvYmo7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbmcuZm9yRWFjaChiLCBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFJZHMuaGFzT3duUHJvcGVydHkob2JqLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICBvYmouJGlzTmV3ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouJGlzTmV3ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMjAwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kRGV2aWNlKGRldmljZXMsIGRldmljZUlkKSB7XG4gICAgICAgICAgICB2YXIgZm91bmQgPSAkZmlsdGVyKCdmaWx0ZXInKShkZXZpY2VzLCB7XG4gICAgICAgICAgICAgICAgaWQ6IGRldmljZUlkXG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZFswXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQXNzZXQoZGV2aWNlcywgZGV2aWNlSWQsIGFzc2V0SWQpIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2UgPSBmaW5kRGV2aWNlKGRldmljZXMsIGRldmljZUlkKTtcblxuICAgICAgICAgICAgaWYgKGRldmljZSkge1xuICAgICAgICAgICAgICAgIHZhciBmb3VuZEFzc2V0cyA9ICRmaWx0ZXIoJ2ZpbHRlcicpKGRldmljZS5hc3NldHMsIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGFzc2V0SWRcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb3VuZEFzc2V0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvdW5kQXNzZXRzWzBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kU2VydmljZShzZXJ2aWNlcywgc2VydmljZUlkKSB7XG4gICAgICAgICAgICB2YXIgZm91bmQgPSAkZmlsdGVyKCdmaWx0ZXInKShzZXJ2aWNlcywge1xuICAgICAgICAgICAgICAgIGlkOiBzZXJ2aWNlSWRcbiAgICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvdW5kWzBdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRvUGFzY2FsQ2FzZShzKSB7XG4gICAgICAgICAgICByZXR1cm4gcy5yZXBsYWNlKC9cXHcrL2csXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24odykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd1swXS50b1VwcGVyQ2FzZSgpICsgdy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNQcm9maWxlTnVtZXJpYyhwcm9maWxlVHlwZSkge1xuXG4gICAgICAgICAgICBpZiAocHJvZmlsZVR5cGUgPT0gJ2ludCcgfHwgcHJvZmlsZVR5cGUgPT0gJ2ludGVnZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlVHlwZSA9PSAnZG91YmxlJyB8fCBwcm9maWxlVHlwZSA9PSAnZmxvYXQnIHx8IHByb2ZpbGVUeXBlID09ICdkZWNpbWFsJyB8fCBwcm9maWxlVHlwZSA9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc1Byb2ZpbGVCb29sZWFuKHByb2ZpbGVUeXBlKSB7XG4gICAgICAgICAgICBpZiAocHJvZmlsZVR5cGUgPT0gJ2Jvb2wnIHx8IHByb2ZpbGVUeXBlID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYXBSdWxlU2VjdGlvbihydWxlRGVmaW5pdGlvbiwgc2VjdGlvbk5hbWUsIHNlY3Rpb25WaWV3TW9kZWwsIGRldmljZXMsIHNlcnZpY2VzKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZTZWN0aW9uID0gbnVsbDtcblxuICAgICAgICAgICAgdmFyIGRheVRpbWVTZXJ2aWNlID0gZGF5VGltZS5kYXlUaW1lKCk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZURlZmluaXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAocnVsZURlZmluaXRpb25baV0uaGFzT3duUHJvcGVydHkoc2VjdGlvbk5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZlNlY3Rpb24gPSBydWxlRGVmaW5pdGlvbltpXVtzZWN0aW9uTmFtZV1bMF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBwZXJDYXNlU2VjdGlvbk5hbWUgPSB0b1Bhc2NhbENhc2Uoc2VjdGlvbk5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocnVsZURlZmluaXRpb25baV0uaGFzT3duUHJvcGVydHkodXBwZXJDYXNlU2VjdGlvbk5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZTZWN0aW9uID0gcnVsZURlZmluaXRpb25baV1bdXBwZXJDYXNlU2VjdGlvbk5hbWVdWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRlZlNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwcm9maWxlID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKCFkZWZTZWN0aW9uLmxlZnQpIHsgLy9pZiB0aGVyZSBpcyBubyAnbGVmdCcgcGFydCBpbiBzZWN0aW9uIGl0IGlzIGFzc3VtZWQgdGhlIHJ1bGUgaXMgRGV2aWNlU3RhdGVDaGFuZ2UgcnVsZSBhbmQgdGhhdCBPbkV2ZXJ5Q2hhbmdlIHdhcyBzZWxlY3RlZC5cblxuICAgICAgICAgICAgICAgIG1hcERldmljZVN0YXRlUGFydChzZWN0aW9uVmlld01vZGVsLCBkZWZTZWN0aW9uLCBkZXZpY2VzKTtcblxuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRDb21wYXJlVHlwZSA9ICdvbkV2ZXJ5Q2hhbmdlJztcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi5vcCA9ICdPRUMnO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nTGVmdEFzc2V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcm9maWxlID0gc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZEFzc2V0LnByb2ZpbGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25WaWV3TW9kZWw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vTWFwcGluZyBsZWZ0IHBhcnRcbiAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmxlZnQuc2VydmljZSA9PSAnYXNzZXQnKSB7XG5cbiAgICAgICAgICAgICAgICBtYXBEZXZpY2VTdGF0ZVBhcnQoc2VjdGlvblZpZXdNb2RlbCwgZGVmU2VjdGlvbi5sZWZ0LCBkZXZpY2VzKTtcblxuICAgICAgICAgICAgICAgIGlmICghc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwubWlzc2luZ0xlZnRBc3NldCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZSA9IHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRBc3NldC5wcm9maWxlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlcnZpY2UgPT0gJ2RheVRpbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5kZXZpY2VPclNlcnZpY2VDaG9pY2UgPSAnc2VydmljZSc7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlbnNvcikge1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IGRheVRpbWVTZXJ2aWNlWzBdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByb2ZpbGUgPSBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZS5wcm9maWxlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmxlZnQuc2VydmljZSA9PSAnbm90aWZ5Jykge1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuZGV2aWNlT3JTZXJ2aWNlQ2hvaWNlID0gJ3NlcnZpY2UnO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ubGVmdC5hY3R1YXRvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IGZpbmRTZXJ2aWNlKHNlcnZpY2VzLCBkZWZTZWN0aW9uLmxlZnQuYWN0dWF0b3IpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IHNlcnZpY2VzWzBdO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkTm90aWZpY2F0aW9ucy53ZWIgPSBnZXRTZWxlY3RlZE5vdGlmaWNhdGlvbnMoZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yLCAnd2ViJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWROb3RpZmljYXRpb25zLnB1c2ggPSBnZXRTZWxlY3RlZE5vdGlmaWNhdGlvbnMoZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yLCAncHVzaCcpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5lbWFpbCA9IGdldFNlbGVjdGVkTm90aWZpY2F0aW9ucyhkZWZTZWN0aW9uLmxlZnQuYWN0dWF0b3IsICdlbWFpbCcpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlcnZpY2VBY3R1YXRvclZhbHVlID0gZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmxlZnQuc2Vuc29yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRTZXJ2aWNlID0gZmluZFNlcnZpY2Uoc2VydmljZXMsIGRlZlNlY3Rpb24ubGVmdC5zZW5zb3IpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IHNlcnZpY2VzWzBdO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkTm90aWZpY2F0aW9ucy53ZWIgPSBnZXRTZWxlY3RlZE5vdGlmaWNhdGlvbnMoZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yLCAnd2ViJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWROb3RpZmljYXRpb25zLnB1c2ggPSBnZXRTZWxlY3RlZE5vdGlmaWNhdGlvbnMoZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yLCAncHVzaCcpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5lbWFpbCA9IGdldFNlbGVjdGVkTm90aWZpY2F0aW9ucyhkZWZTZWN0aW9uLmxlZnQuYWN0dWF0b3IsICdlbWFpbCcpO1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlcnZpY2VBY3R1YXRvclZhbHVlID0gZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHByb2ZpbGUgPSBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZS5wcm9maWxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL01hcHBpbmcgcmlnaHQgcGFydFxuICAgICAgICAgICAgaWYgKCFkZWZTZWN0aW9uLnJpZ2h0Lmhhc093blByb3BlcnR5KCdzZXJ2aWNlJykpIHtcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkQ29tcGFyZVR5cGUgPSAnY29uc3RhbnQnO1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLm9wID0gZGVmU2VjdGlvbi5vcDtcblxuICAgICAgICAgICAgICAgIGlmIChwcm9maWxlICYmIHByb2ZpbGUudHlwZSA9PSAnZGF0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5jb25zdGFudENvbXBhcmVPcGVyYXRpb24udmFsdWUgPSBuZXcgRGF0ZShkZWZTZWN0aW9uLnJpZ2h0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb2ZpbGUgJiYgaXNQcm9maWxlTnVtZXJpYyhwcm9maWxlLnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlID0gTnVtYmVyKGRlZlNlY3Rpb24ucmlnaHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvZmlsZSAmJiBpc1Byb2ZpbGVCb29sZWFuKHByb2ZpbGUudHlwZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRlZlNlY3Rpb24ucmlnaHQgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSA9IGRlZlNlY3Rpb24ucmlnaHQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlID0gZGVmU2VjdGlvbi5yaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlcnZpY2UgPT0gJ2RheVRpbWUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlID0gZGF5VGltZS51dGNDcm9uVG9Mb2NhbFRpbWUoZGVmU2VjdGlvbi5yaWdodCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5jb25zdGFudENvbXBhcmVPcGVyYXRpb24udmFsdWUgPSBkZWZTZWN0aW9uLnJpZ2h0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRDb21wYXJlVHlwZSA9ICdyZWZlcmVuY2UnO1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5vcCA9IGRlZlNlY3Rpb24ub3A7XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5yaWdodC5zZXJ2aWNlID09ICdhc3NldCcpIHtcblxuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlID0gZmluZERldmljZShkZXZpY2VzLCBkZWZTZWN0aW9uLnJpZ2h0LmRldmljZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWN0aW9uVmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLm1pc3NpbmdSaWdodERldmljZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5yaWdodC5hY3R1YXRvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmFzc2V0ID0gZmluZEFzc2V0KGRldmljZXMsIGRlZlNlY3Rpb24ucmlnaHQuZGV2aWNlLCBkZWZTZWN0aW9uLnJpZ2h0LmFjdHVhdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLnJpZ2h0LnNlbnNvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmFzc2V0ID0gZmluZEFzc2V0KGRldmljZXMsIGRlZlNlY3Rpb24ucmlnaHQuZGV2aWNlLCBkZWZTZWN0aW9uLnJpZ2h0LnNlbnNvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5hc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nUmlnaHRBc3NldCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5yaWdodC5zZXJ2aWNlID09ICdub3RpZnknKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ucmlnaHQuYWN0dWF0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5zZXJ2aWNlID0gZmluZFNlcnZpY2Uoc2VydmljZXMsIGRlZlNlY3Rpb24ucmlnaHQuYWN0dWF0b3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLnNlcnZpY2UgPSBzZXJ2aWNlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLnJpZ2h0LnNlbnNvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLnNlcnZpY2UgPSBmaW5kU2VydmljZShzZXJ2aWNlcywgZGVmU2VjdGlvbi5yaWdodC5zZW5zb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLnNlcnZpY2UgPSBzZXJ2aWNlc1swXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRTZWxlY3RlZE5vdGlmaWNhdGlvbnMoYWN0dWF0b3IsIG5vdGlmaWNhdGlvblR5cGUpIHtcbiAgICAgICAgICAgIHZhciBub3RpZmljYXRpb25zID0gYWN0dWF0b3Iuc3BsaXQoJy8nKVsyXS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgdmFyIGlzTm90aWZpY2F0aW9uU2VsZWN0ZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub3RpZmljYXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbnNbaV0gPT09IG5vdGlmaWNhdGlvblR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNOb3RpZmljYXRpb25TZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gaXNOb3RpZmljYXRpb25TZWxlY3RlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1hcERldmljZVN0YXRlUGFydChzZWN0aW9uVmlld01vZGVsLCBkZXZpY2VTdGF0ZUNvbmZpZywgZGV2aWNlcykge1xuXG4gICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkRGV2aWNlID0gZmluZERldmljZShkZXZpY2VzLCBkZXZpY2VTdGF0ZUNvbmZpZy5kZXZpY2UpO1xuICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5kZXZpY2VPclNlcnZpY2VDaG9pY2UgPSAnZGV2aWNlJztcblxuICAgICAgICAgICAgaWYgKCFzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkRGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nTGVmdERldmljZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VTdGF0ZUNvbmZpZy5hY3R1YXRvcikge1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRBc3NldCA9IGZpbmRBc3NldChkZXZpY2VzLCBkZXZpY2VTdGF0ZUNvbmZpZy5kZXZpY2UsIGRldmljZVN0YXRlQ29uZmlnLmFjdHVhdG9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZVN0YXRlQ29uZmlnLnNlbnNvcikge1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRBc3NldCA9IGZpbmRBc3NldChkZXZpY2VzLCBkZXZpY2VTdGF0ZUNvbmZpZy5kZXZpY2UsIGRldmljZVN0YXRlQ29uZmlnLnNlbnNvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVSdWxlU2VjdGlvblZpZXdNb2RlbChvcGVyYXRvcikge1xuICAgICAgICAgICAgdmFyIHNlY3Rpb25WaWV3TW9kZWwgPSB7XG4gICAgICAgICAgICAgICAgZGV2aWNlT3JTZXJ2aWNlQ2hvaWNlOiBudWxsLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRGV2aWNlOiBudWxsLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkU2VydmljZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZE5vdGlmaWNhdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgd2ViOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBwdXNoOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbXBhcmVUeXBlOiBudWxsLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQXNzZXQ6IG51bGwsXG4gICAgICAgICAgICAgICAgY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIG9wOiBvcGVyYXRvciA/IG9wZXJhdG9yIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG51bGxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgb3A6IG9wZXJhdG9yID8gb3BlcmF0b3IgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2U6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHNlcnZpY2U6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGFzc2V0OiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWN0aW9uT3BlcmFuZDogbnVsbCxcbiAgICAgICAgICAgICAgICBzZXJ2aWNlQWN0dWF0b3JWYWx1ZTogbnVsbFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25WaWV3TW9kZWw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYXBSdWxlUHJldmlldyhydWxlRGVmaW5pdGlvbiwgc2VjdGlvbk5hbWUsIHdob2xlU2VjdGlvblZpZXdNb2RlbCwgZGV2aWNlcywgc2VydmljZXMpIHtcblxuICAgICAgICAgICAgdmFyIGRlZlNlY3Rpb24gPSBudWxsO1xuXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcblxuICAgICAgICAgICAgdmFyIGRheVRpbWVTZXJ2aWNlID0gZGF5VGltZS5kYXlUaW1lKCk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcnVsZURlZmluaXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAocnVsZURlZmluaXRpb25baV0uaGFzT3duUHJvcGVydHkoc2VjdGlvbk5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcnVsZURlZmluaXRpb25baV1bc2VjdGlvbk5hbWVdLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbk5hbWUgPT09ICd3aGVuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdob2xlU2VjdGlvblZpZXdNb2RlbC5wdXNoKGNyZWF0ZVJ1bGVTZWN0aW9uVmlld01vZGVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aG9sZVNlY3Rpb25WaWV3TW9kZWwucHVzaChjcmVhdGVSdWxlU2VjdGlvblZpZXdNb2RlbCgnPScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmU2VjdGlvbiA9IHJ1bGVEZWZpbml0aW9uW2ldW3NlY3Rpb25OYW1lXVtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG1hcFNpbmdsZVNlY3Rpb24oZGVmU2VjdGlvbiwgc2VjdGlvbk5hbWUsIHdob2xlU2VjdGlvblZpZXdNb2RlbFtqXSwgZGV2aWNlcywgc2VydmljZXMsIGRheVRpbWVTZXJ2aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwcGVyQ2FzZVNlY3Rpb25OYW1lID0gdG9QYXNjYWxDYXNlKHNlY3Rpb25OYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVEZWZpbml0aW9uW2ldLmhhc093blByb3BlcnR5KHVwcGVyQ2FzZVNlY3Rpb25OYW1lKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJ1bGVEZWZpbml0aW9uW2ldW3NlY3Rpb25OYW1lXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uTmFtZSA9PT0gJ3doZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdob2xlU2VjdGlvblZpZXdNb2RlbC5wdXNoKGNyZWF0ZVJ1bGVTZWN0aW9uVmlld01vZGVsKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdob2xlU2VjdGlvblZpZXdNb2RlbC5wdXNoKGNyZWF0ZVJ1bGVTZWN0aW9uVmlld01vZGVsKCc9JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZlNlY3Rpb24gPSBydWxlRGVmaW5pdGlvbltpXVt1cHBlckNhc2VTZWN0aW9uTmFtZV1bal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbWFwU2luZ2xlU2VjdGlvbihkZWZTZWN0aW9uLCBzZWN0aW9uTmFtZSwgd2hvbGVTZWN0aW9uVmlld01vZGVsW2pdLCBkZXZpY2VzLCBzZXJ2aWNlcywgZGF5VGltZVNlcnZpY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWZTZWN0aW9uID0gcnVsZURlZmluaXRpb25baV1bdXBwZXJDYXNlU2VjdGlvbk5hbWVdWzBdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbWFwU2luZ2xlU2VjdGlvbihkZWZTZWN0aW9uLCBzZWN0aW9uTmFtZSwgc2VjdGlvblZpZXdNb2RlbCwgZGV2aWNlcywgc2VydmljZXMsIGRheVRpbWVTZXJ2aWNlKSB7XG4gICAgICAgICAgICBpZiAoIWRlZlNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmhhc093blByb3BlcnR5KCdhbmQnKSkge1xuICAgICAgICAgICAgICAgIGRlZlNlY3Rpb24gPSBkZWZTZWN0aW9uLmFuZDtcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlY3Rpb25PcGVyYW5kID0gJ2FuZCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmhhc093blByb3BlcnR5KCdvcicpKSB7XG4gICAgICAgICAgICAgICAgZGVmU2VjdGlvbiA9IGRlZlNlY3Rpb24ub3I7XG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5zZWN0aW9uT3BlcmFuZCA9ICdvcic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwcm9maWxlID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKCFkZWZTZWN0aW9uLmxlZnQpIHsgLy9pZiB0aGVyZSBpcyBubyAnbGVmdCcgcGFydCBpbiBzZWN0aW9uIGl0IGlzIGFzc3VtZWQgdGhlIHJ1bGUgaXMgRGV2aWNlU3RhdGVDaGFuZ2UgcnVsZSBhbmQgdGhhdCBPbkV2ZXJ5Q2hhbmdlIHdhcyBzZWxlY3RlZC5cblxuICAgICAgICAgICAgICAgIG1hcERldmljZVN0YXRlUGFydChzZWN0aW9uVmlld01vZGVsLCBkZWZTZWN0aW9uLCBkZXZpY2VzKTtcblxuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRDb21wYXJlVHlwZSA9ICdjb25zdGFudCc7XG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5jb25zdGFudENvbXBhcmVPcGVyYXRpb24ub3AgPSAnT0VDJztcblxuICAgICAgICAgICAgICAgIGlmICghc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwubWlzc2luZ0xlZnRBc3NldCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZSA9IHNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRBc3NldC5wcm9maWxlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBzZWN0aW9uVmlld01vZGVsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL01hcHBpbmcgbGVmdCBwYXJ0XG4gICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlcnZpY2UgPT0gJ2Fzc2V0Jykge1xuXG4gICAgICAgICAgICAgICAgbWFwRGV2aWNlU3RhdGVQYXJ0KHNlY3Rpb25WaWV3TW9kZWwsIGRlZlNlY3Rpb24ubGVmdCwgZGV2aWNlcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNlY3Rpb25WaWV3TW9kZWwuc2VsZWN0ZWRBc3NldCkge1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLm1pc3NpbmdMZWZ0QXNzZXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2ZpbGUgPSBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkQXNzZXQucHJvZmlsZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ubGVmdC5zZXJ2aWNlID09ICdkYXlUaW1lJykge1xuICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuZGV2aWNlT3JTZXJ2aWNlQ2hvaWNlID0gJ3NlcnZpY2UnO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ubGVmdC5zZW5zb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UgPSBkYXlUaW1lU2VydmljZVswXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwcm9maWxlID0gc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UucHJvZmlsZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlcnZpY2UgPT0gJ25vdGlmeScpIHtcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmRldmljZU9yU2VydmljZUNob2ljZSA9ICdzZXJ2aWNlJztcblxuICAgICAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLmxlZnQuYWN0dWF0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UgPSBmaW5kU2VydmljZShzZXJ2aWNlcywgZGVmU2VjdGlvbi5sZWZ0LmFjdHVhdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UgPSBzZXJ2aWNlc1swXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5sZWZ0LnNlbnNvcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IGZpbmRTZXJ2aWNlKHNlcnZpY2VzLCBkZWZTZWN0aW9uLmxlZnQuc2Vuc29yKTtcbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UgPSBzZXJ2aWNlc1swXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBwcm9maWxlID0gc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZFNlcnZpY2UucHJvZmlsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9NYXBwaW5nIHJpZ2h0IHBhcnRcbiAgICAgICAgICAgIGlmICghZGVmU2VjdGlvbi5yaWdodC5oYXNPd25Qcm9wZXJ0eSgnc2VydmljZScpKSB7XG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5zZWxlY3RlZENvbXBhcmVUeXBlID0gJ2NvbnN0YW50JztcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi5vcCA9IGRlZlNlY3Rpb24ub3A7XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvZmlsZSAmJiBwcm9maWxlLnR5cGUgPT0gJ2RhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlID0gbmV3IERhdGUoZGVmU2VjdGlvbi5yaWdodCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9maWxlICYmIGlzUHJvZmlsZU51bWVyaWMocHJvZmlsZS50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSA9IE51bWJlcihkZWZTZWN0aW9uLnJpZ2h0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb2ZpbGUgJiYgaXNQcm9maWxlQm9vbGVhbihwcm9maWxlLnR5cGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkZWZTZWN0aW9uLnJpZ2h0ID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5jb25zdGFudENvbXBhcmVPcGVyYXRpb24udmFsdWUgPSBkZWZTZWN0aW9uLnJpZ2h0LnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSA9IGRlZlNlY3Rpb24ucmlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlZlNlY3Rpb24ubGVmdC5zZXJ2aWNlID09ICdkYXlUaW1lJykge1xuICAgICAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSA9IGRheVRpbWUudXRjQ3JvblRvTG9jYWxUaW1lKGRlZlNlY3Rpb24ucmlnaHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlID0gZGVmU2VjdGlvbi5yaWdodDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnNlbGVjdGVkQ29tcGFyZVR5cGUgPSAncmVmZXJlbmNlJztcbiAgICAgICAgICAgICAgICBzZWN0aW9uVmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24ub3AgPSBkZWZTZWN0aW9uLm9wO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ucmlnaHQuc2VydmljZSA9PSAnYXNzZXQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmRldmljZSA9IGZpbmREZXZpY2UoZGV2aWNlcywgZGVmU2VjdGlvbi5yaWdodC5kZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2VjdGlvblZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nUmlnaHREZXZpY2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ucmlnaHQuYWN0dWF0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5hc3NldCA9IGZpbmRBc3NldChkZXZpY2VzLCBkZWZTZWN0aW9uLnJpZ2h0LmRldmljZSwgZGVmU2VjdGlvbi5yaWdodC5hY3R1YXRvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5yaWdodC5zZW5zb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5hc3NldCA9IGZpbmRBc3NldChkZXZpY2VzLCBkZWZTZWN0aW9uLnJpZ2h0LmRldmljZSwgZGVmU2VjdGlvbi5yaWdodC5zZW5zb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzZWN0aW9uVmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uYXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwubWlzc2luZ1JpZ2h0QXNzZXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGRlZlNlY3Rpb24ucmlnaHQuc2VydmljZSA9PSAnbm90aWZ5Jykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWZTZWN0aW9uLnJpZ2h0LmFjdHVhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZWN0aW9uVmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uc2VydmljZSA9IGZpbmRTZXJ2aWNlKHNlcnZpY2VzLCBkZWZTZWN0aW9uLnJpZ2h0LmFjdHVhdG9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5zZXJ2aWNlID0gc2VydmljZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVmU2VjdGlvbi5yaWdodC5zZW5zb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5zZXJ2aWNlID0gZmluZFNlcnZpY2Uoc2VydmljZXMsIGRlZlNlY3Rpb24ucmlnaHQuc2Vuc29yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb25WaWV3TW9kZWwucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5zZXJ2aWNlID0gc2VydmljZXNbMF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZXNldFJ1bGVTZWN0aW9uVmlld01vZGVsKHZpZXdNb2RlbCkge1xuICAgICAgICAgICAgdmlld01vZGVsLmRldmljZU9yU2VydmljZUNob2ljZSA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuc2VsZWN0ZWREZXZpY2UgPSBudWxsO1xuICAgICAgICAgICAgdmlld01vZGVsLnNlbGVjdGVkU2VydmljZSA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuc2VsZWN0ZWROb3RpZmljYXRpb25zLndlYiA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuc2VsZWN0ZWROb3RpZmljYXRpb25zLnB1c2ggPSBudWxsO1xuICAgICAgICAgICAgdmlld01vZGVsLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5lbWFpbCA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuc2VsZWN0ZWRDb21wYXJlVHlwZSA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuc2VsZWN0ZWRBc3NldCA9IG51bGw7XG4gICAgICAgICAgICB2aWV3TW9kZWwuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLm9wID0gbnVsbDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5jb25zdGFudENvbXBhcmVPcGVyYXRpb24udmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgdmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24ub3AgPSBudWxsO1xuICAgICAgICAgICAgdmlld01vZGVsLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlID0gbnVsbDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmFzc2V0ID0gbnVsbDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLnNlcnZpY2UgPSBudWxsO1xuICAgICAgICAgICAgdmlld01vZGVsLnNlY3Rpb25PcGVyYW5kID0gbnVsbDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5zZXJ2aWNlQWN0dWF0b3JWYWx1ZSA9IG51bGw7XG5cbiAgICAgICAgfVxuXG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3NlcnZpY2UuZGF5VGltZScsIHNlcnZpY2VEYXlUaW1lKTtcblxuICAgIHNlcnZpY2VEYXlUaW1lLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIHNlcnZpY2VEYXlUaW1lKCkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZGF5VGltZTogcmV0dXJuRGF5VGltZVNlcnZpY2UsXG4gICAgICAgICAgICBsb2NhbFRpbWVDcm9uVG9VVENUaW1lOiBnZW5lcmF0ZUNyb25Gb3JVVEMsXG4gICAgICAgICAgICB1dGNDcm9uVG9Mb2NhbFRpbWU6IGdlbmVyYXRlQ3JvbkZvckxvY2FsVGltZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICBmdW5jdGlvbiByZXR1cm5EYXlUaW1lU2VydmljZSgpIHtcbiAgICAgICAgICAgdmFyIGRheVRpbWUgPSBbe1xuICAgICAgICAgICAgICAgIGlzOiAnc2Vuc29yJyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjcm9uJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6ICc1NDEyZWFiM2RhOGFiNzFkMTRiZmZmZmYnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdEYXkgYW5kIFRpbWUnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdkYXlUaW1lJyxcbiAgICAgICAgICAgICAgICBpY29uS2V5OiAnZmEtZGF5LXRpbWUnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU2V0IGRheSBhbmQgdGltZSB0byB0cmlnZ2VyIHRoaXMgcnVsZScsXG4gICAgICAgICAgICAgICAgZGV0YWlsc1BhZ2U6ICcnXG4gICAgICAgICAgICB9XTtcblxuICAgICAgICAgICAgcmV0dXJuIGRheVRpbWU7XG4gICAgICAgfTtcblxuICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ3JvbkZvckxvY2FsVGltZSAodXRjQ3Jvbil7XG4gICAgICAgIHZhciAgdXRjVGltZUNyb24gPSB1dGNDcm9uLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgIHZhciBtaW4gPSB1dGNUaW1lQ3JvblsxXTtcbiAgICAgICAgICAgIHZhciBob3VyID0gdXRjVGltZUNyb25bMl07XG4gICAgICAgICAgICB2YXIgZGF5T2ZNb250aCA9IHV0Y1RpbWVDcm9uWzNdO1xuICAgICAgICAgICAgdmFyIG1vbnRoID0gdXRjVGltZUNyb25bNF07XG4gICAgICAgICAgICB2YXIgZGF5c09mV2VlayA9IFsnTU9OJywgJ1RVRScsICdXRUQnLCAnVEhVJywgJ0ZSSScsICdTQVQnLCAnU1VOJ107XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWREYXlzO1xuXG4gICAgICAgICAgICBpZiAodXRjQ3Jvbls1XSkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkRGF5cyA9IHV0Y1RpbWVDcm9uWzVdLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9mZnNldCA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciBsb2NhbE1pbnV0ZXMgPSAwO1xuICAgICAgICAgICAgdmFyIGNyb24gPSAnMCAnO1xuICAgICAgICAgICAgdmFyIGhvdXJzID0gcGFyc2VJbnQoaG91cik7XG4gICAgICAgICAgICB2YXIgbWludXRlcyA9IHBhcnNlSW50KG1pbik7XG5cblxuICAgICAgICAgICAgbG9jYWxNaW51dGVzID0gaG91cnMgKiA2MCArIG1pbnV0ZXM7XG5cblxuICAgICAgICAgICAgdmFyIGRpZmYgPSBsb2NhbE1pbnV0ZXMgLSBvZmZzZXQ7XG5cbiAgICAgICAgICAgIHZhciBzaGlmdERheXM7XG5cbiAgICAgICAgICAgIGlmIChkaWZmIDwgMCkge1xuICAgICAgICAgICAgICAgIGlmIChob3VycyA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXJzID0gMjQgKyBNYXRoLmZsb29yKGRpZmYgLyA2MCk7XG4gICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSAoKChtaW51dGVzICsgNjApICsgb2Zmc2V0KSAlIDYwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtaW51dGVzID0gKChkaWZmKSAlIDYwKSAqICgtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNoaWZ0RGF5cyA9ICdwcmV2aW91cyc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpZmYgPj0gMTQ0MCkge1xuICAgICAgICAgICAgICAgIGhvdXJzID0gTWF0aC5mbG9vcihkaWZmIC8gNjApIC0gMjQ7XG4gICAgICAgICAgICAgICAgbWludXRlcyA9IChkaWZmKSAlIDYwO1xuICAgICAgICAgICAgICAgIHNoaWZ0RGF5cyA9ICduZXh0JztcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGhvdXJzID0gTWF0aC5mbG9vcihkaWZmIC8gNjApO1xuICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBkaWZmICUgNjA7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgY3JvbiArPSBtaW51dGVzICsgJyAnO1xuICAgICAgICAgICAgY3JvbiArPSBob3VycyArICcgJztcbiAgICAgICAgICAgIGNyb24gKz0gJz8gKiAnO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGVkRGF5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBkYXlPcmRlciA9IGRheXNPZldlZWsuaW5kZXhPZihzZWxlY3RlZERheXNbaV0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNoaWZ0RGF5cyA9PSAncHJldmlvdXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXlPcmRlciA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyb24gKz0gZGF5c09mV2Vla1tkYXlPcmRlciAtIDFdICsgJywnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3JvbiArPSBkYXlzT2ZXZWVrW2RheXNPZldlZWsubGVuZ3RoIC0gMV0gKyAnLCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNoaWZ0RGF5cyA9PSAnbmV4dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheU9yZGVyID09IChkYXlzT2ZXZWVrLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcm9uICs9IGRheXNPZldlZWtbMF0gKyAnLCc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcm9uICs9IGRheXNPZldlZWtbZGF5T3JkZXIgKyAxXSArICcsJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNyb24gKz0gc2VsZWN0ZWREYXlzW2ldICsgJywnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNyb24gPSBjcm9uLnNsaWNlKDAsIC0xKTtcblxuICAgICAgICAgICAgcmV0dXJuIGNyb247XG4gICAgICAgfTtcblxuXG5cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVDcm9uRm9yVVRDKGxvY2FsVGltZUNyb24pIHtcblxuICAgICAgICAgICAgdmFyIGxvY2FsQ3JvbiA9IGxvY2FsVGltZUNyb24uc3BsaXQoXCIgXCIpO1xuICAgICAgICAgICAgdmFyIG1pbiA9IGxvY2FsQ3JvblsxXTtcbiAgICAgICAgICAgIHZhciBob3VyID0gbG9jYWxDcm9uWzJdO1xuICAgICAgICAgICAgdmFyIGRheU9mTW9udGggPSBsb2NhbENyb25bM107XG4gICAgICAgICAgICB2YXIgbW9udGggPSBsb2NhbENyb25bNF07XG4gICAgICAgICAgICB2YXIgZGF5c09mV2VlayA9IFsnTU9OJywgJ1RVRScsICdXRUQnLCAnVEhVJywgJ0ZSSScsICdTQVQnLCAnU1VOJ107XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWREYXlzO1xuXG4gICAgICAgICAgICBpZiAobG9jYWxDcm9uWzVdKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWREYXlzID0gbG9jYWxDcm9uWzVdLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9mZnNldCA9IG5ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgICAgIHZhciBsb2NhbE1pbnV0ZXMgPSAwO1xuICAgICAgICAgICAgdmFyIGNyb24gPSAnMCAnO1xuICAgICAgICAgICAgdmFyIGhvdXJzID0gcGFyc2VJbnQoaG91cik7XG4gICAgICAgICAgICB2YXIgbWludXRlcyA9IHBhcnNlSW50KG1pbik7XG5cblxuICAgICAgICAgICAgbG9jYWxNaW51dGVzID0gaG91cnMgKiA2MCArIG1pbnV0ZXM7XG5cblxuICAgICAgICAgICAgdmFyIGRpZmYgPSBsb2NhbE1pbnV0ZXMgKyBvZmZzZXQ7XG5cbiAgICAgICAgICAgIHZhciBzaGlmdERheXM7XG5cbiAgICAgICAgICAgIGlmIChkaWZmIDwgMCkge1xuICAgICAgICAgICAgICAgIGlmIChob3VycyA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhvdXJzID0gMjQgKyBNYXRoLmZsb29yKGRpZmYgLyA2MCk7XG4gICAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSAoKChtaW51dGVzICsgNjApICsgb2Zmc2V0KSAlIDYwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtaW51dGVzID0gKChkaWZmKSAlIDYwKSAqICgtMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNoaWZ0RGF5cyA9ICdwcmV2aW91cyc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpZmYgPiAxNDQwKSB7XG4gICAgICAgICAgICAgICAgaG91cnMgPSBNYXRoLmZsb29yKGRpZmYgLyA2MCkgLSAyNDtcbiAgICAgICAgICAgICAgICBtaW51dGVzID0gKGRpZmYpICUgNjA7XG4gICAgICAgICAgICAgICAgc2hpZnREYXlzID0gJ25leHQnO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgaG91cnMgPSBNYXRoLmZsb29yKGRpZmYgLyA2MCk7XG4gICAgICAgICAgICAgICAgbWludXRlcyA9IGRpZmYgJSA2MDtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBjcm9uICs9IG1pbnV0ZXMgKyAnICc7XG4gICAgICAgICAgICBjcm9uICs9IGhvdXJzICsgJyAnO1xuICAgICAgICAgICAgY3JvbiArPSAnPyAqICc7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWREYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRheU9yZGVyID0gZGF5c09mV2Vlay5pbmRleE9mKHNlbGVjdGVkRGF5c1tpXSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2hpZnREYXlzID09ICdwcmV2aW91cycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheU9yZGVyID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3JvbiArPSBkYXlzT2ZXZWVrW2RheU9yZGVyIC0gMV0gKyAnLCc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcm9uICs9IGRheXNPZldlZWtbZGF5c09mV2Vlay5sZW5ndGggLSAxXSArICcsJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hpZnREYXlzID09ICduZXh0Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF5T3JkZXIgPT0gKGRheXNPZldlZWsubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyb24gKz0gZGF5c09mV2Vla1swXSArICcsJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyb24gKz0gZGF5c09mV2Vla1tkYXlPcmRlciArIDFdICsgJywnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3JvbiArPSBzZWxlY3RlZERheXNbaV0gKyAnLCc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY3JvbiA9IGNyb24uc2xpY2UoMCwgLTEpO1xuXG4gICAgICAgICAgICByZXR1cm4gY3JvbjtcbiAgICAgICAgfVxuXG4gICAgfTtcbn0od2luZG93LmFuZ3VsYXIpKTsiLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgndXRpbGl0eS5kZXZpY2VJY29ucycsIGRldmljZUljb25zKTtcbiAgICBkZXZpY2VJY29ucy4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBkZXZpY2VJY29ucygpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGdldEljb25cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaWNvbnMgPSB7XG4gICAgICAgICAgICAnYmluYXJ5LXNlbnNvcic6ICdzbC1kZXZpY2UtZmxvb2Qtc2Vuc29yJyxcbiAgICAgICAgICAgICdiaW5hcnktc3dpdGNoJzogJ3NsLWRldmljZS1yZWxheScsXG4gICAgICAgICAgICAnZmxvb2Qtc2Vuc29yJzogJ3NsLWRldmljZS1mbG9vZC1zZW5zb3InLFxuICAgICAgICAgICAgJ21vdGlvbi1zZW5zb3InOiAnc2wtZGV2aWNlLW1vdGlvbi1zZW5zb3InLFxuICAgICAgICAgICAgJ3dhbGwtcGx1Zyc6ICdzbC1kZXZpY2Utd2FsbC1wbHVnJyxcbiAgICAgICAgICAgICdkZXZpY2UtY3VzdG9tJzogJ3NsLWRldmljZS1jdXN0b20nLFxuICAgICAgICAgICAgJ2ludGVsLWVkaXNvbic6ICdzbC1kZXZpY2UtaW50ZWwtZWRpc29uJyxcbiAgICAgICAgICAgICdxdWljay1kZW1vJzogJ3NsLWRldmljZS1tb2JpbGUnLFxuICAgICAgICAgICAgJ3Byb3hpbXVzLWxvcmEnOiAnc2wtZGV2aWNlLWxvcmEnLFxuICAgICAgICAgICAgJ2RldmljZS1wcm94aW11cy1sb3JhJzogJ3NsLWRldmljZS1sb3JhJyxcblxuICAgICAgICAgICAgZ2F0ZXdheTogJ3NsLWRldmljZS1nYXRld2F5JyxcblxuICAgICAgICAgICAgYXJkdWlubzogJ3NsLWRldmljZS1hcmR1aW5vJyxcbiAgICAgICAgICAgIHJwaTogJ3NsLWRldmljZS1ycGknLFxuICAgICAgICAgICAgZmFfZW52ZWxvcGU6ICdzbC1zZXJ2aWNlLWVtYWlsJyxcbiAgICAgICAgICAgIGZhX2RheV90aW1lOiAnc2wtc2VydmljZS1jYWxlbmRhcicsXG4gICAgICAgICAgICBhc3NldDogJ3NsLWFzc2V0LWRlZmF1bHQnLFxuICAgICAgICAgICAgc2Vuc29yOiAnc2wtYXNzZXQtc2Vuc29yJyxcbiAgICAgICAgICAgIGFjdHVhdG9yOiAnc2wtYXNzZXQtYWN0dWF0b3InLFxuICAgICAgICAgICAgdmlydHVhbDogJ3NsLWFzc2V0LXZpcnR1YWwnLFxuICAgICAgICAgICAgY29uZmlnOiAnc2wtYXNzZXQtY29uZmlnJyxcbiAgICAgICAgICAgIGN1c3RvbTogJ3NsLWRldmljZS1jdXN0b20nXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0SWNvbihkZXZpY2VOYW1lKSB7XG4gICAgICAgICAgICBpZiAoZGV2aWNlTmFtZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpY29ucy5jdXN0b207XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpY29uID0gaWNvbnNbZGV2aWNlTmFtZV07XG5cbiAgICAgICAgICAgIGlmIChpY29uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGljb247XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBpY29ucy5jdXN0b207XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgndXRpbGl0eS5nZW9Mb2NhdGlvbicsIFtcbiAgICAgICAgJyRxJyxcbiAgICAgICAgZnVuY3Rpb24oJHEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZ2V0TG9jYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oZGVmZXJyZWQucmVzb2x2ZSwgZGVmZXJyZWQucmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCd1dGlsaXR5Lmdvb2dsZU1hcHMnLCBbXG4gICAgICAgICckcScsXG4gICAgICAgICckbG9nJyxcbiAgICAgICAgJyRyb290U2NvcGUnLFxuICAgICAgICAnJGRvY3VtZW50JyxcbiAgICAgICAgJyR3aW5kb3cnLFxuICAgICAgICBmdW5jdGlvbiAoJHEsICRsb2csICRyb290U2NvcGUsICRkb2N1bWVudCwgJHdpbmRvdykge1xuICAgICAgICAgICAgdmFyIGFwaUtleSA9IFwiQUl6YVN5QmJhaEtXVTlZWTNlQVEyeUhOSlczUUVOeVpOR19TWTh3XCI7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAkd2luZG93Lmdvb2dsZU1hcHNMb2FkRG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCR3aW5kb3cuZ29vZ2xlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWRTY3JpcHQoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjcmlwdCA9ICRkb2N1bWVudFswXS5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblxuICAgICAgICAgICAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgICAgICAgICAgc2NyaXB0LnNyYyA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/dj0zLmV4cCZjYWxsYmFjaz1nb29nbGVNYXBzTG9hZERvbmUmbGlicmFyaWVzPXBsYWNlcyxnZW9tZXRyeSZrZXk9JyArIGFwaUtleTtcblxuICAgICAgICAgICAgICAgICRkb2N1bWVudFswXS5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghbmcuaXNEZWZpbmVkKCR3aW5kb3cuZ29vZ2xlKSkge1xuICAgICAgICAgICAgICAgIGxvYWRTY3JpcHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdodHRwVG9rZW5JbnRlcmNlcHRvcicsIEh0dHBUb2tlbkludGVyY2VwdG9yKTtcblxuICAgIEh0dHBUb2tlbkludGVyY2VwdG9yLiRpbmplY3QgPSBbXG4gICAgICAgICckcScsXG4gICAgICAgICckaW5qZWN0b3InLFxuICAgICAgICAnYXBpLnVybCcsXG4gICAgICAgICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJyxcbiAgICAgICAgJ3Nlc3Npb24nXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIEh0dHBUb2tlbkludGVyY2VwdG9yKCRxLCAkaW5qZWN0b3IsIGFwaVVybCwgbG9jYWxTdG9yYWdlU2VydmljZSwgc2Vzc2lvbikge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcbiAgICAgICAgICAgIHJlc3BvbnNlRXJyb3I6IHJlc3BvbnNlRXJyb3JcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIHJlcXVlc3QoY29uZmlnKSB7XG5cbiAgICAgICAgICAgIGlmIChpc0F0dEFwaShjb25maWcudXJsKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XG5cbiAgICAgICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW4gPSBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkuYWNjZXNzVG9rZW47XG5cbiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4gJiYgIWNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZXNwb25zZUVycm9yKHJlamVjdGlvbikge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAxICYmIGlzQXR0QXBpKHJlamVjdGlvbi5jb25maWcudXJsKSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlamVjdGlvbi5jb25maWcuX19kb25vdHJlZnJlc2h0b2tlbikge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gJGluamVjdG9yLmdldCgnJHN0YXRlJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXJlamVjdGlvbi5jb25maWcuX190b2tlbnJlZnJlc2hlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdXRoU2VydmljZSA9ICRpbmplY3Rvci5nZXQoJ2F1dGhTZXJ2aWNlJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZWZyZXNoVG9rZW4gPSBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucmVmcmVzaFRva2VuO1xuXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24uY2xlYXJBdXRoZW50aWNhdGlvbkRhdGEoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVmcmVzaFRva2VuICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3Rpb24uY29uZmlnLl9fdG9rZW5yZWZyZXNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gcmVqZWN0aW9uLmNvbmZpZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5SHR0cFJlcXVlc3QocmVqZWN0aW9uLmNvbmZpZywgZGVmZXJyZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbygndW5hdXRob3JpemVkJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlamVjdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNBdHRBcGkodXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsLnN1YnN0cmluZygwLCBhcGlVcmwubGVuZ3RoKSA9PSBhcGlVcmw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZXRyeUh0dHBSZXF1ZXN0KGNvbmZpZywgZGVmZXJyZWQpIHtcblxuICAgICAgICAgICAgdmFyICRodHRwID0gJGluamVjdG9yLmdldCgnJGh0dHAnKTtcblxuICAgICAgICAgICAgJGh0dHAoY29uZmlnKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRLZXlGcm9tTG9jYWxTdG9yYWdlQXV0aChrZXkpIHtcblxuICAgICAgICAgICAgdmFyIGF1dGggPSBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHJldHVybiAoYXV0aCAmJiBhdXRoW2tleV0pID8gYXV0aFtrZXldIDogbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFwcC5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJGh0dHBQcm92aWRlcikge1xuXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBUb2tlbkludGVyY2VwdG9yJyk7XG5cbiAgICB9XSk7XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ3V0aWxpdHkuaW5wdXRTdGF0ZVZhbGlkYXRvcicsIFtcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBpc0VtcHR5KHZhbCkge1xuICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gJycgfHwgIXZhbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlzVmFsaWRJbnRlZ2VyOiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0VtcHR5KHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWlzTmFOKHZhbCk7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGlzVmFsaWRTdHJpbmc6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRW1wdHkodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBpc1ZhbGlkQm9vbGVhbjogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNFbXB0eSh2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsID09ICd0cnVlJyB8fCB2YWwgPT0gJ2ZhbHNlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBpc1ZhbGlkSnNvbjogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNFbXB0eSh2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmcuZnJvbUpTT04odmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuXG5cbiAgICAgICAgICAgICAgICB2YWxpZGF0ZUJ5VHlwZTogZnVuY3Rpb24odHlwZSwgdmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYm9vbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZEJvb2xlYW4odmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ludCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZEludGVnZXIodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZFN0cmluZyh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnanNvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZEpzb24odmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdzZXNzaW9uJywgc2Vzc2lvbik7XG5cbiAgICBzZXNzaW9uLiRpbmplY3QgPSBbJyRxJywgJyRsb2cnLCAnbG9jYWxTdG9yYWdlU2VydmljZScsICckcm9vdFNjb3BlJywgJ25vdGlmeVNlcnZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIHNlc3Npb24oJHEsICRsb2csIGxvY2FsU3RvcmFnZVNlcnZpY2UsICRyb290U2NvcGUsIG5vdGlmeVNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGluaXQ6IGluaXQsXG4gICAgICAgICAgICBhdXRoZW50aWNhdGlvbjogZ2V0QXV0aGVudGljYXRpb25EYXRhLFxuICAgICAgICAgICAgc2F2ZUF1dGhlbnRpY2F0aW9uRGF0YTogc2F2ZUF1dGhlbnRpY2F0aW9uRGF0YSxcbiAgICAgICAgICAgIGNsZWFyQXV0aGVudGljYXRpb25EYXRhOiBjbGVhckF1dGhlbnRpY2F0aW9uRGF0YSxcbiAgICAgICAgICAgIGdldFVzZXJEZXRhaWxzOiBnZXRVc2VyRGV0YWlscyxcbiAgICAgICAgICAgIHNldFVzZXJEZXRhaWxzOiBzZXRVc2VyRGV0YWlsc1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuXG4gICAgICAgICAgICBpZiAoIWdldEF1dGhlbnRpY2F0aW9uRGF0YSgpKSB7XG5cbiAgICAgICAgICAgICAgICBjbGVhckF1dGhlbnRpY2F0aW9uRGF0YSgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRyb290U2NvcGUuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBnZXRBdXRoZW50aWNhdGlvbkRhdGEoKTtcblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0aW9uRGF0YSgpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYXV0aGVudGljYXRpb25EYXRhJyk7XG5cbiAgICAgICAgICAgIGlmIChpc1ZhbGlkQWNjZXNzVG9rZW4oZGF0YSkpIHtcblxuICAgICAgICAgICAgICAgIGRhdGEuaXNBdXRoID0gdHJ1ZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVBdXRoZW50aWNhdGlvbkRhdGEoZGF0YSkge1xuXG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgZGF0YS5pc0F1dGggPSB0cnVlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRoZW50aWNhdGlvbkRhdGEnLCB7XG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogZGF0YS5yZWZyZXNoX3Rva2VuLFxuICAgICAgICAgICAgICAgIGlzc3VlZDogZGF0YVsnLmlzc3VlZCddLFxuICAgICAgICAgICAgICAgIGV4cGlyZXM6IGRhdGFbJy5leHBpcmVzJ10sXG4gICAgICAgICAgICAgICAgcm1xOiB7XG4gICAgICAgICAgICAgICAgICAgIGNsaWVudElkOiBkYXRhWydybXE6Y2xpZW50SWQnXSxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50S2V5OiBkYXRhWydybXE6Y2xpZW50S2V5J11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBkYXRhLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIGlzQXV0aDogZGF0YS5pc0F1dGhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xlYXJBdXRoZW50aWNhdGlvbkRhdGEoKSB7XG5cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRoZW50aWNhdGlvbkRhdGEnLCB7XG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IG51bGwsXG4gICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBudWxsLFxuICAgICAgICAgICAgICAgIGlzc3VlZDogbnVsbCxcbiAgICAgICAgICAgICAgICBleHBpcmVzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJtcTogbnVsbCxcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJycsXG4gICAgICAgICAgICAgICAgaXNBdXRoOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCd1c2VyRGV0YWlscycsIG51bGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0VXNlckRldGFpbHMoZGF0YSkge1xuXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgndXNlckRldGFpbHMnLCBkYXRhKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlckRldGFpbHMoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgndXNlckRldGFpbHMnKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZEFjY2Vzc1Rva2VuKGRhdGEpIHtcblxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRhLmV4cGlyZXMpID4gbmV3IERhdGUoKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCd1dGlsaXR5LnR5cGVDb252ZXJ0ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHRvVHlwZSwgZnJvbVR5cGUpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodG9UeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaW50JzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGZyb21UeXBlKTtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnJvbVR5cGU7XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbCc6XG4gICAgICAgICAgICAgICAgICAgIGlmIChmcm9tVHlwZSA9PSAndHJ1ZScpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBjYXNlICdqc29uJzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZyb21UeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3ZhbGlkYXRvckhlbHBlcicsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCkge1xuXG4gICAgICAgIGZ1bmN0aW9uIFZhbGlkYXRvckhlbHBlcigpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZVVzZXJuYW1lSW5wdXRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmhpZGVGdWxsTmFtZUlucHV0RXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5oaWRlRW1haWxJbnB1dEVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuaGlkZVBhc3N3b3JkSW5wdXRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmhpZGVHcm91bmROYW1lSW5wdXRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnVzZXJuYW1lUGF0dGVybiA9ICdeW2EtekEtWjAtOV9dezEsMzB9JCc7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIFZhbGlkYXRvckhlbHBlci5wcm90b3R5cGUub25Vc2VybmFtZUZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVVc2VybmFtZUlucHV0RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBWYWxpZGF0b3JIZWxwZXIucHJvdG90eXBlLm9uVXNlcm5hbWVCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVVc2VybmFtZUlucHV0RXJyb3IgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIFZhbGlkYXRvckhlbHBlci5wcm90b3R5cGUub25GdWxsTmFtZUZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVGdWxsTmFtZUlucHV0RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBWYWxpZGF0b3JIZWxwZXIucHJvdG90eXBlLm9uRnVsbE5hbWVCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVGdWxsTmFtZUlucHV0RXJyb3IgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIFZhbGlkYXRvckhlbHBlci5wcm90b3R5cGUub25FbWFpbEZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVFbWFpbElucHV0RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBWYWxpZGF0b3JIZWxwZXIucHJvdG90eXBlLm9uRW1haWxCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVFbWFpbElucHV0RXJyb3IgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIFZhbGlkYXRvckhlbHBlci5wcm90b3R5cGUub25QYXNzd29yZEZvY3VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVQYXNzd29yZElucHV0RXJyb3IgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBWYWxpZGF0b3JIZWxwZXIucHJvdG90eXBlLm9uUGFzc3dvcmRCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVQYXNzd29yZElucHV0RXJyb3IgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIFZhbGlkYXRvckhlbHBlci5wcm90b3R5cGUub25Hcm91bmROYW1lRm9jdXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHRoYXQuaGlkZUdyb3VuZE5hbWVJbnB1dEVycm9yID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgVmFsaWRhdG9ySGVscGVyLnByb3RvdHlwZS5vbkdyb3VuZE5hbWVCbHVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0LmhpZGVHcm91bmROYW1lSW5wdXRFcnJvciA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFZhbGlkYXRvckhlbHBlcjtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCd1dGlsaXR5LnZpZXdDb25maWdzJywgW1xuXG4gICAgICAgIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIganNvbkVkaXRvck9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgbGluZVdyYXBwaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXJzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBtb2RlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgdGhlbWU6ICduZW8nLFxuICAgICAgICAgICAgICAgIHNtYXJ0SW5kZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgIGluZGVudFVuaXQ6IDQsXG4gICAgICAgICAgICAgICAgdGFiU2l6ZTogNFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBnZXRKc29uRWRpdG9yT3B0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqc29uRWRpdG9yT3B0aW9ucztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmcubW9kdWxlKCdhcHAnKS5maWx0ZXIoJ2Fzc2V0VHlwZUZpbHRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaXRlbXMsIGFzc2V0VHlwZSkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG5cbiAgICAgICAgICAgIGlmICghaXRlbXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghYXNzZXRUeXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBhc3NldEluZGV4ID0gMDsgYXNzZXRJbmRleCA8IGl0ZW1zLmxlbmd0aDsgYXNzZXRJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2Fzc2V0SW5kZXhdLmlzID09IGFzc2V0VHlwZSB8fCBpdGVtc1thc3NldEluZGV4XS5pcyA9PSAndmlydHVhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChpdGVtc1thc3NldEluZGV4XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyZWQ7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZpbHRlcignYXNzZXRWYWx1ZUZvcm1hdCcsIGFzc2V0VmFsdWVGb3JtYXRGaWx0ZXIpO1xuXG4gICAgYXNzZXRWYWx1ZUZvcm1hdEZpbHRlci4kaW5qZWN0ID0gWydhcGkuYXNzZXRzU2VydmljZScsICckZmlsdGVyJ107XG5cbiAgICBmdW5jdGlvbiBhc3NldFZhbHVlRm9ybWF0RmlsdGVyKGFzc2V0c1NlcnZpY2UsICRmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW0sIHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgaWYgKCFwcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghcHJvZmlsZS50eXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwcm9maWxlVHlwZSA9IGFzc2V0c1NlcnZpY2Uubm9ybWFsaXplUHJvZmlsZVR5cGUocHJvZmlsZS50eXBlKTtcblxuICAgICAgICAgICAgaWYgKHByb2ZpbGVUeXBlID09ICdkYXRldGltZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignYW1EYXRlRm9ybWF0JykoaXRlbSwgJ01NTU0gRG8gWVlZWScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZVR5cGUgPT0gJ2Nyb24nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ2Nyb25GaWx0ZXInKShpdGVtKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgIH07XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmZpbHRlcignY2FwaXRhbGl6ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHNjb3BlKSB7XG4gICAgICAgICAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbnB1dCA9IGlucHV0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQuc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBpbnB1dC5zdWJzdHJpbmcoMSk7XG4gICAgICAgIH07XG4gICAgfSk7XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZpbHRlcignY3JvbkZpbHRlcicsIGNyb25GaWx0ZXIpO1xuXG4gICAgY3JvbkZpbHRlci4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBjcm9uRmlsdGVyKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgdmFyIHByZXR0eUNyb24gPSAnJztcblxuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcblxuICAgICAgICAgICAgICAgIHZhciBjcm9uID0gaXRlbS5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgdmFyIG1pbiA9IGNyb25bMV07XG4gICAgICAgICAgICAgICAgdmFyIGhvdXIgPSBjcm9uWzJdO1xuICAgICAgICAgICAgICAgIHZhciBkYXlPZk1vbnRoID0gY3JvblszXTtcbiAgICAgICAgICAgICAgICB2YXIgbW9udGggPSBjcm9uWzRdO1xuICAgICAgICAgICAgICAgIHZhciBkYXlzT2ZXZWVrO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lT2ZEYXkgPSAnQU0nO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRheXMgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAoY3Jvbls1XSkge1xuICAgICAgICAgICAgICAgICAgICBkYXlzT2ZXZWVrID0gY3Jvbls1XS5zcGxpdChcIixcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXlzT2ZXZWVrLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZGF5c09mV2Vla1tpXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ01PTic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXMgKz0gXCJNb25kYXksIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdUVUUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzICs9IFwiVHVlc2RheSwgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1dFRCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheXMgKz0gXCJXZWRuZXNkYXksIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdUSFUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzICs9IFwiVGh1cnNkYXksIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdGUkknOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlzICs9IFwiRnJpZGF5LCBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU0FUJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5cyArPSBcIlNhdHVyZGF5LCBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU1VOJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5cyArPSBcIlN1bmRheSwgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGRheXNPZldlZWspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheXNPZldlZWtbMF0gPT0gJyonKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJUaGlzIHJ1bGUgd2lsbCBub3QgdHJpZ2dlciB3aXRob3V0IGFueSBzZWxlY3RlZCBkYXkhXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChkYXlzID09ICdNb25kYXksIFR1ZXNkYXksIFdlZG5lc2RheSwgVGh1cnNkYXksIEZyaWRheSwgU2F0dXJkYXksIFN1bmRheSwgJykge1xuICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9ICdFdmVyeSB3ZWVrZGF5JztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRheXMgPT0gJ1NhdHVyZGF5LCBTdW5kYXksICcpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldHR5Q3JvbiArPSAnRXZlcnkgd2Vla2VuZCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXlzID09ICdNb25kYXksIFR1ZXNkYXksIFdlZG5lc2RheSwgVGh1cnNkYXksIEZyaWRheSwgJykge1xuICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9ICdFdmVyeSB3b3JrZGF5JztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9IGRheXMuc2xpY2UoMCwgLTIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByZXR0eUNyb24gKz0gJyBhdCAnO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNIb3VyID0gcGFyc2VJbnQoaG91cik7XG4gICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRIb3VycyA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRNaW51dGVzID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIGlmIChtaW4gPT0gJzAnIHx8IG1pbiA9PSAnNScpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZE1pbnV0ZXMgPSAnMCcgKyBtaW47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZE1pbnV0ZXMgPSBtaW47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNIb3VyID4gMTIgJiYgY0hvdXIgPCAyNCkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lT2ZEYXkgPSAnUE0nO1xuICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkSG91cnMgPSAoaG91ciAtIDEyKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQobm9ybWFsaXplZEhvdXJzKSA8IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9ICcwJyArIG5vcm1hbGl6ZWRIb3VycyArICc6JyArIG5vcm1hbGl6ZWRNaW51dGVzICsgJyAnICsgdGltZU9mRGF5O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldHR5Q3JvbiArPSBub3JtYWxpemVkSG91cnMgKyAnOicgKyBub3JtYWxpemVkTWludXRlcyArICcgJyArIHRpbWVPZkRheTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjSG91ciA8IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVPZkRheSA9ICdBTSc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjSG91ciA8IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9ICcwJyArIGNIb3VyLnRvU3RyaW5nKCkgKyAnOicgKyBub3JtYWxpemVkTWludXRlcyArICcgJyArIHRpbWVPZkRheTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXR0eUNyb24gKz0gY0hvdXIudG9TdHJpbmcoKSArICc6JyArIG5vcm1hbGl6ZWRNaW51dGVzICsgJyAnICsgdGltZU9mRGF5O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjSG91ciA9PSAxMikge1xuICAgICAgICAgICAgICAgICAgICB0aW1lT2ZEYXkgPSAnUE0nO1xuICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9IGNIb3VyLnRvU3RyaW5nKCkgKyAnOicgKyBub3JtYWxpemVkTWludXRlcyArICcgJyArIHRpbWVPZkRheTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY0hvdXIgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lT2ZEYXkgPSAnQU0nO1xuICAgICAgICAgICAgICAgICAgICBwcmV0dHlDcm9uICs9IGNIb3VyLnRvU3RyaW5nKCkgKyAnOicgKyBub3JtYWxpemVkTWludXRlcyArICcgJyArIHRpbWVPZkRheTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNIb3VyID09IDI0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVPZkRheSA9ICdBTSc7XG4gICAgICAgICAgICAgICAgICAgIHByZXR0eUNyb24gKz0gJzAwJyArICc6JyArIG5vcm1hbGl6ZWRNaW51dGVzICsgJyAnICsgdGltZU9mRGF5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHByZXR0eUNyb247XG4gICAgICAgIH07XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmlsdGVyKCdkZXZpY2VzV2l0aEFzc2V0RmlsdGVyJywgZGV2aWNlc1dpdGhBc3NldEZpbHRlckZhY3RvcnkpO1xuXG4gICAgZnVuY3Rpb24gZGV2aWNlc1dpdGhBc3NldEZpbHRlckZhY3RvcnkoKSB7XG5cbiAgICAgICAgcmV0dXJuIGZpbHRlck1ldGhvZDtcblxuICAgICAgICAvLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlck1ldGhvZChpdGVtcywgYXNzZXRUeXBlKSB7XG5cbiAgICAgICAgICAgIGlmICghaXRlbXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghYXNzZXRUeXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXNzZXRUeXBlID09ICcqJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaW5kRGV2aWNlc0NvbnRhaW5pbmdBbnlBc3NldChpdGVtcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmaW5kRGV2aWNlc0NvbnRhaW5pbmdBc3NldHNPZlR5cGUoaXRlbXMsIGFzc2V0VHlwZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kRGV2aWNlc0NvbnRhaW5pbmdBbnlBc3NldChpdGVtcykge1xuXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSBbXTtcblxuICAgICAgICAgICAgZm9yICh2YXIgZGV2aWNlSW5kZXggPSAwOyBkZXZpY2VJbmRleCA8IGl0ZW1zLmxlbmd0aDsgZGV2aWNlSW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtc1tkZXZpY2VJbmRleF0uYXNzZXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChpdGVtc1tkZXZpY2VJbmRleF0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmluZERldmljZXNDb250YWluaW5nQXNzZXRzT2ZUeXBlKGl0ZW1zLCBhc3NldFR5cGUpIHtcblxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGRldmljZUluZGV4ID0gMDsgZGV2aWNlSW5kZXggPCBpdGVtcy5sZW5ndGg7IGRldmljZUluZGV4KyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhc3NldEluZGV4ID0gMDsgYXNzZXRJbmRleCA8IGl0ZW1zW2RldmljZUluZGV4XS5hc3NldHMubGVuZ3RoOyBhc3NldEluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zW2RldmljZUluZGV4XS5hc3NldHNbYXNzZXRJbmRleF0uaXMgPT0gYXNzZXRUeXBlIHx8IGl0ZW1zW2RldmljZUluZGV4XS5hc3NldHNbYXNzZXRJbmRleF0uaXMgPT0gJ3ZpcnR1YWwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZC5wdXNoKGl0ZW1zW2RldmljZUluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdUZXJtc09mVXNlQ29udHJvbGxlcicsIFRlcm1zT2ZVc2VDb250cm9sbGVyKTtcblxuICAgIFRlcm1zT2ZVc2VDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICd0ZXJtc09mVXNlUmVwb3NpdG9yeScsICd1c2VyQ29udGV4dCddO1xuXG4gICAgZnVuY3Rpb24gVGVybXNPZlVzZUNvbnRyb2xsZXIoJHN0YXRlLCB0ZXJtc09mVXNlUmVwb3NpdG9yeSwgdXNlckNvbnRleHQpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnRlcm1zT2ZVc2VIdG1sID0gbnVsbDtcblxuICAgICAgICB2bS5hY2NlcHRUZXJtcyA9IGFjY2VwdFRlcm1zO1xuXG4gICAgICAgIHZtLnNob3dBY2NlcHRCdXR0b24gPSB1c2VyQ29udGV4dC51c2VyICYmICF1c2VyQ29udGV4dC51c2VyLnRlcm1zQWNjZXB0ZWRPbjtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdGVybXNPZlVzZVJlcG9zaXRvcnkuZ2V0VGVybXNPZlVzZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24odGVybXNPZlVzZUh0bWwpIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS50ZXJtc09mVXNlSHRtbCA9IHRlcm1zT2ZVc2VIdG1sO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhY2NlcHRUZXJtcygpIHtcblxuICAgICAgICAgICAgdGVybXNPZlVzZVJlcG9zaXRvcnkuYWNjZXB0VGVybXNPZlVzZSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdXNlckNvbnRleHQubG9hZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgYXBwID0gYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnVG9VSW50ZXJjZXB0b3InLCBUb1VJbnRlcmNlcHRvcik7XG5cbiAgICBUb1VJbnRlcmNlcHRvci4kaW5qZWN0ID0gW1xuICAgICAgICAnJHEnLFxuICAgICAgICAnJGluamVjdG9yJyxcbiAgICAgICAgJ2FwaS51cmwnLFxuICAgICAgICAnbG9jYWxTdG9yYWdlU2VydmljZScsXG4gICAgICAgICdzZXNzaW9uJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBUb1VJbnRlcmNlcHRvcigkcSwgJGluamVjdG9yLCBhcGlVcmwsIGxvY2FsU3RvcmFnZVNlcnZpY2UsIHNlc3Npb24pIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3RcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIHJlcXVlc3QoY29uZmlnKSB7XG5cbiAgICAgICAgICAgIGlmIChpc0F0dEFwaShjb25maWcudXJsKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHVzZXJEZXRhaWxzID0gc2Vzc2lvbi5nZXRVc2VyRGV0YWlscygpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJEZXRhaWxzICYmICF1c2VyRGV0YWlscy50ZXJtc0FjY2VwdGVkT24gJiYgIWNvbmZpZy5fX2luZ29yZVRlcm1zT2ZVc2VBY2NlcHRhbmNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gJGluamVjdG9yLmdldCgnJHN0YXRlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oJ3Rlcm1zT2ZVc2UnKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHsgaXNTaWxlbnRFcnJvcjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0F0dEFwaSh1cmwpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHVybC5zdWJzdHJpbmcoMCwgYXBpVXJsLmxlbmd0aCkgPT0gYXBpVXJsO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhcHAuY29uZmlnKFsnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIpIHtcblxuICAgICAgICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdUb1VJbnRlcmNlcHRvcicpO1xuXG4gICAgfV0pO1xuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3Rlcm1zT2ZVc2VSZXBvc2l0b3J5JywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJ3V0aWxzJywgJ3Nlc3Npb24nLCAnJGh0dHAnLCAnYXBpLnVybCcsICd0ZXJtc09mVXNlQ0ROVXJsJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KHV0aWxzLCBzZXNzaW9uLCAkaHR0cCwgYXBpVXJsLCB0ZXJtc09mVXNlQ0ROVXJsKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBnZXRUZXJtc09mVXNlOiBnZXRUZXJtc09mVXNlLFxuICAgICAgICAgICAgYWNjZXB0VGVybXNPZlVzZTogYWNjZXB0VGVybXNPZlVzZVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBnZXRUZXJtc09mVXNlKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHRlcm1zT2ZVc2VDRE5VcmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWNjZXB0VGVybXNPZlVzZSgpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICd0ZXJtcy9sYXRlc3QvYWNjZXB0YW5jZSc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgbnVsbCwge1xuXG4gICAgICAgICAgICAgICAgX19pbmdvcmVUZXJtc09mVXNlQWNjZXB0YW5jZTogdHJ1ZVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2F3YWl0aW5nQ29udGVudCcsIGF3YWl0aW5nQ29udGVudCk7XG5cbiAgICBhd2FpdGluZ0NvbnRlbnQuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gYXdhaXRpbmdDb250ZW50KCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2F3YWl0aW5nQ29udGVudCcsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9hZGVyRWxlbWVudCA9IGVsZW1lbnQuZmluZCgnbG9hZGVyLXdyYXBwZXInKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGVyRWxlbWVudC5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRWxlbWVudC5zaG93KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQoJzxsb2FkZXItd3JhcHBlciBjbGFzcz1cInNtYWxsIG92ZXJsYXktbG9hZGVyXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsb2FkZXI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsZC8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsZC8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxsZC8+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvbG9hZGVyPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2xvYWRlci13cmFwcGVyPicpO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnbG9hZGVyLXdyYXBwZXInKS5oaWRlKCk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdidXR0b25Mb2FkTW9yZScsIGJ1dHRvbkxvYWRNb3JlKTtcblxuICAgIGZ1bmN0aW9uIGJ1dHRvbkxvYWRNb3JlKCkge1xuXG4gICAgICAgIC8vIFVzYWdlOlxuICAgICAgICAvLyBmdW5jdGlvbiAnbG9hZCcsIGxpbmtlZCB1c2luZyBzY29wZSBwcm9wZXJ0eSAnbG9hZCcgbmVlZHMgdG8gcmV0dXJuIHByb21pc2VcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvd2lkZ2V0cy9idXR0b24tbG9hZC1tb3JlLmh0bWwnLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBsb2FkOiAnJicsXG4gICAgICAgICAgICAgICAgc2l6ZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcigpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdm0uaGFzRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgdm0ubG9hZE1vcmUgPSBsb2FkTW9yZTtcbiAgICAgICAgdm0udGhlcmVJc05vTW9yZUl0ZW1zID0gZmFsc2U7XG5cbiAgICAgICAgZnVuY3Rpb24gbG9hZE1vcmUoKSB7XG5cbiAgICAgICAgICAgIGlmICh2bS5sb2FkKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZtLmhhc0Vycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2bS5sb2FkKCkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiBhbmd1bGFyLmlzQXJyYXkocmVzdWx0KSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2l6ZSA+IHJlc3VsdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50aGVyZUlzTm9Nb3JlSXRlbXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uaGFzRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgICAgIGZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnY29udHJvbEhhbmRsZXInLCBjb250cm9sSGFuZGxlcik7XG5cbiAgICBjb250cm9sSGFuZGxlci4kaW5qZWN0ID0gWyckY29tcGlsZScsICdhc3NldC5yZXBvc2l0b3J5JywgJ2FwaS5jb250cm9sc1NlcnZpY2UnLCAndXRpbHMnXTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xIYW5kbGVyKCRjb21waWxlLCBhc3NldFJlcG9zaXRvcnksIGNvbnRyb2xzU2VydmljZSwgdXRpbHMpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlcixcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgY29udHJvbE5hbWU6ICc9JyxcbiAgICAgICAgICAgICAgICBhc3NldDogJz0nLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29udHJvbChhc3NldCkge1xuXG4gICAgICAgICAgICB2YXIgd2lkZ2V0TmFtZSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5jb250cm9sICYmIGFzc2V0LmNvbnRyb2wubmFtZSkge1xuXG4gICAgICAgICAgICAgICAgd2lkZ2V0TmFtZSA9IGFzc2V0LmNvbnRyb2wubmFtZTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHdpZGdldE5hbWUgPSBjb250cm9sc1NlcnZpY2UuZ2V0RGVmYXVsdENvbnRyb2woYXNzZXQpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9ICc8ezB9LWNvbnRyb2wgZW5hYmxlZD1cImVuYWJsZWRcIiB2YWx1ZT1cImFzc2V0LnN0YXRlLnZhbHVlXCIgcHJvZmlsZT1cImFzc2V0LnByb2ZpbGVcIiBpZD1cImFzc2V0LmlkXCIgb24tY2hhbmdlPVwib25DaGFuZ2UodmFsKVwiIGFzc2V0PVwiYXNzZXRcIiBjb25maWd1cmF0aW9uPVwiYXNzZXQuY29udHJvbC5leHRyYXNcIj48L3swfS1jb250cm9sPicuZm9ybWF0KHdpZGdldE5hbWUpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUub25DaGFuZ2UgPSBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5lbmFibGVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzc2V0UmVwb3NpdG9yeS5wdWJsaXNoQ29tbWFuZChzY29wZS5hc3NldC5pZCwgdmFsKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB1dGlscy4kcS53aGVuKCk7XG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnYXNzZXQuY29udHJvbC5uYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKGdldENvbnRyb2woc2NvcGUuYXNzZXQpKTtcblxuICAgICAgICAgICAgICAgICRjb21waWxlKGVsZW1lbnQuY29udGVudHMoKSkoc2NvcGUpO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2ZsZXhUZXh0YXJlYScsIGZsZXhUZXh0YXJlYSk7XG5cbiAgICBmbGV4VGV4dGFyZWEuJGluamVjdCA9IFsnJHRpbWVvdXQnXTtcblxuICAgIGZ1bmN0aW9uIGZsZXhUZXh0YXJlYSgkdGltZW91dCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IEZsZXhUZXh0Q29udHJvbGxlcixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvd2lkZ2V0cy9mbGV4LXRleHRhcmVhLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgc2F2ZWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsLCB0cmFuc2NsdWRlKSB7XG5cbiAgICAgICAgICAgIHZhciB0ZXh0YXJlYSA9IGVsZW1lbnQuZmluZCgndGV4dGFyZWEnKTtcbiAgICAgICAgICAgIHZhciBvbGRWYWx1ZSA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodGV4dGFyZWEpIHtcblxuICAgICAgICAgICAgICAgICQodGV4dGFyZWEpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlID0gdGV4dGFyZWEudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCd0by1yZXBsYWNlJykucmVwbGFjZVdpdGgodHJhbnNjbHVkZSgpKTtcblxuICAgICAgICAgICAgICAgIGlmICh0ZXh0YXJlYSkge1xuICAgICAgICAgICAgICAgICAgICAkKHRleHRhcmVhKS5mb2N1c291dChmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzY29wZS52bS5zYXZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS52bS5kYXRhID0gb2xkVmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIEZsZXhUZXh0Q29udHJvbGxlcigpIHtcblxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnZm9jdXNJZicsIEZvY3VzSWYpO1xuXG4gICAgRm9jdXNJZi4kaW5qZWN0ID0gWyckdGltZW91dCddO1xuXG4gICAgZnVuY3Rpb24gRm9jdXNJZigkdGltZW91dCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICAgICAgXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgdmFyIGZvY3VzQ2xhc3MgPSBhdHRycy5mb2N1c0NsYXNzO1xuXG4gICAgICAgICAgICBpZiAoIWZvY3VzQ2xhc3MpXG4gICAgICAgICAgICAgICAgZm9jdXNDbGFzcyA9ICdmb2N1cyc7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRycy5mb2N1c0lmLCB3YXRjaEhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB3YXRjaEhhbmRsZXIodmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudFswXSkuYWRkQ2xhc3MoZm9jdXNDbGFzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnRbMF0pLnJlbW92ZUNsYXNzKGZvY3VzQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByYW5kb21TdHJpbmcobGVuZ3RoLCBjaGFycykge1xuICAgICAgICAgICAgdmFyIG1hc2sgPSAnJztcbiAgICAgICAgICAgIGlmIChjaGFycy5pbmRleE9mKCdhJykgPiAtMSkgbWFzayArPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonO1xuICAgICAgICAgICAgaWYgKGNoYXJzLmluZGV4T2YoJ0EnKSA+IC0xKSBtYXNrICs9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7XG4gICAgICAgICAgICBpZiAoY2hhcnMuaW5kZXhPZignIycpID4gLTEpIG1hc2sgKz0gJzAxMjM0NTY3ODknO1xuICAgICAgICAgICAgaWYgKGNoYXJzLmluZGV4T2YoJyEnKSA+IC0xKSBtYXNrICs9ICd+YCFAIyQlXiYqKClfKy09e31bXTpcIjtcXCc8Pj8sLi98XFxcXCc7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gbGVuZ3RoOyBpID4gMDsgLS1pKSByZXN1bHQgKz0gbWFza1tNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAobWFzay5sZW5ndGggLSAxKSldO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgncGFnZUxvYWRlcicsIHBhZ2VMb2FkZXIpO1xuXG4gICAgZnVuY3Rpb24gcGFnZUxvYWRlcigpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIC8vIFN0b3JlIG9yaWdpbmFsIGRpc3BsYXkgbW9kZSBvZiBlbGVtZW50XG4gICAgICAgICAgICAgICAgdmFyIHNob3duVHlwZSA9IGVsZW1lbnQuY3NzKCdkaXNwbGF5Jyk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJG9uKCckcm91dGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiRvbignJHJvdXRlQ2hhbmdlRW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGx5IGhpZGRlblxuICAgICAgICAgICAgICAgIGhpZGVFbGVtZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3Njcm9sbElmJywgc2Nyb2xsSWYpO1xuXG4gICAgc2Nyb2xsSWYuJGluamVjdCA9IFsnJHRpbWVvdXQnLCAnJHdpbmRvdyddO1xuXG4gICAgZnVuY3Rpb24gc2Nyb2xsSWYoJHRpbWVvdXQsICR3aW5kb3cpIHtcblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycykge1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMuc2Nyb2xsSWYsIHdhdGNoSGFuZGxlcik7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdhdGNoSGFuZGxlcih2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxpbmdQYXJlbnQgPSBnZXRTY3JvbGxpbmdQYXJlbnQoZWxbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlclNjcm9sbCA9IHNjcm9sbGluZ1BhcmVudC5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICQoc2Nyb2xsaW5nUGFyZW50KS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IGNlbnRlclNjcm9sbFxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2Nyb2xsaW5nUGFyZW50KGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgICAgICAgICAgICAgIHdoaWxlIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LnNjcm9sbEhlaWdodCAhPT0gZWxlbWVudC5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdzdWJzY3JpYmVkSW5kaWNhdG9yJywgc3Vic2NyaWJlZEluZGljYXRvcik7XG5cbiAgICBmdW5jdGlvbiBzdWJzY3JpYmVkSW5kaWNhdG9yKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogQ29udHJvbGxlcixcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvd2lkZ2V0cy9zdWJzY3JpYmVkLWluZGljYXRvci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGl0ZW1JZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfVxuXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gWydHcm91bmRDb250ZXh0J107XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKGdyb3VuZENvbnRleHQpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5pc1N1YnNjcmliZWQgPSBpc1N1YnNjcmliZWQ7XG5cbiAgICAgICAgZnVuY3Rpb24gaXNTdWJzY3JpYmVkKCkge1xuXG4gICAgICAgICAgICB2YXIgZ3JvdW5kID0gZ3JvdW5kQ29udGV4dC5maW5kKHZtLml0ZW1JZCk7XG5cbiAgICAgICAgICAgIGlmICghZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZ3JvdW5kLmlzU3Vic2NyaWJlZCgpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NsVGFicycsIHNsVGFicyk7XG5cbiAgICBmdW5jdGlvbiBzbFRhYnMoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcblxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidGFiLXBhbmVsXCI+JyArXG4gICAgICAgICAgICAgICAgJzx1bCBjbGFzcz1cInRhYi1jb250cm9sLWhlYWRlclwiPicgK1xuICAgICAgICAgICAgICAgICcgPGxpIG5nLWNsYXNzPVwieyBhY3RpdmU6dGFiLmFjdGl2ZSB9XCIgbmctcmVwZWF0PVwidGFiIGluIHZtLnRhYnMgfCBvcmRlckJ5OlxcJ29yZGVyXFwnIHRyYWNrIGJ5ICRpbmRleFwiPicgK1xuICAgICAgICAgICAgICAgICcgPGEgaWQ9XCJ7e3RhYi5uYW1lfX1cIiBuZy1jbGljaz1cInZtLnNlbGVjdCh0YWIpXCI+PGkgbmctaWY9XCJ0YWIuaWNvblwiIGNsYXNzPVwie3t0YWIuaWNvbn19XCI+PC9pPjxzcGFuPnt7dGFiLmhlYWRpbmd9fTwvc3Bhbj48L2E+JyArXG4gICAgICAgICAgICAgICAgJyA8L2xpPicgK1xuICAgICAgICAgICAgICAgICc8L3VsPicgK1xuICAgICAgICAgICAgICAgICc8bmctdHJhbnNjbHVkZSBjbGFzcz1cInRhYi1ob2xkZXJcIj4nICtcbiAgICAgICAgICAgICAgICAnPC9uZy10cmFuc2NsdWRlPicgK1xuICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG9uVGFiQ2xpY2s6ICcmJyxcbiAgICAgICAgICAgICAgICBhY3RpdmVUYWI6ICc9PydcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG5cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICdvcmRlckJ5RmlsdGVyJ107XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgb3JkZXJCeUZpbHRlcikge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLnRhYnMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlVGFiID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ID0gc2VsZWN0O1xuICAgICAgICB2bS5zZWxlY3RCeU5hbWUgPSBzZWxlY3RCeU5hbWU7XG4gICAgICAgIHZtLmFkZFRhYiA9IGFkZFRhYjtcbiAgICAgICAgdm0ucmVtb3ZlVGFiID0gcmVtb3ZlVGFiO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmFjdGl2ZVRhYicsIGZ1bmN0aW9uKHRhYk5hbWUpIHtcbiAgICAgICAgICAgIGlmICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0QnlOYW1lKHRhYk5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBzZWxlY3Qoc2VsZWN0ZWRUYWIpIHtcblxuICAgICAgICAgICAgdm0uYWN0aXZlVGFiID0gc2VsZWN0ZWRUYWIubmFtZTtcblxuICAgICAgICAgICAgaWYgKHZtLm9uVGFiQ2xpY2spIHtcbiAgICAgICAgICAgICAgICB2bS5vblRhYkNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZWxlY3RCeU5hbWUodGFiTmFtZSkge1xuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLnRhYnMsIGZ1bmN0aW9uKHRhYikge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRhYi5uYW1lICE9PSB0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhYi5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YWIuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZFRhYih0YWIpIHtcblxuICAgICAgICAgICAgdm0udGFicy5wdXNoKHRhYik7XG4gICAgICAgICAgICBpZiAodm0udGFicy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0YWIuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF2bS5hY3RpdmVUYWIpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0udGFicy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFiLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYi5vcmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0QnlOYW1lKG9yZGVyQnlGaWx0ZXIodm0udGFicywgJ29yZGVyJylbMF0ubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZVRhYih0YWIpIHtcblxuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0udGFicy5pbmRleE9mKHRhYik7XG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG5cbiAgICAgICAgICAgICAgICB2bS50YWJzLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGFiLmFjdGl2ZSAmJiB2bS50YWJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udGFic1swXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NsVGFiJywgc2xUYWIpO1xuXG4gICAgZnVuY3Rpb24gc2xUYWIoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiByb2xlPVwidGFicGFuZWxcIiBuZy1zaG93PVwiYWN0aXZlXCIgbmctdHJhbnNjbHVkZT48L2Rpdj4nLFxuICAgICAgICAgICAgcmVxdWlyZTogJ15zbFRhYnMnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBoZWFkaW5nOiAnQCcsXG4gICAgICAgICAgICAgICAgaWNvbjogJ0AnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdAJyxcbiAgICAgICAgICAgICAgICBvcmRlcjogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluaygkc2NvcGUsIGVsZW0sIGF0dHIsIHRhYnNldEN0cmwpIHtcblxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGFic2V0Q3RybC5hZGRUYWIoJHNjb3BlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZGVzdHJveSB0YWIgaGFzIGJlZW4gY2FsbGVkJyk7XG4gICAgICAgICAgICAgICAgdGFic2V0Q3RybC5yZW1vdmVUYWIoJHNjb3BlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdhcHAuY29uZmlnJywgYXBwQ29uZmlnKTtcblxuICAgIGFwcENvbmZpZy4kaW5qZWN0ID0gW1xuICAgICAgICAnYXBpLnVybCcsXG4gICAgICAgICdhcGkuY2xpZW50SWQnLFxuICAgICAgICAnYnJva2VyLnVybCcsXG4gICAgICAgICdicm9rZXIucG9ydCcsXG4gICAgICAgICdicm9rZXIuc291cmNlUm9vdCcsXG4gICAgICAgICdwdWJsaWMudG9rZW4nLFxuICAgICAgICAncHVibGljLmNsaWVudElkJyxcbiAgICAgICAgJ3B1YmxpYy5jbGllbnRLZXknLFxuICAgICAgICAncHVibGljLnVybFNob3J0ZW5lckFwaUtleScsXG4gICAgICAgICdwdWJsaWMudXJsU2hvcnRlbmVyQXBpVXJsJyxcbiAgICAgICAgJ29yaWdpbidcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gYXBwQ29uZmlnKGFwaVVybCwgYXBpQ2xpZW50SWQsIGJyb2tlclVybCwgYnJva2VyUG9ydCwgYnJva2VyU291cmNlUm9vdCwgcHVibGljVG9rZW4sIHB1YmxpY0NsaWVudElkLCBwdWJsaWNDbGllbnRLZXksIHVybFNob3J0ZW5lckFwaUtleSwgdXJsU2hvcnRlbmVyQXBpVXJsLCBvcmlnaW4pIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBhcGk6IHtcbiAgICAgICAgICAgICAgICB1cmw6IGFwaVVybCxcbiAgICAgICAgICAgICAgICBjbGllbnRJZDogYXBpQ2xpZW50SWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBicm9rZXI6IHtcbiAgICAgICAgICAgICAgICB1cmw6IGJyb2tlclVybCxcbiAgICAgICAgICAgICAgICBwb3J0OiBicm9rZXJQb3J0LFxuICAgICAgICAgICAgICAgIHNvdXJjZVJvb3Q6IGJyb2tlclNvdXJjZVJvb3RcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBndWVzdDoge1xuICAgICAgICAgICAgICAgIHRva2VuOiBwdWJsaWNUb2tlbixcbiAgICAgICAgICAgICAgICBjbGllbnRJZDogcHVibGljQ2xpZW50SWQsXG4gICAgICAgICAgICAgICAgY2xpZW50S2V5OiBwdWJsaWNDbGllbnRLZXlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cmxTaG9ydGVuZXI6IHtcbiAgICAgICAgICAgICAgICBrZXk6IHVybFNob3J0ZW5lckFwaUtleSxcbiAgICAgICAgICAgICAgICB1cmw6IHVybFNob3J0ZW5lckFwaVVybFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yaWdpbjogb3JpZ2luXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdleGNlcHRpb24nLCBleGNlcHRpb24pO1xuXG4gICAgZXhjZXB0aW9uLiRpbmplY3QgPSBbJyRsb2cnLCAnbG9nZ2VyJywgJ3V0aWxzJ107XG5cbiAgICBmdW5jdGlvbiBleGNlcHRpb24oJGxvZywgbG9nZ2VyLCB1dGlscykge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgY2F0Y2hlcjogY2F0Y2hlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjYXRjaGVyKG1lc3NhZ2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlYXNvbikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IG1lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNDbGllbnRFcnJvcihyZWFzb24pKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IGdldEVycm9yTWVzc2FnZShyZWFzb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtc2cpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gbXNnO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghcmVhc29uLmlzU2lsZW50RXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JNZXNzYWdlLCByZWFzb24sICdFcnJvcjogJyk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdXRpbHMuJHEucmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNDbGllbnRFcnJvcihyZWFzb24pIHtcblxuICAgICAgICAgICAgcmV0dXJuIHJlYXNvbi5zdGF0dXMgPj0gNDAwICYmIHJlYXNvbi5zdGF0dXMgPD0gNDk5O1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UocmVhc29uKSB7XG5cbiAgICAgICAgICAgIGlmIChyZWFzb24uZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlYXNvbi5kYXRhLmVycm9yX2Rlc2NyaXB0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYXNvbi5kYXRhLmVycm9yX2Rlc2NyaXB0aW9uO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJlYXNvbi5kYXRhLmVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYXNvbi5kYXRhLmVycm9yO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJlYXNvbi5kYXRhLm1lc3NhZ2UpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhc29uLmRhdGEubWVzc2FnZTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbn0oKSk7XG4iLCIvLyAoZnVuY3Rpb24obmcpIHtcblxuLy8gICAgIG5nXG4vLyAgICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4vLyAgICAgICAgIC5wcm92aWRlcignZXhjZXB0aW9uSGFuZGxlcicsIGV4Y2VwdGlvbkhhbmRsZXJQcm92aWRlcilcbi8vICAgICAgICAgLmNvbmZpZyhjb25maWcpO1xuXG4vLyAgICAgLyoqXG4vLyAgICAgICogTXVzdCBjb25maWd1cmUgdGhlIGV4Y2VwdGlvbiBoYW5kbGluZ1xuLy8gICAgICAqIEByZXR1cm4ge1t0eXBlXX1cbi8vICAgICAgKi9cbi8vICAgICBmdW5jdGlvbiBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIoKSB7XG4vLyAgICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuLy8gICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbi8vICAgICAgICAgICAgIGFwcEVycm9yUHJlZml4OiB1bmRlZmluZWRcbi8vICAgICAgICAgfTtcblxuLy8gICAgICAgICB0aGlzLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uKGFwcEVycm9yUHJlZml4KSB7XG4vLyAgICAgICAgICAgICB0aGlzLmNvbmZpZy5hcHBFcnJvclByZWZpeCA9IGFwcEVycm9yUHJlZml4O1xuLy8gICAgICAgICB9O1xuXG4vLyAgICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICAgcmV0dXJuIHtcbi8vICAgICAgICAgICAgICAgICBjb25maWc6IHRoaXMuY29uZmlnXG4vLyAgICAgICAgICAgICB9O1xuLy8gICAgICAgICB9O1xuLy8gICAgIH1cblxuLy8gICAgIC8qKlxuLy8gICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXG4vLyAgICAgICogQWNjZXNzaWJsZSB2aWEgY29uZmlnLmFwcEVycm9yUHJlZml4ICh2aWEgY29uZmlnIHZhbHVlKS5cbi8vICAgICAgKiBAcGFyYW0gIHtbdHlwZV19ICRwcm92aWRlXG4vLyAgICAgICogQHJldHVybiB7W3R5cGVdfVxuLy8gICAgICAqL1xuXG4vLyAgICAgY29uZmlnLmluamVjdCA9IFsnJHByb3ZpZGUnXTtcblxuLy8gICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xuLy8gICAgICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRleGNlcHRpb25IYW5kbGVyJywgZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcik7XG4vLyAgICAgfVxuXG4vLyAgICAgKlxuLy8gICAgICAqIEV4dGVuZCB0aGUgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZSB0byBhbHNvIGRpc3BsYXkgYSB0b2FzdC5cbi8vICAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICRkZWxlZ2F0ZVxuLy8gICAgICAqIEBwYXJhbSAge09iamVjdH0gZXhjZXB0aW9uSGFuZGxlclxuLy8gICAgICAqIEBwYXJhbSAge09iamVjdH0gbG9nZ2VyXG4vLyAgICAgICogQHJldHVybiB7RnVuY3Rpb259IHRoZSBkZWNvcmF0ZWQgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZVxuICAgICBcblxuLy8gICAgIGV4dGVuZEV4Y2VwdGlvbkhhbmRsZXIuJGluamVjdCA9IFsnJGRlbGVnYXRlJywgJ2V4Y2VwdGlvbkhhbmRsZXInLCAnbG9nZ2VyJ107XG5cbi8vICAgICBmdW5jdGlvbiBleHRlbmRFeGNlcHRpb25IYW5kbGVyKCRkZWxlZ2F0ZSwgZXhjZXB0aW9uSGFuZGxlciwgbG9nZ2VyKSB7XG4vLyAgICAgICAgIHJldHVybiBmdW5jdGlvbihleGNlcHRpb24sIGNhdXNlKSB7XG4vLyAgICAgICAgICAgICB2YXIgYXBwRXJyb3JQcmVmaXggPSBleGNlcHRpb25IYW5kbGVyLmNvbmZpZy5hcHBFcnJvclByZWZpeCB8fCAnJztcbi8vICAgICAgICAgICAgIHZhciBlcnJvckRhdGEgPSB7XG4vLyAgICAgICAgICAgICAgICAgZXhjZXB0aW9uOiBleGNlcHRpb24sXG4vLyAgICAgICAgICAgICAgICAgY2F1c2U6IGNhdXNlXG4vLyAgICAgICAgICAgICB9O1xuLy8gICAgICAgICAgICAgZXhjZXB0aW9uLm1lc3NhZ2UgPSBhcHBFcnJvclByZWZpeCArIGV4Y2VwdGlvbi5tZXNzYWdlO1xuLy8gICAgICAgICAgICAgJGRlbGVnYXRlKGV4Y2VwdGlvbiwgY2F1c2UpO1xuLy8gICAgICAgICAgICAgLyoqXG4vLyAgICAgICAgICAgICAgKiBDb3VsZCBhZGQgdGhlIGVycm9yIHRvIGEgc2VydmljZSdzIGNvbGxlY3Rpb24sXG4vLyAgICAgICAgICAgICAgKiBhZGQgZXJyb3JzIHRvICRyb290U2NvcGUsIGxvZyBlcnJvcnMgdG8gcmVtb3RlIHdlYiBzZXJ2ZXIsXG4vLyAgICAgICAgICAgICAgKiBvciBsb2cgbG9jYWxseS4gT3IgdGhyb3cgaGFyZC4gSXQgaXMgZW50aXJlbHkgdXAgdG8geW91LlxuLy8gICAgICAgICAgICAgICogdGhyb3cgZXhjZXB0aW9uO1xuLy8gICAgICAgICAgICAgICpcbi8vICAgICAgICAgICAgICAqIEBleGFtcGxlXG4vLyAgICAgICAgICAgICAgKiAgICAgdGhyb3cgeyBtZXNzYWdlOiAnZXJyb3IgbWVzc2FnZSB3ZSBhZGRlZCcgfTtcbi8vICAgICAgICAgICAgICAqL1xuLy8gICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGV4Y2VwdGlvbi5tZXNzYWdlLCBlcnJvckRhdGEsICdFcnJvcicpO1xuLy8gICAgICAgICB9O1xuLy8gICAgIH1cbi8vIH0od2luZG93LmFuZ3VsYXIpKTsiLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdsb2dnZXInLCBsb2dnZXIpO1xuXG4gICAgbG9nZ2VyLiRpbmplY3QgPSBbJyRsb2cnLCAnbm90aWZ5U2VydmljZSddO1xuXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIG5vdGlmeVNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcblxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxuICAgICAgICAgICAgaW5mbzogaW5mbyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3MsXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nXG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBlcnJvcihtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuXG4gICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmVycm9yKHRpdGxlLCBtZXNzYWdlLCBudWxsLCB0cnVlKTtcblxuICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6ICcgKyBtZXNzYWdlLCBkYXRhKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5mbyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuXG4gICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmluZm8odGl0bGUsIG1lc3NhZ2UpO1xuXG4gICAgICAgICAgICAkbG9nLmluZm8oJ0luZm86ICcgKyBtZXNzYWdlLCBkYXRhKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuXG4gICAgICAgICAgICBub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGl0bGUsIG1lc3NhZ2UpO1xuXG4gICAgICAgICAgICAkbG9nLmluZm8oJ1N1Y2Nlc3M6ICcgKyBtZXNzYWdlLCBkYXRhKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gd2FybmluZyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuXG4gICAgICAgICAgICBub3RpZnlTZXJ2aWNlLndhcm5pbmcodGl0bGUsIG1lc3NhZ2UpO1xuXG4gICAgICAgICAgICAkbG9nLndhcm4oJ1dhcm5pbmc6ICcgKyBtZXNzYWdlLCBkYXRhKTtcblxuICAgICAgICB9XG4gICAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ21lc3NhZ2luZy5nYXRld2F5JywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnYXBwLmNvbmZpZycsICd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gZmFjdG9yeSgkd2luZG93LCBhcHBDb25maWcsIHV0aWxzKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gR2F0ZXdheSgpIHtcblxuICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jbGllbnRJZCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNsaWVudEtleSA9IG51bGw7XG4gICAgICAgICAgICAkd2luZG93LkNhcHBNZXNzYWdpbmcuYnJva2VyVXJsID0gYXBwQ29uZmlnLmJyb2tlci51cmw7XG4gICAgICAgICAgICAkd2luZG93LkNhcHBNZXNzYWdpbmcuYnJva2VyUG9ydCA9IGFwcENvbmZpZy5icm9rZXIucG9ydDtcbiAgICAgICAgICAgICR3aW5kb3cuQ2FwcE1lc3NhZ2luZy5zb3VyY2VSb290ID0gYXBwQ29uZmlnLmJyb2tlci5zb3VyY2VSb290O1xuICAgICAgICB9XG5cbiAgICAgICAgR2F0ZXdheS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uKGNsaWVudElkLCBjbGllbnRLZXksIGZhaWxIYW5kbGVyKSB7XG5cbiAgICAgICAgICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDtcbiAgICAgICAgICAgIHRoaXMuY2xpZW50S2V5ID0gY2xpZW50S2V5O1xuXG4gICAgICAgICAgICBzYXZlQ2xpZW50KGNsaWVudElkLCBjbGllbnRLZXkpO1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBkZWZmZXJlZCA9IHV0aWxzLiRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHZhciBkaXNjb25uZWN0UHJvbWlzZSA9IHRoYXQuZGlzY29ubmVjdCgpO1xuXG4gICAgICAgICAgICBkaXNjb25uZWN0UHJvbWlzZS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5DYXBwTWVzc2FnaW5nLmNvbm5lY3QoY2xpZW50SWQsIGNsaWVudEtleSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmNvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuY29ubmVjdGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsSGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxIYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIEdhdGV3YXkucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGRlZmZlcmVkID0gdXRpbHMuJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgJHdpbmRvdy5DYXBwTWVzc2FnaW5nLmRpc2Nvbm5lY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIHRoYXQuY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgR2F0ZXdheS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24odG9waWMsIGNhbGxiYWNrRm4sIHN1YnNjcmlwdGlvbkNhbGxiYWNrRm4pIHtcblxuICAgICAgICAgICAgJHdpbmRvdy5DYXBwTWVzc2FnaW5nLnN1YnNjcmliZSh0b3BpYywgY2FsbGJhY2tGbiwgc3Vic2NyaXB0aW9uQ2FsbGJhY2tGbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgR2F0ZXdheS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbihzdWIpIHtcblxuICAgICAgICAgICAgJHdpbmRvdy5DYXBwTWVzc2FnaW5nLnVuc3Vic2NyaWJlKHN1Yik7XG4gICAgICAgIH07XG5cbiAgICAgICAgR2F0ZXdheS5wcm90b3R5cGUucHVibGlzaCA9IGZ1bmN0aW9uKHRvcGljLCBwYXlsb2FkKSB7XG5cbiAgICAgICAgICAgICR3aW5kb3cuQ2FwcE1lc3NhZ2luZy5wdWJsaXNoKHRvcGljLCBwYXlsb2FkKTtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBzYXZlQ2xpZW50KGNsaWVudElkLCBjbGllbnRLZXkpIHtcblxuICAgICAgICAgICAgJHdpbmRvdy5DYXBwTWVzc2FnaW5nLmNsaWVudElkID0gY2xpZW50SWQ7XG4gICAgICAgICAgICAkd2luZG93LkNhcHBNZXNzYWdpbmcuY2xpZW50S2V5ID0gY2xpZW50S2V5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBHYXRld2F5KCk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdtZXNzYWdpbmcucGFyc2VyJywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJ3V0aWxzJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KHV0aWxzKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBwYXJzZU1lc3NhZ2U6IHBhcnNlTWVzc2FnZSxcbiAgICAgICAgICAgIGdldE1lc3NhZ2VUb3BpYzogZ2V0TWVzc2FnZVRvcGljXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIHBhcnNlTWVzc2FnZSh0b3BpYywgcGF5bG9hZCkge1xuXG4gICAgICAgICAgICB2YXIgdG9waWNFbGVtZW50cyA9IHRvcGljLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICB2YXIgaW5mbyA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHBheWxvYWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoaXNNYXRjaCgnZ3JvdW5kLiUuaW4uYXNzZXQuJS5zdGF0ZScsIHRvcGljRWxlbWVudHMpKSB7XG4gICAgICAgICAgICAgICAgaW5mby5uYW1lID0gJ2Fzc2V0LnN0YXRlJztcbiAgICAgICAgICAgICAgICBpbmZvLmRhdGEuZ3JvdW5kSWQgPSB0b3BpY0VsZW1lbnRzWzFdO1xuICAgICAgICAgICAgICAgIGluZm8uZGF0YS5hc3NldElkID0gdG9waWNFbGVtZW50c1s0XTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5mbztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzTWF0Y2goJ2NsaWVudC4lLmluLmFzc2V0LiUuc3RhdGUnLCB0b3BpY0VsZW1lbnRzKSkge1xuICAgICAgICAgICAgICAgIGluZm8ubmFtZSA9ICdhc3NldC5zdGF0ZSc7XG4gICAgICAgICAgICAgICAgaW5mby5kYXRhLmFzc2V0SWQgPSB0b3BpY0VsZW1lbnRzWzRdO1xuICAgICAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNNYXRjaCgnZ3JvdW5kLiUuaW4uYWN0aXZpdHknLCB0b3BpY0VsZW1lbnRzKSkge1xuICAgICAgICAgICAgICAgIGluZm8ubmFtZSA9ICdncm91bmQuYWN0aXZpdHknO1xuICAgICAgICAgICAgICAgIGluZm8uZGF0YS5ncm91bmRJZCA9IHRvcGljRWxlbWVudHNbMV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZm87XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc01hdGNoKCdjbGllbnQuJS5pbi5hc3NldC4lLmV2ZW50JywgdG9waWNFbGVtZW50cykpIHtcblxuICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLk5hbWUgPT09ICdjcmVhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8ubmFtZSA9ICdhc3NldC5jcmVhdGVkJztcbiAgICAgICAgICAgICAgICAgICAgaW5mby5kYXRhLmFzc2V0SWQgPSB0b3BpY0VsZW1lbnRzWzRdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLk5hbWUgPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8ubmFtZSA9ICdhc3NldC5kZWxldGVkJztcbiAgICAgICAgICAgICAgICAgICAgaW5mby5kYXRhLmFzc2V0SWQgPSB0b3BpY0VsZW1lbnRzWzRdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNNYXRjaCgnY2xpZW50LiUuaW4uZGV2aWNlLiUuYXNzZXQuJS5jb21tYW5kJywgdG9waWNFbGVtZW50cykpIHtcbiAgICAgICAgICAgICAgICBpbmZvLm5hbWUgPSAnYXNzZXQuY29tbWFuZCc7XG4gICAgICAgICAgICAgICAgaW5mby5kYXRhLmFzc2V0SWQgPSB0b3BpY0VsZW1lbnRzWzZdO1xuICAgICAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNNYXRjaCgnY2xpZW50LiUuaW4uZGV2aWNlLiUuZXZlbnQnLCB0b3BpY0VsZW1lbnRzKSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHBheWxvYWQuTmFtZSA9PT0gJ2NyZWF0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5mby5uYW1lID0gJ2RldmljZS5jcmVhdGVkJztcbiAgICAgICAgICAgICAgICAgICAgaW5mby5kYXRhLmRldmljZUlkID0gdG9waWNFbGVtZW50c1s0XTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5OYW1lID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLm5hbWUgPSAnZGV2aWNlLmRlbGV0ZWQnO1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmRhdGEuZGV2aWNlSWQgPSB0b3BpY0VsZW1lbnRzWzRdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNNYXRjaCgnY2xpZW50LiUuaW4uZ2F0ZXdheS4lLmV2ZW50JywgdG9waWNFbGVtZW50cykpIHtcblxuICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLk5hbWUgPT09ICdjcmVhdGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8ubmFtZSA9ICdnYXRld2F5LmNyZWF0ZWQnO1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmRhdGEuZ2F0ZXdheUlkID0gdG9waWNFbGVtZW50c1s0XTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5OYW1lID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLm5hbWUgPSAnZ2F0ZXdheS5kZWxldGVkJztcbiAgICAgICAgICAgICAgICAgICAgaW5mby5kYXRhLmdhdGV3YXlJZCA9IHRvcGljRWxlbWVudHNbNF07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZm87XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNNYXRjaCh0b3BpY1BhdHRlcm4sIHRvcGljRWxlbWVudHMpIHtcblxuICAgICAgICAgICAgdmFyIHBhdHRlcm5FbGVtZW50cyA9IHRvcGljUGF0dGVybi5zcGxpdCgnLicpO1xuXG4gICAgICAgICAgICBpZiAocGF0dGVybkVsZW1lbnRzLmxlbmd0aCAhPT0gdG9waWNFbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBtYXRjaCA9IHRydWU7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm5FbGVtZW50cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhdHRlcm5FbGVtZW50c1tpXSAhPT0gdG9waWNFbGVtZW50c1tpXSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuRWxlbWVudHNbaV0gIT09ICclJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0TWVzc2FnZVRvcGljKGNsaWVudElkLCBhY3Rpb24sIGVudGl0eSkge1xuXG4gICAgICAgICAgICB2YXIgdG9waWMgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnY29tbWFuZCcpIHtcbiAgICAgICAgICAgICAgICB0b3BpYyA9ICdjbGllbnQuezB9LmluLmRldmljZS57MX0uYXNzZXQuezJ9LmNvbW1hbmQnLmZvcm1hdChcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50SWQsXG4gICAgICAgICAgICAgICAgICAgIGVudGl0eS5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ3N0YXRlJykge1xuICAgICAgICAgICAgICAgIHRvcGljID0gJ2NsaWVudC57MH0ub3V0LmFzc2V0LnsxfS5zdGF0ZScuZm9ybWF0KFxuICAgICAgICAgICAgICAgICAgICBjbGllbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LmlkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRvcGljO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdtZXNzYWdpbmcucmVsYXknLCBmYWN0b3J5KTtcblxuICAgIGZhY3RvcnkuJGluamVjdCA9IFsnbWVzc2FnaW5nLmdhdGV3YXknLCAndXRpbHMnLCAnc2Vzc2lvbicsICd1c2VyQ29udGV4dCcsICdtZXNzYWdpbmcucGFyc2VyJywgJ05vdGlmaWNhdGlvbk1vZGVsJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KG1lc3NhZ2luZ0dhdGV3YXksIHV0aWxzLCBzZXNzaW9uLCB1c2VyQ29udGV4dCwgcGFyc2VyLCBOb3RpZmljYXRpb24pIHtcblxuICAgICAgICB2YXIgbm90aWZpY2F0aW9uU3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICAgICAgdmFyIGdyb3VuZFN1YnNjcmlwdGlvbiA9IG51bGw7XG5cbiAgICAgICAgdmFyIHJlY29ubmVjdEF0dGVtcHRDb3VudCA9IDA7XG5cbiAgICAgICAgLy9ob3cgbWFueSB0aW1lcyB0byB0cnkgdG8gcmVjb25uZWN0IGJlZm9yZSBhYm9ydGluZ1xuICAgICAgICB2YXIgcmVjb25uZWN0QXR0ZW1wdFRocmVzaG9sZCA9IDM7XG5cbiAgICAgICAgLy93YWl0IGludGVydmFsIGJldHdlZW4gcmVjb25uZWN0IGF0dGVtcHRzXG4gICAgICAgIHZhciByZWNvbm5lY3RBdHRlbXB0SW50ZXJ2YWwgPSA1MDAwO1xuXG4gICAgICAgIGZ1bmN0aW9uIE1lc3NhZ2VSZWxheSgpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIE1lc3NhZ2VSZWxheS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmIChzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkuaXNBdXRoKSB7XG5cbiAgICAgICAgICAgICAgICBjb25uZWN0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ2luJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBtZXNzYWdpbmdHYXRld2F5LmRpc2Nvbm5lY3QoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbigndXNlci5sb2dvdXQnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkuZGlzY29ubmVjdCgpO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gY29ubmVjdCgpIHtcblxuICAgICAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkuY29ubmVjdChzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudElkLCBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudEtleSwgY29ubmVjdGlvbkZhaWxIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5zdWJzY3JpYmVGb3JVc2VyTm90aWZpY2F0aW9ucygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0LnN1YnNjcmliZUZvckFsbE5vdGlmaWNhdGlvbnMoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0QXR0ZW1wdENvdW50ID0gMDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kZW1pdCgnJG1lc3NhZ2luZy5jb25uZWN0aW9uLmNvbm5lY3RlZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbm5lY3Rpb25GYWlsSGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIGlmIChyZWNvbm5lY3RBdHRlbXB0Q291bnQgPj0gcmVjb25uZWN0QXR0ZW1wdFRocmVzaG9sZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcjIyNNRVNTQUdJTkcjIyMgLSBGQUlMRUQgVE8gUkVDT05ORUNULCBBQk9SVElORy4gJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kZW1pdCgnJG1lc3NhZ2luZy5jb25uZWN0aW9uLmRpc2Nvbm5lY3RlZCcpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy4kdGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb25uZWN0QXR0ZW1wdENvdW50Kys7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcjIyNNRVNTQUdJTkcjIyMgLSBSRUNPTk5FQ1QgQVRURU1QVCAnICsgcmVjb25uZWN0QXR0ZW1wdENvdW50KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sIHJlY29ubmVjdEF0dGVtcHRJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIE1lc3NhZ2VSZWxheS5wcm90b3R5cGUuc3Vic2NyaWJlRm9yVXNlck5vdGlmaWNhdGlvbnMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKCF1c2VyQ29udGV4dC51c2VyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBub3RpZmljYXRpb25TdWJzY3JpcHRpb24gPSBtZXNzYWdpbmdHYXRld2F5LnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAnY2xpZW50LnswfS5pbi51c2VyLnsxfS5ub3RpZmljYXRpb25zJy5mb3JtYXQobWVzc2FnaW5nR2F0ZXdheS5jbGllbnRJZCwgdXNlckNvbnRleHQudXNlci5pZCksXG4gICAgICAgICAgICAgICAgaGFuZGxlTm90aWZpY2F0aW9uTWVzc2FnZSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZU5vdGlmaWNhdGlvbk1lc3NhZ2UocGF5bG9hZCkge1xuICAgICAgICAgICAgICAgIC8vSEFDSyFcbiAgICAgICAgICAgICAgICB2YXIgbm9ybWFsaXplZE1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgICAgIGF0OiBwYXlsb2FkLkF0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXlsb2FkLlZhbHVlXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGVtaXQoJyRtZXNzYWdpbmcubm90aWZpY2F0aW9uJywgbmV3IE5vdGlmaWNhdGlvbihub3JtYWxpemVkTWVzc2FnZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIE1lc3NhZ2VSZWxheS5wcm90b3R5cGUuc3Vic2NyaWJlRm9yR3JvdW5kTm90aWZpY2F0aW9ucyA9IGZ1bmN0aW9uKGdyb3VuZElkKSB7XG5cbiAgICAgICAgICAgIGlmIChncm91bmRTdWJzY3JpcHRpb24pIHtcblxuICAgICAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkudW5zdWJzY3JpYmUoZ3JvdW5kU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICAgICAgICAgIGdyb3VuZFN1YnNjcmlwdGlvbiA9IG51bGw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWVzc2FnaW5nR2F0ZXdheS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgJ2dyb3VuZC57MH0uaW4uIycuZm9ybWF0KGdyb3VuZElkKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVHcm91bmRNZXNzYWdlLFxuICAgICAgICAgICAgICAgIGhhbmRsZVN1YnNjcmliZWQpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVHcm91bmRNZXNzYWdlKHBheWxvYWQsIHRvcGljKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHBhcnNlci5wYXJzZU1lc3NhZ2UodG9waWMsIHBheWxvYWQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UubmFtZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGVtaXQoJyRtZXNzYWdpbmcuJyArIG1lc3NhZ2UubmFtZSwgbWVzc2FnZS5kYXRhKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlU3Vic2NyaWJlZChzdWJzY3JpcHRpb24pIHtcblxuICAgICAgICAgICAgICAgIGdyb3VuZFN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbjtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vT2Jzb2xldGUgLSB3aWxsIGJlIHJlbW92ZWQgd2hlbiBhbGwgbWVzc2FnZXMgYXJlIHRyYW5zZmVycmVkIHVuZGVyIGdyb3VuZC57aWR9LmluLiNcbiAgICAgICAgTWVzc2FnZVJlbGF5LnByb3RvdHlwZS5zdWJzY3JpYmVGb3JBbGxOb3RpZmljYXRpb25zID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgICdjbGllbnQuezB9LmluLiMnLmZvcm1hdChtZXNzYWdpbmdHYXRld2F5LmNsaWVudElkKSxcbiAgICAgICAgICAgICAgICBoYW5kbGVNZXNzYWdlKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShwYXlsb2FkLCB0b3BpYykge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBwYXJzZXIucGFyc2VNZXNzYWdlKHRvcGljLCBwYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLm5hbWUpIHtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRlbWl0KCckbWVzc2FnaW5nLicgKyBtZXNzYWdlLm5hbWUsIG1lc3NhZ2UuZGF0YSk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgTWVzc2FnZVJlbGF5LnByb3RvdHlwZS51bnN1YnNjcmliZUZyb21Hcm91bmROb3RpZmljYXRpb25zID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGlmIChncm91bmRTdWJzY3JpcHRpb24pIHtcblxuICAgICAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkudW5zdWJzY3JpYmUoZ3JvdW5kU3Vic2NyaXB0aW9uKTtcblxuICAgICAgICAgICAgICAgIGdyb3VuZFN1YnNjcmlwdGlvbiA9IG51bGw7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBNZXNzYWdlUmVsYXkucHJvdG90eXBlLnB1Ymxpc2hTdGF0ZSA9IGZ1bmN0aW9uKGFzc2V0LCBzdGF0ZURhdGEpIHtcblxuICAgICAgICAgICAgdmFyIHRvcGljID0gcGFyc2VyLmdldE1lc3NhZ2VUb3BpYyhtZXNzYWdpbmdHYXRld2F5LmNsaWVudElkLCAnc3RhdGUnLCBhc3NldCk7XG5cbiAgICAgICAgICAgIG1lc3NhZ2luZ0dhdGV3YXkucHVibGlzaCh0b3BpYywgc3RhdGVEYXRhKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIE1lc3NhZ2VSZWxheS5wcm90b3R5cGUucHVibGlzaENvbW1hbmQgPSBmdW5jdGlvbihhc3NldCwgY29tbWFuZERhdGEpIHtcblxuICAgICAgICAgICAgdmFyIHRvcGljID0gcGFyc2VyLmdldE1lc3NhZ2VUb3BpYyhtZXNzYWdpbmdHYXRld2F5LmNsaWVudElkLCAnY29tbWFuZCcsIGFzc2V0KTtcblxuICAgICAgICAgICAgbWVzc2FnaW5nR2F0ZXdheS5wdWJsaXNoKHRvcGljLCBjb21tYW5kRGF0YSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gbmV3IE1lc3NhZ2VSZWxheSgpO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignQWxsTm90aWZpY2F0aW9uc0NvbnRyb2xsZXInLCBBbGxOb3RpZmljYXRpb25zQ29udHJvbGxlcik7XG5cbiAgICBBbGxOb3RpZmljYXRpb25zQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnbW9kZWwnLCAndmlld05vdGlmaWNhdGlvbkNhbGxiYWNrJ107XG5cbiAgICBmdW5jdGlvbiBBbGxOb3RpZmljYXRpb25zQ29udHJvbGxlcigkc2NvcGUsIG1vZGVsLCB2aWV3Tm90aWZpY2F0aW9uQ2FsbGJhY2spIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB2bS52aWV3Tm90aWZpY2F0aW9uID0gdmlld05vdGlmaWNhdGlvbjtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cbiAgICAgICAgICAgIHZtLm1vZGVsLnN1YnNjcmliZSgpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZtLm1vZGVsLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdmlld05vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgIHZtLm1vZGVsLnZpZXdOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcblxuICAgICAgICAgICAgaWYgKHZpZXdOb3RpZmljYXRpb25DYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHZpZXdOb3RpZmljYXRpb25DYWxsYmFjayhub3RpZmljYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0FsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwnLCBmYWN0b3J5KTtcblxuICAgIGZhY3RvcnkuJGluamVjdCA9IFsnbm90aWZpY2F0aW9uc1JlcG9zaXRvcnknLCAnbm90aWZpY2F0aW9uQ29udGV4dCcsICd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gZmFjdG9yeShub3RpZmljYXRpb25zUmVwb3NpdG9yeSwgbm90aWZpY2F0aW9uQ29udGV4dCwgdXRpbHMpIHtcblxuICAgICAgICB2YXIgUEFHRV9TSVpFID0gMTA7XG4gICAgICAgIHZhciB1bnN1YnNjcmliZUhhbmRsZXIgPSBudWxsO1xuXG4gICAgICAgIGZ1bmN0aW9uIEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwobm90aWZpY2F0aW9ucykge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGF0Lm5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zO1xuICAgICAgICAgICAgdGhhdC5wYWdlU2l6ZSA9IFBBR0VfU0laRTtcbiAgICAgICAgICAgIHRoYXQucGFnZSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBBbGxOb3RpZmljYXRpb25zVmlld01vZGVsLnByb3RvdHlwZS5tYXJrQXNSZWFkID0gZnVuY3Rpb24obm90aWZpY2F0aW9uKSB7XG5cbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbnRleHQubWFya0FzUmVhZChub3RpZmljYXRpb24pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwucHJvdG90eXBlLnZpZXdOb3RpZmljYXRpb24gPSBmdW5jdGlvbihub3RpZmljYXRpb24pIHtcblxuICAgICAgICAgICAgdGhpcy5tYXJrQXNSZWFkKG5vdGlmaWNhdGlvbik7XG4gICAgICAgICAgICBub3RpZmljYXRpb24udmlldyh0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICBBbGxOb3RpZmljYXRpb25zVmlld01vZGVsLnByb3RvdHlwZS5sb2FkTW9yZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoYXQucGFnZSsrO1xuXG4gICAgICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uc1JlcG9zaXRvcnkuZmluZChQQUdFX1NJWkUsIHRoYXQucGFnZSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5ub3RpZmljYXRpb25zID0gdGhhdC5ub3RpZmljYXRpb25zLmNvbmNhdChyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgaWYgKHVuc3Vic2NyaWJlSGFuZGxlcikge1xuICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlSGFuZGxlcigpO1xuICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlSGFuZGxlciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgQWxsTm90aWZpY2F0aW9uc1ZpZXdNb2RlbC5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdW5zdWJzY3JpYmVIYW5kbGVyID0gdXRpbHMuJHJvb3RTY29wZS4kb24oJ3VzZXIubm90aWZpY2F0aW9uJywgdXNlck5vdGlmaWNhdGlvbkhhbmRsZXIpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB1c2VyTm90aWZpY2F0aW9uSGFuZGxlcihldmVudCwgbm90aWZpY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5ub3RpZmljYXRpb25zLnB1c2gobm90aWZpY2F0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBBbGxOb3RpZmljYXRpb25zVmlld01vZGVsLnJlc29sdmUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbnNSZXBvc2l0b3J5LmZpbmQoUEFHRV9TSVpFKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gQWxsTm90aWZpY2F0aW9uc1ZpZXdNb2RlbDtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ25vdGlmaWNhdGlvbkNvbnRleHQnLCBmYWN0b3J5KTtcblxuICAgIGZhY3RvcnkuJGluamVjdCA9IFsndXRpbHMnLCAnc2Vzc2lvbicsICdub3RpZmljYXRpb25zUmVwb3NpdG9yeScsICdOb3RpZmljYXRpb25Nb2RlbCcsICd1c2VyQ29udGV4dCddO1xuXG4gICAgZnVuY3Rpb24gZmFjdG9yeSh1dGlscywgc2Vzc2lvbiwgbm90aWZpY2F0aW9uc1JlcG9zaXRvcnksIE5vdGlmaWNhdGlvbiwgdXNlckNvbnRleHQpIHtcblxuICAgICAgICBmdW5jdGlvbiBOb3RpZmljYXRpb25Db250ZXh0KCkge1xuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBOb3RpZmljYXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRVbnJlYWRDb3VudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdW5yZWFkQ291bnQgPSAwO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godGhpcy5ub3RpZmljYXRpb25zLCBmdW5jdGlvbihub3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vdGlmaWNhdGlvbi52YWx1ZS5pc1JlYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdW5yZWFkQ291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHVucmVhZENvdW50O1xuICAgICAgICB9O1xuXG4gICAgICAgIE5vdGlmaWNhdGlvbkNvbnRleHQucHJvdG90eXBlLm1hcmtBc1JlYWQgPSBmdW5jdGlvbihub3RpZmljYXRpb24pIHtcblxuICAgICAgICAgICAgbm90aWZpY2F0aW9uLnZhbHVlLmlzUmVhZCA9IHRydWU7XG5cbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnNSZXBvc2l0b3J5Lm1hcmtBc1JlYWQobm90aWZpY2F0aW9uKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb3RpZmljYXRpb25Db250ZXh0LnByb3RvdHlwZS5tYXJrQWxsQXNSZWFkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLm5vdGlmaWNhdGlvbnMsIGZ1bmN0aW9uKG5vdGlmaWNhdGlvbikge1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi52YWx1ZS5pc1JlYWQgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnNSZXBvc2l0b3J5Lm1hcmtBbGxBc1JlYWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb3RpZmljYXRpb25Db250ZXh0LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kb24oJ3VzZXIubG9naW4nLCB1c2VyTG9naW5IYW5kbGVyKTtcbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ291dCcsIHVzZXJMb2dvdXRIYW5kbGVyKTtcbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJG9uKCckbWVzc2FnaW5nLm5vdGlmaWNhdGlvbicsIHVzZXJOb3RpZmljYXRpb25IYW5kbGVyKTtcblxuICAgICAgICAgICAgaWYgKHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5pc0F1dGgpIHtcbiAgICAgICAgICAgICAgICBzZXR1cE5vdGlmaWNhdGlvbnMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdXNlckxvZ2luSGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIHNldHVwTm90aWZpY2F0aW9ucygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB1c2VyTG9nb3V0SGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIHRoYXQubm90aWZpY2F0aW9ucyA9IFtdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB1c2VyTm90aWZpY2F0aW9uSGFuZGxlcihldmVudCwgbm90aWZpY2F0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICB0aGF0Lm5vdGlmaWNhdGlvbnMucHVzaChub3RpZmljYXRpb24pO1xuICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldHVwTm90aWZpY2F0aW9ucygpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBub3RpZmljYXRpb25zUmVwb3NpdG9yeS5maW5kKCkudGhlbihmdW5jdGlvbihub3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQubm90aWZpY2F0aW9ucyA9IG5vdGlmaWNhdGlvbnM7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG5ldyBOb3RpZmljYXRpb25Db250ZXh0KCk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdOb3RpZmljYXRpb25Db250cm9sbGVyJywgTm90aWZpY2F0aW9uQ29udHJvbGxlcik7XG5cbiAgICBOb3RpZmljYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckbW9kYWwnLCAnbm90aWZpY2F0aW9uQ29udGV4dCcsICdBbGxOb3RpZmljYXRpb25zVmlld01vZGVsJywgJ0dyb3VuZENvbnRleHQnXTtcblxuICAgIGZ1bmN0aW9uIE5vdGlmaWNhdGlvbkNvbnRyb2xsZXIoJHN0YXRlLCAkbW9kYWwsIG5vdGlmaWNhdGlvbkNvbnRleHQsIEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwsIGdyb3VuZENvbnRleHQpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5jb250ZXh0ID0gbm90aWZpY2F0aW9uQ29udGV4dDtcbiAgICAgICAgdm0ubm90aWZpY2F0aW9uTGltaXQgPSA1O1xuICAgICAgICB2bS52aWV3Tm90aWZpY2F0aW9uID0gdmlld05vdGlmaWNhdGlvbjtcbiAgICAgICAgdm0ubWFya0FzUmVhZCA9IG1hcmtBc1JlYWQ7XG4gICAgICAgIHZtLm1hcmtBbGxBc1JlYWQgPSBtYXJrQWxsQXNSZWFkO1xuICAgICAgICB2bS5zaG93QWxsID0gc2hvd0FsbDtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIHZpZXdOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7XG5cbiAgICAgICAgICAgIG1hcmtBc1JlYWQobm90aWZpY2F0aW9uKTtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi52aWV3KCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYXJrQXNSZWFkKG5vdGlmaWNhdGlvbikge1xuXG4gICAgICAgICAgICBub3RpZmljYXRpb25Db250ZXh0Lm1hcmtBc1JlYWQobm90aWZpY2F0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1hcmtBbGxBc1JlYWQoKSB7XG5cbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbnRleHQubWFya0FsbEFzUmVhZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2hvd0FsbCgpIHtcblxuICAgICAgICAgICAgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT09ICdtYWluLm5vdGlmaWNhdGlvbnMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcHJldmlvdXNTdGF0ZU5hbWUgPSAkc3RhdGUuY3VycmVudC5uYW1lO1xuICAgICAgICAgICAgdmFyIHByZXZpb3VzU3RhdGVQYXJhbXMgPSBhbmd1bGFyLmNvcHkoJHN0YXRlLnBhcmFtcyk7XG5cbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvY29yZS9ub3RpZmljYXRpb25zL2FsbC1ub3RpZmljYXRpb25zLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBbGxOb3RpZmljYXRpb25zQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFsbE5vdGlmaWNhdGlvbnNWaWV3TW9kZWwucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oYW52bSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhbnZtO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgdmlld05vdGlmaWNhdGlvbkNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VNb2RhbChub3RpZmljYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbG9zZU1vZGFsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAgICAgICAgICAgIC8vbW9kYWwgcmVzdWx0IHByb21pc2UgaXMgcmVzb2x2ZWQgYXMgc3VjY2VzcyBpZlxuICAgICAgICAgICAgICAgIC8vbGluayBpcyBjbGlja2VkIChzdGF0ZSBjaGFuZ2VkKSBmcm9tIHdpdGhpbiB0aGUgbW9kYWwgY29udGVudFxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVhc29uKSB7XG5cbiAgICAgICAgICAgICAgICAvL3VzZXIgY2xpY2tlZCB4IG9yIG91dHNpZGUgb2YgdGhlIGJvdW5kcyBvZiB0aGUgbW9kYWxcbiAgICAgICAgICAgICAgICAvL3NvIHdlIHNob3VsZCByZXR1cm4gdG8gcHJldmlvdXMgc3RhdGVcblxuICAgICAgICAgICAgICAgIGlmIChyZWFzb24gIT09ICdyb3V0ZUNoYW5nZScpIHtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKHByZXZpb3VzU3RhdGVOYW1lLCBwcmV2aW91c1N0YXRlUGFyYW1zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLm5vdGlmaWNhdGlvbnMnLCB7fSwge1xuICAgICAgICAgICAgICAgIG5vdGlmeTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ05vdGlmaWNhdGlvbk1vZGVsJywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJyRzdGF0ZSddO1xuXG4gICAgZnVuY3Rpb24gZmFjdG9yeSgkc3RhdGUpIHtcblxuICAgICAgICBmdW5jdGlvbiBOb3RpZmljYXRpb24oZGF0YSkge1xuXG4gICAgICAgICAgICB0aGlzLmF0ID0gZGF0YS5hdDtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBkYXRhLmRhdGE7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmV2ZW50ID09PSAnRGV2aWNlQXNzZXROZXdTdGF0ZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gJy9hc3NldHMvanMvYXBwL2NvcmUvbm90aWZpY2F0aW9ucy9hc3NldC1zdGF0ZS1jaGFuZ2UudGVtcGxhdGUuaHRtbCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmV2ZW50ID09PSAnUnVsZUVuZ2luZUV4ZWN1dGlvbk5vdGlmaWNhdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gJy9hc3NldHMvanMvYXBwL2NvcmUvbm90aWZpY2F0aW9ucy9tZXNzYWdlLnRlbXBsYXRlLmh0bWwnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgTm90aWZpY2F0aW9uLnByb3RvdHlwZS52aWV3ID0gZnVuY3Rpb24ocmVwbGFjZUxvY2F0aW9uKSB7XG5cbiAgICAgICAgICAgIHZhciByb3V0ZU9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgIHZhciByb3V0ZU5hbWUgPSBudWxsO1xuICAgICAgICAgICAgdmFyIHJvdXRlUGFyYW1zID0ge307XG5cbiAgICAgICAgICAgIGlmIChyZXBsYWNlTG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICByb3V0ZU9wdGlvbnMubG9jYXRpb24gPSAncmVwbGFjZSc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmRhdGEuYXNzZXQpIHtcbiAgICAgICAgICAgICAgICByb3V0ZU5hbWUgPSAnbWFpbi5hc3NldCc7XG4gICAgICAgICAgICAgICAgcm91dGVQYXJhbXMuaWQgPSB0aGlzLnZhbHVlLmRhdGEuYXNzZXQuSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmRhdGEuZ3JvdW5kKSB7XG5cbiAgICAgICAgICAgICAgICByb3V0ZU5hbWUgPSAnbWFpbi5ncm91bmQnO1xuICAgICAgICAgICAgICAgIHJvdXRlUGFyYW1zLmlkID0gdGhpcy52YWx1ZS5kYXRhLmdyb3VuZC5JZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJvdXRlTmFtZSkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyhcbiAgICAgICAgICAgICAgICAgICAgcm91dGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICByb3V0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgcm91dGVPcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gTm90aWZpY2F0aW9uO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnbm90aWZpY2F0aW9uc1JlcG9zaXRvcnknLCBub3RpZmljYXRpb25zUmVwb3NpdG9yeSk7XG5cbiAgICBub3RpZmljYXRpb25zUmVwb3NpdG9yeS4kaW5qZWN0ID0gWydOb3RpZmljYXRpb25Nb2RlbCcsICdub3RpZmljYXRpb25TZXJ2aWNlJywgJ3V0aWxzJywgJ2V4Y2VwdGlvbiddO1xuXG4gICAgZnVuY3Rpb24gbm90aWZpY2F0aW9uc1JlcG9zaXRvcnkoTm90aWZpY2F0aW9uLCBub3RpZmljYXRpb25TZXJ2aWNlLCB1dGlscywgZXhjZXB0aW9uKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBmaW5kOiBmaW5kLFxuICAgICAgICAgICAgbWFya0FzUmVhZDogbWFya0FzUmVhZCxcbiAgICAgICAgICAgIG1hcmtBbGxBc1JlYWQ6IG1hcmtBbGxBc1JlYWRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZmluZChjb3VudCwgcGFnZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uU2VydmljZS5maW5kKGNvdW50LCBwYWdlKS50aGVuKGZ1bmN0aW9uKGJvZHkpIHtcblxuICAgICAgICAgICAgICAgIHZhciBtb2RlbHMgPSBbXTtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goYm9keS5pdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICBtb2RlbHMucHVzaChuZXcgTm90aWZpY2F0aW9uKGl0ZW0pKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbHM7XG4gICAgICAgICAgICB9KS5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB0byBsb2FkIG5vdGlmaWNhdGlvbnMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbWFya0FzUmVhZChub3RpZmljYXRpb24pIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvblNlcnZpY2UubWFya0FzUmVhZChub3RpZmljYXRpb24uYXQpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIG1hcmsgbm90aWZpY2F0aW9uIGFzIHJlYWQnKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYXJrQWxsQXNSZWFkKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uU2VydmljZS5tYXJrQWxsQXNSZWFkKClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbWFyayBhbGwgbm90aWZpY2F0aW9ucyBhcyByZWFkJykpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ29mZmxpbmUnLCBvZmZsaW5lKTtcblxuICAgIGZ1bmN0aW9uIG9mZmxpbmUoKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2NvcmUvb2ZmbGluZS9vZmZsaW5lLnRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6e31cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG5cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbJ29mZmxpbmUnXTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIob2ZmbGluZSkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLnN0YXR1cyA9IG9mZmxpbmU7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdvZmZsaW5lJywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJyR3aW5kb3cnLCAndXRpbHMnXTtcblxuICAgIGZ1bmN0aW9uIGZhY3RvcnkoJHdpbmRvdywgdXRpbHMpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGlzT2ZmbGluZTogZmFsc2UsXG4gICAgICAgICAgICBpc01lc3NhZ2luZ0Rpc2Nvbm5lY3RlZDogZmFsc2UsXG4gICAgICAgICAgICBpbml0OiBpbml0XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignJG1lc3NhZ2luZy5jb25uZWN0aW9uLmNvbm5lY3RlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNlcnZpY2UuaXNNZXNzYWdpbmdEaXNjb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignJG1lc3NhZ2luZy5jb25uZWN0aW9uLmRpc2Nvbm5lY3RlZCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzZXJ2aWNlLmlzTWVzc2FnaW5nRGlzY29ubmVjdGVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMubm90aWZ5Lndhcm5pbmcoXG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29ubmVjdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU2VydmVyIGNvbm5lY3Rpb24gaGFzIGRyb3BwZWQuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICdSZWxvYWQgcGFnZScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VydmljZS5pc01lc3NhZ2luZ0Rpc2Nvbm5lY3RlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0T2ZmbGluZSgpIHtcblxuICAgICAgICAgICAgaWYgKCFzZXJ2aWNlLmlzT2ZmbGluZSkge1xuICAgICAgICAgICAgICAgIHV0aWxzLm5vdGlmeS53YXJuaW5nKCdDb25uZWN0aW9uJywgJ1NlcnZlciBkb2VzIG5vdCByZXNwb25kIGF0IHRoZSBtb21lbnQuIENoYW5nZXMgdGhhdCB5b3UgbWFrZSBub3csIG1heSBub3QgYmUgYXBwbGllZC4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VydmljZS5pc09mZmxpbmUgPSB0cnVlO1xuICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldE9ubGluZSgpIHtcblxuICAgICAgICAgICAgc2VydmljZS5pc09mZmxpbmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGFwcGx5KCk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgncGVybWlzc2lvbicsIHBlcm1pc3Npb24pO1xuXG4gICAgcGVybWlzc2lvbi4kaW5qZWN0ID0gWyckYW5pbWF0ZScsICd1dGlscycsICdyb2xlcy5tYW5hZ2VyJ107XG5cbiAgICBmdW5jdGlvbiBwZXJtaXNzaW9uKCRhbmltYXRlLCB1dGlscywgcm9sZU1hbmFnZXIpIHtcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBtdWx0aUVsZW1lbnQ6IHRydWUsXG4gICAgICAgICAgICBwcmlvcml0eTogNTk5LFxuICAgICAgICAgICAgdGVybWluYWw6IHRydWUsXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiAnZWxlbWVudCcsXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICAkJHRsYjogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcigkc2NvcGUsICRlbGVtZW50LCAkYXR0ciwgY3RybCwgJHRyYW5zY2x1ZGUpIHtcblxuICAgICAgICAgICAgdmFyIGJsb2NrO1xuICAgICAgICAgICAgdmFyIGNoaWxkU2NvcGU7XG4gICAgICAgICAgICB2YXIgcHJldmlvdXNFbGVtZW50cztcblxuICAgICAgICAgICAgdmFyIHBlcm1pc3Npb24gPSBwYXJzZVBlcm1pc3Npb25SZWYoJGF0dHIucGVybWlzc2lvbik7XG5cbiAgICAgICAgICAgIGlmIChwZXJtaXNzaW9uLnBheWxvYWRFeHByKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChwZXJtaXNzaW9uLnBheWxvYWRFeHByLCBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gcGVybWlzc2lvbi5wYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGUodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgcGVybWlzc2lvbi5wYXlsb2FkID0gYW5ndWxhci5jb3B5KCRzY29wZS4kZXZhbChwZXJtaXNzaW9uLnBheWxvYWRFeHByKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcGVybWlzc2lvbi5wYXlsb2FkID0ge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ2luJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlKHBlcm1pc3Npb24ucGF5bG9hZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kb24oJ3VzZXIubG9nb3V0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlKHBlcm1pc3Npb24ucGF5bG9hZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdXBkYXRlKHBlcm1pc3Npb24ucGF5bG9hZCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlUGVybWlzc2lvblJlZihyZWYpIHtcblxuICAgICAgICAgICAgICAgIHZhciBwYXJzZWQgPSByZWYucmVwbGFjZSgvXFxuL2csICcgJykubWF0Y2goL14oW14oXSs/KVxccyooXFwoKC4qKVxcKSk/JC8pO1xuICAgICAgICAgICAgICAgIGlmICghcGFyc2VkIHx8IHBhcnNlZC5sZW5ndGggIT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBlcm1pc3Npb24gcmVmIFwiJyArIHJlZiArICdcIicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcnNlZFsxXSxcbiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZEV4cHI6IHBhcnNlZFszXSB8fCBudWxsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlKG5ld1Blcm1pc3Npb25QYXlsb2FkKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3UGVybWlzc2lvblBheWxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbi5wYXlsb2FkID0gYW5ndWxhci5jb3B5KG5ld1Blcm1pc3Npb25QYXlsb2FkKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYXV0aG9yaXplZCA9IHJvbGVNYW5hZ2VyLmF1dGhvcml6ZShwZXJtaXNzaW9uLm5hbWUsIHBlcm1pc3Npb24ucGF5bG9hZCk7XG5cbiAgICAgICAgICAgICAgICAvL3J1biBuZ0lmIHRvIHJlbW92ZSBlbGVtZW50cyBhbmQgY2hpbGQgc2NvcGVzIGlmIG5vdCBhdXRob3JpemVkIG9yIHRvIGFkZCBlbGVtZW50c1xuICAgICAgICAgICAgICAgIHJ1bk5nSWYoYXV0aG9yaXplZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vQ29kZSBlbnRpcmVseSB0YWtlbiBmcm9tIGFuZ3VsYXIgbmdJZiBkaXJlY3RpdmVcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJ1bk5nSWYodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGlsZFNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNjbHVkZShmdW5jdGlvbihjbG9uZSwgbmV3U2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZFNjb3BlID0gbmV3U2NvcGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmVbY2xvbmUubGVuZ3RoKytdID0gZG9jdW1lbnQuY3JlYXRlQ29tbWVudCgnIGVuZCBwZXJtaXNzaW9uOiAnICsgJGF0dHIucGVybWlzc2lvbiArICcgJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBXZSBvbmx5IG5lZWQgdGhlIGZpcnN0L2xhc3Qgbm9kZSBvZiB0aGUgY2xvbmVkIG5vZGVzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvd2V2ZXIsIHdlIG5lZWQgdG8ga2VlcCB0aGUgcmVmZXJlbmNlIHRvIHRoZSBqcWxpdGUgd3JhcHBlciBhcyBpdCBtaWdodCBiZSBjaGFuZ2VkIGxhdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnkgYSBkaXJlY3RpdmUgd2l0aCB0ZW1wbGF0ZVVybCB3aGVuIGl0cyB0ZW1wbGF0ZSBhcnJpdmVzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9uZTogY2xvbmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbmltYXRlLmVudGVyKGNsb25lLCAkZWxlbWVudC5wYXJlbnQoKSwgJGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNFbGVtZW50cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNFbGVtZW50cy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzRWxlbWVudHMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkU2NvcGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcGUuJGRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkU2NvcGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0VsZW1lbnRzID0gZ2V0QmxvY2tOb2RlcyhibG9jay5jbG9uZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYW5pbWF0ZS5sZWF2ZShwcmV2aW91c0VsZW1lbnRzKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzRWxlbWVudHMgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9Db2RlIGVudGlyZWx5IHRha2UgZnJvbSBhbmd1bGFyIGNvcmUsIGFzIG5nSWYgd2FzIHVzaW5nIGl0IGludGVybmFsbHlcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJsb2NrTm9kZXMobm9kZXMpIHtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHBlcmYpOiB1cGRhdGUgYG5vZGVzYCBpbnN0ZWFkIG9mIGNyZWF0aW5nIGEgbmV3IG9iamVjdD9cbiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzWzBdO1xuICAgICAgICAgICAgICAgIHZhciBlbmROb2RlID0gbm9kZXNbbm9kZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgdmFyIGJsb2NrTm9kZXM7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgbm9kZSAhPT0gZW5kTm9kZSAmJiAobm9kZSA9IG5vZGUubmV4dFNpYmxpbmcpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrTm9kZXMgfHwgbm9kZXNbaV0gIT09IG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYmxvY2tOb2Rlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrTm9kZXMgPSBqcUxpdGUoc2xpY2UuY2FsbChub2RlcywgMCwgaSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBibG9ja05vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvY2tOb2RlcyB8fCBub2RlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdyb2xlcy5pbml0aWFsaXphdG9yJywgcm9sZUluaXRpYWxpemF0b3IpO1xuXG4gICAgcm9sZUluaXRpYWxpemF0b3IuJGluamVjdCA9IFsncm9sZXMubWFuYWdlcicsICdHcm91bmRDb250ZXh0JywgJ3VzZXJDb250ZXh0JywgJ3V0aWxzJ107XG5cbiAgICBmdW5jdGlvbiByb2xlSW5pdGlhbGl6YXRvcihyb2xlTWFuYWdlciwgZ3JvdW5kQ29udGV4dCwgdXNlckNvbnRleHQsIHV0aWxzKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBpbml0OiBpbml0XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcblxuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJSb2xlKCdncm91bmQtb3duZXInLCBmdW5jdGlvbihwYXlsb2FkKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZ3JvdW5kID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIGlmICghdXNlckNvbnRleHQudXNlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHBheWxvYWQgJiYgcGF5bG9hZC5ncm91bmRJZCkge1xuICAgICAgICAgICAgICAgICAgICBncm91bmQgPSBncm91bmRDb250ZXh0LmZpbmQocGF5bG9hZC5ncm91bmRJZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdW5kID0gZ3JvdW5kQ29udGV4dC5jdXJyZW50O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChncm91bmQub3duZXJJZCA9PT0gdXNlckNvbnRleHQudXNlci5pZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJSb2xlKCdzZWxmJywgZnVuY3Rpb24ocGF5bG9hZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyQ29udGV4dC51c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcGF5bG9hZC5yZWxhdGVkVXNlcklkID09PSB1c2VyQ29udGV4dC51c2VyLmlkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUm9sZSgnZ29kJywgZnVuY3Rpb24ocGF5bG9hZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyQ29udGV4dC51c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckNvbnRleHQudXNlci5yb2xlID09PSAnQWRtaW5pc3RyYXRvcic7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdncm91bmQtdmlldy1kZXZpY2VzJywgWydncm91bmQtb3duZXInXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2dyb3VuZC1tZW1iZXItcmVtb3ZlJywgWydzZWxmJywgJ2dyb3VuZC1vd25lciddKTtcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZ3JvdW5kLWRlbGV0ZScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdncm91bmQtc2F2ZScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdncm91bmQtbWVtYmVyLWFkZCcsIFsnZ3JvdW5kLW93bmVyJ10pO1xuXG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZXMtYWRkJywgWydncm91bmQtb3duZXInXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1zYXZlJywgWydncm91bmQtb3duZXInXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1kZWxldGUnLCBbJ2dyb3VuZC1vd25lciddKTtcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZGV2aWNlLWNvbnRyb2wtc2F2ZScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdkZXZpY2UtcHJvZmlsZS1zYXZlJywgWydncm91bmQtb3duZXInXSk7XG5cbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZGV2aWNlLWFzc2V0cy1hZGQnLCBbJ2dyb3VuZC1vd25lciddKTtcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZGV2aWNlLWFzc2V0LXJlbW92ZScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuXG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1hc3NldC1zYXZlJywgWydncm91bmQtb3duZXInXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1hc3NldC1jb21tYW5kJywgWydncm91bmQtb3duZXInXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1hc3NldC1jb250cm9sLXNhdmUnLCBbJ2dyb3VuZC1vd25lciddKTtcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZGV2aWNlLWFzc2V0LXByb2ZpbGUtc2F2ZScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdkZXZpY2UtYXNzZXQtc3RhdGUnLCBbJ2dyb3VuZC1vd25lcicsICdnb2QnXSk7XG4gICAgICAgICAgICByb2xlTWFuYWdlci5yZWdpc3RlclBlcm1pc3Npb24oJ2RldmljZS1jb21tYW5kJywgWydncm91bmQtb3duZXInXSk7XG5cbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZ2F0ZXdheS1jbGFpbScsIFsnZ3JvdW5kLW93bmVyJ10pO1xuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCdnYXRld2F5LXNhdmUnLCBbJ2dyb3VuZC1vd25lciddKTtcbiAgICAgICAgICAgIHJvbGVNYW5hZ2VyLnJlZ2lzdGVyUGVybWlzc2lvbignZ2F0ZXdheS1kZWxldGUnLCBbJ2dyb3VuZC1vd25lciddKTtcblxuICAgICAgICAgICAgcm9sZU1hbmFnZXIucmVnaXN0ZXJQZXJtaXNzaW9uKCd1c2VybWVudS1nb2RzZWN0aW9uJywgWydnb2QnXSk7XG5cbiAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuaGFzUGVybWlzc2lvbiA9IGZ1bmN0aW9uKHBlcm1pc3Npb25OYW1lLCBwYXlsb2FkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJvbGVNYW5hZ2VyLmF1dGhvcml6ZShwZXJtaXNzaW9uTmFtZSwgcGF5bG9hZCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdyb2xlcy5tYW5hZ2VyJywgZmFjdG9yeSk7XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCkge1xuXG4gICAgICAgIHJldHVybiBuZXcgUm9sZU1hbmFnZXIoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBSb2xlTWFuYWdlcigpIHtcblxuICAgICAgICB0aGlzLnJvbGVzID0ge307XG4gICAgICAgIHRoaXMucGVybWlzc2lvbnMgPSB7fTtcbiAgICB9XG5cbiAgICBSb2xlTWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJSb2xlID0gZnVuY3Rpb24obmFtZSwgZ3JhbnRGbikge1xuXG4gICAgICAgIHRoaXMucm9sZXNbbmFtZV0gPSB7XG4gICAgICAgICAgICBncmFudDogZ3JhbnRGblxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBSb2xlTWFuYWdlci5wcm90b3R5cGUucmVnaXN0ZXJQZXJtaXNzaW9uID0gZnVuY3Rpb24obmFtZSwgcm9sZXMpIHtcblxuICAgICAgICB0aGlzLnBlcm1pc3Npb25zW25hbWVdID0ge1xuICAgICAgICAgICAgcm9sZXM6IHJvbGVzXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIFJvbGVNYW5hZ2VyLnByb3RvdHlwZS5hdXRob3JpemUgPSBmdW5jdGlvbihwZXJtaXNzaW9uTmFtZSwgcGF5bG9hZCkge1xuXG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB2YXIgcGVybWlzc2lvbiA9IHRoaXMucGVybWlzc2lvbnNbcGVybWlzc2lvbk5hbWVdO1xuXG4gICAgICAgIHZhciBhdXRob3JpemVkID0gZmFsc2U7XG5cbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKHBlcm1pc3Npb24ucm9sZXMsIGZ1bmN0aW9uKHJvbGUpIHtcbiAgICAgICAgICAgIGlmICh0aGF0LnJvbGVzW3JvbGVdLmdyYW50KHBheWxvYWQpKSB7XG4gICAgICAgICAgICAgICAgYXV0aG9yaXplZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBhdXRob3JpemVkO1xuICAgIH07XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnYXNzZXROYW1lJywgYXNzZXROYW1lKTtcblxuICAgIGFzc2V0TmFtZS4kaW5qZWN0ID0gWydhc3NldC5yZXBvc2l0b3J5JywgJ25hbWVDYWNoZSddO1xuXG4gICAgZnVuY3Rpb24gYXNzZXROYW1lKGFzc2V0UmVwb3NpdG9yeSwgbmFtZUNhY2hlKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBpZDogJz1hc3NldE5hbWUnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdpZCcsIGZ1bmN0aW9uKG5ld0lkKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobmFtZUNhY2hlLmFzc2V0c1tzY29wZS5pZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50WzBdKS5odG1sKG5hbWVDYWNoZS5hc3NldHNbc2NvcGUuaWRdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGFzc2V0UmVwb3NpdG9yeS5maW5kKHNjb3BlLmlkKS50aGVuKGZ1bmN0aW9uKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnRbMF0pLmh0bWwoYXNzZXQudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZUNhY2hlLmFzc2V0c1tzY29wZS5pZF0gPSBhc3NldC50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdkZXZpY2VOYW1lJywgZGV2aWNlTmFtZSk7XG5cbiAgICBkZXZpY2VOYW1lLiRpbmplY3QgPSBbJ2RldmljZS5yZXBvc2l0b3J5JywgJ25hbWVDYWNoZSddO1xuXG4gICAgZnVuY3Rpb24gZGV2aWNlTmFtZShkZXZpY2VSZXBvc2l0b3J5LCBuYW1lQ2FjaGUpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGlkOiAnPWRldmljZU5hbWUnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdpZCcsIGZ1bmN0aW9uKG5ld0lkKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobmFtZUNhY2hlLmRldmljZXNbc2NvcGUuaWRdKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudFswXSkuaHRtbChuYW1lQ2FjaGUuZGV2aWNlc1tzY29wZS5pZF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5maW5kKHNjb3BlLmlkKS50aGVuKGZ1bmN0aW9uKGRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50WzBdKS5odG1sKGRldmljZS50aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lQ2FjaGUuZGV2aWNlc1tzY29wZS5pZF0gPSBkZXZpY2UudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnZ3JvdW5kTmFtZScsIGdyb3VuZE5hbWUpO1xuXG4gICAgZ3JvdW5kTmFtZS4kaW5qZWN0ID0gWydncm91bmQucmVwb3NpdG9yeScsICduYW1lQ2FjaGUnXTtcblxuICAgIGZ1bmN0aW9uIGdyb3VuZE5hbWUoZ3JvdW5kUmVwb3NpdG9yeSwgbmFtZUNhY2hlKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBpZDogJz1ncm91bmROYW1lJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnaWQnLCBmdW5jdGlvbihuZXdJZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCFzY29wZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5hbWVDYWNoZS5ncm91bmRzW3Njb3BlLmlkXSkge1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnRbMF0pLmh0bWwobmFtZUNhY2hlLmdyb3VuZHNbc2NvcGUuaWRdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBncm91bmRSZXBvc2l0b3J5LmZpbmQoc2NvcGUuaWQpLnRoZW4oZnVuY3Rpb24oZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnRbMF0pLmh0bWwoZ3JvdW5kLnRpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVDYWNoZS5ncm91bmRzW3Njb3BlLmlkXSA9IGdyb3VuZC50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCduYW1lQ2FjaGUnLCBuYW1lQ2FjaGUpO1xuXG4gICAgZnVuY3Rpb24gbmFtZUNhY2hlKCkge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGFzc2V0czogW10sXG4gICAgICAgICAgICBncm91bmRzOiBbXSxcbiAgICAgICAgICAgIGRldmljZXM6IFtdXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XHJcbiAgICBuZ1xyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2FwaS5hY2NvdW50U2VydmljZScsIEFjY291bnRTZXJ2aWNlKTtcclxuXHJcbiAgICBBY2NvdW50U2VydmljZS4kaW5qZWN0ID0gW1xyXG4gICAgICAgICckaHR0cCcsXHJcbiAgICAgICAgJ3Nlc3Npb24nLFxyXG4gICAgICAgICdhcGkudXJsJyxcclxuICAgICAgICAnZXhjZXB0aW9uJ1xyXG4gICAgXTtcclxuXHJcbiAgICBmdW5jdGlvbiBBY2NvdW50U2VydmljZSgkaHR0cCwgc2Vzc2lvbiwgYXBpVXJsLCBleGNlcHRpb24pIHtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGFjdGl2YXRlOiBhY3RpdmF0ZSxcclxuICAgICAgICAgICAgcmVzZW5kQWN0aXZhdGlvbjogcmVzZW5kQWN0aXZhdGlvbixcclxuICAgICAgICAgICAgcmVjb3ZlclBhc3N3b3JkOiByZWNvdmVyUGFzc3dvcmQsXHJcbiAgICAgICAgICAgIGNoYW5nZVBhc3N3b3JkOiBjaGFuZ2VQYXNzd29yZFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKHRva2VuKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2FjY291bnQvYWN0aXZhdGlvbi8nICsgdG9rZW47XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGFjdGl2YXRlIGFjY291bnQuJykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZW5kQWN0aXZhdGlvbih1c2VyTmFtZUVtYWlsKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2FjY291bnQvcmVzZW5kYWN0aXZhdGlvbic7XHJcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgZW1haWw6IHVzZXJOYW1lRW1haWxcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBkYXRhKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlU3VjY2VzcylcclxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB0byBzZW5kIGFjdGl2YXRpb24gbWFpbC4nKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWNvdmVyUGFzc3dvcmQodXNlck5hbWUpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnYWNjb3VudC9yZWNvdmVycGFzc3dvcmQnO1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyTmFtZVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVTdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIHJlY292ZXIgcGFzc3dvcmQuJykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmQob2xkUGFzc3dvcmQsIG5ld1Bhc3N3b3JkLCBjb25maXJtZWRQYXNzd29yZCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdhY2NvdW50L2NoYW5nZXBhc3N3b3JkJztcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBvbGRQYXNzd29yZDogb2xkUGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBuZXdQYXNzd29yZDogbmV3UGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6IGNvbmZpcm1lZFBhc3N3b3JkXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGRhdGEpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gY2hhbmdlIHBhc3N3b3JkLicpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KHdpbmRvdy5hbmd1bGFyKSk7XHJcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnYXBpLmFzc2V0c1NlcnZpY2UnLCBBc3NldHNTZXJ2aWNlKTtcblxuICAgIEFzc2V0c1NlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnYXBpLnVybCcsICdleGNlcHRpb24nLCAnZGV2aWNlQWN0aXZpdHlTZXJ2aWNlJywgJ3V0aWxzJ107XG5cbiAgICBmdW5jdGlvbiBBc3NldHNTZXJ2aWNlKCRodHRwLCBhcGlVcmwsIGV4Y2VwdGlvbiwgZGV2aWNlQWN0aXZpdHlTZXJ2aWNlLCB1dGlscykge1xuXG4gICAgICAgIHZhciBhc3NldFR5cGVzID0gW3tcbiAgICAgICAgICAgIG5hbWU6ICdTZW5zb3InLFxuICAgICAgICAgICAgdHlwZTogJ3NlbnNvcicsXG4gICAgICAgICAgICBjc3NDbGFzczogJ3NsLWRldmljZS13YWxsLXBsdWcnXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIG5hbWU6ICdBY3R1YXRvcicsXG4gICAgICAgICAgICB0eXBlOiAnYWN0dWF0b3InLFxuICAgICAgICAgICAgY3NzQ2xhc3M6ICdzbC1kZXZpY2Utd2FsbC1wbHVnJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnVmlydHVhbCcsXG4gICAgICAgICAgICB0eXBlOiAndmlydHVhbCdcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgbmFtZTogJ0NvbmZpZycsXG4gICAgICAgICAgICB0eXBlOiAnY29uZmlnJ1xuICAgICAgICB9XTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHB1Ymxpc2hDb21tYW5kOiBwdWJsaXNoQ29tbWFuZCxcbiAgICAgICAgICAgIHB1Ymxpc2hTdGF0ZTogcHVibGlzaFN0YXRlLFxuICAgICAgICAgICAgcmVwbGFjZVByb2ZpbGU6IHJlcGxhY2VQcm9maWxlLFxuICAgICAgICAgICAgcmVwbGFjZUNvbnRyb2w6IHJlcGxhY2VDb250cm9sLFxuICAgICAgICAgICAgY3JlYXRlQXNzZXQ6IGNyZWF0ZUFzc2V0LFxuICAgICAgICAgICAgZ2V0QXNzZXQ6IGdldEFzc2V0LFxuICAgICAgICAgICAgZ2V0QXNzZXRUeXBlczogZ2V0QXNzZXRUeXBlcyxcbiAgICAgICAgICAgIGRlbGV0ZUFzc2V0OiBkZWxldGVBc3NldCxcbiAgICAgICAgICAgIHVwZGF0ZUFzc2V0OiB1cGRhdGVBc3NldCxcbiAgICAgICAgICAgIGFyZVNhbWVQcm9maWxlczogYXJlU2FtZVByb2ZpbGVzLFxuICAgICAgICAgICAgbm9ybWFsaXplUHJvZmlsZVR5cGU6IG5vcm1hbGl6ZVByb2ZpbGVUeXBlLFxuICAgICAgICAgICAgZ2V0QXNzZXRIaXN0b3J5OiBnZXRBc3NldEhpc3RvcnksXG5cbiAgICAgICAgICAgIGNyZWF0ZUFzc2V0VXNpbmdUb2tlbjogY3JlYXRlQXNzZXRVc2luZ1Rva2VuLFxuICAgICAgICAgICAgY3JlYXRlQXNzZXRVc2luZ1RpY2tldDogY3JlYXRlQXNzZXRVc2luZ1RpY2tldFxuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gcHVibGlzaENvbW1hbmQoaWQsIHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2Fzc2V0LycgKyBpZCArICcvY29tbWFuZCc7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwdWJsaXNoU3RhdGUoaWQsIHZhbHVlKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnYXNzZXQvJyArIGlkICsgJy9zdGF0ZSc7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVwbGFjZVByb2ZpbGUoZGV2aWNlSWQsIGFzc2V0TmFtZSwgcHJvZmlsZSkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZS8nICsgZGV2aWNlSWQgKyAnL2Fzc2V0LycgKyBhc3NldE5hbWUgKyAnL3Byb2ZpbGUnO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgcHJvZmlsZSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZXBsYWNlQ29udHJvbChkZXZpY2VJZCwgYXNzZXROYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdkZXZpY2UvJyArIGRldmljZUlkICsgJy9hc3NldC8nICsgYXNzZXROYW1lICsgJy9jb250cm9sJztcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB2YWx1ZTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXNzZXQoZGV2aWNlSWQsIG5hbWUsIHRpdGxlLCB0eXBlLCBwcm9maWxlLCBjb250cm9sKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZGV2aWNlLycgKyBkZXZpY2VJZCArICcvYXNzZXQvJyArIG5hbWU7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VJZCkge1xuICAgICAgICAgICAgICAgIGRhdGEuZGV2aWNlSWQgPSBkZXZpY2VJZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICAgICAgZGF0YS50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgICAgICAgIGRhdGEuaXMgPSB0eXBlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZSAhPT0gbnVsbCAmJiBwcm9maWxlICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIGlmICgodHlwZW9mIHByb2ZpbGUpID09PSAnb2JqZWN0Jykge1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJvZmlsZSA9IHByb2ZpbGU7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJvZmlsZSA9IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcHJvZmlsZVxuXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZGF0YS5wcm9maWxlID0ge1xuXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY29udHJvbCAhPT0gbnVsbCAmJiBjb250cm9sICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIGRhdGEuY29udHJvbCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogY29udHJvbFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXNzZXRVc2luZ1Rva2VuKGRldmljZUlkLCBhc3NldENvbmZpZywgdG9rZW4pIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdkZXZpY2UvJyArIGRldmljZUlkICsgJy9hc3NldC8nICsgYXNzZXRDb25maWcubmFtZTtcblxuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGdldENvbmZpZyh0b2tlbik7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBhc3NldENvbmZpZywgY29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFzc2V0KGlkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2Fzc2V0LycgKyBpZDtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QXNzZXRUeXBlcygpIHtcbiAgICAgICAgICAgIHJldHVybiBhc3NldFR5cGVzO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlQXNzZXQoZGV2aWNlSWQsIG5hbWUpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZGV2aWNlLycgKyBkZXZpY2VJZCArICcvYXNzZXQvJyArIG5hbWU7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVBc3NldChkZXZpY2VJZCwgYXNzZXRJZCwgbmFtZSwgYXNzZXRJcywgdGl0bGUpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZGV2aWNlLycgKyBkZXZpY2VJZCArICcvYXNzZXQvJyArIG5hbWU7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGlkOiBhc3NldElkLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgICAgICBpczogYXNzZXRJc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QXNzZXRIaXN0b3J5KGlkLCBmcm9tLCB0bywgcmVzb2x1dGlvbikge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2Fzc2V0LycgKyBpZCArICcvYWN0aXZpdHknO1xuXG4gICAgICAgICAgICB2YXIgcXVlcnkgPSAnP2Zyb209JyArIGVuY29kZVVSSUNvbXBvbmVudChmcm9tKSArICcmdG89JyArIGVuY29kZVVSSUNvbXBvbmVudCh0bykgKyAnJnJlc29sdXRpb249JyArIHJlc29sdXRpb247XG5cbiAgICAgICAgICAgIHVybCA9IHVybCArIHF1ZXJ5O1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFzc2V0VXNpbmdUaWNrZXQodGlja2V0LCBkYXRhKXtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdhc3NldC8nICsgZGF0YS5uYW1lO1xuXG4gICAgICAgICAgICB2YXIgY29uZmlnID0gZ2V0Q29uZmlnRm9yVGlja2V0KHRpY2tldCk7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBkYXRhLCBjb25maWcpXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhcmVTYW1lUHJvZmlsZXMobGVmdFByb2ZpbGUsIHJpZ2h0UHJvZmlsZSkge1xuXG4gICAgICAgICAgICBpZiAoIWxlZnRQcm9maWxlIHx8ICFyaWdodFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghbGVmdFByb2ZpbGUudHlwZSB8fCAhcmlnaHRQcm9maWxlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBsZWZ0ID0gbm9ybWFsaXplUHJvZmlsZVR5cGUobGVmdFByb2ZpbGUudHlwZSk7XG4gICAgICAgICAgICB2YXIgcmlnaHQgPSBub3JtYWxpemVQcm9maWxlVHlwZShyaWdodFByb2ZpbGUudHlwZSk7XG5cbiAgICAgICAgICAgIHJldHVybiBsZWZ0ID09IHJpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplUHJvZmlsZVR5cGUocHJvZmlsZVR5cGUpIHtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwcm9maWxlVHlwZSAhPSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcm9maWxlVHlwZSA9IHByb2ZpbGVUeXBlLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlVHlwZSA9PSAnYm9vbCcgfHwgcHJvZmlsZVR5cGUgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdib29sJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGVUeXBlID09ICdpbnQnIHx8IHByb2ZpbGVUeXBlID09ICdpbnRlZ2VyJykge1xuICAgICAgICAgICAgICAgIHJldHVybiAnaW50JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGVUeXBlID09ICdkb3VibGUnIHx8IHByb2ZpbGVUeXBlID09ICdmbG9hdCcgfHwgcHJvZmlsZVR5cGUgPT0gJ2RlY2ltYWwnIHx8IHByb2ZpbGVUeXBlID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdudW1iZXInO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZVR5cGUgPT0gJ3N0cmluZycgfHwgcHJvZmlsZVR5cGUgPT0gJ3RleHQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdzdHJpbmcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZVR5cGUgPT0gJ2RhdGV0aW1lJyB8fCBwcm9maWxlVHlwZSA9PSAnZGF0ZScgfHwgcHJvZmlsZVR5cGUgPT0gJ3RpbWUnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdkYXRldGltZSc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlVHlwZSA9PSAndGltZXNwYW4nIHx8IHByb2ZpbGVUeXBlID09ICd0aW1lcmFuZ2UnIHx8IHByb2ZpbGVUeXBlID09ICdkdXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3RpbWVzcGFuJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHByb2ZpbGVUeXBlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29uZmlnRm9yVGlja2V0KHRpY2tldCkge1xuXG4gICAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodGlja2V0KSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdUaWNrZXQgezB9Jy5mb3JtYXQodGlja2V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29uZmlnKHRva2VuKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHt9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciB7MH0nLmZvcm1hdCh0b2tlbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2F1dGhIZWxwZXInLCBhdXRoZW50aWNhdGlvbkhlbHBlcik7XG5cbiAgICBhdXRoZW50aWNhdGlvbkhlbHBlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJ3Nlc3Npb24nLCAnJHN0YXRlJ107XG5cbiAgICBmdW5jdGlvbiBhdXRoZW50aWNhdGlvbkhlbHBlcigkcm9vdFNjb3BlLCBzZXNzaW9uLCAkc3RhdGUpIHtcblxuICAgICAgICB2YXIgYXR0ZW1wdGVkUm91dGUgPSB7XG4gICAgICAgICAgICBuYW1lOiBudWxsLFxuICAgICAgICAgICAgcGFyYW1zOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBnZXRBdHRlbXB0ZWRSb3V0ZTogZ2V0QXR0ZW1wdGVkUm91dGVcbiAgICAgICAgfTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBzdGF0ZUNoYW5nZUhhbmRsZXIpO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEF0dGVtcHRlZFJvdXRlKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gYXR0ZW1wdGVkUm91dGU7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN0YXRlQ2hhbmdlSGFuZGxlcihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRvU3RhdGUuZGF0YSA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHRvU3RhdGUuZGF0YS5yZXF1aXJlTG9naW4gPT09ICd1bmRlZmluZWQnKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkuaXNBdXRoKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgYXR0ZW1wdGVkUm91dGUubmFtZSA9IHRvU3RhdGUubmFtZTtcblxuICAgICAgICAgICAgICAgIGF0dGVtcHRlZFJvdXRlLnBhcmFtcyA9IHRvUGFyYW1zO1xuXG4gICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnbG9naW4nKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdhdXRoU2VydmljZScsIEF1dGhTZXJ2aWNlKTtcblxuICAgIEF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbXG4gICAgICAgICckaHR0cCcsXG4gICAgICAgICdhcGkudXJsJyxcbiAgICAgICAgJ3Nlc3Npb24nLFxuICAgICAgICAnYXBpLmNsaWVudElkJyxcbiAgICAgICAgJ3VzZXJDb250ZXh0JyxcbiAgICAgICAgJ2V4Y2VwdGlvbidcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gQXV0aFNlcnZpY2UoJGh0dHAsIGFwaVVybCwgc2Vzc2lvbiwgYXBpQ2xpZW50SWQsIHVzZXJDb250ZXh0LCBleGNlcHRpb24pIHtcblxuICAgICAgICB2YXIgaGVhZGVycyA9IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgcmVnaXN0ZXI6IHJlZ2lzdGVyLFxuICAgICAgICAgICAgcmVmcmVzaFRva2VuOiByZWZyZXNoVG9rZW4sXG4gICAgICAgICAgICBsb2dpbjogbG9naW4sXG4gICAgICAgICAgICBsb2dvdXQ6IGxvZ291dCxcbiAgICAgICAgICAgIGdldERhdGFGcm9tSGFzaDogZ2V0RGF0YUZyb21IYXNoLFxuICAgICAgICAgICAgY29udGludWVBY3RpdmF0aW9uOiBjb250aW51ZUFjdGl2YXRpb24sXG4gICAgICAgICAgICByb290OiByb290XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXIocmVnaXN0cmF0aW9uKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KGFwaVVybCArICdyZWdpc3RlcicsIHJlZ2lzdHJhdGlvbilcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBwcm9ibGVtIHRvIGNyZWF0ZSB5b3VyIGFjY291bnQuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaFRva2VuKHRva2VuKSB7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0gJ2dyYW50X3R5cGU9cmVmcmVzaF90b2tlbiZyZWZyZXNoX3Rva2VuPScgKyB0b2tlbiArICcmY2xpZW50X2lkPScgKyBhcGlDbGllbnRJZDtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoYXBpVXJsICsgJ2xvZ2luJywgZGF0YSwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNhdmVBdXRoZW50aWNhdGlvbkRhdGEocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luKGxvZ2luRGF0YSkge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9ICdncmFudF90eXBlPXBhc3N3b3JkJnVzZXJuYW1lPScgKyBlbmNvZGVVUklDb21wb25lbnQobG9naW5EYXRhLnVzZXJuYW1lKSArICcmcGFzc3dvcmQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChsb2dpbkRhdGEucGFzc3dvcmQpICsgJyZjbGllbnRfaWQ9JyArIGFwaUNsaWVudElkO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChhcGlVcmwgKyAnbG9naW4nLCBkYXRhLCB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKG9uU3VjY2Vzc2Z1bGxMb2dpbilcbiAgICAgICAgICAgICAgICAudGhlbihsb2FkVXNlckluZm9ybWF0aW9uKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignQ291bGQgbm90IGxvZ2luIHdpdGggY3JlZGVudGlhbHMgcHJvdmlkZWQuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb25TdWNjZXNzZnVsbExvZ2luKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIHNlc3Npb24uc2F2ZUF1dGhlbnRpY2F0aW9uRGF0YShyZXNwb25zZS5kYXRhKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2FkVXNlckluZm9ybWF0aW9uKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gdXNlckNvbnRleHQubG9hZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9nb3V0KCkge1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdChhcGlVcmwgKyAnbG9nb3V0JywgbnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb24uY2xlYXJBdXRoZW50aWNhdGlvbkRhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgdXNlckNvbnRleHQudW5sb2FkKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gc2lnbiB5b3Ugb3V0LicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGFGcm9tSGFzaChoYXNoKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnYWNjb3VudC9jb21wbGV0aW9uLycgKyBoYXNoO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gd2l0aCB5b3VyIGFjdGl2YXRpb24gbGluay4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb250aW51ZUFjdGl2YXRpb24oaGFzaCwgbmV3VXNlcm5hbWUsIG5ld1Bhc3N3b3JkKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnYWNjb3VudC9jb21wbGV0aW9uLycgKyBoYXNoO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogbmV3VXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IG5ld1Bhc3N3b3JkXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgZGF0YSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gY29udGludWUgYWN0aXZhdGlvbiBwcm9jZXNzLicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJvb3QoKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmw7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnYXBpLmNsaWVudEF1dGhvcml6YXRpb25TZXJ2aWNlJywgQ2xpZW50QXV0aG9yaXphdGlvblNlcnZpY2UpO1xuXG4gICAgQ2xpZW50QXV0aG9yaXphdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnYXBpLnVybCcsICdleGNlcHRpb24nXTtcblxuICAgIGZ1bmN0aW9uIENsaWVudEF1dGhvcml6YXRpb25TZXJ2aWNlKCRodHRwLCBhcGlVcmwsIGV4Y2VwdGlvbikge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZ2V0Q2xpZW50czogZ2V0Q2xpZW50cyxcbiAgICAgICAgICAgIHJldm9rZUNsaWVudEF1dGhvcml6YXRpb246IHJldm9rZUNsaWVudEF1dGhvcml6YXRpb25cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgLy8gLSAvYXV0aG9yaXphdGlvbnMgZ2V0cyBhbGwgYXV0aG9yaXplZCBjbGllbnRzXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q2xpZW50cygpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdtZS9jbGllbnRzJztcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGxvYWQgYXV0aG9yaXplZCBjbGllbnRzLicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJldm9rZUNsaWVudEF1dGhvcml6YXRpb24oY2xpZW50SWQpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdjbGllbnQvJyArIGNsaWVudElkO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbG9hZCBhdXRob3JpemVkIGNsaWVudHMuJykpO1xuXG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnYXBpLmNvbnRyb2xzU2VydmljZScsIENvbnRyb2xzU2VydmljZSk7XG5cbiAgICBDb250cm9sc1NlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnYXBpLnVybCcsICd3aWRnZXRzQ29tbW9uJywgJ2V4Y2VwdGlvbiddO1xuXG4gICAgZnVuY3Rpb24gQ29udHJvbHNTZXJ2aWNlKCRodHRwLCBhcGlVcmwsIHdpZGdldHNDb21tb24sIGV4Y2VwdGlvbikge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZ2V0QWxsOiBnZXRBbGwsXG4gICAgICAgICAgICBnZXRDb250cm9sOiBnZXRDb250cm9sLFxuICAgICAgICAgICAgZ2V0Q29udHJvbHNGb3JBc3NldDogZ2V0Q29udHJvbHNGb3JBc3NldCxcbiAgICAgICAgICAgIGdldENvbnRyb2xzRm9yUHJvZmlsZTogZ2V0Q29udHJvbHNGb3JQcm9maWxlLFxuICAgICAgICAgICAgZ2V0RGVmYXVsdENvbnRyb2w6IGdldERlZmF1bHRDb250cm9sXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIC8vIC0gL2NvbnRyb2xzIGdldHMgYWxsIGNvbnRyb2xzXG4gICAgICAgIC8vIC0gL2NvbnRyb2xzLyB7aWR9IGdldHMgY29udHJvbCBieSBpdCdzIG5hbWVcbiAgICAgICAgLy8gLSAvY29udHJvbHMvYXNzZXQgLyB7aWR9IGdldHMgY29udHJvbHMgZm9yIGFzc2V0IGJ5IGl0ICdzIGlkXG4gICAgICAgIC8vIC0gUE9TVCAvIGNvbnRyb2xzIC8gcHJvZmlsZSBnZXRzIGNvbnRyb2xzIGZvciBwcm9maWxlIGluIHRoZSBib2R5XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsKCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdjb250cm9scyc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGxvYWQgY29udHJvbHMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29udHJvbChjb250cm9sTmFtZSkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdjb250cm9scy8nICsgY29udHJvbE5hbWU7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGxvYWQgY29udHJvbC4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRDb250cm9sc0ZvckFzc2V0KGFzc2V0SWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnY29udHJvbHMvYXNzZXQvJyArIGFzc2V0SWQ7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGxvYWQgYXNzZXQgY29udHJvbHMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29udHJvbHNGb3JQcm9maWxlKHByb2ZpbGUpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnY29udHJvbHMvcHJvZmlsZSc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgcHJvZmlsZSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB0byBsb2FkIGNvbnRyb2xzIGZvciBhIHByb2ZpbGUuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbnRyb2woYXNzZXQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHdpZGdldHNDb21tb24uZmluZERlZmF1bHRDb250cm9sKGFzc2V0KTtcblxuICAgICAgICB9XG4gICAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2RldmljZUFjdGl2aXR5U2VydmljZScsIGRldmljZUFjdGl2aXR5U2VydmljZSk7XG5cbiAgICBkZXZpY2VBY3Rpdml0eVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnYXBpLnVybCcsICckcSddO1xuXG4gICAgZnVuY3Rpb24gZGV2aWNlQWN0aXZpdHlTZXJ2aWNlKCRodHRwLCBhcGlVcmwsICRxKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBnZXRBc3NldEFjdGl2aXR5OiBnZXRBc3NldEFjdGl2aXR5XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHRlc3REYXRhID0gW3tcbiAgICAgICAgICAgIGF0OiAnMjAxNS0wOC0yMFQxMzowMDowMC4wMDBaJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgYXZnOiAxLjUsXG4gICAgICAgICAgICAgICAgbWF4OiAyXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiAnMjAxNS0wOC0yMFQxNDowMDowMC4wMDBaJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgYXZnOiAxLjYsXG4gICAgICAgICAgICAgICAgbWF4OiAyLjJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6ICcyMDE1LTA4LTIwVDE1OjAwOjAwLjAwMFonLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICBhdmc6IDEuOCxcbiAgICAgICAgICAgICAgICBtYXg6IDIuOVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBhdDogJzIwMTUtMDgtMjBUMTY6MDA6MDAuMDAwWicsXG4gICAgICAgICAgICBkYXRhOiBudWxsXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiAnMjAxNS0wOC0yMFQxNzowMDowMC4wMDBaJyxcbiAgICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6ICcyMDE1LTA4LTIwVDE4OjAwOjAwLjAwMFonLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICBhdmc6IDEuOCxcbiAgICAgICAgICAgICAgICBtYXg6IDMuNVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBhdDogJzIwMTUtMDgtMjBUMTk6MDA6MDAuMDAwWicsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIGF2ZzogNyxcbiAgICAgICAgICAgICAgICBtYXg6IDE0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGF0OiAnMjAxNS0wOC0yMFQyMDowMDowMC4wMDBaJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBtaW46IDAsXG4gICAgICAgICAgICAgICAgYXZnOiAyLjUsXG4gICAgICAgICAgICAgICAgbWF4OiAzLjdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgYXQ6ICcyMDE1LTA4LTIwVDIxOjAwOjAwLjAwMFonLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICBhdmc6IDEuOCxcbiAgICAgICAgICAgICAgICBtYXg6IDMuNVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBhdDogJzIwMTUtMDgtMjBUMjI6MDA6MDAuMDAwWicsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgICAgIGF2ZzogNCxcbiAgICAgICAgICAgICAgICBtYXg6IDdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfV07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFzc2V0QWN0aXZpdHkoKSB7XG4gICAgICAgICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0ZXN0RGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdhcGkuZGV2aWNlc1NlcnZpY2UnLCBEZXZpY2VTZXJ2aWNlKTtcblxuICAgIERldmljZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnc2Vzc2lvbicsICdhcGkudXJsJywgJ3B1YmxpYy50b2tlbiddO1xuXG4gICAgZnVuY3Rpb24gRGV2aWNlU2VydmljZSgkaHR0cCwgc2Vzc2lvbiwgYXBpVXJsLCBwdWJsaWNUb2tlbikge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZ2V0QWxsOiBnZXRBbGwsXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZUluR3JvdW5kOiBjcmVhdGVJbkdyb3VuZCxcbiAgICAgICAgICAgIGdldEZyb21Hcm91bmQ6IGdldEZyb21Hcm91bmQsXG4gICAgICAgICAgICBnZXQ6IGdldCxcbiAgICAgICAgICAgIHJlZnJlc2g6IHJlZnJlc2gsXG4gICAgICAgICAgICBlbmFibGU6IGVuYWJsZSxcbiAgICAgICAgICAgIGRpc2FibGU6IGRpc2FibGUsXG4gICAgICAgICAgICBkZWxldGVEZXZpY2U6IGRlbGV0ZURldmljZSxcbiAgICAgICAgICAgIHVwZGF0ZURldmljZUNvbnRyb2w6IHVwZGF0ZURldmljZUNvbnRyb2wsXG4gICAgICAgICAgICB1cGRhdGVEZXZpY2U6IHVwZGF0ZURldmljZSxcbiAgICAgICAgICAgIGFkb3B0OiBhZG9wdCxcblxuICAgICAgICAgICAgLy8vdXNpbmcgdG9rZW5cbiAgICAgICAgICAgIGdldEFsbFVzaW5nVG9rZW46IGdldEFsbFVzaW5nVG9rZW4sXG4gICAgICAgICAgICBnZXRTZWxmVXNpbmdUaWNrZXQ6IGdldFNlbGZVc2luZ1RpY2tldCxcbiAgICAgICAgICAgIGNyZWF0ZVVzaW5nVG9rZW46IGNyZWF0ZVVzaW5nVG9rZW4sXG4gICAgICAgICAgICB1cGRhdGVVc2luZ1Rva2VuOiB1cGRhdGVVc2luZ1Rva2VuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbChnYXRld2F5SWQsIG5ld0RldmljZXNPbmx5KSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZT9pbmNsdWRlQXNzZXRzPXRydWUnO1xuXG4gICAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHBhcmFtczoge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChnYXRld2F5SWQpIHtcbiAgICAgICAgICAgICAgICBjb25maWcucGFyYW1zLmdhdGV3YXlJZCA9IGdhdGV3YXlJZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5ld0RldmljZXNPbmx5KSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLnBhcmFtcy5uZXcgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCwgY29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShkYXRhKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZSc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbkdyb3VuZChkYXRhLCBncm91bmRJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdncm91bmQvJyArIGdyb3VuZElkICsgJy9kZXZpY2VzJztcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldChpZCkge1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldChhcGlVcmwgKyAnZGV2aWNlLycgKyBpZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEZyb21Hcm91bmQoZ3JvdW5kSWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ3JvdW5kLycgKyBncm91bmRJZCArICcvZGV2aWNlcyc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZG9EZXZpY2VBY3Rpb24oYWN0aW9uTmFtZSwgZGV2aWNlSWQpIHtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoYXBpVXJsICsgJ2RldmljZS8nICsgZGV2aWNlSWQgKyAnLycgKyBhY3Rpb25OYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlZnJlc2goaWQpIHtcbiAgICAgICAgICAgIHJldHVybiBkb0RldmljZUFjdGlvbigncmVmcmVzaCcsIGlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGVuYWJsZShpZCkge1xuICAgICAgICAgICAgcmV0dXJuIGRvRGV2aWNlQWN0aW9uKCdlbmFibGUnLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkaXNhYmxlKGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9EZXZpY2VBY3Rpb24oJ2Rpc2FibGUnLCBpZCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZWxldGVEZXZpY2UoaWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZGV2aWNlLycgKyBpZDtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURldmljZUNvbnRyb2woaWQsIGNvbnRyb2wpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7fTtcblxuICAgICAgICAgICAgaWYgKGNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmNvbnRyb2wgPSBjb250cm9sO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KGFwaVVybCArICdkZXZpY2UvJyArIGlkICsgJy9jb250cm9sJywgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVEZXZpY2UoaWQsIGRhdGEpIHtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dChhcGlVcmwgKyAnZGV2aWNlLycgKyBpZCwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhZG9wdChkZXZpY2VJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdkZXZpY2UvJyArIGRldmljZUlkICsgJy9hZG9wdCc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxVc2luZ1Rva2VuKGJ5TmFtZSwgdG9rZW4pIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdkZXZpY2U/aW5jbHVkZUFzc2V0cz10cnVlJztcblxuICAgICAgICAgICAgaWYgKGJ5TmFtZSkge1xuICAgICAgICAgICAgICAgIHVybCArPSAnJm5hbWU9JyArIGJ5TmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGdldENvbmZpZ0ZvclRpY2tldCh0b2tlbik7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsLCBjb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNpbmdUb2tlbihkZXZpY2VDb25maWcsIHRva2VuKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZSc7XG5cbiAgICAgICAgICAgIHZhciBjb25maWcgPSBnZXRDb25maWdGb3JUaWNrZXQodG9rZW4pO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGRldmljZUNvbmZpZywgY29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVzaW5nVG9rZW4oZGV2aWNlQ29uZmlnLCB0b2tlbikge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlQ29uZmlnLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBkYXRhLm5hbWUgPSBkZXZpY2VDb25maWcubmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZUNvbmZpZy5kZXNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24gPSBkZXZpY2VDb25maWcuZGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VDb25maWcuYWN0aXZpdHlFbmFibGVkICE9PSB1bmRlZmluZWQgJiYgZGV2aWNlQ29uZmlnLmFjdGl2aXR5RW5hYmxlZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGRhdGEuYWN0aXZpdHlFbmFibGVkID0gZGV2aWNlQ29uZmlnLmFjdGl2aXR5RW5hYmxlZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZUNvbmZpZy5hc3NldHMpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmFzc2V0cyA9IGRldmljZUNvbmZpZy5hc3NldHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2VDb25maWcudGl0bGUpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnRpdGxlID0gZGV2aWNlQ29uZmlnLnRpdGxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY29uZmlnID0gZ2V0Q29uZmlnKHRva2VuKTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dChhcGlVcmwgKyAnZGV2aWNlLycgKyBkZXZpY2VDb25maWcuaWQsIGRhdGEsIGNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRTZWxmVXNpbmdUaWNrZXQodGlja2V0KSB7XG5cbiAgICAgICAgICAgIHZhciBjb25maWcgPSBnZXRDb25maWdGb3JUaWNrZXQodGlja2V0KTtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdzZWxmJztcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwsIGNvbmZpZyk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbmZpZ0ZvclRpY2tldCh0aWNrZXQpIHtcblxuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRpY2tldCkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnVGlja2V0IHswfScuZm9ybWF0KHRpY2tldCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbmZpZyh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgezB9Jy5mb3JtYXQodG9rZW4pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2FwaS5HYXRld2F5U2VydmljZScsIEdhdGV3YXlTZXJ2aWNlKTtcblxuICAgIEdhdGV3YXlTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJ2FwaS51cmwnLCAnZXhjZXB0aW9uJ107XG5cbiAgICBmdW5jdGlvbiBHYXRld2F5U2VydmljZSgkaHR0cCwgYXBpVXJsLCBleGNlcHRpb24pIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG5cbiAgICAgICAgICAgIGxpc3RHYXRld2F5czogbGlzdEdhdGV3YXlzLFxuICAgICAgICAgICAgZ2V0RnJvbUdyb3VuZDogZ2V0RnJvbUdyb3VuZCxcbiAgICAgICAgICAgIGdldEdhdGV3YXk6IGdldEdhdGV3YXksXG4gICAgICAgICAgICBjbGFpbUdhdGV3YXk6IGNsYWltR2F0ZXdheSxcbiAgICAgICAgICAgIGVucm9sbEdhdGV3YXk6IGVucm9sbEdhdGV3YXksXG4gICAgICAgICAgICB1cGRhdGVHYXRld2F5OiB1cGRhdGVHYXRld2F5LFxuICAgICAgICAgICAgZGVsZXRlR2F0ZXdheTogZGVsZXRlR2F0ZXdheVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUdhdGV3YXkoZ2F0ZXdheUlkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2dhdGV3YXkvJyArIGdhdGV3YXlJZDtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsaXN0R2F0ZXdheXMoKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2dhdGV3YXknO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCwge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBnZXRIZWFkZXJzKClcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RnJvbUdyb3VuZChncm91bmRJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdncm91bmQvJyArIGdyb3VuZElkICsgJy9nYXRld2F5cyc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R2F0ZXdheShpZCwgaW5jbHVkZURldmljZXMsIGluY2x1ZGVBc3NldHMpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ2F0ZXdheS8nICsgaWQ7XG5cbiAgICAgICAgICAgIGlmIChpbmNsdWRlRGV2aWNlcyAmJiBpbmNsdWRlQXNzZXRzKSB7XG4gICAgICAgICAgICAgICAgdXJsICs9ICc/aW5jbHVkZURldmljZXM9dHJ1ZSZpbmNsdWRlQXNzZXRzPXRydWUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmNsdWRlRGV2aWNlcykge1xuICAgICAgICAgICAgICAgIHVybCArPSAnP2luY2x1ZGVEZXZpY2VzPXRydWUnO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmNsdWRlQXNzZXRzKSB7XG4gICAgICAgICAgICAgICAgdXJsICs9ICc/aW5jbHVkZUFzc2V0cz10cnVlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwsIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogZ2V0SGVhZGVycygpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xhaW1HYXRld2F5KGdyb3VuZElkLCBjbGFpbUNvZGUpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ3JvdW5kLycgKyBncm91bmRJZCArICcvY2xhaW0nO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBjbGFpbUNvZGU6IGNsYWltQ29kZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBKU09OLnN0cmluZ2lmeShkYXRhKSwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IGdldEhlYWRlcnMoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBlbnJvbGxHYXRld2F5KHVpZCwgaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBrZXkpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ2F0ZXdheS8nO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHt9O1xuXG4gICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmlkID0gaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgZGF0YS5rZXkgPSBrZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiBnZXRIZWFkZXJzKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlR2F0ZXdheShpZCwgbmFtZSwgZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZ2F0ZXdheS8nICsgaWQ7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgSlNPTi5zdHJpbmdpZnkoZGF0YSksIHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogZ2V0SGVhZGVycygpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlcnMoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2dyb3VuZHNTZXJ2aWNlJywgZmFjdG9yeSk7XG5cbiAgICBmYWN0b3J5LiRpbmplY3QgPSBbJyRodHRwJywgJ2FwcC5jb25maWcnXTtcblxuICAgIGZ1bmN0aW9uIGZhY3RvcnkoJGh0dHAsIGFwcENvbmZpZykge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgICAgICBmaW5kQWxsOiBmaW5kQWxsLFxuICAgICAgICAgICAgZmluZEFsbFB1YmxpYzogZmluZEFsbFB1YmxpYyxcbiAgICAgICAgICAgIGZpbmRBbGxTaGFyZWQ6IGZpbmRBbGxTaGFyZWQsXG4gICAgICAgICAgICBkZWxldGU6IGRlbGV0ZUdyb3VuZCxcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGwoKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcHBDb25maWcuYXBpLnVybCArICdtZS9ncm91bmRzJztcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmluZEFsbFB1YmxpYygpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwcENvbmZpZy5hcGkudXJsICsgJ2dyb3VuZHMnO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsU2hhcmVkKCkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBwQ29uZmlnLmFwaS51cmwgKyAnbWUvZ3JvdW5kcz90eXBlPXNoYXJlZCc7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmQoaWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcHBDb25maWcuYXBpLnVybCArICdncm91bmQvJyArIGlkO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlR3JvdW5kKGlkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBwQ29uZmlnLmFwaS51cmwgKyAnZ3JvdW5kLycgKyBpZDtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShuYW1lLCB2aXNpYmlsaXR5KSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBwQ29uZmlnLmFwaS51cmwgKyAnbWUvZ3JvdW5kcyc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwge1xuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgdGl0bGU6IG5hbWUsXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJpbGl0eVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoaWQsIGRhdGEpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcHBDb25maWcuYXBpLnVybCArICdncm91bmQvJyArIGlkO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdtZW1iZXJzU2VydmljZScsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gWyckaHR0cCcsICdhcHAuY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCRodHRwLCBhcHBDb25maWcpIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBmaW5kQWxsOiBmaW5kQWxsLFxuICAgICAgICAgICAgYWRkTWVtYmVyOiBhZGRNZW1iZXIsXG4gICAgICAgICAgICBkZWxldGVNZW1iZXI6IGRlbGV0ZU1lbWJlclxuXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsKGdyb3VuZElkKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcHBDb25maWcuYXBpLnVybCArICdncm91bmQvJyArIGdyb3VuZElkICsgJy9tZW1iZXJzJztcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkTWVtYmVyKGdyb3VuZElkLCBtZW1iZXJFbWFpbCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwcENvbmZpZy5hcGkudXJsICsgJ2dyb3VuZC8nICsgZ3JvdW5kSWQgKyAnL21lbWJlcnMnO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgZW1haWw6IG1lbWJlckVtYWlsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBkYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlTWVtYmVyKGdyb3VuZElkLCBtZW1iZXJJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwcENvbmZpZy5hcGkudXJsICsgJ2dyb3VuZC8nICsgZ3JvdW5kSWQgKyAnL21lbWJlci8nICsgbWVtYmVySWQ7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2FwaS5tZXRyaWNzU2VydmljZScsIE1ldHJpY3NTZXJ2aWNlKTtcblxuICAgIE1ldHJpY3NTZXJ2aWNlLiRpbmplY3QgPSBbXG4gICAgICAgICckaHR0cCcsXG4gICAgICAgICdhcGkudXJsJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBNZXRyaWNzU2VydmljZSgkaHR0cCwgYXBpVXJsKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBnZXRQZXJmb3JtYW5jZTogZ2V0UGVyZm9ybWFuY2VcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQZXJmb3JtYW5jZSgpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnbWV0cmljcy9wZXJmb3JtYW5jZS9jdXJyZW50JztcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKTtcbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnbm90aWZpY2F0aW9uU2VydmljZScsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gWyckaHR0cCcsICdhcHAuY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCRodHRwLCBhcHBDb25maWcpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgICAgICBtYXJrQXNSZWFkOiBtYXJrQXNSZWFkLFxuICAgICAgICAgICAgbWFya0FsbEFzUmVhZDogbWFya0FsbEFzUmVhZFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZmluZChjb3VudCwgcGFnZSkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBwQ29uZmlnLmFwaS51cmwgKyAnbWUvbm90aWZpY2F0aW9ucyc7XG5cbiAgICAgICAgICAgIHVybCA9IHVybCArIGdldFF1ZXJ5KGNvdW50LCBwYWdlKTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRRdWVyeShjb3VudCwgcGFnZSkge1xuICAgICAgICAgICAgaWYgKCFwYWdlICYmICFjb3VudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gJz8nO1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgICAgICAgIGlmIChwYWdlKSB7XG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCgncGFnZT0nICsgcGFnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjb3VudCkge1xuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goJ2NvdW50PScgKyBjb3VudCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkgKyBpdGVtcy5qb2luKCcmJyk7XG5cbiAgICAgICAgICAgIHJldHVybiBxdWVyeTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG1hcmtBc1JlYWQodGltZXN0YW1wKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcHBDb25maWcuYXBpLnVybCArICdtZS9ub3RpZmljYXRpb25zJztcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBhdGNoKHVybCwge1xuICAgICAgICAgICAgICAgIGF0OiB0aW1lc3RhbXBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbWFya0FsbEFzUmVhZCgpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwcENvbmZpZy5hcGkudXJsICsgJ21lL25vdGlmaWNhdGlvbnMnO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBhdGNoKHVybCwge30pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdhcGkucnVsZXNTZXJ2aWNlJywgUnVsZXNTZXJ2aWNlKTtcblxuICAgIFJ1bGVzU2VydmljZS4kaW5qZWN0ID0gW1xuICAgICAgICAnJGh0dHAnLFxuICAgICAgICAnYXBpLnVybCdcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gUnVsZXNTZXJ2aWNlKCRodHRwLCBhcGlVcmwpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGdldEFsbDogZ2V0QWxsLFxuICAgICAgICAgICAgZ2V0OiBnZXQsXG4gICAgICAgICAgICBnZXRIaXN0b3J5OiBnZXRIaXN0b3J5LFxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgICAgICAgIGRlbGV0ZTogZGVsZXRlUnVsZSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IGVuYWJsZWQsXG4gICAgICAgICAgICBoYXNJc3N1ZTogaGFzSXNzdWUsXG4gICAgICAgICAgICBnZXREZXZpY2VSdWxlc0NvdW50OiBnZXREZXZpY2VSdWxlc0NvdW50LFxuICAgICAgICAgICAgZ2V0RGV2aWNlUnVsZXM6IGdldERldmljZVJ1bGVzLFxuICAgICAgICAgICAgc3Vic2NyaWJlT25SdWxlTm90aWZpY2F0aW9uczogc3Vic2NyaWJlLFxuICAgICAgICAgICAgdW5zdWJzY3JpYmVGcm9tUnVsZU5vdGlmaWNhdGlvbnM6IHVuc3Vic2NyaWJlXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbCgpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdydWxlcyc7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXQocnVsZUlkKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAncnVsZXMvJyArIHJ1bGVJZDtcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEhpc3RvcnkocnVsZUlkKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSAnezB9cnVsZXMvezF9L2hpc3RvcnknLmZvcm1hdChhcGlVcmwsIHJ1bGVJZCk7XG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUobmFtZSwgZGVzY3JpcHRpb24sIGRlZmluaXRpb24pIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdydWxlcyc7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBOYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBEZWZpbml0aW9uOiBkZWZpbml0aW9uXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGlkLCBuYW1lLCBkZXNjcmlwdGlvbiwgZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdydWxlcy8nICsgaWQ7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XG5cbiAgICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5OYW1lID0gbmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5EZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgICAgIGRhdGEuRGVmaW5pdGlvbiA9IGRlZmluaXRpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZVJ1bGUoaWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAncnVsZXMvJyArIGlkO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBlbmFibGVkKGlkLCB2YWx1ZSkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdydWxlcy9lbmFibGVkLycgKyBpZCArICc/dmFsdWU9JyArIHZhbHVlO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaGFzSXNzdWUocnVsZSkge1xuXG4gICAgICAgICAgICAvL3VuZGVmaW5lZCwgY29tcGxpYXRpb24gZXJyb3IsIG1pc3NpbmcgYXNzZXRzXG4gICAgICAgICAgICBpZiAocnVsZS5zdGF0dXMgPT09IDAgfHwgcnVsZS5zdGF0dXMgPT09IDMgfHwgcnVsZS5zdGF0dXMgPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGV2aWNlUnVsZXMoZGV2aWNlSUQsIHBhZ2VTaXplLCBwYWdlKSB7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnZGV2aWNlLycgKyBkZXZpY2VJRCArICcvcnVsZXMnO1xuXG4gICAgICAgICAgICB1cmwgPSB1cmwgKyBnZXRRdWVyeShwYWdlU2l6ZSwgcGFnZSk7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGV2aWNlUnVsZXNDb3VudChkZXZpY2VJRCkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZS8nICsgZGV2aWNlSUQgKyAnL3J1bGVzL21ldGEnO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmUocnVsZUlkKSB7XG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ2RldmljZS9ub3RpZmljYXRpb25zLycgKyBydWxlSWQgKyAnL3N1YnNjcmlwdGlvbic7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVuc3Vic2NyaWJlKHJ1bGVJZCkge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdkZXZpY2Uvbm90aWZpY2F0aW9ucy8nICsgcnVsZUlkICsgJy9zdWJzY3JpcHRpb24nO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRRdWVyeShjb3VudCwgcGFnZSkge1xuICAgICAgICAgICAgaWYgKCFwYWdlICYmICFjb3VudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gJz8nO1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gW107XG5cbiAgICAgICAgICAgIGlmIChjb3VudCkge1xuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goJ3BlclBhZ2U9JyArIGNvdW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhZ2UpIHtcbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKCdwYWdlPScgKyBwYWdlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcXVlcnkgPSBxdWVyeSArIGl0ZW1zLmpvaW4oJyYnKTtcblxuICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5O1xuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2FwaS5zZXJ2aWNlc1NlcnZpY2UnLCBzZXJ2aWNlc1NlcnZpY2UpO1xuXG4gICAgc2VydmljZXNTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJ3Nlc3Npb24nLCAnYXBpLnVybCcsICckcSddO1xuXG4gICAgZnVuY3Rpb24gc2VydmljZXNTZXJ2aWNlKCRodHRwLCBzZXNzaW9uLCBhcGlVcmwsICRxKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBnZXRBbGw6IGdldEFsbCxcbiAgICAgICAgICAgIGdldDogZ2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbCgpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAnc2VydmljZXMnO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0KHNlcnZpY2VBbGlhcykge1xuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdzZXJ2aWNlcy8nICsgc2VydmljZUFsaWFzO1xuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8vLy8vLy8vRmFrZXMgdW50aWwgdGhlIEFQSSBpcyBhdmFpbGFibGVcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsRmFrZSgpIHtcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IFt7XG4gICAgICAgICAgICAgICAgICAgIFwiaWRcIjogXCI1NDk3ZWFjZmQxNTEwMDA5ZWNlODM2OWJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiRW1haWwgTWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiZW1haWxNZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImlzXCI6IFwiYWN0dWF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgXCJpY29uS2V5XCI6IFwiZmEtZW52ZWxvcGVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIlZpZXcgdGhlIGRldGFpbHMgb2YgeW91ciBub3RpZnktbWUgZW1haWwgc2VydmljZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRldGFpbHNQYWdlXCI6IFwic2VydmljZXMvZW1haWxtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcInByb2ZpbGVcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvXCI6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdWJqZWN0XCI6IFwic3RyaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJib2R5XCI6IFwic3RyaW5nXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRGYWtlKHNlcnZpY2VBbGlhcykge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBcImlkXCI6IFwiZGVtb1wiLFxuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJlbWFpbCBtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImlzXCI6IFwiYWN0dWF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWRPblwiOiBcIjAwMDEtMDEtMDFUMDA6MDA6MDBcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkQnlcIjogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgXCJ1cGRhdGVkT25cIjogXCIwMDAxLTAxLTAxVDAwOjAwOjAwXCIsXG4gICAgICAgICAgICAgICAgICAgIFwidXBkYXRlZEJ5XCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIFwicHJvZmlsZVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidG9cIjogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN1YmplY3RcIjogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJvZHlcIjogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICB9XG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2FwaS51cmwnLCAnaHR0cHM6Ly9hcGlkZXYuc21hcnRsaXZpbmcuaW8vJyk7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdhcGkuY2xpZW50SWQnLCAnbWFrZXJfbG9jYWwnKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2Jyb2tlci51cmwnLCAnaHR0cHM6Ly9icm9rZXJkZXYuc21hcnRsaXZpbmcuaW8nKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2Jyb2tlci5wb3J0JywgMTU2NzEpO1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnYnJva2VyLnNvdXJjZVJvb3QnLCAnL2V4Y2hhbmdlL3Jvb3QvJyk7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCd3aWRnZXQuaG9zdFVybCcsICdodHRwOi8vd2lkZ2V0LnNtYXJ0bGl2aW5nLmlvJyk7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdvcmlnaW4nLCAnaHR0cHM6Ly9mZWF0dXJlLWNyZWF0ZS1raXQtZGV2aWNlLmZpcmViYXNlYXBwLmNvbScpO1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgncHVibGljLnRva2VuJywgJzBMTEh0ajN5dGFZSWcyWHlBQi01Tmp5VFkxZWRaVkwxdGQzbDJTSng3d0t3RUcnKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ3B1YmxpYy5jbGllbnRJZCcsICdndWVzdF91c2VyJyk7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdwdWJsaWMuY2xpZW50S2V5JywgJ2d1ZXN0X3VzZXInKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ3B1YmxpYy51cmxTaG9ydGVuZXJBcGlLZXknLCAnQUl6YVN5RExxZ0lDQWJucTc1U0pGNU5mcE5xenBqd1BYUW83WWdBJyk7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdwdWJsaWMudXJsU2hvcnRlbmVyQXBpVXJsJywgJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3VybHNob3J0ZW5lci92MS91cmwnKTtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ3Rlcm1zT2ZVc2VDRE5VcmwnLCAnaHR0cHM6Ly81OWFjOTdmNmNhNjU1NjliYjJkOWE4Mjg4ODI4MGZmMzgxNGE0Mjc0Lmdvb2dsZWRyaXZlLmNvbS9ob3N0LzBCNno4WFpVTHRWN3hSR3B5Tmt0ck0zaERXbmMvVGVybXNfb2ZfVXNlL3RvdS10ZXh0Lmh0bWwnKTtcbn0oKSk7XG5cblxuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgndXJsU2hvcnRlbmVyU2VydmljZScsIHVybFNob3J0ZW5lclNlcnZpY2UpO1xuXG4gICAgdXJsU2hvcnRlbmVyU2VydmljZS4kaW5qZWN0ID0gW1xuICAgICAgICAnJGh0dHAnLFxuICAgICAgICAncHVibGljLnVybFNob3J0ZW5lckFwaUtleScsXG4gICAgICAgICdwdWJsaWMudXJsU2hvcnRlbmVyQXBpVXJsJyxcbiAgICAgICAgJ2V4Y2VwdGlvbidcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gdXJsU2hvcnRlbmVyU2VydmljZSgkaHR0cCwgc2hvcnRlbmVyQXBpS2V5LCB1cmxTaG9ydGVuZXJBcGlVcmwsIGV4Y2VwdGlvbikge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgc2hvcnRlblVybDogc2hvcnRlblVybFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBzaG9ydGVuVXJsKHVybCkge1xuXG4gICAgICAgICAgICB2YXIgYm9keSA9IHtcbiAgICAgICAgICAgICAgICBsb25nVXJsOiB1cmxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybFNob3J0ZW5lckFwaVVybCArICc/a2V5PScgKyBzaG9ydGVuZXJBcGlLZXksIGJvZHkpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEuaWQ7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gZ2VuZXJhdGluZyBzaG9ydCB1cmwnKSk7XG4gICAgICAgIH1cblxuICAgIH1cblxufSgpKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2FwaS51c2Vyc1NlcnZpY2UnLCBVc2VyU2VydmljZSk7XG5cbiAgICBVc2VyU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICdhcGkudXJsJywgJ2V4Y2VwdGlvbicsICckcSddO1xuXG4gICAgZnVuY3Rpb24gVXNlclNlcnZpY2UoJGh0dHAsIGFwaVVybCwgZXhjZXB0aW9uLCAkcSkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZ2V0QWxsOiBnZXRBbGwsXG4gICAgICAgICAgICBkZWxldGVVc2VyOiBkZWxldGVVc2VyLFxuICAgICAgICAgICAgZ2V0TWU6IGdldE1lLFxuICAgICAgICAgICAgZ2V0Q2xpZW50czogZ2V0Q2xpZW50cyxcbiAgICAgICAgICAgIGdvZENyZWF0ZXNVc2VyOiBnb2RDcmVhdGVzVXNlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsKCkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ3VzZXJzJztcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGdldCBhbGwgdXNlcnMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlVXNlcihpZCkge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ3VzZXIvJyArIGlkO1xuXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gZGVsZXRlIHVzZXIuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRNZSgpIHtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGFwaVVybCArICdtZSc7XG5cbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsLCB7XG4gICAgICAgICAgICAgICAgICAgIF9faW5nb3JlVGVybXNPZlVzZUFjY2VwdGFuY2U6IHRydWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB3aGlsZSBnZXR0aW5nIHlvdXIgZGF0YS4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRDbGllbnRzKHRva2VuKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBhcGlVcmwgKyAndXNlci9jbGllbnRzJztcbiAgICAgICAgICAgIHZhciBjb25maWcgPSBnZXRDb25maWcodG9rZW4pO1xuXG4gICAgICAgICAgICAkaHR0cC5nZXQodXJsLCBjb25maWcpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoJ1Rva2VuIGlzIGludmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29kQ3JlYXRlc1VzZXIodXNlcikge1xuXG4gICAgICAgICAgICB2YXIgdXJsID0gYXBpVXJsICsgJ3VzZXJzJztcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHVzZXIucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogdXNlci5vcmdhbmlzYXRpb24sXG4gICAgICAgICAgICAgICAgbmFtZTogdXNlci5mdWxsTmFtZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBkYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGNyZWF0ZSBuZXcgdXNlci4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRDb25maWcodG9rZW4pIHtcblxuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgICAgICAgICBfX2Rvbm90cmVmcmVzaHRva2VuOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcblxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyIHswfScuZm9ybWF0KHRva2VuKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9XG4gICAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnYXNzZXQucmVwb3NpdG9yeScsIGFzc2V0c1JlcG9zaXRvcnkpO1xuXG4gICAgYXNzZXRzUmVwb3NpdG9yeS4kaW5qZWN0ID0gWydhcGkuYXNzZXRzU2VydmljZScsICdleGNlcHRpb24nLCAnYXNzZXRNb2RlbCddO1xuXG4gICAgZnVuY3Rpb24gYXNzZXRzUmVwb3NpdG9yeShhc3NldHNTZXJ2aWNlLCBleGNlcHRpb24sIEFzc2V0TW9kZWwpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcbiAgICAgICAgICAgIGNyZWF0ZVVzaW5nVG9rZW46IGNyZWF0ZVVzaW5nVG9rZW4sXG4gICAgICAgICAgICBjcmVhdGVVc2luZ1RpY2tldDogY3JlYXRlVXNpbmdUaWNrZXQsXG4gICAgICAgICAgICByZXBsYWNlQ29udHJvbDogcmVwbGFjZUNvbnRyb2wsXG4gICAgICAgICAgICByZXBsYWNlUHJvZmlsZTogcmVwbGFjZVByb2ZpbGUsXG4gICAgICAgICAgICBwdWJsaXNoQ29tbWFuZDogcHVibGlzaENvbW1hbmQsXG4gICAgICAgICAgICBwdWJsaXNoU3RhdGU6IHB1Ymxpc2hTdGF0ZSxcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBmaW5kKGFzc2V0SWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UuZ2V0QXNzZXQoYXNzZXRJZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBuZXcgQXNzZXRNb2RlbChyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWwuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShkZXZpY2VJZCwgbmFtZSwgdGl0bGUsIHR5cGUsIHByb2ZpbGUsIGNvbnRyb2wpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UuY3JlYXRlQXNzZXQoZGV2aWNlSWQsIG5hbWUsIHRpdGxlLCB0eXBlLCBwcm9maWxlLCBjb250cm9sKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBBc3NldE1vZGVsKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBjcmVhdGluZyBuZXcgYXNzZXQuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNpbmdUb2tlbihkZXZpY2VJZCwgYXNzZXQsIHRva2VuKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBhc3NldHNTZXJ2aWNlLmNyZWF0ZUFzc2V0VXNpbmdUb2tlbihkZXZpY2VJZCwgYXNzZXQsIHRva2VuKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBBc3NldE1vZGVsKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBjcmVhdGluZyBuZXcgYXNzZXQuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2luZ1RpY2tldCh0aWNrZXQsIGRhdGEpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UuY3JlYXRlQXNzZXRVc2luZ1RpY2tldCh0aWNrZXQsIGRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4gKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gbmV3IEFzc2V0TW9kZWwocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWw7XG5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3IgY3JlYXRpbmcgbmV3IGFzc2V0LicpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVwbGFjZUNvbnRyb2woZGV2aWNlSWQsIGFzc2V0TmFtZSwgdmFsdWUpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UucmVwbGFjZUNvbnRyb2woZGV2aWNlSWQsIGFzc2V0TmFtZSwgdmFsdWUpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIHJlcGxhY2luZyBjb250cm9sIGFzc2V0LicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlcGxhY2VQcm9maWxlKGRldmljZUlkLCBhc3NldE5hbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBhc3NldHNTZXJ2aWNlLnJlcGxhY2VQcm9maWxlKGRldmljZUlkLCBhc3NldE5hbWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciByZXBsYWNpbmcgYXNzZXQgcHJvZmlsZS4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwdWJsaXNoQ29tbWFuZChpZCwgdmFsdWUpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UucHVibGlzaENvbW1hbmQoaWQsIHZhbHVlKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBwdWJsaXNoaW5nIGNvbW1hbmQuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcHVibGlzaFN0YXRlKGlkLCB2YWx1ZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gYXNzZXRzU2VydmljZS5wdWJsaXNoU3RhdGUoaWQsIHZhbHVlKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBwdWJsaXNoaW5nIHN0YXRlLicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShkZXZpY2VJZCwgYXNzZXROYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gYXNzZXRzU2VydmljZS5kZWxldGVBc3NldChkZXZpY2VJZCwgYXNzZXROYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZShkZXZpY2VJZCwgYXNzZXRJZCwgYXNzZXROYW1lLCBhc3NldElzLCB0aXRsZSkge1xuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UudXBkYXRlQXNzZXQoZGV2aWNlSWQsIGFzc2V0SWQsIGFzc2V0TmFtZSwgYXNzZXRJcywgdGl0bGUpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gbmV3IEFzc2V0TW9kZWwocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIiAoZnVuY3Rpb24obmcpIHtcbiAgICAgbmdcbiAgICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgICAuZmFjdG9yeSgnY2FwcC5saXZlJywgY2FwcExpdmUpO1xuXG4gICAgIC8vY2FwcExpdmUuJGluamVjdCA9IFsnJHdpbmRvdycsICckcm9vdFNjb3BlJywgJ3Nlc3Npb24nLCAnYnJva2VyLnVybCcsICdicm9rZXIucG9ydCcsICdicm9rZXIuc291cmNlUm9vdCcsICdwdWJsaWMuY2xpZW50SWQnLCAncHVibGljLmNsaWVudEtleScsICckcSddO1xuICAgICBjYXBwTGl2ZS4kaW5qZWN0ID0gWyckd2luZG93JywgJyRyb290U2NvcGUnLCAnc2Vzc2lvbicsICdhcHAuY29uZmlnJywgJyRxJ107XG5cbiAgICAgZnVuY3Rpb24gY2FwcExpdmUoJHdpbmRvdywgJHJvb3RTY29wZSwgc2Vzc2lvbiwgYXBwQ29uZmlnLCAkcSkge1xuXG4gICAgICAgICB2YXIgY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgICBpbml0OiBpbml0LFxuICAgICAgICAgICAgIGVudGl0eTogJHdpbmRvdy5DYXBwTGl2ZSxcbiAgICAgICAgICAgICBjb25uZWN0OiBjb25uZWN0LFxuICAgICAgICAgICAgIGRpc2Nvbm5lY3Q6IGRpc2Nvbm5lY3QsXG4gICAgICAgICAgICAgaXNDb25uZWN0ZWQ6IGlzQ29ubmVjdGVkLFxuICAgICAgICAgICAgIGFsbDogJHdpbmRvdy5DYXBwTGl2ZS5hbGwsXG4gICAgICAgICAgICAgc3Vic2NyaWJlOiAkd2luZG93LkNhcHBMaXZlLnN1YnNjcmliZVxuICAgICAgICAgfTtcblxuICAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuXG4gICAgICAgICAgICAgJHdpbmRvdy5DYXBwTGl2ZS5icm9rZXJVcmwgPSBhcHBDb25maWcuYnJva2VyLnVybDtcbiAgICAgICAgICAgICAkd2luZG93LkNhcHBMaXZlLmJyb2tlclBvcnQgPSBhcHBDb25maWcuYnJva2VyLnBvcnQ7XG4gICAgICAgICAgICAgJHdpbmRvdy5DYXBwTGl2ZS5zb3VyY2VSb290ID0gYXBwQ29uZmlnLmJyb2tlci5zb3VyY2VSb290O1xuXG4gICAgICAgICAgICAgaWYgKHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5pc0F1dGgpIHtcbiAgICAgICAgICAgICAgICAgc2F2ZShzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudElkLCBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCkucm1xLmNsaWVudEtleSk7XG4gICAgICAgICAgICAgICAgIGNvbm5lY3Qoc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRJZCwgc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRLZXkpO1xuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ2luJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgZGlzY29ubmVjdCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICBzYXZlKHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5ybXEuY2xpZW50SWQsIHNlc3Npb24uYXV0aGVudGljYXRpb24oKS5ybXEuY2xpZW50S2V5KTtcbiAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Qoc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRJZCwgc2Vzc2lvbi5hdXRoZW50aWNhdGlvbigpLnJtcS5jbGllbnRLZXkpO1xuICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCd1c2VyLmxvZ291dCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICB9KTtcbiAgICAgICAgIH1cblxuICAgICAgICAgZnVuY3Rpb24gY29ubmVjdChjbGllbnRJZCwgY2xpZW50S2V5KSB7XG5cbiAgICAgICAgICAgICB2YXIgZGVmZmVyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgdmFyIGRpc2Nvbm5lY3RQcm9taXNlID0gZGlzY29ubmVjdCgpO1xuXG4gICAgICAgICAgICAgZGlzY29ubmVjdFByb21pc2UudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgJHdpbmRvdy5DYXBwTGl2ZS5jb25uZWN0KGNsaWVudElkLCBjbGllbnRLZXksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgICAgICAgfVxuXG4gICAgICAgICBmdW5jdGlvbiBkaXNjb25uZWN0KCkge1xuICAgICAgICAgICAgIHZhciBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAkd2luZG93LkNhcHBMaXZlLmRpc2Nvbm5lY3QoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICAgICAgIH1cblxuICAgICAgICAgZnVuY3Rpb24gaXNDb25uZWN0ZWQoKSB7XG4gICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3RlZDtcbiAgICAgICAgIH1cblxuICAgICAgICAgZnVuY3Rpb24gc2F2ZShjbGllbnRJZCwgY2xpZW50S2V5KSB7XG5cbiAgICAgICAgICAgICAkd2luZG93LkNhcHBMaXZlLmNsaWVudElkID0gY2xpZW50SWQ7XG4gICAgICAgICAgICAgJHdpbmRvdy5DYXBwTGl2ZS5jbGllbnRLZXkgPSBjbGllbnRLZXk7XG4gICAgICAgICB9XG4gICAgIH1cblxuIH0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdjb250cm9scy5yZXBvc2l0b3J5JywgY29udHJvbHNSZXBvc2l0b3J5KTtcblxuICAgIGNvbnRyb2xzUmVwb3NpdG9yeS4kaW5qZWN0ID0gWyd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gY29udHJvbHNSZXBvc2l0b3J5KHV0aWxzKSB7XG5cbiAgICAgICAgdmFyIGRlZmF1bHREZXZpY2VDb250cm9sTmFtZSA9ICdiYXItY2hhcnQnO1xuXG4gICAgICAgIHZhciBkZXZpY2VDb250cm9scyA9IFt7XG4gICAgICAgICAgICBuYW1lOiAnYmFyLWNoYXJ0JyxcbiAgICAgICAgICAgIHRpdGxlOiAnQmFyIENoYXJ0JyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU2hvd3MgbnVtZXJpY2FsIGFzc2V0cyBhY3Rpdml0eSBpbiBiYXIgY2hhcnQuJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnbGluZS1jaGFydCcsXG4gICAgICAgICAgICB0aXRsZTogJ0xpbmUgQ2hhcnQnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdTaG93cyBudW1lcmljYWwgYXNzZXRzIGFjdGl2aXR5IGluIGxpbmUgY2hhcnQuJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiAnYXJlYS1yYW5nZS1jaGFydCcsXG4gICAgICAgICAgICB0aXRsZTogJ0FyZWEgR3JhcGggQ2hhcnQnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdTaG93cyBudW1lcmljYWwgYXNzZXRzIGFjdGl2aXR5IHdpdGggbWluaW11bSBhbmQgbWF4aW11bSB2YWx1ZXMuJ1xuICAgICAgICB9XTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcblxuICAgICAgICAgICAgZmluZEFsbERldmljZUNvbnRyb2xzOiBmaW5kQWxsRGV2aWNlQ29udHJvbHMsXG4gICAgICAgICAgICBkZWZhdWx0RGV2aWNlQ29udHJvbE5hbWU6IGRlZmF1bHREZXZpY2VDb250cm9sTmFtZVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGxEZXZpY2VDb250cm9scygpIHtcblxuICAgICAgICAgICAgcmV0dXJuIHV0aWxzLiRxLndoZW4oZGV2aWNlQ29udHJvbHMpO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnZGV2aWNlLnJlcG9zaXRvcnknLCBkZXZpY2VzUmVwb3NpdG9yeSk7XG5cbiAgICBkZXZpY2VzUmVwb3NpdG9yeS4kaW5qZWN0ID0gWydhcGkuZGV2aWNlc1NlcnZpY2UnLCAnZXhjZXB0aW9uJywgJ2RldmljZU1vZGVsJywgJ3V0aWxzJywgJ2NvbnRyb2xzLnJlcG9zaXRvcnknXTtcblxuICAgIGZ1bmN0aW9uIGRldmljZXNSZXBvc2l0b3J5KGRldmljZXNTZXJ2aWNlLCBleGNlcHRpb24sIERldmljZU1vZGVsLCB1dGlscywgY29udHJvbHNSZXBvc2l0b3J5KSB7XG5cbiAgICAgICAgdmFyIF9kZWZhdWx0RGV2aWNlU2V0dGluZ3MgPSB7XG5cbiAgICAgICAgICAgIGNvbnRyb2w6IGNvbnRyb2xzUmVwb3NpdG9yeS5kZWZhdWx0RGV2aWNlQ29udHJvbE5hbWVcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgICAgICAgICBjcmVhdGVJbkdyb3VuZDogY3JlYXRlSW5Hcm91bmQsXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZUNvbnRyb2w6IHVwZGF0ZUNvbnRyb2wsXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcbiAgICAgICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgICAgICBmaW5kQWxsOiBmaW5kQWxsLFxuICAgICAgICAgICAgZmluZEFsbEluR3JvdW5kOiBmaW5kQWxsSW5Hcm91bmQsXG5cbiAgICAgICAgICAgIC8vdXNpbmcgdG9rZW5cbiAgICAgICAgICAgIGNyZWF0ZVVzaW5nVG9rZW46IGNyZWF0ZVVzaW5nVG9rZW4sXG4gICAgICAgICAgICB1cGRhdGVVc2luZ1Rva2VuOiB1cGRhdGVVc2luZ1Rva2VuLFxuICAgICAgICAgICAgZmluZEFsbFVzaW5nVG9rZW46IGZpbmRBbGxVc2luZ1Rva2VuLFxuICAgICAgICAgICAgZmluZFNlbGZVc2luZ1RpY2tldDogZmluZFNlbGZVc2luZ1RpY2tldCxcblxuICAgICAgICAgICAgc2F2ZURldmljZVNldHRpbmdzOiBzYXZlRGV2aWNlU2V0dGluZ3MsXG4gICAgICAgICAgICBnZXREZXZpY2VTZXR0aW5nczogZ2V0RGV2aWNlU2V0dGluZ3NcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUoZGF0YSkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UuY3JlYXRlKGRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoRGV2aWNlTW9kZWwpKVxuICAgICAgICAgICAgICAgIC50aGVuKHN1YnNjcmliZURldmljZSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIGNyZWF0aW5nIG5ldyBkZXZpY2UuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmVEZXZpY2UoZGV2aWNlKSB7XG5cbiAgICAgICAgICAgIGRldmljZS5zdWJzY3JpYmUodHJ1ZSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUluR3JvdW5kKGRhdGEsIGdyb3VuZElkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VzU2VydmljZS5jcmVhdGVJbkdyb3VuZChkYXRhLCBncm91bmRJZClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLnRoZW4oc3Vic2NyaWJlRGV2aWNlKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3IgY3JlYXRpbmcgbmV3IGRldmljZS4nKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZShkZXZpY2VJZCwgZGF0YSkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UudXBkYXRlRGV2aWNlKGRldmljZUlkLCBkYXRhKVxuICAgICAgICAgICAgICAgIC50aGVuKHV0aWxzLnRyYW5zZm9ybVJlc3BvbnNlKERldmljZU1vZGVsKSlcbiAgICAgICAgICAgICAgICAudGhlbihzdWJzY3JpYmVEZXZpY2UpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciB1cGRhdGluZyBkZXZpY2UuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVDb250cm9sKGlkLCBjb250cm9sKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VzU2VydmljZS51cGRhdGVEZXZpY2VDb250cm9sKGlkLCBjb250cm9sKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3IgdXBkYXRpbmcgZGV2aWNlIGNvbnRyb2wuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZXNTZXJ2aWNlLmRlbGV0ZURldmljZShpZClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIGRlbGV0aW5nIGRldmljZScpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNpbmdUb2tlbihkZXZpY2VDb25maWcsIHRva2VuKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VzU2VydmljZS5jcmVhdGVVc2luZ1Rva2VuKGRldmljZUNvbmZpZywgdG9rZW4pXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoRGV2aWNlTW9kZWwpKVxuICAgICAgICAgICAgICAgIC50aGVuKHN1YnNjcmliZURldmljZSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIGNyZWF0aW5nIG5ldyBkZXZpY2UuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVVc2luZ1Rva2VuKGRldmljZUNvbmZpZywgdG9rZW4pIHtcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZXNTZXJ2aWNlLnVwZGF0ZVVzaW5nVG9rZW4oZGV2aWNlQ29uZmlnLCB0b2tlbilcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLnRoZW4oc3Vic2NyaWJlRGV2aWNlKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3IgdXBkYXRpbmcgZGV2aWNlLicpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmluZChkZXZpY2VJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UuZ2V0KGRldmljZUlkKVxuICAgICAgICAgICAgICAgIC50aGVuKHV0aWxzLnRyYW5zZm9ybVJlc3BvbnNlKERldmljZU1vZGVsKSlcbiAgICAgICAgICAgICAgICAudGhlbihzdWJzY3JpYmVEZXZpY2UpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsKGJ5TmFtZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UuZ2V0QWxsKGJ5TmFtZSlcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBsb2FkaW5nIGRldmljZXMnKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGxJbkdyb3VuZChncm91bmRJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UuZ2V0RnJvbUdyb3VuZChncm91bmRJZClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBsb2FkaW5nIGRldmljZXMnKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGxVc2luZ1Rva2VuKGJ5TmFtZSwgdG9rZW4pIHtcblxuICAgICAgICAgICAgcmV0dXJuIGRldmljZXNTZXJ2aWNlLmdldEFsbFVzaW5nVG9rZW4oYnlOYW1lLCB0b2tlbilcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciBsb2FkaW5nIHB1YmxpYyBkZXZpY2VzJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzYXZlRGV2aWNlU2V0dGluZ3MoZGV2aWNlSWQsIHNldHRpbmdzKSB7XG5cbiAgICAgICAgICAgIHZhciBrZXkgPSBnZXREZXZpY2VTZXR0aW5nc0tleShkZXZpY2VJZCk7XG5cbiAgICAgICAgICAgIHZhciBleGlzdGluZ1NldHRpbmdzID0gdXRpbHMucHJlZmVyZW5jZXMucmVhZEdsb2JhbChrZXkpO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdTZXR0aW5ncykge1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZXhpc3RpbmdTZXR0aW5ncywgc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgZXhpc3RpbmdTZXR0aW5ncyA9IHNldHRpbmdzO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHV0aWxzLnByZWZlcmVuY2VzLnJlbWVtYmVyR2xvYmFsKGtleSwgZXhpc3RpbmdTZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIHJldHVybiB1dGlscy4kcS53aGVuKCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldERldmljZVNldHRpbmdzKGRldmljZUlkKSB7XG5cbiAgICAgICAgICAgIHZhciBrZXkgPSBnZXREZXZpY2VTZXR0aW5nc0tleShkZXZpY2VJZCk7XG5cbiAgICAgICAgICAgIHZhciBleGlzdGluZ1NldHRpbmdzID0gdXRpbHMucHJlZmVyZW5jZXMucmVhZEdsb2JhbChrZXkpO1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdTZXR0aW5ncykge1xuXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBhbmd1bGFyLmV4dGVuZCh7fSwgX2RlZmF1bHREZXZpY2VTZXR0aW5ncywgZXhpc3RpbmdTZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBfZGVmYXVsdERldmljZVNldHRpbmdzKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdXRpbHMuJHEud2hlbihzZXR0aW5ncyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kU2VsZlVzaW5nVGlja2V0KHRpY2tldCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZGV2aWNlc1NlcnZpY2UuZ2V0U2VsZlVzaW5nVGlja2V0KHRpY2tldClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShEZXZpY2VNb2RlbCkpXG4gICAgICAgICAgICAgICAgLnRoZW4oc3Vic2NyaWJlRGV2aWNlKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RGV2aWNlU2V0dGluZ3NLZXkoZGV2aWNlSWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuICdkZXZpY2Utc2V0dGluZ3MtezB9Jy5mb3JtYXQoZGV2aWNlSWQpO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdnYXRld2F5LnJlcG9zaXRvcnknLCBnYXRld2F5UmVwb3NpdG9yeSk7XG5cbiAgICBnYXRld2F5UmVwb3NpdG9yeS4kaW5qZWN0ID0gWydhcGkuR2F0ZXdheVNlcnZpY2UnLCAnZXhjZXB0aW9uJywgJ2dhdGV3YXlNb2RlbCcsICd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gZ2F0ZXdheVJlcG9zaXRvcnkoZ2F0ZXdheVNlcnZpY2UsIGV4Y2VwdGlvbiwgR2F0ZXdheU1vZGVsLCB1dGlscykge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZmluZDogZmluZCxcbiAgICAgICAgICAgIGZpbmRBbGw6IGZpbmRBbGwsXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxuICAgICAgICAgICAgZmluZEFsbEluR3JvdW5kOiBmaW5kQWxsSW5Hcm91bmQsXG4gICAgICAgICAgICBjbGFpbUdhdGV3YXk6IGNsYWltR2F0ZXdheVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmQoZ2F0ZXdheUlkLCBpbmNsdWRlRGV2aWNlcywgaW5jbHVkZUFzc2V0cykge1xuXG4gICAgICAgICAgICBpZiAoIWluY2x1ZGVEZXZpY2VzKSB7XG5cbiAgICAgICAgICAgICAgICBpbmNsdWRlRGV2aWNlcyA9IGZhbHNlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaW5jbHVkZUFzc2V0cykge1xuXG4gICAgICAgICAgICAgICAgaW5jbHVkZUFzc2V0cyA9IGZhbHNlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBnYXRld2F5U2VydmljZS5nZXRHYXRld2F5KGdhdGV3YXlJZCwgaW5jbHVkZURldmljZXMsIGluY2x1ZGVBc3NldHMpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoR2F0ZXdheU1vZGVsKSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbG9hZCBnYXRld2F5LicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGwoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBnYXRld2F5U2VydmljZS5saXN0R2F0ZXdheXMoKVxuICAgICAgICAgICAgICAgIC50aGVuKHV0aWxzLnRyYW5zZm9ybVJlc3BvbnNlKEdhdGV3YXlNb2RlbCkpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIGxvYWQgZ2F0ZXdheXMuJykpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsSW5Hcm91bmQoZ3JvdW5kSWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGdhdGV3YXlTZXJ2aWNlLmdldEZyb21Hcm91bmQoZ3JvdW5kSWQpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoR2F0ZXdheU1vZGVsKSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ1RoZXJlIHdhcyBhIHByb2JsZW0gdG8gbG9hZCBnYXRld2F5cy4nKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShnYXRld2F5SWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGdhdGV3YXlTZXJ2aWNlLmRlbGV0ZUdhdGV3YXkoZ2F0ZXdheUlkKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB0byByZW1vdmUgZ2F0ZXdheS4nKSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZShnYXRld2F5SWQsIG5hbWUsIGRlc2NyaXB0aW9uKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBnYXRld2F5U2VydmljZS51cGRhdGVHYXRld2F5KGdhdGV3YXlJZCwgbmFtZSwgZGVzY3JpcHRpb24pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdUaGVyZSB3YXMgYSBwcm9ibGVtIHRvIHVwZGF0ZSBnYXRld2F5LicpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xhaW1HYXRld2F5KGdyb3VuZElkLCBjbGFpbUNvZGUpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGdhdGV3YXlTZXJ2aWNlLmNsYWltR2F0ZXdheShncm91bmRJZCwgY2xhaW1Db2RlKVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignVGhlcmUgd2FzIGEgcHJvYmxlbSB0byBjbGFpbSBnYXRld2F5LicpKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2dyb3VuZC5yZXBvc2l0b3J5JywgZ3JvdW5kUmVwb3NpdG9yeSk7XG5cbiAgICBncm91bmRSZXBvc2l0b3J5LiRpbmplY3QgPSBbJ2dyb3VuZHNTZXJ2aWNlJywgJ2dyb3VuZE1vZGVsJywgJ2V4Y2VwdGlvbicsICd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gZ3JvdW5kUmVwb3NpdG9yeShncm91bmRzU2VydmljZSwgR3JvdW5kTW9kZWwsIGV4Y2VwdGlvbiwgdXRpbHMpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGZpbmQ6IGZpbmQsXG4gICAgICAgICAgICBmaW5kQWxsOiBmaW5kQWxsLFxuICAgICAgICAgICAgZmluZEFsbFB1YmxpYzogZmluZEFsbFB1YmxpYyxcbiAgICAgICAgICAgIGZpbmRBbGxTaGFyZWQ6IGZpbmRBbGxTaGFyZWQsXG4gICAgICAgICAgICBkZWxldGU6IGRlbGV0ZUdyb3VuZCxcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGVcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZmluZChpZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZ3JvdW5kc1NlcnZpY2UuZmluZChpZClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShHcm91bmRNb2RlbCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZmluZEFsbCgpIHtcblxuICAgICAgICAgICAgcmV0dXJuIGdyb3VuZHNTZXJ2aWNlLmZpbmRBbGwoKVxuICAgICAgICAgICAgICAgIC50aGVuKHV0aWxzLnRyYW5zZm9ybVJlc3BvbnNlKEdyb3VuZE1vZGVsKSlcbiAgICAgICAgICAgICAgICAvLyAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIHdoaWxlIGxvYWRpbmcgR3JvdW5kcy4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsUHVibGljKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gZ3JvdW5kc1NlcnZpY2UuZmluZEFsbFB1YmxpYygpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoR3JvdW5kTW9kZWwpKVxuICAgICAgICAgICAgICAgIC8vIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3Igd2hpbGUgbG9hZGluZyBHcm91bmRzLicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRBbGxTaGFyZWQoKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBncm91bmRzU2VydmljZS5maW5kQWxsU2hhcmVkKClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShHcm91bmRNb2RlbCkpXG4gICAgICAgICAgICAgICAgLy8gLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciB3aGlsZSBsb2FkaW5nIEdyb3VuZHMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlR3JvdW5kKGlkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBncm91bmRzU2VydmljZS5kZWxldGUoaWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGVtaXQoJ2dyb3VuZC5kZWxldGUnLCBpZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIHdoaWxlIGRlbGV0aW5nIGdyb3VuZC4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUobmFtZSwgdmlzaWJpbGl0eSkge1xuXG4gICAgICAgICAgICByZXR1cm4gZ3JvdW5kc1NlcnZpY2UuY3JlYXRlKG5hbWUsIHZpc2liaWxpdHkpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoR3JvdW5kTW9kZWwpKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGdyb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRlbWl0KCdncm91bmQuY3JlYXRlJywgZ3JvdW5kKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdyb3VuZDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3Igd2hpbGUgY3JlYXRpbmcgZ3JvdW5kLicpKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGlkLCBkYXRhKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBncm91bmRzU2VydmljZS51cGRhdGUoaWQsIGRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4odXRpbHMudHJhbnNmb3JtUmVzcG9uc2UoR3JvdW5kTW9kZWwpKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGdyb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRlbWl0KCdncm91bmQudXBkYXRlJywgZ3JvdW5kKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdyb3VuZDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChleGNlcHRpb24uY2F0Y2hlcignRXJyb3Igd2hpbGUgdXBkYXRpbmcgZ3JvdW5kLicpKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnaGlzdG9yeS5zZXJ2aWNlJywgaGlzdG9yeVNlcnZpY2UpO1xuXG4gICAgaGlzdG9yeVNlcnZpY2UuJGluamVjdCA9IFsnYXBpLmFzc2V0c1NlcnZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIGhpc3RvcnlTZXJ2aWNlKGFzc2V0c1NlcnZpY2UpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcblxuICAgICAgICAgICAgZ2V0QXNzZXRIaXN0b3J5OiBnZXRBc3NldEhpc3RvcnksXG5cbiAgICAgICAgICAgIHN1YnNjcmliZU9uQXNzZXRTdGF0ZUNoYW5nZTogc3Vic2NyaWJlT25Bc3NldFN0YXRlQ2hhbmdlXG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBnZXRBc3NldEhpc3RvcnkoYXNzZXRJZCwgZnJvbSwgdG8sIHJlc29sdXRpb24pIHtcblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0c1NlcnZpY2UuZ2V0QXNzZXRIaXN0b3J5KGFzc2V0SWQsIGZyb20sIHRvLCByZXNvbHV0aW9uKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlT25Bc3NldFN0YXRlQ2hhbmdlKGFzc2V0LCBzdGF0ZUNoYW5nZUhhbmRsZXIpIHtcblxuICAgICAgICAgICAgYXNzZXQub24oJ3N0YXRlJywgc3RhdGVDaGFuZ2VIYW5kbGVyKTtcblxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdtZW1iZXJzLnJlcG9zaXRvcnknLCBtZW1iZXJzUmVwb3NpdG9yeSk7XG5cbiAgICBtZW1iZXJzUmVwb3NpdG9yeS4kaW5qZWN0ID0gWydtZW1iZXJzU2VydmljZScsICdtZW1iZXJNb2RlbCcsICdleGNlcHRpb24nLCAndXRpbHMnXTtcblxuICAgIGZ1bmN0aW9uIG1lbWJlcnNSZXBvc2l0b3J5KG1lbWJlcnNTZXJ2aWNlLCBNZW1iZXJNb2RlbCwgZXhjZXB0aW9uLCB1dGlscykge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZmluZEFsbDogZmluZEFsbCxcbiAgICAgICAgICAgIGRlbGV0ZU1lbWJlcjogZGVsZXRlTWVtYmVyLFxuICAgICAgICAgICAgYWRkTWVtYmVyOiBhZGRNZW1iZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZmluZEFsbChncm91bmRJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbWVtYmVyc1NlcnZpY2UuZmluZEFsbChncm91bmRJZClcbiAgICAgICAgICAgICAgICAudGhlbih1dGlscy50cmFuc2Zvcm1SZXNwb25zZShNZW1iZXJNb2RlbCkpXG4gICAgICAgICAgICAgICAgLmNhdGNoKGV4Y2VwdGlvbi5jYXRjaGVyKCdFcnJvciB3aGlsZSBsb2FkaW5nIG1lbWJlcnMuJykpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlTWVtYmVyKGdyb3VuZElkLCBtZW1iZXJJZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbWVtYmVyc1NlcnZpY2UuZGVsZXRlTWVtYmVyKGdyb3VuZElkLCBtZW1iZXJJZClcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIGRlbGV0aW5nIG1lbWJlci4nKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhZGRNZW1iZXIoZ3JvdW5kSUQsIG1lbWJlckVtYWlsKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBtZW1iZXJzU2VydmljZS5hZGRNZW1iZXIoZ3JvdW5kSUQsIG1lbWJlckVtYWlsKVxuICAgICAgICAgICAgICAgIC50aGVuKHV0aWxzLnRyYW5zZm9ybVJlc3BvbnNlKE1lbWJlck1vZGVsKSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXhjZXB0aW9uLmNhdGNoZXIoJ0Vycm9yIG9jY3VyZWQgd2hpbGUgYWRkaW5nIG1lbWJlci4nKSk7XG5cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnZGVtby5nYW1lJywgR2FtZUZhY3RvcnkpO1xuXG4gICAgR2FtZUZhY3RvcnkuJGluamVjdCA9IFsnZGVtby5sZXZlbCcsICckdGltZW91dCddO1xuXG4gICAgZnVuY3Rpb24gR2FtZUZhY3RvcnkoTGV2ZWwsICR0aW1lb3V0KSB7XG5cbiAgICAgICAgdmFyIHN0YXJ0Q2FwdGlvbiA9ICcnO1xuICAgICAgICB2YXIgcHJlU3VzcGVuc2lvblN0YXR1cyA9ICdwbGF5aW5nJztcblxuICAgICAgICBmdW5jdGlvbiBHYW1lKCkge1xuICAgICAgICAgICAgdGhpcy5sZXZlbHMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuY2FwdGlvbiA9IHN0YXJ0Q2FwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gJ3R1dG9yaWFsJztcbiAgICAgICAgICAgIHRoaXMuZ2FtZVNjcmVlbiA9ICd1cCc7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbEluZGV4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuZmluaXNoVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbktleVRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5pc0xvY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5rZXkgPSAnJztcblxuICAgICAgICAgICAgdmFyIGwxID0gbmV3IExldmVsLlN0YXRlKHRoaXMsIHtcbiAgICAgICAgICAgICAgICBvcmRlcjogMSxcbiAgICAgICAgICAgICAgICBrZXk6ICdkb3duJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnUHV0IHlvdXIgcGhvbmUgb24gdGFibGUnLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRDYXB0aW9uOiAnTm9wZSwgaXRcXCdzIG5vdCBvbiB0aGUgdGFibGUgeWV0JyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzQ2FwdGlvbjogJ0Nvb2wsIHlvdXIgcGhvbmUgaXMgb24gdGFibGUhJyxcbiAgICAgICAgICAgICAgICBleHBlY3RlZEFzc2V0U3RhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3Bvc2l0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdvbnRhYmxlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbDIgPSBuZXcgTGV2ZWwuU3RhdGUodGhpcywge1xuICAgICAgICAgICAgICAgIG9yZGVyOiAyLFxuICAgICAgICAgICAgICAgIGtleTogJ2xlZnQnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdOb3csIHJvdGF0ZSB5b3VyIHBob25lIGxlZnQnLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRDYXB0aW9uOiAnQ21vbiwgcm90YXRlIGl0IGxlZnQnLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3NDYXB0aW9uOiAnR3JlYXQsIHlvdSByb3RhdGVkIGxlZnQhJyxcbiAgICAgICAgICAgICAgICBleHBlY3RlZEFzc2V0U3RhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3JvdGF0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdsZWZ0Um90YXRpb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBsMyA9IG5ldyBMZXZlbC5TdGF0ZSh0aGlzLCB7XG4gICAgICAgICAgICAgICAgb3JkZXI6IDMsXG4gICAgICAgICAgICAgICAga2V5OiAncmlnaHQnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdOb3csIHJvdGF0ZSB5b3VyIHBob25lIHJpZ2h0JyxcbiAgICAgICAgICAgICAgICB0aW1lb3V0Q2FwdGlvbjogJ0Ntb24sIHJvdGF0ZSBpdCByaWdodCcsXG4gICAgICAgICAgICAgICAgc3VjY2Vzc0NhcHRpb246ICdHcmVhdCwgeW91IHJvdGF0ZSBpdCByaWdodCEnLFxuICAgICAgICAgICAgICAgIGV4cGVjdGVkQXNzZXRTdGF0ZToge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAncm90YXRpb24nLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJ3JpZ2h0Um90YXRpb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBsNCA9IG5ldyBMZXZlbC5TdGF0ZSh0aGlzLCB7XG4gICAgICAgICAgICAgICAgb3JkZXI6IDQsXG4gICAgICAgICAgICAgICAga2V5OiAnc2hha2UnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdOb3csIHNoYWtlIGl0IGJhYnknLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRDYXB0aW9uOiAnRG9uXFwndCBiZSBzaHksIHNoYWtlIGl0IDopJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzQ2FwdGlvbjogJ09vbywgeWVlZXMsIGdyZWF0LicsXG4gICAgICAgICAgICAgICAgZXhwZWN0ZWRBc3NldFN0YXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdhbWlzaGFraW5nJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICdzaGFraW5nJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBkZWxheTogNDAwMCxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogMTUwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb246ICdHb2luZyB0byB0aGUgZnJlZSBsZXZlbC4uLicsXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6ICd0dXRvcmlhbC1lbmQnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGw1ID0gbmV3IExldmVsLkZyZWUodGhpcywge1xuICAgICAgICAgICAgICAgIG9yZGVyOiA1LFxuICAgICAgICAgICAgICAgIGtleTogJ2ZyZWUnLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdUcnkgbWFraW5nIHNvbWUgb2YgcHJldmlvdXMgbW92ZXMsIHdlXFwnbGwgZ3Vlc3Mgd2hpY2ggb25lIGl0IGlzJyxcbiAgICAgICAgICAgICAgICBoaWRlSW5OYXY6IHRydWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmxldmVscy5wdXNoKGwxLCBsMiwgbDMsIGw0LCBsNSk7XG4gICAgICAgIH1cblxuICAgICAgICBHYW1lLnByb3RvdHlwZS5hZGRMZXZlbCA9IGZ1bmN0aW9uKGxldmVsQ29uZmlnKSB7XG4gICAgICAgICAgICB0aGlzLmxldmVscy5wdXNoKHRoaXMsIGxldmVsQ29uZmlnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBHYW1lLnByb3RvdHlwZS5zZXRDYXB0aW9uID0gZnVuY3Rpb24oY2FwdGlvblRleHQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FwdGlvbiA9IGNhcHRpb25UZXh0O1xuICAgICAgICB9O1xuXG4gICAgICAgIEdhbWUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmdldEN1cnJlbnRMZXZlbCgpLmVudGVyKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0dXMgIT09ICdzdXNwZW5kZWQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSAndHV0b3JpYWwnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIEdhbWUucHJvdG90eXBlLnN1c3BlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyAhPT0gJ3N1c3BlbmRlZCcpIHtcbiAgICAgICAgICAgICAgICBwcmVTdXNwZW5zaW9uU3RhdHVzID0gdGhpcy5zdGF0dXM7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSAnc3VzcGVuZGVkJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBHYW1lLnByb3RvdHlwZS51bnN1c3BlbmQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gJ3N1c3BlbmRlZCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHByZVN1c3BlbnNpb25TdGF0dXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuZ2V0Q3VycmVudExldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sZXZlbHNbdGhpcy5jdXJyZW50TGV2ZWxJbmRleF07XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuaXNDdXJyZW50TGV2ZWwgPSBmdW5jdGlvbihsKSB7XG4gICAgICAgICAgICByZXR1cm4gbC5vcmRlciA9PT0gdGhpcy5nZXRDdXJyZW50TGV2ZWwoKS5vcmRlcjtcbiAgICAgICAgfTtcblxuICAgICAgICBHYW1lLnByb3RvdHlwZS5pc0NvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaXNDb21wbGV0ZSA9IHRydWU7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLmxldmVscywgZnVuY3Rpb24obCkge1xuICAgICAgICAgICAgICAgIGlmICghbC5pc0NvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGlzQ29tcGxldGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuc2V0R2FtZVNjcmVlbiA9IGZ1bmN0aW9uKGdhbWVTY3JlZW4pIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZVNjcmVlbiA9IGdhbWVTY3JlZW47XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKGFzc2V0TmFtZSwgYXNzZXRWYWx1ZSkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmICh0aGF0LmlzQ29tcGxldGUoKSB8fCB0aGF0LmlzTG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGF0LmdldEN1cnJlbnRMZXZlbCgpO1xuICAgICAgICAgICAgbGV2ZWwuc3RhdGVDaGFuZ2VkKGFzc2V0TmFtZSwgYXNzZXRWYWx1ZSk7XG5cbiAgICAgICAgICAgIGlmICghdGhhdC5pc0NvbXBsZXRlKCkgJiYgbGV2ZWwuaXNDb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIGlmICghbGV2ZWwudHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmN1cnJlbnRMZXZlbEluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2V0Q3VycmVudExldmVsKCkuZW50ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5rZXkgPSB0aGF0LmdldEN1cnJlbnRMZXZlbCgpLmtleTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmlzTG9ja2VkID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAvL2RlbGF5IHRyYW5zaXRpb24gdG8gdGhlIG5leHQgc3RlcFxuICAgICAgICAgICAgICAgICAgICB0aGF0LnRyYW5zaXRpb25UaW1lb3V0ID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5jdXJyZW50TGV2ZWxJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZ2V0Q3VycmVudExldmVsKCkuZW50ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmtleSA9IHRoYXQuZ2V0Q3VycmVudExldmVsKCkua2V5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaXNMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsLnRyYW5zaXRpb24uZGVsYXkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vZGVsYXkgY2hhbmdlIG9mIHRoZSB0ZXh0IGFuZCBzY3JlZW5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC50cmFuc2l0aW9uS2V5VGltZW91dCA9ICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuc2V0Q2FwdGlvbihsZXZlbC50cmFuc2l0aW9uLnN0YXR1cy5jYXB0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmtleSA9IGxldmVsLnRyYW5zaXRpb24uc3RhdHVzLmtleTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsLnRyYW5zaXRpb24uc3RhdHVzLmRlbGF5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUuc2tpcCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgbGV2ZWwgPSB0aGlzLmdldEN1cnJlbnRMZXZlbCgpO1xuICAgICAgICAgICAgbGV2ZWwuc2tpcCgpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNDb21wbGV0ZSgpICYmIGxldmVsLmlzQ29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbEluZGV4Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDdXJyZW50TGV2ZWwoKS5lbnRlcigpO1xuICAgICAgICAgICAgICAgIHRoaXMua2V5ID0gdGhpcy5nZXRDdXJyZW50TGV2ZWwoKS5rZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0Q2FwdGlvbignJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgR2FtZS5wcm90b3R5cGUucmVzdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmluaXNoVGltZW91dCkge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aGlzLmZpbmlzaFRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy50cmFuc2l0aW9uVGltZW91dCkge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aGlzLnRyYW5zaXRpb25UaW1lb3V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMudHJhbnNpdGlvbktleVRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGhpcy50cmFuc2l0aW9uS2V5VGltZW91dCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLmxldmVscywgZnVuY3Rpb24obCkge1xuICAgICAgICAgICAgICAgIGwucmVzZXQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbEluZGV4ID0gMDtcbiAgICAgICAgICAgIHRoaXMuY2FwdGlvbiA9IHN0YXJ0Q2FwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gJ3R1dG9yaWFsJztcbiAgICAgICAgICAgIHRoaXMua2V5ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuaXNMb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZVNjcmVlbiA9ICd1cCc7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEdhbWU7XG4gICAgfVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2RlbW8ubGV2ZWwnLCBMZXZlbEZhY3RvcnkpO1xuXG4gICAgTGV2ZWxGYWN0b3J5LiRpbmplY3QgPSBbJyR0aW1lb3V0JywgJyRpbnRlcnZhbCddO1xuXG4gICAgZnVuY3Rpb24gTGV2ZWxGYWN0b3J5KCR0aW1lb3V0LCAkaW50ZXJ2YWwpIHtcblxuICAgICAgICAvL0Jhc2UgTGV2ZWxcbiAgICAgICAgZnVuY3Rpb24gQmFzZUxldmVsKCkge1xuXG4gICAgICAgICAgICB0aGlzLmlzQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNUaW1lb3V0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNXYWl0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9yZGVyID0gMDtcbiAgICAgICAgICAgIHRoaXMua2V5ID0gJyc7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSAnJztcbiAgICAgICAgICAgIHRoaXMuZ2FtZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbk5hdiA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIEJhc2VMZXZlbC5wcm90b3R5cGUuc3RhdGVDaGFuZ2VkID0gZnVuY3Rpb24oYXNzZXROYW1lLCBhc3NldFZhbHVlKSB7fTtcblxuICAgICAgICBCYXNlTGV2ZWwucHJvdG90eXBlLmVudGVyID0gZnVuY3Rpb24oKSB7fTtcblxuICAgICAgICBCYXNlTGV2ZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7fTtcblxuICAgICAgICBCYXNlTGV2ZWwucHJvdG90eXBlLnNraXAgPSBmdW5jdGlvbigpIHt9O1xuXG4gICAgICAgIC8vU3RhdGUgTGV2ZWxcbiAgICAgICAgZnVuY3Rpb24gU3RhdGVMZXZlbChnYW1lLCBjb25maWcpIHtcblxuICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgICAgIHRoaXMub3JkZXIgPSBjb25maWcub3JkZXI7XG4gICAgICAgICAgICB0aGlzLmtleSA9IGNvbmZpZy5rZXk7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBjb25maWcudGV4dDtcbiAgICAgICAgICAgIHRoaXMudGltZW91dENhcHRpb24gPSBjb25maWcudGltZW91dENhcHRpb247XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NDYXB0aW9uID0gY29uZmlnLnN1Y2Nlc3NDYXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5leHBlY3RlZEFzc2V0U3RhdGUgPSBjb25maWcuZXhwZWN0ZWRBc3NldFN0YXRlO1xuXG4gICAgICAgICAgICB0aGlzLmNhcHRpb25XYXJuaW5nVGltZXJJbnRlcnZhbCA9IDcwMDA7XG4gICAgICAgICAgICB0aGlzLmNhcHRpb25XYXJuaW5nVGltZXIgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy53YWl0aW5nVGltZXJJbnRlcnZhbCA9IDMwMDA7XG4gICAgICAgICAgICB0aGlzLndhaXRpbmdUaW1lciA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChjb25maWcudHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IGNvbmZpZy50cmFuc2l0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY29uZmlnLmNhcHRpb25XYXJuaW5nVGltZXJJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FwdGlvbldhcm5pbmdUaW1lckludGVydmFsID0gY29uZmlnLmNhcHRpb25XYXJuaW5nVGltZXJJbnRlcnZhbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNvbmZpZy53YWl0aW5nVGltZXJJbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMud2FpdGluZ1RpbWVySW50ZXJ2YWwgPSBjb25maWcud2FpdGluZ1RpbWVySW50ZXJ2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBTdGF0ZUxldmVsLnByb3RvdHlwZSA9IG5ldyBCYXNlTGV2ZWwoKTtcbiAgICAgICAgU3RhdGVMZXZlbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBTdGF0ZUxldmVsO1xuXG4gICAgICAgIFN0YXRlTGV2ZWwucHJvdG90eXBlLnN0YXRlQ2hhbmdlZCA9IGZ1bmN0aW9uKGFzc2V0TmFtZSwgYXNzZXRWYWx1ZSkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5leHBlY3RlZEFzc2V0U3RhdGUubmFtZSA9PT0gYXNzZXROYW1lICYmIHRoaXMuZXhwZWN0ZWRBc3NldFN0YXRlLnZhbHVlID09PSBhc3NldFZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGhpcy5jYXB0aW9uV2FybmluZ1RpbWVyKTtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGhpcy53YWl0aW5nVGltZXIpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldENhcHRpb24odGhpcy5zdWNjZXNzQ2FwdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLnNldEdhbWVTY3JlZW4odGhpcy5rZXkpO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNDb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1RpbWVvdXRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuaXNXYWl0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdGVMZXZlbC5wcm90b3R5cGUuc2tpcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5pc0NvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuaXNUaW1lb3V0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNXYWl0aW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNhcHRpb25XYXJuaW5nVGltZXIpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGhpcy5jYXB0aW9uV2FybmluZ1RpbWVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMud2FpdGluZ1RpbWVyKSB7XG4gICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHRoaXMud2FpdGluZ1RpbWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0ZUxldmVsLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGF0LmNhcHRpb25XYXJuaW5nVGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0Q2FwdGlvbih0aGF0LnRpbWVvdXRDYXB0aW9uKTtcbiAgICAgICAgICAgICAgICB0aGF0LmlzVGltZW91dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0sIHRoYXQuY2FwdGlvbldhcm5pbmdUaW1lckludGVydmFsKTtcblxuICAgICAgICAgICAgdGhhdC53YWl0aW5nVGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGF0LmlzV2FpdGluZyA9IHRydWU7XG4gICAgICAgICAgICB9LCB0aGF0LndhaXRpbmdUaW1lckludGVydmFsKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0ZUxldmVsLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB0aGlzLmlzQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNUaW1lb3V0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNXYWl0aW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNhcHRpb25XYXJuaW5nVGltZXIpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGhpcy5jYXB0aW9uV2FybmluZ1RpbWVyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMud2FpdGluZ1RpbWVyKSB7XG4gICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHRoaXMud2FpdGluZ1RpbWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvL0ZyZWUgTGV2ZWxcbiAgICAgICAgZnVuY3Rpb24gRnJlZUxldmVsKGdhbWUsIGNvbmZpZykge1xuICAgICAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcbiAgICAgICAgICAgIHRoaXMub3JkZXIgPSBjb25maWcub3JkZXI7XG4gICAgICAgICAgICB0aGlzLmtleSA9IGNvbmZpZy5rZXk7XG4gICAgICAgICAgICB0aGlzLnRleHQgPSBjb25maWcudGV4dDtcbiAgICAgICAgICAgIHRoaXMuaGlkZUluTmF2ID0gY29uZmlnLmhpZGVJbk5hdjtcblxuICAgICAgICAgICAgdGhpcy5xdWV1ZSA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgRnJlZUxldmVsLnByb3RvdHlwZSA9IG5ldyBCYXNlTGV2ZWwoKTtcbiAgICAgICAgRnJlZUxldmVsLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEZyZWVMZXZlbDtcblxuICAgICAgICBGcmVlTGV2ZWwucHJvdG90eXBlLnN0YXRlQ2hhbmdlZCA9IGZ1bmN0aW9uKGFzc2V0TmFtZSwgYXNzZXRWYWx1ZSkge1xuXG4gICAgICAgICAgICB0aGlzLnF1ZXVlLnB1c2goe1xuICAgICAgICAgICAgICAgIGFzc2V0TmFtZTogYXNzZXROYW1lLFxuICAgICAgICAgICAgICAgIGFzc2V0VmFsdWU6IGFzc2V0VmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEZyZWVMZXZlbC5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRHYW1lU2NyZWVuKCd1cCcpO1xuXG4gICAgICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdGhhdC5wcm9jZXNzUXVldWUoKTtcbiAgICAgICAgICAgIH0sIDMwKTtcblxuICAgICAgICAgICAgdGhhdC5nYW1lLnN0YXR1cyA9ICdmcmVlJztcbiAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRDYXB0aW9uKCcnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBGcmVlTGV2ZWwucHJvdG90eXBlLnByb2Nlc3NRdWV1ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGF0LnF1ZXVlLnNoaWZ0KCk7XG5cbiAgICAgICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGFzc2V0TmFtZSA9IGl0ZW0uYXNzZXROYW1lO1xuICAgICAgICAgICAgdmFyIGFzc2V0VmFsdWUgPSBpdGVtLmFzc2V0VmFsdWU7XG5cbiAgICAgICAgICAgIGlmICh0aGF0LmdhbWUuZ2FtZVNjcmVlbiA9PT0gJ3VwJykge1xuICAgICAgICAgICAgICAgIGlmIChhc3NldE5hbWUgPT09ICdwb3NpdGlvbicgJiYgYXNzZXRWYWx1ZSA9PT0gJ29udGFibGUnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5nYW1lLnNldEdhbWVTY3JlZW4oJ2Rvd24nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5nYW1lLnNldENhcHRpb24oJ0lcXCdtIG9uIGEgdGFibGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGF0LmdhbWUuZ2FtZVNjcmVlbiA9PT0gJ2Rvd24nIHx8IHRoYXQuZ2FtZS5nYW1lU2NyZWVuID09PSAnbGVmdCcgfHwgdGhhdC5nYW1lLmdhbWVTY3JlZW4gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXROYW1lID09PSAncG9zaXRpb24nICYmIGFzc2V0VmFsdWUgPT09ICdub3RvbnRhYmxlJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRHYW1lU2NyZWVuKCd1cCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0Q2FwdGlvbignSVxcJ20gdXAhJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXNzZXROYW1lID09PSAnYW1pc2hha2luZycgJiYgYXNzZXRWYWx1ZSA9PT0gJ3NoYWtpbmcnKSB7XG5cbiAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0R2FtZVNjcmVlbignc2hha2UnKTtcbiAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0Q2FwdGlvbignSVxcJ20gU2hha2luXFwnIScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhhdC5nYW1lLmdhbWVTY3JlZW4gPT09ICdzaGFrZScpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXROYW1lID09PSAnYW1pc2hha2luZycgJiYgYXNzZXRWYWx1ZSA9PT0gJ3N0aWxsJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRHYW1lU2NyZWVuKCd1cCcpO1xuICAgICAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0Q2FwdGlvbignSVxcJ20gdXAhJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhhdC5nYW1lLmdhbWVTY3JlZW4gPT09ICdzaGFrZScpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXROYW1lID09PSAncG9zaXRpb24nICYmIGFzc2V0VmFsdWUgPT09ICdvbnRhYmxlJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRHYW1lU2NyZWVuKCdkb3duJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2FtZS5zZXRDYXB0aW9uKCdJXFwnbSBvbiBhIHRhYmxlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhhdC5nYW1lLmdhbWVTY3JlZW4gIT09ICdzaGFrZScpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXROYW1lID09PSAncm90YXRpb24nICYmIGFzc2V0VmFsdWUgPT09ICdsZWZ0Um90YXRpb24nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhhdC5nYW1lLnNldEdhbWVTY3JlZW4oJ2xlZnQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5nYW1lLnNldENhcHRpb24oJ0xlZnQgcm90YXRpb24hJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFzc2V0TmFtZSA9PT0gJ3JvdGF0aW9uJyAmJiBhc3NldFZhbHVlID09PSAncmlnaHRSb3RhdGlvbicpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LmdhbWUuc2V0R2FtZVNjcmVlbigncmlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC5nYW1lLnNldENhcHRpb24oJ1JpZ2h0IHJvdGF0aW9uIScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgU3RhdGU6IFN0YXRlTGV2ZWwsXG4gICAgICAgICAgICBGcmVlOiBGcmVlTGV2ZWxcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnZGVtby5tb3Rpb24nLCBNb3Rpb24pO1xuXG4gICAgTW90aW9uLiRpbmplY3QgPSBbJyR3aW5kb3cnXTtcblxuICAgIGZ1bmN0aW9uIE1vdGlvbigkd2luZG93KSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBpc1N1cHBvcnRlZDogaXNTdXBwb3J0ZWQsXG4gICAgICAgICAgICBzdWJzY3JpYmVPbk1vdmVDaGFuZ2U6IHN1YnNjcmliZU9uTW92ZUNoYW5nZVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBtb3ZlU3Vic2NyaWJlcnMgPSBbXTtcbiAgICAgICAgdmFyIGxhc3RVcGRhdGUgPSAtMTtcbiAgICAgICAgdmFyIHg7XG4gICAgICAgIHZhciB5O1xuICAgICAgICB2YXIgejtcbiAgICAgICAgdmFyIGxhc3RYO1xuICAgICAgICB2YXIgbGFzdFk7XG4gICAgICAgIHZhciBsYXN0WjtcbiAgICAgICAgdmFyIGlzTGlzdGVuZXJBdHRhY2hlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgbGFzdFB1Ymxpc2hlZE1vdmVWYWx1ZSA9IG51bGw7XG4gICAgICAgIHZhciBsYXN0S25vd25EaXJlY3Rpb24gPSBudWxsO1xuICAgICAgICB2YXIgbnVtUmlnaHQgPSAwO1xuICAgICAgICB2YXIgbnVtTGVmdCA9IDA7XG4gICAgICAgIHZhciBpc1N0aWxsID0gbnVsbDtcbiAgICAgICAgdmFyIHNhbXBsZUNvdW50ID0gMDtcblxuICAgICAgICB2YXIgU0FNUExFX0lOVEVSVkFMID0gMjA7IC8vbWlsaXNlY29uZHNcbiAgICAgICAgdmFyIE1PVkVfVEhSRVNIT0xEID0gMC42O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gaXNTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gKCdvbmRldmljZW1vdGlvbicgaW4gJHdpbmRvdyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmVPbk1vdmVDaGFuZ2UobW92ZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0xpc3RlbmVyQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBhdHRhY2hMaXN0ZW5lcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb3ZlU3Vic2NyaWJlcnMucHVzaChtb3ZlSGFuZGxlcik7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhdHRhY2hMaXN0ZW5lcigpIHtcbiAgICAgICAgICAgICR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgZGV2aWNlTW90aW9uQ2hhbmdlZCk7XG4gICAgICAgICAgICBpc0xpc3RlbmVyQXR0YWNoZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGV2aWNlTW90aW9uQ2hhbmdlZChldmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBkYXRlLmdldFRpbWUoKTtcblxuICAgICAgICAgICAgeCA9IGV2ZW50LmFjY2VsZXJhdGlvbi54O1xuICAgICAgICAgICAgeSA9IGV2ZW50LmFjY2VsZXJhdGlvbi55O1xuICAgICAgICAgICAgeiA9IGV2ZW50LmFjY2VsZXJhdGlvbi56O1xuXG4gICAgICAgICAgICAvL29uZSB1cGRhdGUgZXZlcnkgMTAwbXNcbiAgICAgICAgICAgIGlmICgoY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlKSA+IFNBTVBMRV9JTlRFUlZBTCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGRpZmZUaW1lID0gY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlO1xuICAgICAgICAgICAgICAgIGxhc3RVcGRhdGUgPSBjdXJyZW50VGltZTtcblxuICAgICAgICAgICAgICAgIHZhciB4RGlmZiA9IGxhc3RYIC0geDtcbiAgICAgICAgICAgICAgICBzYW1wbGVDb3VudCsrO1xuXG4gICAgICAgICAgICAgICAgLy9kZWNpZGUgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgaWYgKHhEaWZmID4gTU9WRV9USFJFU0hPTEQpIHtcbiAgICAgICAgICAgICAgICAgICAgbnVtUmlnaHQrKztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHhEaWZmIDwgLU1PVkVfVEhSRVNIT0xEKSB7XG4gICAgICAgICAgICAgICAgICAgIG51bUxlZnQrKztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNhbXBsZUNvdW50ID4gNCkge1xuICAgICAgICAgICAgICAgIGlmIChudW1SaWdodCA+IG51bUxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFzdEtub3duRGlyZWN0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG51bUxlZnQgPiBudW1SaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0S25vd25EaXJlY3Rpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaE1vdmUobGFzdEtub3duRGlyZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBudW1SaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgbnVtTGVmdCA9IDA7XG4gICAgICAgICAgICAgICAgc2FtcGxlQ291bnQgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsYXN0WCA9IHg7XG4gICAgICAgICAgICBsYXN0WSA9IHk7XG4gICAgICAgICAgICBsYXN0WiA9IHo7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwdWJsaXNoTW92ZShpc01vdmluZykge1xuICAgICAgICAgICAgaWYgKGxhc3RQdWJsaXNoZWRNb3ZlVmFsdWUgIT09IGlzTW92aW5nKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtb3ZlU3Vic2NyaWJlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbW92ZVN1YnNjcmliZXJzW2ldKGlzTW92aW5nKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsYXN0UHVibGlzaGVkTW92ZVZhbHVlID0gaXNNb3Zpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2RlbW8ub3JpZW50YXRpb24nLCBvcmllbnRhdGlvbik7XG5cbiAgICBvcmllbnRhdGlvbi4kaW5qZWN0ID0gWyckd2luZG93J107XG5cbiAgICBmdW5jdGlvbiBvcmllbnRhdGlvbigkd2luZG93KSB7XG5cbiAgICAgICAgdmFyIFVQUEVSX0JFVEFfUE9TSVRJT05fQk9VTkQgPSAxMjA7XG4gICAgICAgIHZhciBMT1dFUl9CRVRBX1BPU0lUSU9OX0JPVU5EID0gNjA7XG4gICAgICAgIHZhciBVUFBFUl9CRVRBX0xBWUlOR19PTl9UQUJMRSA9IDEwO1xuICAgICAgICB2YXIgTE9XRVJfQkVUQV9MQVlJTkdfT05fVEFCTEUgPSAtNTtcbiAgICAgICAgdmFyIFVQUEVSX1JPVEFUSU9OX0JPVU5EID0gNTtcbiAgICAgICAgdmFyIExPV0VSX1JPVEFUSU9OX0JPVU5EID0gLTU7XG4gICAgICAgIHZhciBST1RBVElPTl9TRU5TSVRJVklUWSA9IDMwO1xuICAgICAgICB2YXIgU0FNUExFX0lOVEVSVkFMID0gMTAwOyAvL21zXG5cbiAgICAgICAgdmFyIHJvdGF0aW9uU3Vic2NyaWJlcnMgPSBbXTtcbiAgICAgICAgdmFyIHZlcnRpY2FsU3Vic2NyaWJlcnMgPSBbXTtcbiAgICAgICAgdmFyIGxhc3RVcGRhdGUgPSAtMTtcbiAgICAgICAgdmFyIGlzTGlzdGVuZXJBdHRhY2hlZCA9IGZhbHNlO1xuICAgICAgICB2YXIgbGFzdFB1Ymxpc2hlZFZhbHVlID0gbnVsbDtcblxuICAgICAgICB2YXIgYWxwaGEsIGJldGEsIGdhbW1hO1xuICAgICAgICB2YXIgcEFscGhhLCBwQmV0YSwgcEdhbW1hO1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgaXNTdXBwb3J0ZWQ6IGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgc3Vic2NyaWJlT25Sb3RhdGlvbjogc3Vic2NyaWJlUm90YXRpb24sXG4gICAgICAgICAgICBzdWJzY3JpYmVPblZlcnRpY2FsT3JpZW50YXRpb25DaGFuZ2U6IHN1YnNjcmliZVZlcnRpY2FsXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuICgnb25kZXZpY2VvcmllbnRhdGlvbicgaW4gJHdpbmRvdyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmVSb3RhdGlvbihyb3RhdGlvbkhhbmRsZXIpIHtcbiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0xpc3RlbmVyQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBhdHRhY2hMaXN0ZW5lcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByb3RhdGlvblN1YnNjcmliZXJzLnB1c2gocm90YXRpb25IYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZVZlcnRpY2FsKHZlcnRpY2FsSGFuZGxlcikge1xuICAgICAgICAgICAgaWYgKCFpc1N1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWlzTGlzdGVuZXJBdHRhY2hlZCkge1xuICAgICAgICAgICAgICAgIGF0dGFjaExpc3RlbmVyKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZlcnRpY2FsU3Vic2NyaWJlcnMucHVzaCh2ZXJ0aWNhbEhhbmRsZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYXR0YWNoTGlzdGVuZXIoKSB7XG4gICAgICAgICAgICAkd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgZGV2aWNlT3JpZW50YXRpb25DaGFuZ2VkKTtcbiAgICAgICAgICAgIGlzTGlzdGVuZXJBdHRhY2hlZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZXZpY2VPcmllbnRhdGlvbkNoYW5nZWQoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50VGltZSA9IGRhdGUuZ2V0VGltZSgpO1xuXG4gICAgICAgICAgICBhbHBoYSA9IE1hdGgucm91bmQoZXZlbnQuYWxwaGEpO1xuICAgICAgICAgICAgYmV0YSA9IE1hdGgucm91bmQoZXZlbnQuYmV0YSk7XG4gICAgICAgICAgICBnYW1tYSA9IE1hdGgucm91bmQoZXZlbnQuZ2FtbWEpO1xuXG4gICAgICAgICAgICBpZiAocEFscGhhID09PSB1bmRlZmluZWQgfHwgcEJldGEgPT09IHVuZGVmaW5lZCB8fCBwR2FtbWEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHBBbHBoYSA9IGFscGhhO1xuICAgICAgICAgICAgICAgIHBCZXRhID0gYmV0YTtcbiAgICAgICAgICAgICAgICBwR2FtbWEgPSBnYW1tYTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKChjdXJyZW50VGltZSAtIGxhc3RVcGRhdGUpID4gU0FNUExFX0lOVEVSVkFMICYmIChpc1ZhbGlkUm90YXRpb24oYWxwaGEgLSBwQWxwaGEpIHx8IGlzVmFsaWRSb3RhdGlvbihiZXRhIC0gcEJldGEpIHx8IGlzVmFsaWRSb3RhdGlvbihnYW1tYSAtIHBHYW1tYSkpKSB7XG5cbiAgICAgICAgICAgICAgICBsYXN0VXBkYXRlID0gY3VycmVudFRpbWU7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNSb3RhdGluZygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hSb3RhdGlvbignUk9UQVRJTkcnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNPblRhYmxlKGJldGEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hWZXJ0aWNhbCgnT04gVEFCTEUgUkVTVElORycpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hWZXJ0aWNhbCgnSSBBTSBOT1QgUkVTVElORycpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBBbHBoYSA9IGFscGhhO1xuICAgICAgICAgICAgICAgIHBCZXRhID0gYmV0YTtcbiAgICAgICAgICAgICAgICBwR2FtbWEgPSBnYW1tYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hSb3RhdGlvbihtZXNzYWdlKSB7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm90YXRpb25TdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJvdGF0aW9uU3Vic2NyaWJlcnNbaV0obWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwdWJsaXNoVmVydGljYWwobWVzc2FnZSkge1xuXG4gICAgICAgICAgICBpZiAobGFzdFB1Ymxpc2hlZFZhbHVlICE9PSBtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJ0aWNhbFN1YnNjcmliZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZlcnRpY2FsU3Vic2NyaWJlcnNbaV0obWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGFzdFB1Ymxpc2hlZFZhbHVlID0gbWVzc2FnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzVmVydGljYWwodmFsdWUpIHtcblxuICAgICAgICAgICAgaWYgKHZhbHVlID4gTE9XRVJfQkVUQV9QT1NJVElPTl9CT1VORCAmJiB2YWx1ZSA8IFVQUEVSX0JFVEFfUE9TSVRJT05fQk9VTkQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNPblRhYmxlKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPiBMT1dFUl9CRVRBX0xBWUlOR19PTl9UQUJMRSAmJiB2YWx1ZSA8IFVQUEVSX0JFVEFfTEFZSU5HX09OX1RBQkxFKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzUm90YXRpbmcoKSB7XG5cbiAgICAgICAgICAgIGFscGhhRGlmZiA9IGFscGhhIC0gcEFscGhhO1xuICAgICAgICAgICAgYmV0YURpZmYgPSBiZXRhIC0gcEJldGE7XG4gICAgICAgICAgICBnYW1tYURpZmYgPSBnYW1tYSAtIHBHYW1tYTtcblxuICAgICAgICAgICAgaWYgKGluUm90YXRpb25Cb3VuZChhbHBoYURpZmYpIHx8IGluUm90YXRpb25Cb3VuZChiZXRhRGlmZikgfHwgaW5Sb3RhdGlvbkJvdW5kKGdhbW1hRGlmZikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNWYWxpZFJvdGF0aW9uKGRpZmZlcmVuY2UpIHtcblxuICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpID4gUk9UQVRJT05fU0VOU0lUSVZJVFkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5Sb3RhdGlvbkJvdW5kKHZhbHVlKSB7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSA8IFVQUEVSX1JPVEFUSU9OX0JPVU5EICYmIHZhbHVlID4gTE9XRVJfUk9UQVRJT05fQk9VTkQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2RlbW8ucGFnZVZpc2liaWxpdHknLCBwYWdlVmlzaWJpbGl0eSk7XG5cbiAgICBwYWdlVmlzaWJpbGl0eS4kaW5qZWN0ID0gWyckd2luZG93J107XG5cbiAgICBmdW5jdGlvbiBwYWdlVmlzaWJpbGl0eSgkd2luZG93KSB7XG5cbiAgICAgICAgdmFyIHZpc2liaWxpdHlTdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICB2YXIgbGFzdFVwZGF0ZSA9IC0xO1xuICAgICAgICB2YXIgaXNMaXN0ZW5lckF0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBsYXN0UHVibGlzaGVkVmFsdWUgPSB0cnVlO1xuICAgICAgICB2YXIgZXZlbnROYW1lID0gbnVsbDtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHN1YnNjcmliZU9uUGFnZVZpc2liaWxpdHk6IHN1YnNjcmliZU9uUGFnZVZpc2liaWxpdHksXG4gICAgICAgICAgICB1bnN1YnNjcmliZU9uUGFnZVZpc2liaWxpdHk6IHVuc3Vic2NyaWJlT25QYWdlVmlzaWJpbGl0eVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBnZXRIaWRkZW5Qcm9wKCkge1xuICAgICAgICAgICAgdmFyIHByZWZpeGVzID0gWyd3ZWJraXQnLCAnbW96JywgJ21zJywgJ28nXTtcblxuICAgICAgICAgICAgaWYgKCdoaWRkZW4nIGluIGRvY3VtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdoaWRkZW4nO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByZWZpeGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKChwcmVmaXhlc1tpXSArICdIaWRkZW4nKSBpbiBkb2N1bWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ZXNbaV0gKyAnSGlkZGVuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlT25QYWdlVmlzaWJpbGl0eSh2aXNpYmlsaXR5SGFuZGxlcikge1xuXG4gICAgICAgICAgICBpZiAoIWlzTGlzdGVuZXJBdHRhY2hlZCkge1xuICAgICAgICAgICAgICAgIGF0dGFjaExpc3RlbmVyKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZpc2liaWxpdHlTdWJzY3JpYmVycy5wdXNoKHZpc2liaWxpdHlIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVuc3Vic2NyaWJlT25QYWdlVmlzaWJpbGl0eSgpIHtcbiAgICAgICAgICAgIHZpc2liaWxpdHlTdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHBhZ2VWaXNpYmlsaXR5Q2hhbmdlcyk7XG4gICAgICAgICAgICBpc0xpc3RlbmVyQXR0YWNoZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF0dGFjaExpc3RlbmVyKCkge1xuICAgICAgICAgICAgdmFyIHZpc1Byb3AgPSBnZXRIaWRkZW5Qcm9wKCk7XG4gICAgICAgICAgICBpZiAodmlzUHJvcCkge1xuICAgICAgICAgICAgICAgIGV2ZW50TmFtZSA9IHZpc1Byb3AucmVwbGFjZSgvW0h8aF1pZGRlbi8sICcnKSArICd2aXNpYmlsaXR5Y2hhbmdlJztcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcGFnZVZpc2liaWxpdHlDaGFuZ2VzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaXNMaXN0ZW5lckF0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHBhZ2VWaXNpYmlsaXR5Q2hhbmdlcyhldmVudCkge1xuICAgICAgICAgICAgcHVibGlzaFZpc2liaWxpdHkoIWxhc3RQdWJsaXNoZWRWYWx1ZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hWaXNpYmlsaXR5KG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGlmIChsYXN0UHVibGlzaGVkVmFsdWUgIT09IG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpc2liaWxpdHlTdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5U3Vic2NyaWJlcnNbaV0obWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGFzdFB1Ymxpc2hlZFZhbHVlID0gbWVzc2FnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2RlbW8ucG9zaXRpb24nLCBQb3NpdGlvbik7XG5cbiAgICBQb3NpdGlvbi4kaW5qZWN0ID0gWyckd2luZG93JywgJyR0aW1lb3V0J107XG5cbiAgICBmdW5jdGlvbiBQb3NpdGlvbigkd2luZG93LCAkdGltZW91dCkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgaXNTdXBwb3J0ZWQ6IGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgc3Vic2NyaWJlT25Qb3NpdGlvbkNoYW5nZTogc3Vic2NyaWJlT25Qb3NpdGlvbkNoYW5nZSxcbiAgICAgICAgICAgIHVuc3Vic2NyaWJlT25Qb3NpdGlvbkNoYW5nZTogdW5zdWJzY3JpYmVPblBvc2l0aW9uQ2hhbmdlXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHBvc2l0aW9uU3Vic2NyaWJlcnMgPSBbXTtcbiAgICAgICAgdmFyIGxhc3RQdWJsaXNoZWRQb3NpdGlvbiA9IG51bGw7XG4gICAgICAgIHZhciBvdGhlckxhc3RQdWJsaXNoZWRQb3MgPSBudWxsO1xuICAgICAgICB2YXIgaXNMaXN0ZW5lckF0dGFjaGVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGFscGhhO1xuICAgICAgICB2YXIgYmV0YTtcbiAgICAgICAgdmFyIGdhbW1hO1xuICAgICAgICB2YXIgeDtcbiAgICAgICAgdmFyIHk7XG4gICAgICAgIHZhciB6O1xuXG4gICAgICAgIHZhciBNT1ZFX0JPVU5EID0gMC4zO1xuICAgICAgICB2YXIgSE9SSVpPTlRBTF9CT1VORCA9IDI7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgdmFyIGlzSXQgPSAoKCdvbmRldmljZW1vdGlvbicgaW4gJHdpbmRvdykgJiYgKCdvbmRldmljZW9yaWVudGF0aW9uJyBpbiAkd2luZG93KSk7XG4gICAgICAgICAgICByZXR1cm4gaXNJdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZU9uUG9zaXRpb25DaGFuZ2UocG9zaXRpb25DaGFuZ2VIYW5kbGVyKSB7XG4gICAgICAgICAgICBpZiAoIWlzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaXNMaXN0ZW5lckF0dGFjaGVkKSB7XG4gICAgICAgICAgICAgICAgYXR0YWNoTGlzdGVuZXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcG9zaXRpb25TdWJzY3JpYmVycy5wdXNoKHBvc2l0aW9uQ2hhbmdlSGFuZGxlcik7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVuc3Vic2NyaWJlT25Qb3NpdGlvbkNoYW5nZSgpIHtcbiAgICAgICAgICAgIHBvc2l0aW9uU3Vic2NyaWJlcnMgPSBbXTtcbiAgICAgICAgICAgICR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgcG9zaXRpb25IYW5kbGVyKTtcbiAgICAgICAgICAgICR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCBwb3NpdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgaXNMaXN0ZW5lckF0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhdHRhY2hMaXN0ZW5lcigpIHtcbiAgICAgICAgICAgICR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgcG9zaXRpb25IYW5kbGVyKTtcbiAgICAgICAgICAgICR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCBwb3NpdGlvbkhhbmRsZXIpO1xuICAgICAgICAgICAgaXNMaXN0ZW5lckF0dGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHBvc2l0aW9uSGFuZGxlcihldmVudCkge1xuICAgICAgICAgICAgaWYgKGV2ZW50LmFscGhhIHx8IGV2ZW50LmJldGEgfHwgZXZlbnQuZ2FtbWEpIHtcbiAgICAgICAgICAgICAgICBhbHBoYSA9IGV2ZW50LmFscGhhO1xuICAgICAgICAgICAgICAgIGJldGEgPSBldmVudC5iZXRhO1xuICAgICAgICAgICAgICAgIGdhbW1hID0gZXZlbnQuZ2FtbWE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudC5hY2NlbGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICB4ID0gZXZlbnQuYWNjZWxlcmF0aW9uLng7XG4gICAgICAgICAgICAgICAgeSA9IGV2ZW50LmFjY2VsZXJhdGlvbi55O1xuICAgICAgICAgICAgICAgIHogPSBldmVudC5hY2NlbGVyYXRpb24uejtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzRGF0YUNvbGxlY3RlZChhbHBoYSwgYmV0YSwgZ2FtbWEpICYmIGlzRGF0YUNvbGxlY3RlZCh4LCB5LCB6KSkge1xuICAgICAgICAgICAgICAgIGlmIChpc0xheWluZ0Rvd24oYmV0YSwgZ2FtbWEpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1N0aWxsKHgsIHksIHopKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwdWIodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwdWIoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB0cnVlVGltZW91dCA9IG51bGw7XG5cbiAgICAgICAgZnVuY3Rpb24gcHViKHBvc2l0aW9uKSB7XG5cbiAgICAgICAgICAgIGlmIChsYXN0UHVibGlzaGVkUG9zaXRpb24gIT0gcG9zaXRpb24pIHtcblxuICAgICAgICAgICAgICAgIGlmICh0cnVlVGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodHJ1ZVRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbikge1xuXG4gICAgICAgICAgICAgICAgICAgIHRydWVUaW1lb3V0ID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hQb3NpdGlvbih0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB9LCAyMDApO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaFBvc2l0aW9uKGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsYXN0UHVibGlzaGVkUG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hQb3NpdGlvbihwb3NpdGlvbikge1xuICAgICAgICAgICAgaWYgKG90aGVyTGFzdFB1Ymxpc2hlZFBvcyAhPSBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zaXRpb25TdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN1YnNjcmliZXJzW2ldKHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvdGhlckxhc3RQdWJsaXNoZWRQb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNEYXRhQ29sbGVjdGVkKHgsIHksIHopIHtcbiAgICAgICAgICAgIGlmICh4ICE9PSBudWxsICYmIHkgIT09IG51bGwgJiYgeiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0xheWluZ0Rvd24oYmV0YSwgZ2FtbWEpIHtcbiAgICAgICAgICAgIGlmIChiZXRhID4gLUhPUklaT05UQUxfQk9VTkQgJiYgYmV0YSA8IEhPUklaT05UQUxfQk9VTkQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtbWEgPiAtSE9SSVpPTlRBTF9CT1VORCAmJiBnYW1tYSA8IEhPUklaT05UQUxfQk9VTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNTdGlsbCh4LCB5LCB6KSB7XG4gICAgICAgICAgICBpZiAoKHggPCBNT1ZFX0JPVU5EICYmIHggPiAtTU9WRV9CT1VORCkgfHwgKHkgPCBNT1ZFX0JPVU5EICYmIHkgPiAtTU9WRV9CT1VORCkgfHwgKHogPCBNT1ZFX0JPVU5EICYmIHogPiAtTU9WRV9CT1VORCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLnJvdGF0aW9uJywgcm90YXRpb24pO1xuXG4gICAgcm90YXRpb24uJGluamVjdCA9IFsnJHdpbmRvdycsICckaW50ZXJ2YWwnXTtcblxuICAgIGZ1bmN0aW9uIHJvdGF0aW9uKCR3aW5kb3csICRpbnRlcnZhbCkge1xuXG4gICAgICAgIHZhciBVUFBFUl9ST1RBVElPTl9CT1VORCA9IDEwMDtcbiAgICAgICAgdmFyIExPV0VSX1JPVEFUSU9OX0JPVU5EID0gLTEwMDtcbiAgICAgICAgdmFyIFNBTVBMRV9JTlRFUlZBTCA9IDQwOyAvL21zXG4gICAgICAgIHZhciBIT1JJWk9OVEFMX0JPVU5EID0gNTtcblxuICAgICAgICB2YXIgcm90YXRpb25TdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICB2YXIgbGFzdFVwZGF0ZSA9IC0xO1xuICAgICAgICB2YXIgaXNMaXN0ZW5lckF0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBsYXN0UHVibGlzaGVkVmFsdWUgPSBudWxsO1xuICAgICAgICB2YXIgc2FtcGxlQ291bnQgPSAwO1xuICAgICAgICB2YXIgcmlnaHRDb3VudCA9IDA7XG4gICAgICAgIHZhciBsZWZ0Q291bnQgPSAwO1xuXG4gICAgICAgIHZhciBhbHBoYTtcbiAgICAgICAgdmFyIGJldGE7XG4gICAgICAgIHZhciBnYW1tYTtcbiAgICAgICAgdmFyIHBBbHBoYTtcbiAgICAgICAgdmFyIHBCZXRhO1xuICAgICAgICB2YXIgcEdhbW1hO1xuICAgICAgICB2YXIgYWxwaGFEaWZmU3VtID0gbnVsbDtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGlzU3VwcG9ydGVkOiBpc1N1cHBvcnRlZCxcbiAgICAgICAgICAgIHN1YnNjcmliZU9uUm90YXRpb246IHN1YnNjcmliZVJvdGF0aW9uLFxuICAgICAgICAgICAgdW5zdWJzY3JpYmVPblJvdGF0aW9uQ2hhbmdlOiB1bnN1YnNjcmliZU9uUm90YXRpb25DaGFuZ2VcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gaXNTdXBwb3J0ZWQoKSB7XG4gICAgICAgICAgICByZXR1cm4gKCdvbmRldmljZW9yaWVudGF0aW9uJyBpbiAkd2luZG93KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZVJvdGF0aW9uKHJvdGF0aW9uSGFuZGxlcikge1xuICAgICAgICAgICAgaWYgKCFpc1N1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWlzTGlzdGVuZXJBdHRhY2hlZCkge1xuICAgICAgICAgICAgICAgIGF0dGFjaExpc3RlbmVyKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvdGF0aW9uU3Vic2NyaWJlcnMucHVzaChyb3RhdGlvbkhhbmRsZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdW5zdWJzY3JpYmVPblJvdGF0aW9uQ2hhbmdlKCkge1xuICAgICAgICAgICAgcm90YXRpb25TdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICAgICAgJHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdkZXZpY2VvcmllbnRhdGlvbicsIGRldmljZU9yaWVudGF0aW9uQ2hhbmdlZCk7XG4gICAgICAgICAgICBpc0xpc3RlbmVyQXR0YWNoZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF0dGFjaExpc3RlbmVyKCkge1xuICAgICAgICAgICAgJHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2VvcmllbnRhdGlvbicsIGRldmljZU9yaWVudGF0aW9uQ2hhbmdlZCk7XG4gICAgICAgICAgICBpc0xpc3RlbmVyQXR0YWNoZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoYWxwaGFEaWZmU3VtKSA+IDIwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1Bob25lSG9yaXpvbnRhbChiZXRhLCBnYW1tYSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYURpZmZTdW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaFJvdGF0aW9uKCdsZWZ0Um90YXRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaFJvdGF0aW9uKCdyaWdodFJvdGF0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhbHBoYURpZmZTdW0gPSBudWxsO1xuXG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRldmljZU9yaWVudGF0aW9uQ2hhbmdlZChldmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBkYXRlLmdldFRpbWUoKTtcblxuICAgICAgICAgICAgYWxwaGEgPSBNYXRoLnJvdW5kKGV2ZW50LmFscGhhKTtcbiAgICAgICAgICAgIGJldGEgPSBNYXRoLnJvdW5kKGV2ZW50LmJldGEpO1xuICAgICAgICAgICAgZ2FtbWEgPSBNYXRoLnJvdW5kKGV2ZW50LmdhbW1hKTtcblxuICAgICAgICAgICAgaWYgKHBBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcEFscGhhID0gYWxwaGE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgoY3VycmVudFRpbWUgLSBsYXN0VXBkYXRlKSA+IFNBTVBMRV9JTlRFUlZBTCAmJiBhbHBoYSAhPT0gcEFscGhhKSB7XG5cbiAgICAgICAgICAgICAgICBsYXN0VXBkYXRlID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgICAgdmFyIGFscGhhRGlmZiA9IGFscGhhIC0gcEFscGhhO1xuXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGFscGhhRGlmZikgPCAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFscGhhRGlmZlN1bSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGFEaWZmU3VtID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGFscGhhRGlmZlN1bSArPSBhbHBoYURpZmY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwQWxwaGEgPSBhbHBoYTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hSb3RhdGlvbihtZXNzYWdlKSB7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm90YXRpb25TdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJvdGF0aW9uU3Vic2NyaWJlcnNbaV0obWVzc2FnZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzUGhvbmVIb3Jpem9udGFsKGJldGEsIGdhbW1hKSB7XG4gICAgICAgICAgICBpZiAoKGJldGEgPiAtSE9SSVpPTlRBTF9CT1VORCAmJiBiZXRhIDwgSE9SSVpPTlRBTF9CT1VORCkgJiYgKGdhbW1hID4gLUhPUklaT05UQUxfQk9VTkQgJiYgZ2FtbWEgPCBIT1JJWk9OVEFMX0JPVU5EKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLnNlbnNvcnMnLCBzZW5zb3JzRmFjdG9yeSk7XG5cbiAgICBzZW5zb3JzRmFjdG9yeS4kaW5qZWN0ID0gWydkZW1vLnNoYWtlJyxcbiAgICAgICAgJ2RlbW8ucG9zaXRpb24nLFxuICAgICAgICAnZGVtby5tb3Rpb24nLFxuICAgICAgICAnZGVtby5wYWdlVmlzaWJpbGl0eScsXG4gICAgICAgICdkZW1vLnJvdGF0aW9uJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBzZW5zb3JzRmFjdG9yeShzaGFrZSwgcG9zaXRpb24sIG1vdGlvbiwgcGFnZVZpc2liaWxpdHksIHJvdGF0aW9uKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgc2hha2U6IHNoYWtlLFxuICAgICAgICAgICAgcG9zaXRpb246cG9zaXRpb24sXG4gICAgICAgICAgICBtb3Rpb246bW90aW9uLFxuICAgICAgICAgICAgcGFnZVZpc2liaWxpdHk6IHBhZ2VWaXNpYmlsaXR5LFxuICAgICAgICAgICAgcm90YXRpb246cm90YXRpb25cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLnNoYWtlJywgc2hha2UpO1xuXG4gICAgc2hha2UuJGluamVjdCA9IFsnJHdpbmRvdycsICckaW50ZXJ2YWwnXTtcblxuICAgIGZ1bmN0aW9uIHNoYWtlKCR3aW5kb3csICRpbnRlcnZhbCkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgaXNTdXBwb3J0ZWQ6IGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgc3Vic2NyaWJlT25TaGFrZUNoYW5nZTogc3Vic2NyaWJlU2hha2VyLFxuICAgICAgICAgICAgdW5zdWJzY3JpYmVPblNoYWtlQ2hhbmdlOiB1bnN1YnNjcmliZVNoYWtlcixcbiAgICAgICAgICAgIHN1YnNjcmliZU9uU3BlZWRDaGFuZ2U6IHN1YnNjcmliZU9uU3BlZWRDaGFuZ2VcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2hha2VTdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICB2YXIgc3BlZWRTdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICB2YXIgbGFzdFVwZGF0ZSA9IC0xO1xuICAgICAgICB2YXIgeDtcbiAgICAgICAgdmFyIHk7XG4gICAgICAgIHZhciB6O1xuICAgICAgICB2YXIgbGFzdFg7XG4gICAgICAgIHZhciBsYXN0WTtcbiAgICAgICAgdmFyIGxhc3RaO1xuICAgICAgICB2YXIgaXNMaXN0ZW5lckF0dGFjaGVkID0gZmFsc2U7XG4gICAgICAgIHZhciBsYXN0UHVibGlzaGVkU2hha2VWYWx1ZSA9IG51bGw7XG4gICAgICAgIHZhciBsYXN0UHVibGlzaGVkU3BlZWRWYWx1ZSA9IG51bGw7XG4gICAgICAgIHZhciB0aW1lc1NoYWtlbiA9IDA7XG4gICAgICAgIHZhciBpbnRlcnZhbFByb21pc2UgPSBudWxsO1xuXG4gICAgICAgIHZhciBTSEFLRV9USFJFU0hPTERfU1BFRUQgPSA1MDA7XG4gICAgICAgIHZhciBTQU1QTEVfSU5URVJWQUwgPSA1MDsgLy9taWxpc2Vjb25kc1xuICAgICAgICB2YXIgTU9WRV9USFJFU0hPTEQgPSAwLjM7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBpc1N1cHBvcnRlZCgpIHtcbiAgICAgICAgICAgIHJldHVybiAoJ29uZGV2aWNlbW90aW9uJyBpbiAkd2luZG93KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZVNoYWtlcihzaGFrZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0xpc3RlbmVyQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBhdHRhY2hMaXN0ZW5lcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzaGFrZVN1YnNjcmliZXJzLnB1c2goc2hha2VIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVuc3Vic2NyaWJlU2hha2VyKCkge1xuICAgICAgICAgICAgc2hha2VTdWJzY3JpYmVycyA9IFtdO1xuICAgICAgICAgICAgJHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdkZXZpY2Vtb3Rpb24nLCBkZXZpY2VNb3Rpb25DaGFuZ2VkKTtcbiAgICAgICAgICAgIGlzTGlzdGVuZXJBdHRhY2hlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoaW50ZXJ2YWxQcm9taXNlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChpbnRlcnZhbFByb21pc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlT25TcGVlZENoYW5nZShzcGVlZEhhbmRsZXIpIHtcbiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0xpc3RlbmVyQXR0YWNoZWQpIHtcbiAgICAgICAgICAgICAgICBhdHRhY2hMaXN0ZW5lcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzcGVlZFN1YnNjcmliZXJzLnB1c2goc3BlZWRIYW5kbGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF0dGFjaExpc3RlbmVyKCkge1xuICAgICAgICAgICAgJHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2Vtb3Rpb24nLCBkZXZpY2VNb3Rpb25DaGFuZ2VkKTtcbiAgICAgICAgICAgIGlzTGlzdGVuZXJBdHRhY2hlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIGludGVydmFsUHJvbWlzZSA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpbWVzU2hha2VuLCAnVGltZXMgU2hha2VuJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGltZXNTaGFrZW4gPiA0KSB7XG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hTaGFrZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGltZXNTaGFrZW4gPD0gMikge1xuICAgICAgICAgICAgICAgICAgICBwdWJsaXNoU2hha2UoZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRpbWVzU2hha2VuID0gMDtcbiAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGV2aWNlTW90aW9uQ2hhbmdlZChldmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBkYXRlLmdldFRpbWUoKTtcblxuICAgICAgICAgICAgeCA9IGV2ZW50LmFjY2VsZXJhdGlvbi54O1xuICAgICAgICAgICAgeSA9IGV2ZW50LmFjY2VsZXJhdGlvbi55O1xuICAgICAgICAgICAgeiA9IGV2ZW50LmFjY2VsZXJhdGlvbi56O1xuXG4gICAgICAgICAgICBpZiAoKGN1cnJlbnRUaW1lIC0gbGFzdFVwZGF0ZSkgPiBTQU1QTEVfSU5URVJWQUwpIHtcblxuICAgICAgICAgICAgICAgIHZhciBkaWZmVGltZSA9IGN1cnJlbnRUaW1lIC0gbGFzdFVwZGF0ZTtcbiAgICAgICAgICAgICAgICBsYXN0VXBkYXRlID0gY3VycmVudFRpbWU7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3BlZWQgPSBNYXRoLmFicyh4ICsgeSArIHogLSBsYXN0WCAtIGxhc3RZIC0gbGFzdFopIC8gZGlmZlRpbWUgKiAxMDAwMDtcbiAgICAgICAgICAgICAgICBpZiAoc3BlZWQgPiBTSEFLRV9USFJFU0hPTERfU1BFRUQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXNTaGFrZW4rKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxhc3RYID0geDtcbiAgICAgICAgICAgIGxhc3RZID0geTtcbiAgICAgICAgICAgIGxhc3RaID0gejtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hTaGFrZShpc1NoYWtpbikge1xuICAgICAgICAgICAgaWYgKGxhc3RQdWJsaXNoZWRTaGFrZVZhbHVlICE9PSBpc1NoYWtpbikge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hha2VTdWJzY3JpYmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBzaGFrZVN1YnNjcmliZXJzW2ldKGlzU2hha2luKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsYXN0UHVibGlzaGVkU2hha2VWYWx1ZSA9IGlzU2hha2luO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcHVibGlzaFNwZWVkKHNwZWVkKSB7XG4gICAgICAgICAgICBpZiAobGFzdFB1Ymxpc2hlZFNwZWVkVmFsdWUgIT09IHNwZWVkKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVlZFN1YnNjcmliZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwZWVkU3Vic2NyaWJlcnNbaV0oc3BlZWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxhc3RQdWJsaXNoZWRTcGVlZFZhbHVlID0gc3BlZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdkZW1vLnZpYnJhdGlvbicsIHZpYnJhdGlvbik7XG5cbiAgICB2aWJyYXRpb24uJGluamVjdCA9IFsnJHdpbmRvdyddO1xuXG4gICAgZnVuY3Rpb24gdmlicmF0aW9uKCR3aW5kb3cpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGlzU3VwcG9ydGVkOiBpc1N1cHBvcnRlZCxcbiAgICAgICAgICAgIHZpYnJhdGU6IHZpYnJhdGVcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGlzU3VwcG9ydGVkKCkge1xuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubmF2aWdhdG9yICYmICR3aW5kb3cubmF2aWdhdG9yLnZpYnJhdGU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB2aWJyYXRlKG1zKSB7XG5cbiAgICAgICAgICAgIGlmICghaXNTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFtcykge1xuICAgICAgICAgICAgICAgIG1zID0gNTAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkd2luZG93Lm5hdmlnYXRvci52aWJyYXRlKG1zKTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2RldmljZUFjdGl2aXR5JywgZGV2aWNlQWN0aXZpdHkpO1xuXG4gICAgZGV2aWNlQWN0aXZpdHkuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gZGV2aWNlQWN0aXZpdHkoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBEZXZpY2VBY3Rpdml0eUNvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RldmljZXMvY29udHJvbHMvYWN0aXZpdHkuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkZXZpY2U6ICc9JyxcbiAgICAgICAgICAgICAgICBjb25maWc6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIERldmljZUFjdGl2aXR5Q29udHJvbGxlci4kaW5qZWN0ID0gWydkZXZpY2UucmVwb3NpdG9yeScsICd1dGlscyddO1xuXG4gICAgZnVuY3Rpb24gRGV2aWNlQWN0aXZpdHlDb250cm9sbGVyKGRldmljZVJlcG9zaXRvcnksIHV0aWxzKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0uYXNzZXRzID0gW107XG5cbiAgICAgICAgdm0uY29sb3JzID0gWycjNTY2NDZEJywgJyMyNjcwRTAnLCAnIzI1QzJENScsICcjNDNDMzk5JywgJyNBOEMxNEQnLCAnI0Y0QzQ1QicsICcjRkY4NTVBJywgJyNGRjY0NTgnLCAnI0VENEQ3MycsICcjOTA2OEM4J107XG5cbiAgICAgICAgdm0uYXNzZXRDaGFydENvbmZpZyA9IHtcbiAgICAgICAgICAgIHR5cGU6IHZtLmNvbmZpZy50eXBlLFxuICAgICAgICAgICAgcmVmcmVzaENoYXJ0OiBmYWxzZSxcbiAgICAgICAgICAgIHRpbWVTY2FsZTogJzYwbScsXG4gICAgICAgICAgICBwYWdlOiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgYXNzZXRzVG9TaG93OiBbXSxcbiAgICAgICAgICAgIGNvbnRyb2w6IHZtLmNvbmZpZy50eXBlXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNob3dEZWZhdWx0ID0gdHJ1ZTtcblxuICAgICAgICB2bS5udW1iZXJPZk51bWVyaWNBc3NldHMgPSAwO1xuXG4gICAgICAgIHZtLmFzc2V0Q2xpY2tlZCA9IGFzc2V0Q2xpY2tlZDtcbiAgICAgICAgdm0uZ2VuZXJhdGVDb2xvciA9IGdlbmVyYXRlQ29sb3I7XG4gICAgICAgIHZtLmVuYWJsZUFjdGl2aXR5ID0gZW5hYmxlQWN0aXZpdHk7XG4gICAgICAgIHZtLnNldENvbnRyb2wgPSBzZXRDb250cm9sO1xuICAgICAgICB2bS50aW1lU2VsZWN0ZWQgPSB0aW1lU2VsZWN0ZWQ7XG4gICAgICAgIHZtLnNldFRpbWVMYWJlbCA9IHNldFRpbWVMYWJlbDtcbiAgICAgICAgdm0udG9nZ2xlRnVsbHNjcmVlbiA9IHRvZ2dsZUZ1bGxzY3JlZW47XG5cbiAgICAgICAgdm0uc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7XG4gICAgICAgIHZtLnNjcm9sbFJpZ2h0ID0gc2Nyb2xsUmlnaHQ7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cbiAgICAgICAgICAgIHZhciBkZXZpY2VBc3NldHMgPSB2bS5kZXZpY2UuYXNzZXRzO1xuXG4gICAgICAgICAgICBkZXZpY2VSZXBvc2l0b3J5LmdldERldmljZVNldHRpbmdzKHZtLmRldmljZS5pZClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihzZXR0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHQuYXNzZXRzVG9TaG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5hc3NldHNUb1Nob3cgPSBzZXR0LmFzc2V0c1RvU2hvdztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dEZWZhdWx0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dC5wYWdlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnBhZ2UgPSBzZXR0LnBhZ2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MucGFnZSA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZXR0LnRpbWVTY2FsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MudGltZVNjYWxlID0gc2V0dC50aW1lU2NhbGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy50aW1lU2NhbGUgPSAnNjBtJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGV2aWNlQXNzZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNQcm9maWxlTnVtZXJpYyhkZXZpY2VBc3NldHNbaV0ucHJvZmlsZSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLm51bWJlck9mTnVtZXJpY0Fzc2V0cysrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGogPSBpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dEZWZhdWx0ID09PSBmYWxzZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZUFzc2V0c1tpXS5fc2hvd0Fzc2V0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBzZXR0aW5ncy5hc3NldHNUb1Nob3cubGVuZ3RoOyBtKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5hc3NldHNUb1Nob3dbbV0gPT09IGRldmljZUFzc2V0c1tpXS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZUFzc2V0c1tpXS5fc2hvd0Fzc2V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlQXNzZXRzW2ldLl9zaG93QXNzZXQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmFzc2V0c1RvU2hvdy5wdXNoKGRldmljZUFzc2V0c1tpXS5pZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5zYXZlRGV2aWNlU2V0dGluZ3Modm0uZGV2aWNlLmlkLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0RlZmF1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHZtLmNvbG9ycy5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VBc3NldHNbaV0uX2Fzc2V0Q29sb3IgPSB2bS5jb2xvcnNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZUFzc2V0c1tpXS5fYXNzZXRDb2xvciA9IHZtLmNvbG9yc1tqIC0gdm0uY29sb3JzLmxlbmd0aF07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5hc3NldHMucHVzaChkZXZpY2VBc3NldHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uYXNzZXRDaGFydENvbmZpZy50aW1lU2NhbGUgPSBzZXR0aW5ncy50aW1lU2NhbGU7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uYXNzZXRDaGFydENvbmZpZy5wYWdlID0gc2V0dGluZ3MucGFnZTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbigndGltZVNjYWxlVXBkYXRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBwYXJhbXMpIHtcblxuICAgICAgICAgICAgICAgIHNldHRpbmdzLnRpbWVTY2FsZSA9IHBhcmFtcztcblxuICAgICAgICAgICAgICAgIHNldFRpbWVMYWJlbCgpO1xuXG4gICAgICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5zYXZlRGV2aWNlU2V0dGluZ3Modm0uZGV2aWNlLmlkLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNQcm9maWxlTnVtZXJpYyhwcm9maWxlKSB7XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlLnR5cGUgPT09ICdpbnRlZ2VyJyB8fCBwcm9maWxlLnR5cGUgPT09ICdudW1iZXInKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYXNzZXRDbGlja2VkKGFzc2V0KSB7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodm0uYXNzZXRzW2ldLmlkID09PSBhc3NldC5pZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLmFzc2V0c1tpXS5fc2hvd0Fzc2V0ID0gIXZtLmFzc2V0c1tpXS5fc2hvd0Fzc2V0O1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLmFzc2V0Q2hhcnRDb25maWcucmVmcmVzaENoYXJ0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uYXNzZXRzW2ldLl9zaG93QXNzZXQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuYXNzZXRzVG9TaG93LnB1c2godm0uYXNzZXRzW2ldLmlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5zYXZlRGV2aWNlU2V0dGluZ3Modm0uZGV2aWNlLmlkLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gc2V0dGluZ3MuYXNzZXRzVG9TaG93LmluZGV4T2Yodm0uYXNzZXRzW2ldLmlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5hc3NldHNUb1Nob3cuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5zYXZlRGV2aWNlU2V0dGluZ3Modm0uZGV2aWNlLmlkLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVDb2xvcihhc3NldCkge1xuXG4gICAgICAgICAgICB2YXIgY29sb3JTdHlsZSA9IHtcbiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6IG51bGxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5fYXNzZXRDb2xvcikge1xuICAgICAgICAgICAgICAgIGNvbG9yU3R5bGVbJ2JhY2tncm91bmQtY29sb3InXSA9IGFzc2V0Ll9hc3NldENvbG9yO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb2xvclN0eWxlWydiYWNrZ3JvdW5kLWNvbG9yJ10gPSB2bS5jb2xvcnNbMF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb2xvclN0eWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZW5hYmxlQWN0aXZpdHkoZGV2aWNlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBkZXZpY2VSZXBvc2l0b3J5LnVwZGF0ZShkZXZpY2UuaWQsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZGV2aWNlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RW5hYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuc3VjY2VzcygnU3VjY2VzczogJywgJ0FjdGl2aXR5IExvZyBlbmFibGVkLicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGRldmljZS5hY3Rpdml0eUVuYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICB1dGlscy5ub3RpZnkuZXJyb3IoJ0Vycm9yOiAnLCAnRXJyb3IgdXBkYXRpbmcgZGV2aWNlJywgbnVsbCwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldENvbnRyb2woY29udHJvbCkge1xuXG4gICAgICAgICAgICB2bS5hc3NldENoYXJ0Q29uZmlnLnR5cGUgPSBjb250cm9sO1xuXG4gICAgICAgICAgICBzZXR0aW5ncy5jb250cm9sID0gY29udHJvbDtcblxuICAgICAgICAgICAgZGV2aWNlUmVwb3NpdG9yeS5zYXZlRGV2aWNlU2V0dGluZ3Modm0uZGV2aWNlLmlkLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIHZtLmFzc2V0Q2hhcnRDb25maWcucmVmcmVzaENoYXJ0ID0gdHJ1ZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdGltZVNlbGVjdGVkKHRpbWUpIHtcblxuICAgICAgICAgICAgdm0uYXNzZXRDaGFydENvbmZpZy50aW1lU2NhbGUgPSB0aW1lO1xuXG4gICAgICAgICAgICB2bS5hc3NldENoYXJ0Q29uZmlnLnBhZ2UgPSAwO1xuXG4gICAgICAgICAgICBzZXR0aW5ncy50aW1lU2NhbGUgPSB0aW1lO1xuICAgICAgICAgICAgc2V0dGluZ3MucGFnZSA9IDA7XG5cbiAgICAgICAgICAgIGRldmljZVJlcG9zaXRvcnkuc2F2ZURldmljZVNldHRpbmdzKHZtLmRldmljZS5pZCwgc2V0dGluZ3MpO1xuXG4gICAgICAgICAgICB2bS5hc3NldENoYXJ0Q29uZmlnLnJlZnJlc2hDaGFydCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRUaW1lTGFiZWwoKSB7XG5cbiAgICAgICAgICAgIHZhciBsYWJlbCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy50aW1lU2NhbGUgPT09ICcyNGgnKSB7XG5cbiAgICAgICAgICAgICAgICBsYWJlbCA9ICcyNCBob3Vycyc7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNldHRpbmdzLnRpbWVTY2FsZSA9PT0gJzYwbScpIHtcbiAgICAgICAgICAgICAgICBsYWJlbCA9ICcxIGhvdXInO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MudGltZVNjYWxlID09PSAnN2QnKSB7XG5cbiAgICAgICAgICAgICAgICBsYWJlbCA9ICcxIHdlZWsnO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy50aW1lU2NhbGUgPT09ICczMGQnKSB7XG5cbiAgICAgICAgICAgICAgICBsYWJlbCA9ICcxIG1vbnRoJztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MudGltZVNjYWxlICE9PSAnMjRoJyAmJiBzZXR0aW5ncy50aW1lU2NhbGUgIT09ICc2MG0nICYmIHNldHRpbmdzLnRpbWVTY2FsZSAhPT0gJzdkJyAmJiBzZXR0aW5ncy50aW1lU2NhbGUgIT09ICczMGQnKSB7XG5cbiAgICAgICAgICAgICAgICBsYWJlbCA9IHNldHRpbmdzLnRpbWVTY2FsZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbGFiZWw7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7XG4gICAgICAgICAgICB0aGlzLmlzRnVsbHNjcmVlbiA9ICF0aGlzLmlzRnVsbHNjcmVlbjtcbiAgICAgICAgICAgIHZtLmFzc2V0Q2hhcnRDb25maWcucmVmcmVzaENoYXJ0ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNjcm9sbExlZnQoKSB7XG5cbiAgICAgICAgICAgIHZtLmFzc2V0Q2hhcnRDb25maWcucGFnZSsrO1xuXG4gICAgICAgICAgICBzZXR0aW5ncy5wYWdlID0gdm0uYXNzZXRDaGFydENvbmZpZy5wYWdlO1xuXG4gICAgICAgICAgICBkZXZpY2VSZXBvc2l0b3J5LnNhdmVEZXZpY2VTZXR0aW5ncyh2bS5kZXZpY2UuaWQsIHNldHRpbmdzKTtcblxuICAgICAgICAgICAgdm0uYXNzZXRDaGFydENvbmZpZy5yZWZyZXNoQ2hhcnQgPSB0cnVlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzY3JvbGxSaWdodCgpIHtcblxuICAgICAgICAgICAgaWYgKHZtLmFzc2V0Q2hhcnRDb25maWcucGFnZSA+IDApIHtcbiAgICAgICAgICAgICAgICB2bS5hc3NldENoYXJ0Q29uZmlnLnBhZ2UtLTtcblxuICAgICAgICAgICAgICAgIHNldHRpbmdzLnBhZ2UgPSB2bS5hc3NldENoYXJ0Q29uZmlnLnBhZ2U7XG5cbiAgICAgICAgICAgICAgICBkZXZpY2VSZXBvc2l0b3J5LnNhdmVEZXZpY2VTZXR0aW5ncyh2bS5kZXZpY2UuaWQsIHNldHRpbmdzKTtcblxuICAgICAgICAgICAgICAgIHZtLmFzc2V0Q2hhcnRDb25maWcucmVmcmVzaENoYXJ0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2Fzc2V0Q29udHJvbEdyaWQnLCBhc3NldENvbnRyb2xHcmlkKTtcblxuICAgIGZ1bmN0aW9uIGFzc2V0Q29udHJvbEdyaWQoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBBc3NldENvbnRyb2xHcmlkQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGV2aWNlcy9jb250cm9scy9jb250cm9sZ3JpZC5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGFzc2V0czogJz0nLFxuICAgICAgICAgICAgICAgIGdyb3VuZElkOiAnPScsXG4gICAgICAgICAgICAgICAgbW9kZWw6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfVxuXG4gICAgQXNzZXRDb250cm9sR3JpZENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJ3BpblJlcG9zaXRvcnknLCAnYXNzZXRNb2RlbCcsICdHcm91bmRDb250ZXh0J107XG5cbiAgICBmdW5jdGlvbiBBc3NldENvbnRyb2xHcmlkQ29udHJvbGxlcigkc2NvcGUsIHBpblJlcG9zaXRvcnksIEFzc2V0TW9kZWwsIGdyb3VuZENvbnRleHQpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnJlbW92ZUFzc2V0ID0gcmVtb3ZlQXNzZXQ7XG4gICAgICAgIHZtLmlzUGlubmVkID0gaXNQaW5uZWQ7XG4gICAgICAgIHZtLnRvZ2dsZVBpbiA9IHRvZ2dsZVBpbjtcbiAgICAgICAgdm0uYmluZGFibGVBc3NldHMgPSBbXTtcbiAgICAgICAgdm0uY3VycmVudEdyb3VuZCA9IG51bGw7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cbiAgICAgICAgICAgICRzY29wZS5tb2RlbCA9IHZtLm1vZGVsO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uYXNzZXRzJywgZnVuY3Rpb24obmV3QXNzZXRzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIW5ld0Fzc2V0cykge1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3QXNzZXRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0ID0gbmV3QXNzZXRzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgIGFzc2V0Ll9pc1Bpbm5lZCA9IGlzUGlubmVkKGFzc2V0KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZtLmJpbmRhYmxlQXNzZXRzID0gbmV3QXNzZXRzO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uZ3JvdW5kSWQnLCBmdW5jdGlvbihuZXdHcm91bmRJZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKG5ld0dyb3VuZElkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uY3VycmVudEdyb3VuZCA9IGdyb3VuZENvbnRleHQuZmluZChuZXdHcm91bmRJZCk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlQXNzZXQoYXNzZXRJZCkge1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmFzc2V0cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHZtLmFzc2V0c1tpXS5pZCA9PSBhc3NldElkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uYXNzZXRzLnNwbGljZShpLCAxKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzUGlubmVkKGFzc2V0KSB7XG5cbiAgICAgICAgICAgIHJldHVybiBwaW5SZXBvc2l0b3J5LmlzUGlubmVkKHZtLmdyb3VuZElkLCBhc3NldC5pZCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVBpbihhc3NldCkge1xuXG4gICAgICAgICAgICBpZiAoaXNQaW5uZWQoYXNzZXQpKSB7XG5cbiAgICAgICAgICAgICAgICBwaW5SZXBvc2l0b3J5LnVucGluKHZtLmdyb3VuZElkLCBhc3NldCk7XG5cbiAgICAgICAgICAgICAgICBhc3NldC5faXNQaW5uZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmICh2bS5yZW1vdmVPblVucGluKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXNzZXQoYXNzZXQuaWQpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcGluUmVwb3NpdG9yeS5waW4odm0uZ3JvdW5kSWQsIGFzc2V0KTtcblxuICAgICAgICAgICAgICAgIGFzc2V0Ll9pc1Bpbm5lZCA9IHRydWU7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2RldmljZUNvbnRyb2wnLCBkZXZpY2VDb250cm9sKTtcblxuICAgIGRldmljZUNvbnRyb2wuJGluamVjdCA9IFsnJGNvbXBpbGUnXTtcblxuICAgIGZ1bmN0aW9uIGRldmljZUNvbnRyb2woJGNvbXBpbGUpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGV2aWNlOiAnPScsXG4gICAgICAgICAgICAgICAgY29udHJvbDogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnY29udHJvbCcsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGdldENvbnRyb2woc2NvcGUuY29udHJvbCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdHJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lmh0bWwoY3RybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShlbGVtZW50LmNvbnRlbnRzKCkpKHNjb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29udHJvbChjb250cm9sKSB7XG5cbiAgICAgICAgICAgIGlmICghY29udHJvbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gJzx7MH0tZGV2aWNlLWNvbnRyb2wgZGV2aWNlPVwiZGV2aWNlXCI+PC97MH0tZGV2aWNlLWNvbnRyb2w+Jy5mb3JtYXQoY29udHJvbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdhc3NldEdyaWQnLCBhc3NldEdyaWQpO1xuXG4gICAgYXNzZXRHcmlkLiRpbmplY3QgPSBbJ3V0aWxpdHkuZGV2aWNlSWNvbnMnLCAnJGZpbHRlcicsICckc3RhdGUnLCAndXRpbGl0eS5jb21tb24nXTtcblxuICAgIGZ1bmN0aW9uIGFzc2V0R3JpZChpY29ucywgJGZpbHRlciwgJHN0YXRlLCBjb21tb24pIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGV2aWNlcy9jb250cm9scy9ncmlkLmh0bWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBhc3NldHM6ICc9JyxcbiAgICAgICAgICAgICAgICBtb2RlbDogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLmhvd01hbnkgPSAwO1xuXG4gICAgICAgICAgICBzY29wZS5jYXRlZ29yaWVzID0gW3tcbiAgICAgICAgICAgICAgICBuYW1lOiAncHJpbWFyeScsXG4gICAgICAgICAgICAgICAgZXhpc3RzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhc3NldHM6IFtdXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3NlY29uZGFyeScsXG4gICAgICAgICAgICAgICAgZXhpc3RzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhc3NldHM6IFtdXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ21hbmFnZW1lbnQnLFxuICAgICAgICAgICAgICAgIGV4aXN0czogZmFsc2UsXG4gICAgICAgICAgICAgICAgYXNzZXRzOiBbXVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdiYXR0ZXJ5JyxcbiAgICAgICAgICAgICAgICBleGlzdHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFzc2V0czogW11cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnY29uZmlnJyxcbiAgICAgICAgICAgICAgICBleGlzdHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFzc2V0czogW11cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndW5kZWZpbmVkJyxcbiAgICAgICAgICAgICAgICBleGlzdHM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGFzc2V0czogW11cbiAgICAgICAgICAgIH1dO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcmVwYXJlU2VjdGlvbnMoKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjb3BlLmNhdGVnb3JpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2F0ZWdvcmllc1tpXS5hc3NldHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2F0ZWdvcmllc1tpXS5leGlzdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaG93TWFueSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmFzc2V0cykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjb3BlLmFzc2V0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzY29wZS5jYXRlZ29yaWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmFzc2V0c1tpXS5zdHlsZSA9PSBzY29wZS5jYXRlZ29yaWVzW2pdLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2F0ZWdvcmllc1tqXS5leGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jYXRlZ29yaWVzW2pdLmFzc2V0cy5wdXNoKHNjb3BlLmFzc2V0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS5zaG9ydGVuU3RyaW5nID0gZnVuY3Rpb24odmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YodmFsdWUpID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyaW5naWZpZWQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tbW9uLmxpbWl0U3RyaW5nTGVuZ3RoKHN0cmluZ2lmaWVkLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tbW9uLmxpbWl0U3RyaW5nTGVuZ3RoKHZhbHVlLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5nZXRBc3NldEljb24gPSBmdW5jdGlvbihpY29uS2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGljb25LZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGljb25zLmdldEljb24oaWNvbktleSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGljb25zLmdldEljb24oJ2Fzc2V0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuaXNTZWN0aW9uVmlzaWJsZSA9IGZ1bmN0aW9uKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhdGVnb3J5LmV4aXN0cyAmJiAoc2NvcGUuaG93TWFueSA+IDEpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnByZXBhcmVOYW1lRm9yVmlldyA9IGZ1bmN0aW9uKHNlY3Rpb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25OYW1lID09ICdVbmRlZmluZWQnIHx8IHNlY3Rpb25OYW1lID09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25OYW1lID0gJ090aGVyJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VjdGlvbk5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzZWN0aW9uTmFtZS5zbGljZSgxKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmdvVG9Bc3NldCA9IGZ1bmN0aW9uKGFzc2V0SWQpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uYXNzZXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBhc3NldElkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5yZW1vdmVBc3NldCA9IGZ1bmN0aW9uKGFzc2V0SWQpIHtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcGUuYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5hc3NldHNbaV0uaWQgPT0gYXNzZXRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYXNzZXRzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcGUuY2F0ZWdvcmllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHNjb3BlLmNhdGVnb3JpZXNbaV0uYXNzZXRzLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuY2F0ZWdvcmllc1tpXS5hc3NldHNbeV0uaWQgPT0gYXNzZXRJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNhdGVnb3JpZXNbaV0uYXNzZXRzLnNwbGljZSh5LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ2Fzc2V0cycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByZXBhcmVTZWN0aW9ucygpO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY29wZS5jYXRlZ29yaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5jYXRlZ29yaWVzW2ldLmV4aXN0cyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaG93TWFueSsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0ZpcnN0QXBwRGljdGlvbmFyeScsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gWydmaXJzdEFwcFJlcG9zaXRvcnknXTtcblxuICAgIGZ1bmN0aW9uIGZhY3RvcnkoZmlyc3RBcHBSZXBvc2l0b3J5KSB7XG5cbiAgICAgICAgZnVuY3Rpb24gRmlyc3RBcHBEaWN0aW9uYXJ5KCkge1xuXG4gICAgICAgICAgICB0aGlzLnJwaVBhcnRzID0gZmlyc3RBcHBSZXBvc2l0b3J5LmdldFJQSVBhcnRzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuYXJkdWlub1BhcnRzID0gZmlyc3RBcHBSZXBvc2l0b3J5LmdldEFyZHVpbm9QYXJ0cygpO1xuXG4gICAgICAgICAgICB0aGlzWydpbnRlbC1lZGlzb25QYXJ0cyddID0gZmlyc3RBcHBSZXBvc2l0b3J5LmdldEVkaXNvblBhcnRzKCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIEZpcnN0QXBwRGljdGlvbmFyeS5wcm90b3R5cGUuZ2V0SGVhZGVyID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5oZWFkZXI7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdldEFzc2V0ID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5hc3NldDtcbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdldENyZWRlbnRpYWxzID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5jcmVkZW50aWFscztcbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdldFBpbk1vZGVzID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5waW5Nb2RlcztcbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdldENhbGxiYWNrID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5jYWxsYmFjaztcblxuICAgICAgICB9O1xuXG4gICAgICAgIEZpcnN0QXBwRGljdGlvbmFyeS5wcm90b3R5cGUuZ2V0Q29ubmVjdCA9IGZ1bmN0aW9uKGRldmljZVR5cGUpIHtcblxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzW2RldmljZVR5cGUgKyAnUGFydHMnXTtcblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uY29ubmVjdDtcblxuICAgICAgICB9O1xuXG4gICAgICAgIEZpcnN0QXBwRGljdGlvbmFyeS5wcm90b3R5cGUuZ2V0V2hpbGVMb29wID0gZnVuY3Rpb24oZGV2aWNlVHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXNbZGV2aWNlVHlwZSArICdQYXJ0cyddO1xuXG4gICAgICAgICAgICByZXR1cm4gaXRlbS53aGlsZTtcbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdlbmVyYXRlU2NyaXB0ID0gZnVuY3Rpb24oZGV2aWNlLCBhdXRoKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIHNjcmlwdCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2UudHlwZSA9PT0gJ2FyZHVpbm8nKSB7XG5cbiAgICAgICAgICAgICAgICBzY3JpcHQgPSB0aGF0LmdlbmVyYXRlQXJkdWlub1NjcmlwdChkZXZpY2UsIGF1dGgpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRldmljZS50eXBlID09PSAncnBpJykge1xuXG4gICAgICAgICAgICAgICAgc2NyaXB0ID0gdGhhdC5nZW5lcmF0ZVJQSVNjcmlwdChkZXZpY2UsIGF1dGgpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRldmljZS50eXBlID09PSAnaW50ZWwtZWRpc29uJykge1xuXG4gICAgICAgICAgICAgICAgc2NyaXB0ID0gdGhhdC5nZW5lcmF0ZUVkaXNvblNjcmlwdChkZXZpY2UsIGF1dGgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzY3JpcHQ7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmdlbmVyYXRlUlBJU2NyaXB0ID0gZnVuY3Rpb24oZGV2aWNlLCBhdXRoKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIHNjcmlwdCA9ICcnO1xuXG4gICAgICAgICAgICBzY3JpcHQgKz0gdGhhdC5nZXRIZWFkZXIoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICB2YXIgY3JlZGVudGlhbHMgPSB0aGF0LmdldENyZWRlbnRpYWxzKGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBjcmVkZW50aWFscy5yZXBsYWNlKCdERVZJQ0VfSUQnLCBkZXZpY2UuaWQpO1xuICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBjcmVkZW50aWFscy5yZXBsYWNlKCdDTElFTlRfSUQnLCBhdXRoLmNsaWVudElkKTtcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHMucmVwbGFjZSgnQ0xJRU5UX0tFWScsIGF1dGguY2xpZW50S2V5KTtcblxuICAgICAgICAgICAgc2NyaXB0ICs9IGNyZWRlbnRpYWxzO1xuXG4gICAgICAgICAgICB2YXIgYXNzZXQxID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBhc3NldDIgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlLmFzc2V0cy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRldmljZS5hc3NldHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEFzc2V0ID0gZGV2aWNlLmFzc2V0c1tpXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFzc2V0Lm5hbWUgPT09ICdsZWQnICYmIGFzc2V0MSA9PT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldDEgPSBjb25maWd1cmVBc3NldCh0aGF0LmdldEFzc2V0KGRldmljZS50eXBlKSwgY3VycmVudEFzc2V0Lm5hbWUsIGN1cnJlbnRBc3NldC5pcywgNCwgY3VycmVudEFzc2V0LnRpdGxlLCAnZGlnaXRhbCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBc3NldC5uYW1lID09PSAncm90YXJ5X2tub2InICYmIGFzc2V0MiA9PT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldDIgPSBjb25maWd1cmVBc3NldCh0aGF0LmdldEFzc2V0KGRldmljZS50eXBlKSwgY3VycmVudEFzc2V0Lm5hbWUsIGN1cnJlbnRBc3NldC5pcywgMCwgY3VycmVudEFzc2V0LnRpdGxlLCAnYW5hbG9nJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NyaXB0ICs9IGFzc2V0MSArIGFzc2V0MiArIHRoYXQuZ2V0UGluTW9kZXMoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICBzY3JpcHQgKz0gdGhhdC5nZXRDYWxsYmFjayhkZXZpY2UudHlwZSkgKyB0aGF0LmdldENvbm5lY3QoZGV2aWNlLnR5cGUpICsgdGhhdC5nZXRXaGlsZUxvb3AoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICByZXR1cm4gc2NyaXB0O1xuICAgICAgICB9O1xuXG4gICAgICAgIEZpcnN0QXBwRGljdGlvbmFyeS5wcm90b3R5cGUuZ2VuZXJhdGVBcmR1aW5vU2NyaXB0ID0gZnVuY3Rpb24oZGV2aWNlLCBhdXRoKSB7XG5cbiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIHNjcmlwdCA9IG51bGw7XG5cbiAgICAgICAgICAgIHNjcmlwdCA9IHRoYXQuZ2V0SGVhZGVyKGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWxzID0gdGhhdC5nZXRDcmVkZW50aWFscyhkZXZpY2UudHlwZSk7XG5cbiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHMucmVwbGFjZSgnREVWSUNFX0lEJywgZGV2aWNlLmlkKTtcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHMucmVwbGFjZSgnQ0xJRU5UX0lEJywgYXV0aC5jbGllbnRJZCk7XG4gICAgICAgICAgICBjcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzLnJlcGxhY2UoJ0NMSUVOVF9LRVknLCBhdXRoLmNsaWVudEtleSk7XG5cbiAgICAgICAgICAgIHNjcmlwdCArPSBjcmVkZW50aWFscztcblxuICAgICAgICAgICAgc2NyaXB0ICs9IHRoYXQuZ2V0UGluTW9kZXMoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICBzY3JpcHQgKz0gdGhhdC5nZXRDb25uZWN0KGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgc2NyaXB0ICs9IHRoYXQuZ2V0V2hpbGVMb29wKGRldmljZS50eXBlKSArIHRoYXQuZ2V0Q2FsbGJhY2soZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICByZXR1cm4gc2NyaXB0O1xuICAgICAgICB9O1xuXG4gICAgICAgIEZpcnN0QXBwRGljdGlvbmFyeS5wcm90b3R5cGUuZ2VuZXJhdGVFZGlzb25TY3JpcHQgPSBmdW5jdGlvbihkZXZpY2UsIGF1dGgpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgc2NyaXB0ID0gJyc7XG5cbiAgICAgICAgICAgIHNjcmlwdCArPSB0aGF0LmdldEhlYWRlcihkZXZpY2UudHlwZSk7XG5cbiAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IHRoYXQuZ2V0Q3JlZGVudGlhbHMoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICBjcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzLnJlcGxhY2UoJ0RFVklDRV9JRCcsIGRldmljZS5pZCk7XG4gICAgICAgICAgICBjcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzLnJlcGxhY2UoJ0NMSUVOVF9JRCcsIGF1dGguY2xpZW50SWQpO1xuICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBjcmVkZW50aWFscy5yZXBsYWNlKCdDTElFTlRfS0VZJywgYXV0aC5jbGllbnRLZXkpO1xuXG4gICAgICAgICAgICBzY3JpcHQgKz0gY3JlZGVudGlhbHM7XG5cbiAgICAgICAgICAgIHZhciBhc3NldCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChkZXZpY2UuYXNzZXRzLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGV2aWNlLmFzc2V0cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldE5hbWUgPSBkZXZpY2UuYXNzZXRzW2ldLm5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2V0TmFtZVRyYWlsID0gYXNzZXROYW1lLnNsaWNlKC0xKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXROYW1lVHJhaWwgPT09ICc0JyAmJiBhc3NldCA9PT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldCA9IHRoYXQuZ2V0QXNzZXQoZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldCA9IGFzc2V0LnJlcGxhY2UoJ0FDVFVBVE9SX0lEJywgYXNzZXROYW1lVHJhaWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY3JpcHQgKz0gYXNzZXQ7XG5cbiAgICAgICAgICAgIHNjcmlwdCArPSB0aGF0LmdldFBpbk1vZGVzKGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgc2NyaXB0ICs9IHRoYXQuZ2V0Q2FsbGJhY2soZGV2aWNlLnR5cGUpO1xuXG4gICAgICAgICAgICBzY3JpcHQgKz0gdGhhdC5nZXRDb25uZWN0KGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgc2NyaXB0ICs9IHRoYXQuZ2V0V2hpbGVMb29wKGRldmljZS50eXBlKTtcblxuICAgICAgICAgICAgcmV0dXJuIHNjcmlwdDtcbiAgICAgICAgfTtcblxuICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVBc3NldChhc3NldFNjcmlwdCwgYXNzZXROYW1lLCBhc3NldFR5cGUsIHBpbk51bWJlciwgYXNzZXRUaXRsZSwgYXNzZXRNb2RlKSB7XG5cbiAgICAgICAgICAgIGFzc2V0U2NyaXB0ID0gYXNzZXRTY3JpcHQucmVwbGFjZSgnQVNTRVRfTkFNRScsIGFzc2V0TmFtZSk7XG5cbiAgICAgICAgICAgIGFzc2V0U2NyaXB0ID0gYXNzZXRTY3JpcHQucmVwbGFjZShuZXcgUmVnRXhwKCdQSU5fTlVNQkVSJywgJ2cnKSwgcGluTnVtYmVyKTtcblxuICAgICAgICAgICAgYXNzZXRTY3JpcHQgPSBhc3NldFNjcmlwdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ0FTU0VUX1RZUEUnLCAnZycpLCBhc3NldFR5cGUpO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXRNb2RlICE9PSBudWxsICYmIGFzc2V0TW9kZSAhPT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICBhc3NldFNjcmlwdCA9IGFzc2V0U2NyaXB0LnJlcGxhY2UoJ0FTU0VUX01PREUnLCBhc3NldE1vZGUpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgYXNzZXRTY3JpcHQgPSBhc3NldFNjcmlwdC5yZXBsYWNlKCdBU1NFVF9NT0RFJywgJ2RpZ2l0YWwnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFzc2V0VGl0bGUgIT09IG51bGwgJiYgYXNzZXRUaXRsZSAhPT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICBhc3NldFNjcmlwdCA9IGFzc2V0U2NyaXB0LnJlcGxhY2UoJ0FTU0VUX1RJVExFJywgYXNzZXRUaXRsZSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBhc3NldFNjcmlwdCA9IGFzc2V0U2NyaXB0LnJlcGxhY2UoJ0FTU0VUX1RJVExFJywgYXNzZXROYW1lKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFzc2V0U2NyaXB0O1xuXG4gICAgICAgIH1cblxuICAgICAgICBGaXJzdEFwcERpY3Rpb25hcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpcnN0QXBwRGljdGlvbmFyeSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBGaXJzdEFwcERpY3Rpb25hcnk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdmaXJzdEFwcFJlcG9zaXRvcnknLCBGaXJzdEFwcFJlcG8pO1xuXG4gICAgRmlyc3RBcHBSZXBvLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIEZpcnN0QXBwUmVwbygpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcblxuICAgICAgICAgICAgZ2V0UlBJUGFydHM6IGdldFJQSVBhcnRzLFxuICAgICAgICAgICAgZ2V0QXJkdWlub1BhcnRzOiBnZXRBcmR1aW5vUGFydHMsXG4gICAgICAgICAgICBnZXRFZGlzb25QYXJ0czogZ2V0RWRpc29uUGFydHNcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2NyaXB0UGFydHMgPSB7XG5cbiAgICAgICAgICAgIHJwaTogW1xuICAgICAgICAgICAge3RpdGxlOiAnaGVhZGVyJywgY29udGVudDogJ2ltcG9ydCBncm92ZXBpICAjcHJvdmlkZXMgcGluIHN1cHBvcnRcXG5pbXBvcnQgQVRUX0lPVCBhcyBJT1QgICAjcHJvdmlkZSBjbG91ZCBzdXBwb3J0XFxuZnJvbSB0aW1lIGltcG9ydCBzbGVlcCAgI3BhdXNlIHRoZSBhcHBcXG5cXG4nfSxcbiAgICAgICAgICAgIHt0aXRsZTogJ2NyZWRlbnRpYWxzJywgY29udGVudDogJyNjcmVkZW50aWFscyBmb3IgdGhlIEFUVCBJT1QgcGxhdGZvcm0gY29ubmVjdGlvblxcbklPVC5EZXZpY2VJZCA9IFwiREVWSUNFX0lEXCJcXG5JT1QuQ2xpZW50SWQgPSBcIkNMSUVOVF9JRFwiXFxuSU9ULkNsaWVudEtleSA9IFwiQ0xJRU5UX0tFWVwiXFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdhc3NldCcsIGNvbnRlbnQ6ICcjc2V0IEFTU0VUX1RJVExFIHBpbiB0byBBU1NFVF9NT0RFIFBJTl9OVU1CRVIgYW5kIGdldCBpdHMgbmFtZVxcbkFTU0VUX1RZUEVOYW1lID0gXCJBU1NFVF9OQU1FXCIgICNuYW1lIG9mIHRoZSBBU1NFVF9UWVBFXFxuQVNTRVRfVFlQRVBpbiA9IFBJTl9OVU1CRVJcXG5cXG4nfSxcbiAgICAgICAgICAgIHt0aXRsZTogJ3Bpbk1vZGVzJywgY29udGVudDogJyNzZXQgdXAgdGhlIHBpbnMgZm9yIHVzYWdlXFxuZ3JvdmVwaS5waW5Nb2RlKHNlbnNvclBpbixcIklOUFVUXCIpXFxuZ3JvdmVwaS5waW5Nb2RlKGFjdHVhdG9yUGluLFwiT1VUUFVUXCIpXFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdjYWxsYmFjaycsIGNvbnRlbnQ6ICcjY2FsbGJhY2s6IGhhbmRsZXMgdmFsdWVzIHNlbnQgZnJvbSB0aGUgY2xvdWRhcHAgdG8gdGhlIGRldmljZVxcbmRlZiBvbl9tZXNzYWdlKGFzc2V0TmFtZSwgdmFsdWUpOlxcbiAgICBpZiBhc3NldE5hbWUgPT0gYWN0dWF0b3JOYW1lOlxcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5sb3dlcigpICAgICAgICAgICAgICAgICAgICAjbWFrZSBjZXJ0YWluIHRoYXQgdGhlIHZhbHVlIGlzIGluIGxvd2VyIGNhc2UsIGZvciBUcnVlIHZzIHRydWVcXG4gICAgICAgIGlmIHZhbHVlID09IFwidHJ1ZVwiOlxcbiAgICAgICAgICAgIGdyb3ZlcGkuZGlnaXRhbFdyaXRlKGFjdHVhdG9yUGluLCAxKVxcbiAgICAgICAgICAgIElPVC5zZW5kKFwidHJ1ZVwiLCBhY3R1YXRvclBpbikgICAgICAgICNwcm92aWRlIGZlZWRiYWNrIHRvIHRoZSBjbG91ZCB0aGF0IHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc2Z1bFxcbiAgICAgICAgZWxpZiB2YWx1ZSA9PSBcImZhbHNlXCI6XFxuICAgICAgICAgICAgZ3JvdmVwaS5kaWdpdGFsV3JpdGUoYWN0dWF0b3JQaW4sIDApXFxuICAgICAgICAgICAgSU9ULnNlbmQoXCJmYWxzZVwiLCBhY3R1YXRvclBpbikgICAgICAgI3Byb3ZpZGUgZmVlZGJhY2sgdG8gdGhlIGNsb3VkIHRoYXQgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2VzZnVsXFxuICAgICAgICBlbHNlOlxcbiAgICAgICAgICAgIHByaW50KFwidW5rbm93biB2YWx1ZTogXCIgKyB2YWx1ZSlcXG4gICAgZWxzZTpcXG4gICAgICAgIHByaW50KFwidW5rbm93biBhY3R1YXRvcjogXCIgKyBhc3NldE5hbWUpXFxuSU9ULm9uX21lc3NhZ2UgPSBvbl9tZXNzYWdlXFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdjb25uZWN0JywgY29udGVudDogJ0lPVC5jb25uZWN0KCkgICNjb25uZWN0cyB5b3VyIGRldmljZSB0byB0aGUgQVRUIElPVCBwbGF0Zm9ybVxcbklPVC5zdWJzY3JpYmUoKSAgI3N0YXJ0cyB0aGUgYmktZGlyZWN0aW9uYWwgY29tbXVuaWNhdGlvblxcblxcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAnd2hpbGUnLCBjb250ZW50OiAnI21haW4gbG9vcDogcnVuIGFzIGxvbmcgYXMgdGhlIGRldmljZSBpcyB0dXJuZWQgb25cXG53aGlsZSBUcnVlOlxcbiAgICB0cnk6XFxuICAgICAgICAjIFJlYWQgc2Vuc29yIHZhbHVlIGZyb20gcG90ZW50aW9tZXRlclxcbiAgICAgICAgc2Vuc29yX3ZhbHVlID0gZ3JvdmVwaS5hbmFsb2dSZWFkKHNlbnNvclBpbilcXG4gICAgICAgICMgU2VuZCBzZW5zb3IgdmFsdWUgdG8gY2xvdWRcXG4gICAgICAgIElPVC5zZW5kKHNlbnNvcl92YWx1ZSwgc2Vuc29yTmFtZSlcXG4gICAgICAgIHByaW50IChcIlJvdGFyeSBrbm9iIHZhbHVlOiBcIiArIHN0cihzZW5zb3JfdmFsdWUpKVxcbiAgICBleGNlcHQgSU9FcnJvcjpcXG4gICAgICAgIHByaW50IFwiXCInfVxuICAgICAgICAgICAgXSxcblxuICAgICAgICAgICAgYXJkdWlubzogW1xuICAgICAgICAgICAge3RpdGxlOiAnaGVhZGVyJywgY29udGVudDogJyNpbmNsdWRlIDxFdGhlcm5ldC5oPlxcbiNpbmNsdWRlIDxFdGhlcm5ldENsaWVudC5oPlxcbiNpbmNsdWRlIDxQdWJTdWJDbGllbnQuaD5cXG4jaW5jbHVkZSA8QVRUX0lPVC5oPlxcbiNpbmNsdWRlIDxTUEkuaD4gIC8vcmVxdWlyZWQgdG8gaGF2ZSBzdXBwb3J0IGZvciBzaWduZWQvdW5zaWduZWQgbG9uZyB0eXBlLlxcblxcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAnY3JlZGVudGlhbHMnLCBjb250ZW50OiAnY2hhciBkZXZpY2VJZFtdID0gXCJERVZJQ0VfSURcIjtcXG5jaGFyIGNsaWVudElkW10gPSBcIkNMSUVOVF9JRFwiO1xcbmNoYXIgY2xpZW50S2V5W10gPSBcIkNMSUVOVF9LRVlcIjtcXG5ieXRlIG1hY1tdID0gezB4MDAsIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDAsIDB4MDF9OyAgLy9BZGFwdCB0byB5b3VyIEFyZHVpbm8gTUFDIGFkZHJlc3MgaWYgbmVlZGVkXFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdhc3NldCcsIGNvbnRlbnQ6ICcnfSxcbiAgICAgICAgICAgIHt0aXRsZTogJ3Bpbk1vZGVzJywgY29udGVudDogJ2ludCBrbm9iUGluID0gMDsgIC8vIEFuYWxvZyAwIGlzIHRoZSBpbnB1dCBwaW5cXG5pbnQgbGVkUGluID0gNDsgIC8vIFBpbiA0IGlzIHRoZSBMRUQgb3V0cHV0IHBpblxcblxcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAnY2FsbGJhY2snLCBjb250ZW50OiAnLy8gQ2FsbGJhY2sgZnVuY3Rpb246IGhhbmRsZXMgbWVzc2FnZXMgdGhhdCB3ZXJlIHNlbnQgZnJvbSB0aGUgSU9UIHBsYXRmb3JtIHRvIHRoaXMgZGV2aWNlLlxcbnZvaWQgY2FsbGJhY2soY2hhciogdG9waWMsIGJ5dGUqIHBheWxvYWQsIHVuc2lnbmVkIGludCBsZW5ndGgpXFxue1xcbiAgU3RyaW5nIG1zZ1N0cmluZztcXG4gIHtcXG4gICAgY2hhciBtZXNzYWdlX2J1ZmZbbGVuZ3RoICsgMV07ICAvL25lZWQgdG8gY29weSBvdmVyIHRoZSBwYXlsb2FkIHNvIHRoYXQgd2UgY2FuIGFkZCBhIC8wIHRlcm1pbmF0b3IsIHRoaXMgY2FuIHRoZW4gYmUgd3JhcHBlZCBpbnNpZGUgYSBzdHJpbmcgZm9yIGVhc3kgbWFuaXB1bGF0aW9uLlxcbiAgICBzdHJuY3B5KG1lc3NhZ2VfYnVmZiwgKGNoYXIqKXBheWxvYWQsIGxlbmd0aCk7ICAvL2NvcHkgb3ZlciB0aGUgZGF0YVxcbiAgICBtZXNzYWdlX2J1ZmZbbGVuZ3RoXSA9IFxcJ1xcXFwwXFwnOyAgIC8vbWFrZSBjZXJ0YWluIHRoYXQgaXQgZW5kcyB3aXRoIGEgbnVsbFxcblxcbiAgICBtc2dTdHJpbmcgPSBTdHJpbmcobWVzc2FnZV9idWZmKTtcXG4gICAgbXNnU3RyaW5nLnRvTG93ZXJDYXNlKCk7ICAvL3RvIG1ha2UgY2VydGFpbiB0aGF0IG91ciBjb21wYXJpc29uIGxhdGVyIG9uIHdvcmtzIG9rIChpdCBjb3VsZCBiZSB0aGF0IGEgVHJ1ZSBvciBGYWxzZSB3YXMgc2VudClcXG4gIH1cXG5cXG4gIGludCogaWRPdXQgPSBOVUxMO1xcblxcbiAge1xcbiAgICAvLyBnZXQgYXNzZXQgcGluXFxuICAgIGludCBwaW5OciA9IERldmljZS5HZXRQaW5Ocih0b3BpYywgc3RybGVuKHRvcGljKSk7XFxuXFxuICAgIFNlcmlhbC5wcmludChcIlBheWxvYWQ6IFwiKTtcXG4gICAgU2VyaWFsLnByaW50bG4obXNnU3RyaW5nKTtcXG4gICAgU2VyaWFsLnByaW50KFwidG9waWM6IFwiKTtcXG4gICAgU2VyaWFsLnByaW50bG4odG9waWMpO1xcblxcbiAgICBpZiAocGluTnIgPT0gbGVkUGluKVxcbiAgICB7XFxuICAgICAgaWYgKG1zZ1N0cmluZyA9PSBcImZhbHNlXCIpIHtcXG4gICAgICAgIGRpZ2l0YWxXcml0ZShsZWRQaW4sIExPVyk7ICAvL3R1cm4gb2ZmIExFRCBhc3NldFxcbiAgICAgICAgaWRPdXQgPSAmbGVkUGluO1xcbiAgICAgIH1cXG4gICAgICBlbHNlIGlmIChtc2dTdHJpbmcgPT0gXCJ0cnVlXCIpIHtcXG4gICAgICAgIGRpZ2l0YWxXcml0ZShsZWRQaW4sIEhJR0gpOyAgLy90dXJuIG9uIExFRCBhc3NldFxcbiAgICAgICAgaWRPdXQgPSAmbGVkUGluO1xcbiAgICAgIH1cXG4gICAgfVxcbiAgfVxcbiAgaWYoaWRPdXQgIT0gTlVMTClcXG4gICAgRGV2aWNlLlNlbmQobXNnU3RyaW5nLCAqaWRPdXQpO1xcbn1cXG4nIH0sXG4gICAgICAgICAgICB7dGl0bGU6ICdjb25uZWN0JywgY29udGVudDogJy8vcmVxdWlyZWQgZm9yIHRoZSBkZXZpY2UgY29ubmVjdGlvblxcbnZvaWQgY2FsbGJhY2soY2hhciogdG9waWMsIGJ5dGUqIHBheWxvYWQsIHVuc2lnbmVkIGludCBsZW5ndGgpO1xcbmNoYXIgaHR0cFNlcnZlcltdID0gXCJhcGkuc21hcnRsaXZpbmcuaW9cIjtcXG5jaGFyKiBtcXR0U2VydmVyID0gXCJicm9rZXIuc21hcnRsaXZpbmcuaW9cIjtcXG5FdGhlcm5ldENsaWVudCBldGhDbGllbnQ7XFxuUHViU3ViQ2xpZW50IHB1YlN1YihtcXR0U2VydmVyLCAxODgzLCBjYWxsYmFjaywgZXRoQ2xpZW50KTtcXG5BVFREZXZpY2UgRGV2aWNlKGRldmljZUlkLCBjbGllbnRJZCwgY2xpZW50S2V5KTsgIC8vY3JlYXRlIHRoZSBvYmplY3QgdGhhdCBwcm92aWRlcyB0aGUgY29ubmVjdGlvbiB0byB0aGUgY2xvdWQgdG8gbWFuYWdlIHRoZSBkZXZpY2UuXFxuXFxudm9pZCBzZXR1cCgpXFxue1xcbiAgcGluTW9kZShsZWRQaW4sIE9VVFBVVCk7ICAvLyBpbml0aWFsaXplIHRoZSBkaWdpdGFsIHBpbiBhcyBhbiBvdXRwdXQuXFxuICBTZXJpYWwuYmVnaW4oOTYwMCk7ICAvLyBpbml0IHNlcmlhbCBsaW5rIGZvciBkZWJ1Z2dpbmdcXG5cXG4gIGlmIChFdGhlcm5ldC5iZWdpbihtYWMpID09IDApICAvLyBJbml0aWFsaXplIHRoZSBFdGhlcm5ldCBjb25uZWN0aW9uXFxuICB7XFxuICAgIFNlcmlhbC5wcmludGxuKEYoXCJESENQIGZhaWxlZCxlbmRcIikpO1xcbiAgICB3aGlsZSh0cnVlKTsgIC8vd2UgZmFpbGVkIHRvIGNvbm5lY3QsIGhhbHQgZXhlY3V0aW9uIGhlcmUuXFxuICB9XFxuICBkZWxheSgxMDAwKTsgIC8vZ2l2ZSB0aGUgRXRoZXJuZXQgc2hpZWxkIGEgc2Vjb25kIHRvIGluaXRpYWxpemVcXG5cXG4gIHdoaWxlKCFEZXZpY2UuQ29ubmVjdCgmZXRoQ2xpZW50LCBodHRwU2VydmVyKSkgIC8vIGNvbm5lY3QgdGhlIGRldmljZSB3aXRoIHRoZSBJT1QgcGxhdGZvcm1cXG4gICAgU2VyaWFsLnByaW50bG4oXCJyZXRyeWluZ1wiKTtcXG5cXG4gIHdoaWxlKCFEZXZpY2UuU3Vic2NyaWJlKHB1YlN1YikpICAvLyBtYWtlIGNlcnRhaW4gdGhhdCB3ZSBjYW4gcmVjZWl2ZSBtZXNzYWdlIGZyb20gdGhlIGlvdCBwbGF0Zm9ybSAoYWN0aXZhdGUgbXF0dClcXG4gICAgU2VyaWFsLnByaW50bG4oXCJyZXRyeWluZ1wiKTtcXG59XFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICd3aGlsZScsIGNvbnRlbnQ6ICd1bnNpZ25lZCBsb25nIHRpbWU7ICAvL29ubHkgc2VuZCBldmVyeSB4IGFtb3VudCBvZiB0aW1lLlxcbnVuc2lnbmVkIGludCBwcmV2VmFsID0wO1xcbnZvaWQgbG9vcCgpXFxue1xcbiAgdW5zaWduZWQgbG9uZyBjdXJUaW1lID0gbWlsbGlzKCk7XFxuICBpZiAoY3VyVGltZSA+ICh0aW1lICsgMTAwMCkpICAvLyBwdWJsaXNoIGxpZ2h0IHJlYWRpbmcgZXZlcnkgNSBzZWNvbmRzIHRvIHNlbnNvciAxXFxuICB7XFxuICAgIHVuc2lnbmVkIGludCBsaWdodFJlYWQgPSBhbmFsb2dSZWFkKGtub2JQaW4pOyAgLy8gcmVhZCBmcm9tIEtub2Igc2Vuc29yXFxuICAgIGlmKHByZXZWYWwgIT0gbGlnaHRSZWFkKXtcXG4gICAgICBEZXZpY2UuU2VuZChTdHJpbmcobGlnaHRSZWFkKSwga25vYlBpbik7XFxuICAgICAgcHJldlZhbCA9IGxpZ2h0UmVhZDtcXG4gICAgfVxcbiAgICB0aW1lID0gY3VyVGltZTtcXG4gIH1cXG4gIERldmljZS5Qcm9jZXNzKCk7XFxufVxcblxcbid9XG4gICAgICAgICAgICBdLFxuXG4gICAgICAgICAgICAnaW50ZWwtZWRpc29uJzogW1xuICAgICAgICAgICAge3RpdGxlOiAnaGVhZGVyJywgY29udGVudDogJ1xcJ3VzZSBzdHJpY3RcXCc7XFxudmFyIHNtYXJ0bGl2aW5nID0gcmVxdWlyZShcXCdzbWFydGxpdmluZ1xcJyk7XFxudmFyIG1yYWEgPSByZXF1aXJlKFxcJ21yYWFcXCcpOyAvL1dyYXBwZXIgZm9yIEdQSU8gUGluc1xcblxcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAnY3JlZGVudGlhbHMnLCBjb250ZW50OiAnc21hcnRsaXZpbmcuY3JlZGVudGlhbHMgPSB7XFxuICAgIGRldmljZUlkOiBcXCdERVZJQ0VfSURcXCcsXFxuICAgIGNsaWVudElkOiBcXCdDTElFTlRfSURcXCcsXFxuICAgIGNsaWVudEtleTogXFwnQ0xJRU5UX0tFWVxcJ1xcbn07XFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdhc3NldCcsIGNvbnRlbnQ6ICd2YXIgYWN0dWF0b3JJZCA9IFxcJ0FDVFVBVE9SX0lEXFwnO1xcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAncGluTW9kZXMnLCBjb250ZW50OiAndmFyIGEwID0gbmV3IG1yYWEuQWlvKDApOyAvL3NldHVwIGFjY2VzcyBhbmFsb2cgaW5wdXQgQW5hbG9nIHBpbiAjMCAoQTApXFxudmFyIGQ0ID0gbmV3IG1yYWEuR3Bpbyg0KTsgLy9MRUQgaG9va2VkIHVwIHRvIGRpZ2l0YWwgcGluIDRcXG5kNC5kaXIobXJhYS5ESVJfT1VUKTsgLy9zZXQgdGhlIGdwaW8gZGlyZWN0aW9uIHRvIG91dHB1dFxcbnZhciBzdGF0ZSA9IGZhbHNlOyAvL0Jvb2xlYW4gdG8gaG9sZCB0aGUgc3RhdGUgb2YgTGVkXFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICdjYWxsYmFjaycsIGNvbnRlbnQ6ICdmdW5jdGlvbiBhY3R1YXRvckNhbGxiYWNrKCkge1xcbiAgICBkNC53cml0ZShzdGF0ZSA/IDAgOiAxKTsgLy9pZiBzdGF0ZSBpcyB0cnVlIHRoZW4gd3JpdGUgYSAxIChoaWdoKSBvdGhlcndpc2Ugd3JpdGUgYSAwIChsb3cpXFxuICAgIHN0YXRlID0gIXN0YXRlOyAvL2ludmVydCB0aGUgbGVkU3RhdGVcXG59XFxuc21hcnRsaXZpbmcucmVnaXN0ZXJBY3R1YXRvckNhbGxiYWNrKGFjdHVhdG9ySWQsIGFjdHVhdG9yQ2FsbGJhY2spO1xcblxcbid9LFxuICAgICAgICAgICAge3RpdGxlOiAnY29ubmVjdCcsIGNvbnRlbnQ6ICdzbWFydGxpdmluZy5jb25uZWN0KCk7XFxuXFxuJ30sXG4gICAgICAgICAgICB7dGl0bGU6ICd3aGlsZScsIGNvbnRlbnQ6ICdzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xcbiAgICB2YXIgdmFsdWUgPSBhMC5yZWFkKCk7IC8vcmVhZCB0aGUgdmFsdWUgb2YgdGhlIGFuYWxvZyBwaW5cXG4gICAgc21hcnRsaXZpbmcuc2VuZCh2YWx1ZSwgXFwnMFxcJyk7XFxufSwgMzAwMCk7J31cbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBnZXRSUElQYXJ0cygpIHtcblxuICAgICAgICAgICAgdmFyIHBhcnRzID0ge307XG5cbiAgICAgICAgICAgIHZhciBSUEkgPSBzY3JpcHRQYXJ0cy5ycGk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgUlBJLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBwYXJ0c1tSUElbaV0udGl0bGVdID0gUlBJW2ldLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcnRzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRBcmR1aW5vUGFydHMoKSB7XG5cbiAgICAgICAgICAgIHZhciBwYXJ0cyA9IHt9O1xuXG4gICAgICAgICAgICB2YXIgYXJkdWlubyA9IHNjcmlwdFBhcnRzLmFyZHVpbm87XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJkdWluby5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgcGFydHNbYXJkdWlub1tpXS50aXRsZV0gPSBhcmR1aW5vW2ldLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcnRzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRFZGlzb25QYXJ0cygpIHtcblxuICAgICAgICAgICAgdmFyIHBhcnRzID0ge307XG5cbiAgICAgICAgICAgIHZhciBlZGlzb24gPSBzY3JpcHRQYXJ0c1snaW50ZWwtZWRpc29uJ107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWRpc29uLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBwYXJ0c1tlZGlzb25baV0udGl0bGVdID0gZWRpc29uW2ldLmNvbnRlbnQ7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcnRzO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ2Fzc2V0TW9kZWwnLCBBc3NldE1vZGVsRmFjdG9yeSk7XG5cbiAgICBBc3NldE1vZGVsRmFjdG9yeS4kaW5qZWN0ID0gWyd1dGlsaXR5LmRldmljZUljb25zJywgJ3V0aWxzJywgJ21lc3NhZ2luZy5yZWxheSddO1xuXG4gICAgZnVuY3Rpb24gQXNzZXRNb2RlbEZhY3RvcnkoaWNvbnMsIHV0aWxzLCBtZXNzYWdlUmVsYXkpIHtcblxuICAgICAgICBmdW5jdGlvbiBBc3NldE1vZGVsKGRhdGEpIHtcblxuICAgICAgICAgICAgZm9yICh2YXIgYXR0ciBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoYXR0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1thdHRyXSA9IGRhdGFbYXR0cl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIEFzc2V0TW9kZWwucHJvdG90eXBlLmdldEljb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBpY29ucy5nZXRJY29uKHRoaXMuaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEFzc2V0TW9kZWwucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciB1bnN1YnNjcmliZURlbGV0ZSA9IHV0aWxzLiRyb290U2NvcGUuJG9uKCckbWVzc2FnaW5nLmFzc2V0LmRlbGV0ZWQnLCBmdW5jdGlvbihlLCBldmVudERhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlkID09PSBldmVudERhdGEuYXNzZXRJZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kZWxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciB1bnN1YnNjcmliZVN0YXRlID0gdXRpbHMuJHJvb3RTY29wZS4kb24oJyRtZXNzYWdpbmcuYXNzZXQuc3RhdGUnLCBmdW5jdGlvbihlLCBldmVudERhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlkICE9PSBldmVudERhdGEuYXNzZXRJZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGF0LnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuc3RhdGUgPSB7fTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGF0LnN0YXRlLmF0ID0gZXZlbnREYXRhLnBheWxvYWQuQXQ7XG4gICAgICAgICAgICAgICAgdGhhdC5zdGF0ZS52YWx1ZSA9IGV2ZW50RGF0YS5wYXlsb2FkLlZhbHVlO1xuXG4gICAgICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGF0LnN1YnNjcmlwdGlvbnMucHVzaCh1bnN1YnNjcmliZURlbGV0ZSk7XG4gICAgICAgICAgICB0aGF0LnN1YnNjcmlwdGlvbnMucHVzaCh1bnN1YnNjcmliZVN0YXRlKTtcbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldE1vZGVsLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50TmFtZSwgY2FsbGJhY2tGbikge1xuXG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgdW5zdWJzY3JpYmVIYW5kbGVyID0gdXRpbHMuJHJvb3RTY29wZS4kb24oJyRtZXNzYWdpbmcuYXNzZXQuezB9Jy5mb3JtYXQoZXZlbnROYW1lKSwgZnVuY3Rpb24oZSwgZXZlbnREYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pZCAhPT0gZXZlbnREYXRhLmFzc2V0SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRm4oZXZlbnREYXRhLnBheWxvYWQpO1xuICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhhdC5zdWJzY3JpcHRpb25zLnB1c2godW5zdWJzY3JpYmVIYW5kbGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBBc3NldE1vZGVsLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24oc2VuZERhdGEpIHtcblxuICAgICAgICAgICAgbWVzc2FnZVJlbGF5LnB1Ymxpc2hTdGF0ZSh0aGlzLCBzZW5kRGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgQXNzZXRNb2RlbC5wcm90b3R5cGUuc2VuZENvbW1hbmQgPSBmdW5jdGlvbihjb21tYW5kRGF0YSkge1xuXG4gICAgICAgICAgICBtZXNzYWdlUmVsYXkucHVibGlzaENvbW1hbmQodGhpcywgY29tbWFuZERhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEFzc2V0TW9kZWwucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLnN1YnNjcmlwdGlvbnMsIGZ1bmN0aW9uKHVuc3Vic2NyaWJlRm4pIHtcbiAgICAgICAgICAgICAgICB1bnN1YnNjcmliZUZuKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEFzc2V0TW9kZWw7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdDcmVhdGVBc3NldE1vZGVsJywgQ3JlYXRlQXNzZXRNb2RlbEZhY3RvcnkpO1xuXG4gICAgQ3JlYXRlQXNzZXRNb2RlbEZhY3RvcnkuJGluamVjdCA9IFsnYXBpLmFzc2V0c1NlcnZpY2UnXTtcblxuICAgIGZ1bmN0aW9uIENyZWF0ZUFzc2V0TW9kZWxGYWN0b3J5KGFzc2V0c1NlcnZpY2UpIHtcblxuICAgICAgICB2YXIgYXNzZXRUeXBlcyA9IGFzc2V0c1NlcnZpY2UuZ2V0QXNzZXRUeXBlcygpO1xuXG4gICAgICAgIGZ1bmN0aW9uIENyZWF0ZUFzc2V0TW9kZWwoYXNzZXRUeXBlLCBhc3NldE5hbWUpIHtcblxuICAgICAgICAgICAgaWYgKGFzc2V0VHlwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IGFzc2V0VHlwZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gYXNzZXRUeXBlcy5sZW5ndGggPiAwID8gYXNzZXRUeXBlc1swXS50eXBlIDogbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFzc2V0TmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IGFzc2V0TmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIENyZWF0ZUFzc2V0TW9kZWwucHJvdG90eXBlLnNldFR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9O1xuXG4gICAgICAgIENyZWF0ZUFzc2V0TW9kZWwucHJvdG90eXBlLmdldFR5cGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gYXNzZXRUeXBlcztcbiAgICAgICAgfTtcblxuICAgICAgICBDcmVhdGVBc3NldE1vZGVsLnByb3RvdHlwZS5pc1ZhbGlkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnR5cGUgJiYgdGhpcy5uYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBDcmVhdGVBc3NldE1vZGVsO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnZGV2aWNlTW9kZWwnLCBEZXZpY2VNb2RlbEZhY3RvcnkpO1xuXG4gICAgRGV2aWNlTW9kZWxGYWN0b3J5LiRpbmplY3QgPSBbJ3V0aWxpdHkuZGV2aWNlSWNvbnMnLCAndXRpbHMnLCAnYXNzZXRNb2RlbCddO1xuXG4gICAgZnVuY3Rpb24gRGV2aWNlTW9kZWxGYWN0b3J5KGljb25zLCB1dGlscywgQXNzZXRNb2RlbCkge1xuXG4gICAgICAgIGZ1bmN0aW9uIERldmljZU1vZGVsKGRhdGEpIHtcblxuICAgICAgICAgICAgZm9yICh2YXIgYXR0ciBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoYXR0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpc1thdHRyXSA9IGRhdGFbYXR0cl07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NldHNbaV0gPSBuZXcgQXNzZXRNb2RlbCh0aGlzLmFzc2V0c1tpXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgRGV2aWNlTW9kZWwucHJvdG90eXBlLmdldEljb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBpY29ucy5nZXRJY29uKHRoaXMudHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRGV2aWNlTW9kZWwucHJvdG90eXBlLmdldEFzc2V0ID0gZnVuY3Rpb24obmFtZSkge1xuXG4gICAgICAgICAgICB2YXIgZm91bmRBc3NldCA9IG51bGw7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh0aGlzLmFzc2V0cywgZnVuY3Rpb24oYXNzZXQpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXQubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZEFzc2V0ID0gYXNzZXQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmb3VuZEFzc2V0O1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZU1vZGVsLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy50aXRsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZU1vZGVsLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbihpbmNsdWRpbmdBc3NldHMpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgdW5zdWJzY3JpYmVEZWxldGUgPSB1dGlscy4kcm9vdFNjb3BlLiRvbignJG1lc3NhZ2luZy5kZXZpY2UuZGVsZXRlZCcsIGZ1bmN0aW9uKGUsIGV2ZW50RGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoYXQuaWQgPT09IGV2ZW50RGF0YS5kZXZpY2VJZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kZWxldGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciB1bnN1YnNjcmliZUFzc2V0Q3JlYXRlID0gdXRpbHMuJHJvb3RTY29wZS4kb24oJyRtZXNzYWdpbmcuYXNzZXQuY3JlYXRlZCcsIGZ1bmN0aW9uKGUsIGV2ZW50RGF0YSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGFzc2V0ID0gbm9ybWFsaXplUGF5bG9hZERhdGEoZXZlbnREYXRhLnBheWxvYWQuRGF0YSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhhdC5pZCA9PT0gYXNzZXQuZGV2aWNlSWQpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgaXNBc3NldEluQXJyYXkgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXQuYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGF0LmFzc2V0c1tpXS5pZCA9PT0gYXNzZXQuaWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQXNzZXRJbkFycmF5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Fzc2V0SW5BcnJheSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzZXRNb2RlbCA9IG5ldyBBc3NldE1vZGVsKGFzc2V0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRNb2RlbC5zdWJzY3JpYmUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5hc3NldHMucHVzaChhc3NldE1vZGVsKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdXRpbHMuJHJvb3RTY29wZS4kYXBwbHkoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGF0LnN1YnNjcmlwdGlvbnMucHVzaCh1bnN1YnNjcmliZURlbGV0ZSk7XG5cbiAgICAgICAgICAgIGlmIChpbmNsdWRpbmdBc3NldHMpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godGhhdC5hc3NldHMsIGZ1bmN0aW9uKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIERldmljZU1vZGVsLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIHVuc3Vic2NyaWJlSGFuZGxlciA9IHV0aWxzLiRyb290U2NvcGUuJG9uKCckbWVzc2FnaW5nLmRldmljZS57MH0nLmZvcm1hdChldmVudE5hbWUpLCBmdW5jdGlvbihlLCBldmVudERhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGF0LmlkICE9PSBldmVudERhdGEuZGV2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRm4oZXZlbnREYXRhLnBheWxvYWQpO1xuICAgICAgICAgICAgICAgIHV0aWxzLiRyb290U2NvcGUuJGFwcGx5KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhhdC5zdWJzY3JpcHRpb25zLnB1c2godW5zdWJzY3JpYmVIYW5kbGVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBEZXZpY2VNb2RlbC5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godGhhdC5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbih1bnN1YnNjcmliZUZuKSB7XG4gICAgICAgICAgICAgICAgdW5zdWJzY3JpYmVGbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoYXQuc3Vic2NyaXB0aW9ucyA9IFtdO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godGhhdC5hc3NldHMsIGZ1bmN0aW9uKGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgYXNzZXQudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVBheWxvYWREYXRhKHBheWxvYWREYXRhKSB7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge307XG5cbiAgICAgICAgICAgIGZvciAodmFyIGF0dHIgaW4gcGF5bG9hZERhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZERhdGEuaGFzT3duUHJvcGVydHkoYXR0cikpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVt1dGlscy50b0NhbWVsQ2FzZShhdHRyKV0gPSBwYXlsb2FkRGF0YVthdHRyXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIERldmljZU1vZGVsO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnRWRpdERldmljZU1vZGVsJywgRWRpdERldmljZU1vZGVsRmFjdG9yeSk7XG5cbiAgICBFZGl0RGV2aWNlTW9kZWxGYWN0b3J5LiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIEVkaXREZXZpY2VNb2RlbEZhY3RvcnkoKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gRWRpdERldmljZU1vZGVsKG5hbWUsIGRlc2NyaXB0aW9uLCB0aXRsZSkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIGlmICh0aXRsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IG5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaXNFZGl0RW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNhdmVkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gRWRpdERldmljZU1vZGVsO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnZGV2aWNlSG9sZGVyJywgW1xuICAgICAgICAnJGxvZycsXG4gICAgICAgICd1dGlsaXR5LmRldmljZUljb25zJyxcbiAgICAgICAgZnVuY3Rpb24oJGxvZywgZGV2aWNlSWNvbnMpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZURpcmVjdGl2ZUJ5VHlwZShlbGVtZW50LCB0eXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGVsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0UHJpbWFyeUFzc2V0KGFzc2V0cykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXNzZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldHNbaV0uc3R5bGUgPT0gJ3ByaW1hcnknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzZXRzW2ldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL2RldmljZS1ob2xkZXIvdmlldy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBkZXZpY2VEYXRhOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGV2aWNlQ29udGVudCA9IGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLmRldmljZS1jb250ZW50Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coc2NvcGUuZGV2aWNlRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGV2aWNlSGVhZGVySWNvbiA9IGRldmljZUljb25zLmdldEljb24oc2NvcGUuZGV2aWNlRGF0YS5pY29uS2V5KTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucHJpbWFyeUFzc2V0ID0gZ2V0UHJpbWFyeUFzc2V0KHNjb3BlLmRldmljZURhdGEuYXNzZXRzKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZGV2aWNlRGF0YS5jb250cm9sLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZURpcmVjdGl2ZUJ5VHlwZShkZXZpY2VDb250ZW50LCBzY29wZS5kZXZpY2VEYXRhLmNvbnRyb2wudHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdnb29nbGVNYXAnLCBbXG4gICAgICAgICckcScsXG4gICAgICAgICckbG9nJyxcbiAgICAgICAgJyRyb290U2NvcGUnLFxuICAgICAgICAndXRpbGl0eS5nb29nbGVNYXBzJyxcbiAgICAgICAgJ3V0aWxpdHkuZ2VvTG9jYXRpb24nLFxuICAgICAgICBmdW5jdGlvbigkcSwgJGxvZywgJHJvb3RTY29wZSwgZ29vZ2xlTWFwcywgZ2VvTG9jYXRpb24pIHtcbiAgICAgICAgICAgIHZhciBERUZBVUxUX0xPQ0FUSU9OID0ge1xuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiA0NC44MTY2NjY5OTk5OTk5NCxcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IDIwLjQ2NjY2NzAwMDAwMDAzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIENJUkNMRV9XSURUSF9SQVRJTyA9IDIgKiAxLjU7XG5cbiAgICAgICAgICAgIGdvb2dsZU1hcHMuY2F0Y2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignR29vZ2xlIE1hcHMgQVBJIHYzIG5vdCBsb2FkZWQhJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGlyZWN0aXZlcy9nb29nbGUtbWFwL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXAgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VycyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFwWm9vbSA9IDE0O1xuICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXBTZWFyY2ggPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VhcmNoSW5wdXQgPSBhdHRycy5zZWFyY2hTZWxlY3RvciA/IGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKGF0dHJzLnNlYXJjaFNlbGVjdG9yKSA6IGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLm1hcC1zZWFyY2gnKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTaG93IGhpZGRlbiBpbnB1dCBpZiBzZWxlY3RvciBub3QgcHJvdmlkZWRcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoSW5wdXQudHlwZSA9ICd0ZXh0JztcblxuICAgICAgICAgICAgICAgICAgICBzY29wZS5tYXBSZWFkeSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZU1hcHMudGhlbihmdW5jdGlvbihnb29nbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXBTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6b29tOiBtYXBab29tLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoREVGQVVMVF9MT0NBVElPTi5sYXRpdHVkZSwgREVGQVVMVF9MT0NBVElPTi5sb25naXR1ZGUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFR5cGVJZDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZURlZmF1bHRVSTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChlbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoJy5tYXAtY2FudmFzJyksIG1hcFNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFNlYXJjaCA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuU2VhcmNoQm94KHNlYXJjaElucHV0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnYm91bmRzX2NoYW5nZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZU1hcFJhZGl1cygpLnRoZW4oZnVuY3Rpb24oaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFNlYXJjaC5zZXRCb3VuZHMobWFwLmdldEJvdW5kcygpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTWFwQ29vcmRpbmF0ZXMobWUuZ2V0Q2VudGVyKCkubGF0KCksIG1lLmdldENlbnRlcigpLmxuZygpLCBoZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcCwgJ2RyYWdlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZU1hcFJhZGl1cygpLnRoZW4oZnVuY3Rpb24oaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1hcENvb3JkaW5hdGVzKG1lLmdldENlbnRlcigpLmxhdCgpLCBtZS5nZXRDZW50ZXIoKS5sbmcoKSwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXBTZWFyY2gsICdwbGFjZXNfY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbGFjZXMgPSBtYXBTZWFyY2guZ2V0UGxhY2VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxhY2VzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZy5mb3JFYWNoKG1hcmtlcnMsIGZ1bmN0aW9uKG1hcmtlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXIuc2V0TWFwKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggcGxhY2UsIGdldCB0aGUgaWNvbiwgcGxhY2UgbmFtZSwgYW5kIGxvY2F0aW9uLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZy5mb3JFYWNoKHBsYWNlcywgZnVuY3Rpb24ocGxhY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwbGFjZS5pY29uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNzEsIDcxKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMTcsIDM0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDI1LCAyNSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBtYXJrZXIgZm9yIGVhY2ggcGxhY2UuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlcnMucHVzaChuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogaW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogcGxhY2UubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAuZml0Qm91bmRzKGJvdW5kcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxjdWxhdGVNYXBSYWRpdXMoKS50aGVuKGZ1bmN0aW9uKGhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBab29tID0gbWFwLmdldFpvb20oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTWFwQ29vcmRpbmF0ZXMobWFwLmdldENlbnRlcigpLmxhdCgpLCBtYXAuZ2V0Q2VudGVyKCkubG5nKCksIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWFwUmVhZHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cnMuc2V0TG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEdlb0xvY2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVNYXBDb29yZGluYXRlcyhsYXRpdHVkZSwgbG9uZ2l0dWRlLCByYWRpdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBsYWNlLnJhZGl1cyA9IHJhZGl1cztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBsYWNlLmNlbnRlci5sYXRpdHVkZSA9IGxhdGl0dWRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGxhY2UuY2VudGVyLmxvbmdpdHVkZSA9IGxvbmdpdHVkZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kJHBoYXNlIHx8IHNjb3BlLiRhcHBseSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlTWFwUmFkaXVzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlTWFwcy50aGVuKGZ1bmN0aW9uKGdvb2dsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwaGVyaWNhbCA9IGdvb2dsZS5tYXBzLmdlb21ldHJ5LnNwaGVyaWNhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG1hcC5nZXRCb3VuZHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvcjEgPSBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3IyID0gYm91bmRzLmdldFNvdXRoV2VzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgdmFyIGNvcjMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGNvcjIubGF0KCksIGNvcjEubG5nKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29yNCA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoY29yMS5sYXQoKSwgY29yMi5sbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICB2YXIgd2lkdGggPSBzcGhlcmljYWwuY29tcHV0ZURpc3RhbmNlQmV0d2Vlbihjb3IxLCBjb3IzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHNwaGVyaWNhbC5jb21wdXRlRGlzdGFuY2VCZXR3ZWVuKGNvcjEsIGNvcjQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoaGVpZ2h0IC8gQ0lSQ0xFX1dJRFRIX1JBVElPKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ01hcCBub3QgaW5zdGFudGlhdGVkIScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNldEdlb0xvY2F0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlTWFwcy50aGVuKGZ1bmN0aW9uKGdvb2dsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VvTG9jYXRpb24uZ2V0TG9jYXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwLnNldENlbnRlcihuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHJlc3VsdC5jb29yZHMubGF0aXR1ZGUsIHJlc3VsdC5jb29yZHMubG9uZ2l0dWRlKSwgbWFwWm9vbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ0dlbyBsb2NhdGlvbiBub3QgYXZhaWxhYmxlIScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdNYXAgbm90IGluc3RhbnRpYXRlZCEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzY29wZS56b29tSW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAuc2V0Wm9vbShtYXBab29tICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwWm9vbSA9IG1hcC5nZXRab29tKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuem9vbU91dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5zZXRab29tKG1hcFpvb20gLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBab29tID0gbWFwLmdldFpvb20oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3BsYWNlJywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5nLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlTWFwcy50aGVuKGZ1bmN0aW9uKGdvb2dsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAuc2V0Q2VudGVyKG5ldyBnb29nbGUubWFwcy5MYXRMbmcobmV3VmFsdWUuY2VudGVyLmxhdGl0dWRlLCBuZXdWYWx1ZS5jZW50ZXIubG9uZ2l0dWRlKSwgbWFwWm9vbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9ICRyb290U2NvcGUuJG9uKCdwbGFjZXMubWFwOnNldF9nZW9fbG9jYXRpb24nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEdlb0xvY2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCdwbGFjZXMubWFwOnNldF9ib3VuZHMnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFwLmZpdEJvdW5kcyhkYXRhLmJvdW5kcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyT25jZShtYXAsICdpZGxlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwWm9vbSA9IG1hcC5nZXRab29tKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGVNYXBzLnRoZW4oZnVuY3Rpb24oZ29vZ2xlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5jbGVhckxpc3RlbmVycyhtYXAsICdib3VuZHNfY2hhbmdlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5jbGVhckxpc3RlbmVycyhtYXAsICdwbGFjZXNfY2hhbmdlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5jbGVhckxpc3RlbmVycyhtYXAsICdkcmFnZW5kJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdyYW5kb21CYWNrZ3JvdW5kJywgW1xuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJhbmRvbUNvbG9yKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIiNcIiArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIsIDgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZ2V0UmFuZG9tQ29sb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnaW5saW5lRWRpdCcsIFtcbiAgICAgICAgJyR0aW1lb3V0JyxcbiAgICAgICAgZnVuY3Rpb24oJHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHZhciBjbGFzc2VzID0ge1xuICAgICAgICAgICAgICAgIGljb246ICdzbC1zbC1lZGl0JyxcbiAgICAgICAgICAgICAgICBhY3RpdmVDbGFzczogJ2FjdGl2ZScsXG4gICAgICAgICAgICAgICAgZWRpdEJ1dHRvbjogJ2lubGluZS1lZGl0LXJlbmFtZS1idXR0b24nLFxuICAgICAgICAgICAgICAgIGVkaXRJbmRpY2F0b3I6ICdpbmxpbmUtZWRpdC1pbmRpY2F0b3InXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbjogJyYnLFxuICAgICAgICAgICAgICAgICAgICBpc0VuYWJsZWQ6ICc9J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL2lubGluZS1lZGl0L3ZpZXcuaHRtbCcsXG5cbiAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsID0gZWxlbWVudFswXTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb2xkVmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pbnB1dERpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEJ1dHRvbiA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy4nICsgY2xhc3Nlcy5lZGl0QnV0dG9uKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRJbmRpY2F0b3IgPSBlbC5xdWVyeVNlbGVjdG9yKCcuJyArIGNsYXNzZXMuZWRpdEluZGljYXRvcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZWRpdEJ1dHRvbikubW91c2Vkb3duKGVkaXRCdXR0b25DbGljayk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaW5wdXQpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlucHV0RGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICQoaW5wdXQpLmZvY3Vzb3V0KGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJChpbnB1dCkua2V5cHJlc3MoZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRCdXR0b25DbGljaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZm9jdXMoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaW5wdXREaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0QnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNsYXNzZXMuYWN0aXZlQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSAkKGlucHV0KS52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuID0gb2xkVmFsdWUubGVuZ3RoICogMjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGlucHV0KS5mb2N1cygpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2UobGVuLCBsZW4pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBzYXZlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29uZmlybUFjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdW5mb2N1cygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0QnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzZXMuYWN0aXZlQ2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQgJiYgIXNhdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChpbnB1dCkudmFsKG9sZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlucHV0RGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBlZGl0QnV0dG9uQ2xpY2soKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaW5wdXREaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2lzRW5hYmxlZCcsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEJ1dHRvbi5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWRpdEluZGljYXRvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0SW5kaWNhdG9yLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoaW5wdXQpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVkaXRCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEJ1dHRvbi5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0SW5kaWNhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRJbmRpY2F0b3Iuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGlucHV0KS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChlbCkub2ZmKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0QnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChlZGl0QnV0dG9uKS5vZmYoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChpbnB1dCkub2ZmKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ25ld0RldmljZScsIE5ld0RldmljZSk7XG4gICAgTmV3RGV2aWNlLiRpbmplY3QgPSBbJ3V0aWxpdHkuZGV2aWNlSWNvbnMnXTtcblxuICAgIGZ1bmN0aW9uIE5ld0RldmljZShpY29ucykge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGlyZWN0aXZlcy9uZXctZGV2aWNlL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG9uRGV2aWNlQWRkOiAnJicsXG4gICAgICAgICAgICAgICAgb25EZXZpY2VOYW1lQ2hhbmdlOiAnJicsXG4gICAgICAgICAgICAgICAgZGV2aWNlRXJyb3I6ICc9JyxcbiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlOiAnPScsXG4gICAgICAgICAgICAgICAgc2hvd0N1c3RvbTogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGNvbnRyb2xsZXIpIHtcblxuICAgICAgICAgICAgJHNjb3BlLmRldmljZVR5cGUgPSAnYXJkdWlubyc7XG4gICAgICAgICAgICAkc2NvcGUuZGV2aWNlTmFtZSA9IG51bGw7XG4gICAgICAgICAgICB2YXIgY3VzdG9tID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdjdXN0b20nLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdDdXN0b20nLFxuICAgICAgICAgICAgICAgIGljb246ICdzbC1kZXZpY2UtY3VzdG9tJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRlID0gJHNjb3BlLmRldmljZUVycm9yO1xuXG4gICAgICAgICAgICAkc2NvcGUuZGV2aWNlVHlwZXMgPSBbe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdhcmR1aW5vJyxcbiAgICAgICAgICAgICAgICB0ZXh0OiAnQXJkdWlubycsXG4gICAgICAgICAgICAgICAgaWNvbjogJ3NsLWRldmljZS1hcmR1aW5vJ1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdycGknLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdSYXNwYmVycnkgUGknLFxuICAgICAgICAgICAgICAgIGljb246ICdzbC1kZXZpY2UtcnBpJ1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdpbnRlbC1lZGlzb24nLFxuICAgICAgICAgICAgICAgIHRleHQ6ICdJbnRlbCBFZGlzb24nLFxuICAgICAgICAgICAgICAgIGljb246ICdzbC1kZXZpY2UtaW50ZWwtZWRpc29uJ1xuICAgICAgICAgICAgfV07XG4gICAgICAgICAgICBpZigkc2NvcGUuc2hvd0N1c3RvbSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmRldmljZVR5cGVzLnB1c2goY3VzdG9tKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHNjb3BlLnNldERldmljZVR5cGUgPSBmdW5jdGlvbihkZXZpY2VUeXBlKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmRldmljZVR5cGUgPSBkZXZpY2VUeXBlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgJHNjb3BlLmRldmljZUFkZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5vbkRldmljZUFkZCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICRzY29wZS5kZXZpY2VOYW1lLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAkc2NvcGUuZGV2aWNlVHlwZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5kZXZpY2VOYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS5pc0FjdGl2ZURldmljZVR5cGUgPSBmdW5jdGlvbihkVHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkVHlwZSA9PSAkc2NvcGUuZGV2aWNlVHlwZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICRzY29wZS5kZXZpY2VDaGFuZ2VOYW1lID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUub25EZXZpY2VOYW1lQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJHNjb3BlLmRldmljZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICRzY29wZS5kZXZpY2VUeXBlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuZ2V0RGV2aWNlVHlwZUljb24gPSBmdW5jdGlvbihkVHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpY29ucy5nZXRJY29uKGRUeXBlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBlbCA9IGlFbG1bMF07XG4gICAgICAgIH1cbiAgICB9XG59KHdpbmRvdy5hbmd1bGFyKSk7IiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbm90aWZ5Q29udHJvbCcsIE5vdGlmeUNvbnRyb2wpO1xuXG4gICAgTm90aWZ5Q29udHJvbC4kaW5qZWN0ID0gW1xuICAgICAgICAnbm90aWZ5U2VydmljZScsXG4gICAgICAgICckYW5pbWF0ZScsXG4gICAgICAgICckdGltZW91dCcsXG4gICAgICAgICckcm9vdFNjb3BlJ1xuICAgIF07XG5cbiAgICBmdW5jdGlvbiBOb3RpZnlDb250cm9sKG5vdGlmeSwgJGFuaW1hdGUsICR0aW1lb3V0LCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAgLy8zIHNlY29uZHNcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL25vdGlmeS1jb250cm9sL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICBzY29wZToge31cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHZhciBlbCA9IGVsZW1lbnRbMF07XG4gICAgICAgICAgICB2YXIgaGlkZU5vdGlmaWNhdGlvblRpbWVvdXQgPSBudWxsO1xuXG4gICAgICAgICAgICBzY29wZS5pc0Nsb3NlZCA9IHRydWU7XG4gICAgICAgICAgICBzY29wZS5pc1Blcm1hbmVudCA9IGZhbHNlO1xuICAgICAgICAgICAgc2NvcGUudGl0bGUgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUubXNnID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLnR5cGUgPSBudWxsO1xuXG4gICAgICAgICAgICBzY29wZS5jbG9zZSA9IG9uQ2xvc2VkO1xuICAgICAgICAgICAgc2NvcGUub25Nb3VzZU92ZXIgPSBvbk1vdXNlT3ZlcjtcbiAgICAgICAgICAgIHNjb3BlLm9uTW91c2VMZWF2ZSA9IG9uTW91c2VMZWF2ZTtcblxuICAgICAgICAgICAgbm90aWZ5LnN1YnNjcmliZSgnbm90aWZpY2F0aW9uQ29udHJvbCcsIGZ1bmN0aW9uKG5vdGlmaWNhdGlvbkRhdGEpIHtcblxuICAgICAgICAgICAgICAgIHByb2Nlc3NOb3RpZmljYXRpb24obm90aWZpY2F0aW9uRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjbG9zZU5vdGlmaWNhdGlvbigpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uQ2xvc2VkKCkge1xuXG4gICAgICAgICAgICAgICAgY2xvc2VOb3RpZmljYXRpb24oKTtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5jbG9zZUhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2VIYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZU5vdGlmaWNhdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBlbC5xdWVyeVNlbGVjdG9yKCcuYWxlcnQnKTtcblxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGFuaW1hdGUuYWRkQ2xhc3MoY29udGFpbmVyLCAnYWxlcnQtaGlkZGVuJykudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzQ2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBvbk1vdXNlT3ZlcigpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGlkZU5vdGlmaWNhdGlvblRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGhpZGVOb3RpZmljYXRpb25UaW1lb3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uTW91c2VMZWF2ZSgpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLmlzUGVybWFuZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHNldENsb3NlVGltZW91dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc05vdGlmaWNhdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoaGlkZU5vdGlmaWNhdGlvblRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGhpZGVOb3RpZmljYXRpb25UaW1lb3V0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY29wZS50aXRsZSA9IGRhdGEudGl0bGU7XG4gICAgICAgICAgICAgICAgc2NvcGUubXNnID0gZGF0YS5tc2c7XG4gICAgICAgICAgICAgICAgc2NvcGUudHlwZSA9IGRhdGEudHlwZTtcbiAgICAgICAgICAgICAgICBzY29wZS5pc1Blcm1hbmVudCA9IGRhdGEuaXNQZXJtYW5lbnQ7XG4gICAgICAgICAgICAgICAgc2NvcGUuaXNDbG9zZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhLmNsb3NlSGFuZGxlcikge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZUhhbmRsZXIgPSBkYXRhLmNsb3NlSGFuZGxlcjtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd0Nsb3NlQnV0dG9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZUhhbmRsZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zaG93Q2xvc2VCdXR0b24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5hY3Rpb25IYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmFjdGlvbkhhbmRsZXIgPSBkYXRhLmFjdGlvbkhhbmRsZXI7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNob3dBY3Rpb25CdXR0b24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5hY3Rpb25UZXh0ID0gZGF0YS5hY3Rpb25UZXh0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmFjdGlvbkhhbmRsZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zaG93QWN0aW9uQnV0dG9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmFjdGlvblRleHQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghc2NvcGUuaXNQZXJtYW5lbnQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvL2RlbGF5aW5nIHNldHRpbmcgdXAgbW91c2UgbW92ZSBldmVudCBvciAxcyBiZWNhdXNlXG4gICAgICAgICAgICAgICAgICAgIC8vdGhlIG1vdmUgdGhhdCBjYXVzZWQgdGhlIG5vdGlmaWNhdGlvbiBpcyBkZXRlY3RlZCBhcyBtb3ZlbWVudC5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uZSgndG91Y2htb3ZlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0Q2xvc2VUaW1lb3V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub25lKCdtb3VzZW1vdmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDbG9zZVRpbWVvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRDbG9zZVRpbWVvdXQoKSB7XG4gICAgICAgICAgICAgICAgaGlkZU5vdGlmaWNhdGlvblRpbWVvdXQgPSAkdGltZW91dChjbG9zZU5vdGlmaWNhdGlvbiwgc2V0dGluZ3MuZHVyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdzdGF0ZUNvbnRyb2xCdXR0b24nLCBzdGF0ZUNvbnRyb2xCdXR0b24pO1xuXG4gICAgc3RhdGVDb250cm9sQnV0dG9uLiRpbmplY3QgPSBbJyRyb290U2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIHN0YXRlQ29udHJvbEJ1dHRvbigkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6ICdAJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICB2YXIgZXZlbnRBcmdzID0ge1xuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IHNjb3BlLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgc3RhdGU6IGZhbHNlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBlbGVtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBldmVudEFyZ3Muc3RhdGUgPSAhZXZlbnRBcmdzLnN0YXRlO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzdGF0ZUNvbnRyb2xCdXR0b25FdmVudCcsIGV2ZW50QXJncyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1N0YXRlQ29udHJvbENvbnRyb2xsZXInLCBTdGF0ZUNvbnRyb2xDb250cm9sbGVyKTtcblxuICAgIFN0YXRlQ29udHJvbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnc3RhdGVDb250cm9sTWFuYWdlciddO1xuXG4gICAgZnVuY3Rpb24gU3RhdGVDb250cm9sQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsIHN0YXRlQ29udHJvbE1hbmFnZXIsIGVsKSB7XG5cbiAgICAgICAgdmFyIG1vZGlmaWVyQ2xhc3MgPSAkc2NvcGUubW9kaWZpZXJDbGFzcztcbiAgICAgICAgdmFyIG1vcnBoRWwgPSAkKCdbc3RhdGUtY29udHJvbC10eXBlPVwibW9ycGhcIl0nKTtcblxuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XG5cbiAgICAgICAgY3RybC5pZGVudGlmaWVyID0gJHNjb3BlLmlkZW50aWZpZXI7XG4gICAgICAgIGN0cmwuY29udGFpbmVycyA9IFtdO1xuICAgICAgICBjdHJsLnRyaWdnZXJzID0gW107XG4gICAgICAgIGN0cmwubW9ycGhzID0gW107XG4gICAgICAgIGN0cmwucGFyZW50U3RhdGVDb250cm9sSWRlbnRpZmllcnMgPSBbXTtcbiAgICAgICAgY3RybC5yZWdpc3RlckNvbnRhaW5lciA9IHJlZ2lzdGVyQ29udGFpbmVyO1xuICAgICAgICBjdHJsLnJlZ2lzdGVyVHJpZ2dlciA9IHJlZ2lzdGVyVHJpZ2dlcjtcbiAgICAgICAgY3RybC5yZWdpc3Rlck1vcnBoID0gcmVnaXN0ZXJNb3JwaDtcblxuICAgICAgICBjdHJsLnRvZ2dsZSA9IHRvZ2dsZTtcbiAgICAgICAgY3RybC5oaWRlID0gaGlkZTtcblxuICAgICAgICBjdHJsLmFkZFBhcmVudFN0YXRlQ29udHJvbElkID0gYWRkUGFyZW50U3RhdGVDb250cm9sSWQ7XG4gICAgICAgIGN0cmwuZ2V0UGFyZW50U3RhdGVDb250cm9sSWRzID0gZ2V0UGFyZW50U3RhdGVDb250cm9sSWRzO1xuXG4gICAgICAgIHN0YXRlQ29udHJvbE1hbmFnZXIucmVnaXN0ZXIoY3RybCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBzdGF0ZUNvbnRyb2xNYW5hZ2VyLnVucmVnaXN0ZXIoY3RybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3N0YXRlJywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XG5cbiAgICAgICAgICAgIHZhciBpc09sZFZhbHVlVW5kZWZpbmVkID0gdHlwZW9mIG9sZFZhbHVlID09PSAndW5kZWZpbmVkJztcblxuICAgICAgICAgICAgaWYgKCFpc09sZFZhbHVlVW5kZWZpbmVkICYmIChvbGRWYWx1ZSAhPSBuZXdWYWx1ZSkpIHtcblxuICAgICAgICAgICAgICAgIHRvZ2dsZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdzdGF0ZUNvbnRyb2xCdXR0b25FdmVudCcsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKSB7XG5cbiAgICAgICAgICAgIGlmIChhcmdzLmlkZW50aWZpZXIgPT09IGN0cmwuaWRlbnRpZmllcikge1xuXG4gICAgICAgICAgICAgICAgdG9nZ2xlKCk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRnJvbUJleW9uZCgpIHtcblxuICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gZ2V0QWxsRWxlbWVudHNXaXRoQXR0cmlidXRlKCdzdGF0ZS1jb250cm9sLXR5cGUnKTtcblxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsRWxlbWVudHNXaXRoQXR0cmlidXRlKGF0dHJpYnV0ZSkge1xuXG4gICAgICAgICAgICB2YXIgbWF0Y2hpbmdFbGVtZW50cyA9IFtdO1xuICAgICAgICAgICAgdmFyIGFsbEVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBuID0gYWxsRWxlbWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFsbEVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEVsZW1lbnQgZXhpc3RzIHdpdGggYXR0cmlidXRlLiBBZGQgdG8gYXJyYXkuXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoaW5nRWxlbWVudHMucHVzaChhbGxFbGVtZW50c1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hpbmdFbGVtZW50cztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhpZGVNb3JwaCgpIHtcbiAgICAgICAgICAgIGlmIChtb3JwaEVsLmhhc0NsYXNzKG1vZGlmaWVyQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgbW9ycGhFbC5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlKCkge1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLm9uVG9nZ2xlKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm9uVG9nZ2xlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChjdHJsLmNvbnRhaW5lcnMsIGZ1bmN0aW9uKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci50b2dnbGUobW9kaWZpZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwudHJpZ2dlcnMsIGZ1bmN0aW9uKHRyaWdnZXIpIHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyLnRvZ2dsZShtb2RpZmllckNsYXNzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goY3RybC5tb3JwaHMsIGZ1bmN0aW9uKG1vcnBoKSB7XG4gICAgICAgICAgICAgICAgbW9ycGgudG9nZ2xlKG1vZGlmaWVyQ2xhc3MpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGhpZGVNb3JwaCgpO1xuXG4gICAgICAgICAgICBzdGF0ZUNvbnRyb2xNYW5hZ2VyLnJlcG9ydFN0YXRlQ2hhbmdlKGN0cmwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaGlkZSgpIHtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwuY29udGFpbmVycywgZnVuY3Rpb24oY29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmhpZGUobW9kaWZpZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwudHJpZ2dlcnMsIGZ1bmN0aW9uKHRyaWdnZXIpIHtcbiAgICAgICAgICAgICAgICB0cmlnZ2VyLmhpZGUobW9kaWZpZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwubW9ycGhzLCBmdW5jdGlvbihtb3JwaCkge1xuICAgICAgICAgICAgICAgIG1vcnBoLmhpZGUobW9kaWZpZXJDbGFzcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaGlkZU1vcnBoKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlckNvbnRhaW5lcihjb250YWluZXIpIHtcblxuICAgICAgICAgICAgY3RybC5jb250YWluZXJzLnB1c2goY29udGFpbmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVHJpZ2dlcih0cmlnZ2VyKSB7XG5cbiAgICAgICAgICAgIGN0cmwudHJpZ2dlcnMucHVzaCh0cmlnZ2VyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyTW9ycGgobW9ycGgpIHtcblxuICAgICAgICAgICAgY3RybC5tb3JwaHMucHVzaChtb3JwaCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhZGRQYXJlbnRTdGF0ZUNvbnRyb2xJZChwYXJlbnRJZCkge1xuXG4gICAgICAgICAgICBjdHJsLnBhcmVudFN0YXRlQ29udHJvbElkZW50aWZpZXJzLnB1c2gocGFyZW50SWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFyZW50U3RhdGVDb250cm9sSWRzKCkge1xuICAgICAgICAgICAgcmV0dXJuIGN0cmwucGFyZW50U3RhdGVDb250cm9sSWRlbnRpZmllcnM7XG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ3N0YXRlQ29udHJvbE1hbmFnZXInLCBTdGF0ZUNvbnRyb2xNYW5hZ2VyKTtcblxuICAgIFN0YXRlQ29udHJvbE1hbmFnZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZSddO1xuXG4gICAgZnVuY3Rpb24gU3RhdGVDb250cm9sTWFuYWdlcigkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgdmFyIHN0YXRlQ29udHJvbHMgPSBbXTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHJlZ2lzdGVyOiByZWdpc3RlcixcbiAgICAgICAgICAgIHVucmVnaXN0ZXI6IHVucmVnaXN0ZXIsXG4gICAgICAgICAgICByZXBvcnRTdGF0ZUNoYW5nZTogcmVwb3J0U3RhdGVDaGFuZ2VcbiAgICAgICAgfTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChzdGF0ZUNvbnRyb2xzLCBmdW5jdGlvbihzYykge1xuICAgICAgICAgICAgICAgIHNjLmhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlcihzdGF0ZUNvbnRyb2wpIHtcblxuICAgICAgICAgICAgc3RhdGVDb250cm9scy5wdXNoKHN0YXRlQ29udHJvbCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyKHN0YXRlQ29udHJvbCkge1xuXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBzdGF0ZUNvbnRyb2xzLmluZGV4T2Yoc3RhdGVDb250cm9sKTtcbiAgICAgICAgICAgIHN0YXRlQ29udHJvbHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlcG9ydFN0YXRlQ2hhbmdlKHN0YXRlQ29udHJvbCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goc3RhdGVDb250cm9scywgZnVuY3Rpb24oc2MpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2MuaWRlbnRpZmllciAhPSBzdGF0ZUNvbnRyb2wuaWRlbnRpZmllcikge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vbWFrZSBzdXJlIHBhcmVudC1zdGF0ZSBjb250cm9sIGRvZXMgbm90IGNsb3NlXG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1BhcmVudCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRJZHMgPSBzdGF0ZUNvbnRyb2wuZ2V0UGFyZW50U3RhdGVDb250cm9sSWRzKCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFyZW50SWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2MuaWRlbnRpZmllciA9PSBwYXJlbnRJZHNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1BhcmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzUGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzYy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdzdGF0ZUNvbnRyb2xUeXBlJywgU3RhdGVDb250cm9sVHlwZSk7XG5cbiAgICBmdW5jdGlvbiBTdGF0ZUNvbnRyb2xUeXBlKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgcmVxdWlyZTogJ15zdGF0ZUNvbnRyb2wnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnQHN0YXRlQ29udHJvbFR5cGUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGlsZTogZnVuY3Rpb24oZWxtLCBhdHRycywgdHJhbnNjbHVkZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBsaW5rZXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbG0sIGF0dHJzLCBzdGF0ZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIHZhciB0eXBlID0gc2NvcGUudHlwZTtcbiAgICAgICAgICAgIHZhciBzdGF0ZUVsID0gZWxtWzBdO1xuXG4gICAgICAgICAgICBzY29wZS5oaWRlID0gaGlkZTtcbiAgICAgICAgICAgIHNjb3BlLnRvZ2dsZSA9IHRvZ2dsZTtcblxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ3RyaWdnZXInKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVDb250cm9sbGVyLnJlZ2lzdGVyVHJpZ2dlcihzY29wZSk7XG4gICAgICAgICAgICAgICAgJChzdGF0ZUVsKS5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlQ29udHJvbGxlci50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ2NvbnRhaW5lcicpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZUNvbnRyb2xsZXIucmVnaXN0ZXJDb250YWluZXIoc2NvcGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAnbW9ycGgnKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVDb250cm9sbGVyLnJlZ2lzdGVyTW9ycGgoc2NvcGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZSA9PSAnY2xvc2UnKSB7XG4gICAgICAgICAgICAgICAgJChzdGF0ZUVsKS5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlQ29udHJvbGxlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZGUoY2xhc3NOYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAkKHN0YXRlRWwpLnJlbW92ZUNsYXNzKGNsYXNzTmFtZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZShjbGFzc05hbWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUVsLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlRWwuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlRWwuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbmUoJ2NsaWNrJywgZG9jdW1lbnRDbGlja0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbmUoJ2tleXVwJywgZG9jdW1lbnRLZXlVcEhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDbGlja0hhbmRsZXIoZSkge1xuXG4gICAgICAgICAgICAgICAgdmFyICRlbCA9ICQoZS50YXJnZXQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGlzSW5zaWRlU3RhdGVDb250cm9sID0gJGVsLnBhcmVudHMoJ3N0YXRlLWNvbnRyb2wnKS5sZW5ndGggPiAwO1xuXG4gICAgICAgICAgICAgICAgLy9pZiB0cmlnZ2VyIHRvIHRvZ2dsZSBzdGF0ZS1jb250cm9sIGlzIG91dHNpZGUgb2YgdGhlIHN0YXRlLWNvbnRyb2xcbiAgICAgICAgICAgICAgICAvL2l0IGlzIHJlcXVpcmVkIHRvIHNldCAgJ3N0YXRlLWNvbnRyb2wtdHJpZ2dlcicgYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgLy9pbiBvcmRlciB0byBwcmV2ZW50IGRvY3VtZW50LmNsaWNrIHRvIGNsb3NlIHRoZSBzdGF0ZS1jb250cm9sXG4gICAgICAgICAgICAgICAgdmFyIGF0dHIgPSAkZWwuYXR0cignc3RhdGUtY29udHJvbC10b2dnbGVyJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gJGVsLmF0dHIoJ3N0YXRlLWNvbnRyb2wtYnV0dG9uJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNTdGF0ZUNvbnRyb2xUb2dnbGVyID0gdHlwZW9mIGF0dHIgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgYXR0ciAhPT0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNTdGF0ZUNvbnRyb2xCdXR0b24gPSB0eXBlb2YgYnV0dG9uICE9PSB0eXBlb2YgdW5kZWZpbmVkICYmIGJ1dHRvbiAhPT0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNJbnNpZGVTdGF0ZUNvbnRyb2wgfHwgaXNTdGF0ZUNvbnRyb2xUb2dnbGVyIHx8IGlzU3RhdGVDb250cm9sQnV0dG9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub25lKCdjbGljaycsIGRvY3VtZW50Q2xpY2tIYW5kbGVyKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc3RhdGVDb250cm9sbGVyLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50S2V5VXBIYW5kbGVyKGUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlQ29udHJvbGxlci5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAkKHN0YXRlRWwpLm9mZigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnc3RhdGVDb250cm9sJywgU3RhdGVDb250cm9sKTtcblxuICAgIGZ1bmN0aW9uIFN0YXRlQ29udHJvbCgpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTdGF0ZUNvbnRyb2xDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbW9kaWZpZXJDbGFzczogJ0AnLFxuICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6ICdAJyxcbiAgICAgICAgICAgICAgICBzdGF0ZTogJz0/JyxcbiAgICAgICAgICAgICAgICBvblRvZ2dsZTogJyYnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xuXG4gICAgICAgICAgICB2YXIgcGFyZW50U3RhdGVDb250cm9scyA9ICQoZWxlbWVudCkucGFyZW50cygnc3RhdGUtY29udHJvbCcpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmVudFN0YXRlQ29udHJvbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50SWRlbnRpZmllciA9ICQocGFyZW50U3RhdGVDb250cm9sc1tpXSkuYXR0cignaWRlbnRpZmllcicpO1xuICAgICAgICAgICAgICAgIGN0cmwuYWRkUGFyZW50U3RhdGVDb250cm9sSWQocGFyZW50SWRlbnRpZmllcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIlxuKGZ1bmN0aW9uIChuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdzdGF0ZU1vcnBoJyxcbiAgICAgICAgWyckd2luZG93JyxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgkd2luZG93KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGVsZW1lbnRbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9ICQoZWwpLmZpbmQoJ1tzdGF0ZS1jb250cm9sLXR5cGU9XCJ0cmlnZ2VyXCJdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyID0gJChlbCkuZmluZCgnW3N0YXRlLWNvbnRyb2wtdHlwZT1cImNvbnRhaW5lclwiXScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnBoID0gJChlbCkuZmluZCgnW3N0YXRlLWNvbnRyb2wtdHlwZT1cIm1vcnBoXCJdJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZXJDbGFzcyA9ICQoZWwpLmF0dHIoJ21vZGlmaWVyLWNsYXNzJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9IDEwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdHJpZ2dlciBwb3NpdGlvbiBhbmQgc2l6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aCA9IHRyaWdnZXIub3V0ZXJIZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHcgPSB0cmlnZ2VyLm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGwgPSB0cmlnZ2VyLm9mZnNldCgpLmxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR0ID0gdHJpZ2dlci5vZmZzZXQoKS50b3A7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnRhaW5lciBwb3NpdGlvbiBhbmQgc2l6ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdyA9IGNvbnRhaW5lci5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoID0gY29udGFpbmVyLm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsID0gY29udGFpbmVyLm9mZnNldCgpLmxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0ID0gY29udGFpbmVyLm9mZnNldCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnBoLmNzcyh7IHRvcDogdHQgKyAncHgnLCBsZWZ0OiB0bCArICdweCcsIHdpZHRoOiB0dyArICdweCcsIGhlaWdodDp0aCArICdweCd9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnBoLmNzcyh7IHRvcDogY3QgKyAncHgnLCBsZWZ0OiBjbCArICdweCcsIHdpZHRoOiBjdyArICdweCcsIGhlaWdodDpjaCArICdweCd9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRpbWUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbmcuZWxlbWVudCgkd2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1vcnBoLmhhc0NsYXNzKG1vZGlmaWVyQ2xhc3MpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb250YWluZXIgcG9zaXRpb24gYW5kIHNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN3ID0gY29udGFpbmVyLm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoID0gY29udGFpbmVyLm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbCA9IGNvbnRhaW5lci5vZmZzZXQoKS5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3QgPSBjb250YWluZXIub2Zmc2V0KCkudG9wO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcnBoLmNzcyh7IHRvcDogY3QgKyAncHgnLCBsZWZ0OiBjbCArICdweCcsIHdpZHRoOiBjdyArICdweCcsIGhlaWdodDpjaCArICdweCcsIHRyYW5zaXRpb246ICdub25lJ30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1dXG4gICAgKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbiAobmcpIHtcbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgndGFiQ29udHJvbCcsIFtcbiAgICAgICAgJyRsb2cnLFxuXG4gICAgICAgIGZ1bmN0aW9uICgkbG9nKSB7XG4gICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVUYWJzKHRhYnMsIHBhcmVudCkge1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgbmcuZm9yRWFjaCh0YWJzLCBmdW5jdGlvbiAodGFiLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgndGFiLWJ1dHRvbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYi5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbC5pbm5lckhUTUwgPSB0YWIuZ2V0QXR0cmlidXRlKCduYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChlbCk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goZWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzd2l0Y2hUbyhpbmRleCwgdGFiQnV0dG9ucywgdGFicykge1xuICAgICAgICAgICAgICAgIG5nLmZvckVhY2godGFiQnV0dG9ucywgZnVuY3Rpb24gKGJ1dHRvbiwgaSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPSBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYnNbaV0uc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBvblRhYkNsaWNrOiAnJicsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYjogJz0nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGVsZW1lbnRbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhYnMgPSBlbC5xdWVyeVNlbGVjdG9yQWxsKCd0YWItY2hpbGQnKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFiQnV0dG9uc1BhcmVudCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJ3RhYi1jb250cm9sLWhlYWRlcicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFiQnV0dG9ucyA9IGNyZWF0ZVRhYnModGFicywgdGFiQnV0dG9uc1BhcmVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbmcuZm9yRWFjaCh0YWJCdXR0b25zLCBmdW5jdGlvbiAoYnV0dG9uLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChidXR0b24pLmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYWN0aXZlVGFiID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdhY3RpdmVUYWInLCBmdW5jdGlvbiAoY3VyLCBwcmV2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hUbyhjdXIsIHRhYkJ1dHRvbnMsIHRhYnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub25UYWJDbGljaygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmcubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdtb2RhbHMuY29uZmlybUl0ZW1EZWxldGUnLCBDb25maXJtSXRlbURlbGV0ZSk7XG5cbiAgICBDb25maXJtSXRlbURlbGV0ZS4kaW5qZWN0ID0gWyckbW9kYWxJbnN0YW5jZScsICckc3RhdGUnLCAndXRpbHMnLCAnaXRlbScsICdtb2RlbCddO1xuXG4gICAgZnVuY3Rpb24gQ29uZmlybUl0ZW1EZWxldGUoJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgdXRpbHMsIGl0ZW0sIG1vZGVsKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB1dGlscy4kcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xuICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2bS5pdGVtTW9kZWwgPSBpdGVtO1xuXG4gICAgICAgIHZtLm1vZGVsID0gbW9kZWw7XG5cbiAgICAgICAgdm0uc2VsZWN0aW9uID0gZmFsc2U7XG5cbiAgICAgICAgdm0uQ09ORklSTV9ERUxFVElPTl9URVhUID0gJ0RFTEVURSc7XG4gICAgICAgIHZtLmNvbmZpcm1JbnB1dCA9IG51bGw7XG4gICAgICAgIHZtLmVycm9yTXNnID0gbnVsbDtcblxuICAgICAgICB2bS5zZWxlY3RNb2RhbERpc3NtaXNhbCA9IHNlbGVjdE1vZGFsRGlzc21pc2FsO1xuXG4gICAgICAgIHZtLmNvbmZpcm1JdGVtRGVsZXRlID0gY29uZmlybUl0ZW1EZWxldGU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjb25maXJtSXRlbURlbGV0ZShkZXZpY2UpIHtcblxuICAgICAgICAgICAgaWYgKGRldmljZSkge1xuXG4gICAgICAgICAgICAgICAgdm0ubW9kZWwuZGVsZXRlKHZtLml0ZW1Nb2RlbC5kZXZpY2UpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdm0uaXRlbU1vZGVsLmRlbGV0ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5pdGVtTW9kZWwuaGFzT3duUHJvcGVydHkoJ2RldmljZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZ3JvdW5kRGV2aWNlcycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogdm0uaXRlbU1vZGVsLmdyb3VuZElkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5pdGVtTW9kZWwuaGFzT3duUHJvcGVydHkoJ2dhdGV3YXknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmdyb3VuZEdhdGV3YXlzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2bS5pdGVtTW9kZWwuZ3JvdW5kSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZWxlY3RNb2RhbERpc3NtaXNhbCgpIHtcblxuXG4gICAgICAgICAgICB1dGlscy5wcmVmZXJlbmNlcy5yZW1lbWJlckdsb2JhbCgnRGVsZXRlRGV2aWNlTW9kYWxTdGF0dXMnLCB2bS5zZWxlY3Rpb24pO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuICAgIG5nLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignbW9kYWxzLnJ1bGUuT3B0aW9ucycsIFtcbiAgICAgICAgJyRtb2RhbEluc3RhbmNlJyxcbiAgICAgICAgJyRzdGF0ZScsXG4gICAgICAgICdhcGkucnVsZXNTZXJ2aWNlJyxcbiAgICAgICAgJ2FwaS5kZXZpY2VzU2VydmljZScsXG4gICAgICAgICdhcGkuc2VydmljZXNTZXJ2aWNlJyxcbiAgICAgICAgJ25vdGlmeVNlcnZpY2UnLFxuICAgICAgICAndXRpbGl0eS5jb21tb24nLFxuICAgICAgICAnJHEnLFxuICAgICAgICAncnVsZScsXG4gICAgICAgICdzZXJ2aWNlLmRheVRpbWUnLFxuICAgICAgICAnJHJvb3RTY29wZScsXG5cbiAgICAgICAgZnVuY3Rpb24oJG1vZGFsSW5zdGFuY2UsICRzdGF0ZSwgcnVsZXNTZXJ2aWNlLCBkZXZpY2VzU2VydmljZSwgc2VydmljZXNTZXJ2aWNlLCBub3RpZnlTZXJ2aWNlLCBjb21tb24sICRxLCBydWxlLCBkYXlUaW1lLCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2bS5ydWxlID0gcnVsZTtcbiAgICAgICAgICAgIHZtLm5ld1J1bGVOYW1lID0gcnVsZS5uYW1lO1xuICAgICAgICAgICAgdm0uaXNSdWxlRWRpdEVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0uZGVsZXRlT3BlbiA9IHRydWU7XG5cbiAgICAgICAgICAgIHZtLnRvZ2dsZVJ1bGVTdGF0dXMgPSB0b2dnbGVSdWxlU3RhdHVzO1xuICAgICAgICAgICAgdm0udXBkYXRlUnVsZSA9IHVwZGF0ZVJ1bGU7XG4gICAgICAgICAgICB2bS5lZGl0UnVsZUluSlNPTiA9IGVkaXRSdWxlSW5KU09OO1xuICAgICAgICAgICAgdm0uZWRpdFJ1bGVJbldpemFyZCA9IGVkaXRSdWxlSW5XaXphcmQ7XG4gICAgICAgICAgICB2bS52aWV3UnVsZUhpc3RvcnkgPSB2aWV3UnVsZUhpc3Rvcnk7XG4gICAgICAgICAgICB2bS5kZWxldGVSdWxlID0gZGVsZXRlUnVsZTtcbiAgICAgICAgICAgIHZtLmlzRW5hYmxlZCA9IGlzRW5hYmxlZCgpO1xuICAgICAgICAgICAgdm0uaXNEZWZpbml0aW9uTG9hZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5oYXNJc3N1ZXMgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmlzUnVsZVNpbXBsZSA9IG51bGw7XG5cbiAgICAgICAgICAgIHZtLmRlZmluaXRpb25Nb2RlbCA9IHtcbiAgICAgICAgICAgICAgICB3aGVuOiBbXSxcbiAgICAgICAgICAgICAgICB0aGVuOiBbXSxcbiAgICAgICAgICAgICAgICBlbHNlOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdm0uZGVmaW5pdGlvbk1vZGVsLmVsc2UuaXNTZWN0aW9uTG9hZGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHZhciBkZXZpY2VzID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlcyA9IG51bGw7XG4gICAgICAgICAgICB2YXIgcnVsZURlZmluaXRpb24gPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodm0ucnVsZS5kZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgcnVsZURlZmluaXRpb24gPSBKU09OLnBhcnNlKHZtLnJ1bGUuZGVmaW5pdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChkZXZpY2VzU2VydmljZS5nZXRBbGwoKSk7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChzZXJ2aWNlc1NlcnZpY2UuZ2V0QWxsKCkpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFydWxlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChydWxlc1NlcnZpY2UuZ2V0KHJ1bGUuaWQpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkcS5hbGwocHJvbWlzZXMpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcyA9IHJlc3BvbnNlc1swXS5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmljZXMgPSByZXNwb25zZXNbMV0uZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZXNbMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5ydWxlLmRlZmluaXRpb24gPSByZXNwb25zZXNbMl0uZGF0YS5kZWZpbml0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnJ1bGUuZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlRGVmaW5pdGlvbiA9IEpTT04ucGFyc2UocnVsZS5kZWZpbml0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVEZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNSdWxlU2ltcGxlID0gaXNSdWxlU2ltcGxlKHJ1bGVEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAoJ3doZW4nLCBydWxlRGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwKCd0aGVuJywgcnVsZURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcCgnZWxzZScsIHJ1bGVEZWZpbml0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNNaXNzaW5nRGVwZW5kYWJsZXMoKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeVNlcnZpY2UuZXJyb3IoJ0Vycm9yOiAnLCAnUnVsZSAnICsgdm0ucnVsZS5uYW1lICsgJyBoYXMgaXNzdWVzIHdpdGggbWlzc2luZyBhc3NldHMgb3IgZGV2aWNlcy4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzSXNzdWVzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzRGVmaW5pdGlvbkxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdUaGVyZSB3YXMgYW4gZXJyb3IgY29udGFjdGluZyBzZXJ2ZXIuICc7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuZGF0YSAmJiBlcnJvci5kYXRhLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gZXJyb3IuZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmVycm9yKCdFcnJvcjogJywgZXJyb3JNZXNzYWdlLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gbWFwKHNlY3Rpb25OYW1lLCBydWxlRGVmaW5pdGlvbikge1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25WaWV3TW9kZWwgPSB2bS5kZWZpbml0aW9uTW9kZWxbc2VjdGlvbk5hbWVdO1xuXG4gICAgICAgICAgICAgICAgc2VjdGlvblZpZXdNb2RlbC5pc1NlY3Rpb25Mb2FkZWQgPSBjb21tb24ubWFwUnVsZVByZXZpZXdUb1ZpZXdNb2RlbChydWxlRGVmaW5pdGlvbiwgc2VjdGlvbk5hbWUsIHNlY3Rpb25WaWV3TW9kZWwsIGRldmljZXMsIHNlcnZpY2VzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaGFzTWlzc2luZ0RlcGVuZGFibGVzKCkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhc1NlY3Rpb25NaXNzaW5nRGVwZW5kYWJsZXMoJ3doZW4nKSB8fCBoYXNTZWN0aW9uTWlzc2luZ0RlcGVuZGFibGVzKCd0aGVuJykgfHwgaGFzU2VjdGlvbk1pc3NpbmdEZXBlbmRhYmxlcygnZWxzZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBoYXNTZWN0aW9uTWlzc2luZ0RlcGVuZGFibGVzKHNlY3Rpb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlY3Rpb25WaWV3TW9kZWwgPSB2bS5kZWZpbml0aW9uTW9kZWxbc2VjdGlvbk5hbWVdO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25WaWV3TW9kZWwubWlzaW5nTGVmdERldmljZSB8fCBzZWN0aW9uVmlld01vZGVsLm1pc3NpbmdMZWZ0QXNzZXQgfHwgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nUmlnaHREZXZpY2UgfHwgc2VjdGlvblZpZXdNb2RlbC5taXNzaW5nUmlnaHRBc3NldCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVJ1bGVTdGF0dXMoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodm0uaXNFbmFibGVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uaXNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGVzU2VydmljZS5lbmFibGVkKHZtLnJ1bGUuaWQsIGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2VzczogJywgJ1J1bGUgaXMgSWRsZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUuc3RhdHVzID0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdyb290U2NvcGU6cnVsZTpzdGF0dXNDaGFuZ2VkJywge3N0YXR1czogcnVsZS5zdGF0dXMsIGlkOiBydWxlLmlkfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5U2VydmljZS5lcnJvcignRXJyb3I6ICcsICdUaGVyZSB3YXMgYSBwcm9ibGVtIGRpc2FibGluZyB0aGUgUnVsZS4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmlzRW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJ1bGVzU2VydmljZS5lbmFibGVkKHZtLnJ1bGUuaWQsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzOiAnLCAnUnVsZSBpcyBSdW5uaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZS5zdGF0dXMgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ3Jvb3RTY29wZTpydWxlOnN0YXR1c0NoYW5nZWQnLCB7c3RhdHVzOiBydWxlLnN0YXR1cywgaWQ6IHJ1bGUuaWR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmVycm9yKCdFcnJvcjogJywgJ1RoZXJlIHdhcyBhIHByb2JsZW0gZW5hYmxpbmcgdGhlIFJ1bGUuJywgbnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVJ1bGUoKSB7XG5cbiAgICAgICAgICAgICAgICBydWxlc1NlcnZpY2UudXBkYXRlKHZtLnJ1bGUuaWQsIHZtLm5ld1J1bGVOYW1lLCB2bS5ydWxlLmRlc2NyaXB0aW9uLCBKU09OLnBhcnNlKHZtLnJ1bGUuZGVmaW5pdGlvbikpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5U2VydmljZS5zdWNjZXNzKCdTdWNjZXNzOiAnLCAnUnVsZSBVcGRhdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmVycm9yKCdFcnJvcjogJywgJ1RoZXJlIHdhcyBhbiBlcnJvciB1cGRhdGluZyB0aGUgcnVsZS4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVkaXRSdWxlSW5KU09OKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHJ1bGVEZWZpbml0aW9uID0gdm0ucnVsZS5kZWZpbml0aW9uO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJ1bGUuZGVmaW5pdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBydWxlRGVmaW5pdGlvbiA9IEpTT04ucGFyc2Uodm0ucnVsZS5kZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4ucnVsZUVkaXRKU09OJywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdm0ucnVsZS5pZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZWRpdFJ1bGVJbldpemFyZCgpIHtcblxuICAgICAgICAgICAgICAgIHZhciBydWxlRGVmaW5pdGlvbiA9IHZtLnJ1bGUuZGVmaW5pdGlvbjtcblxuICAgICAgICAgICAgICAgIGlmICh2bS5ydWxlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgcnVsZURlZmluaXRpb24gPSBKU09OLnBhcnNlKHZtLnJ1bGUuZGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLnJ1bGVFZGl0V2l6YXJkJywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdm0ucnVsZS5pZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gdmlld1J1bGVIaXN0b3J5KCkge1xuXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLnJ1bGVIaXN0b3J5Jywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdm0ucnVsZS5pZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlUnVsZSgpIHtcblxuICAgICAgICAgICAgICAgIHJ1bGVzU2VydmljZS5kZWxldGUodm0ucnVsZS5pZClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeVNlcnZpY2Uuc3VjY2VzcygnU3VjY2VzczogJywgJ1J1bGUgaXMgZGVsZXRlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5U2VydmljZS5lcnJvcignRXJyb3I6ICcsICdFcnJvciB3aGlsZSBkZWxldGluZyB0aGUgcnVsZS4nLCBudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzRW5hYmxlZCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcnVsZS5zdGF0dXMgPT0gMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaXNSdWxlU2ltcGxlKHJ1bGVEZWZpbml0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNTaW1wbGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJ1bGVEZWZpbml0aW9uLCBmdW5jdGlvbihydWxlU2VjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAocnVsZVNlY3Rpb24uaGFzT3duUHJvcGVydHkoJ3doZW4nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVTZWN0aW9uLndoZW4ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocnVsZVNlY3Rpb24uaGFzT3duUHJvcGVydHkoJ3RoZW4nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVTZWN0aW9uLnRoZW4ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAocnVsZVNlY3Rpb24uaGFzT3duUHJvcGVydHkoJ2Vsc2UnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVTZWN0aW9uLmVsc2UubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzU2ltcGxlO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIF0pO1xufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ21vZGFscy5ydWxlc0F0dGFjaGVkJywgUnVsZXNBdHRhY2hlZCk7XG5cbiAgICBSdWxlc0F0dGFjaGVkLiRpbmplY3QgPSBbJyRtb2RhbEluc3RhbmNlJywgJyRyb290U2NvcGUnLCAnZGV2aWNlJywgJ2FwaS5ydWxlc1NlcnZpY2UnLCAnc2Vzc2lvbiddO1xuXG4gICAgZnVuY3Rpb24gUnVsZXNBdHRhY2hlZCgkbW9kYWxJbnN0YW5jZSwgJHJvb3RTY29wZSwgZGV2aWNlLCBydWxlc1NlcnZpY2UsIHNlc3Npb24pIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmRldmljZU1vZGVsID0gZGV2aWNlO1xuICAgICAgICB2bS5kZXZpY2VSdWxlcyA9IG51bGw7XG4gICAgICAgIHZtLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgdm0ucXVhbnRpdHkgPSAzO1xuICAgICAgICB2bS5wYWdlID0gMDtcbiAgICAgICAgdm0uc2hvd0xvYWRNb3JlID0gZmFsc2U7XG5cbiAgICAgICAgdm0ubG9hZE1vcmUgPSBsb2FkTW9yZTtcbiAgICAgICAgdm0uc3Vic2NyaWJlID0gc3Vic2NyaWJlO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdm0uY3VycmVudFVzZXIgPSBzZXNzaW9uLmdldFVzZXJEZXRhaWxzKCk7XG5cbiAgICAgICAgICAgIHJ1bGVzU2VydmljZS5nZXREZXZpY2VSdWxlcyh2bS5kZXZpY2VNb2RlbC5pZCwgdm0ucXVhbnRpdHkpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5kZXZpY2VSdWxlcyA9IGRhdGEuaXRlbXM7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmRldmljZVJ1bGVzLmxlbmd0aCA9PT0gdm0ucXVhbnRpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dMb2FkTW9yZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uZGV2aWNlUnVsZXMsIGZ1bmN0aW9uKGRldmljZVJ1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZVJ1bGUuc3RlcERlZmluaXRpb25zLnRoZW4udXNlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGV2aWNlUnVsZS5zdGVwRGVmaW5pdGlvbnMudGhlbi51c2VycywgZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5pZCA9PT0gdm0uY3VycmVudFVzZXIuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2VSdWxlLnN0ZXBEZWZpbml0aW9ucy5lbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRldmljZVJ1bGUuc3RlcERlZmluaXRpb25zLmVsc2UudXNlcnMsIGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuaWQgPT09IHZtLmN1cnJlbnRVc2VyLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VSdWxlLmlzQ3VycmVudFVzZXJTdWJzY3JpYmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGRldmljZVJ1bGUpIHtcbiAgICAgICAgICAgIGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQgPSAhZGV2aWNlUnVsZS5pc0N1cnJlbnRVc2VyU3Vic2NyaWJlZDtcblxuICAgICAgICAgICAgdmFyIGFjdGl2ZU5vdGlmaWNhdGlvblJ1bGVzRXhpc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5kZXZpY2VSdWxlcywgZnVuY3Rpb24oZGV2aWNlUnVsZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlTm90aWZpY2F0aW9uUnVsZXNFeGlzdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ2lzVXNlclN1YnNjcmliZWRPblJ1bGUnLCB7XG4gICAgICAgICAgICAgICAgaXNDdXJyZW50VXNlclN1YnNjcmliZWQ6IGFjdGl2ZU5vdGlmaWNhdGlvblJ1bGVzRXhpc3QsXG4gICAgICAgICAgICAgICAgZGV2aWNlSWQ6IHZtLmRldmljZU1vZGVsLmlkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQpIHtcbiAgICAgICAgICAgICAgICBydWxlc1NlcnZpY2Uuc3Vic2NyaWJlT25SdWxlTm90aWZpY2F0aW9ucyhkZXZpY2VSdWxlLmlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcnVsZXNTZXJ2aWNlLnVuc3Vic2NyaWJlRnJvbVJ1bGVOb3RpZmljYXRpb25zKGRldmljZVJ1bGUuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9hZE1vcmUoKSB7XG4gICAgICAgICAgICB2bS5wYWdlKys7XG4gICAgICAgICAgICByZXR1cm4gcnVsZXNTZXJ2aWNlLmdldERldmljZVJ1bGVzKHZtLmRldmljZU1vZGVsLmlkLCB2bS5xdWFudGl0eSwgdm0ucGFnZSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuaXRlbXMubGVuZ3RoIDwgdm0ucXVhbnRpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dMb2FkTW9yZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRhdGEuaXRlbXMsIGZ1bmN0aW9uKGRldmljZVJ1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZVJ1bGUuc3RlcERlZmluaXRpb25zLnRoZW4udXNlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGV2aWNlUnVsZS5zdGVwRGVmaW5pdGlvbnMudGhlbi51c2VycywgZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci5pZCA9PT0gdm0uY3VycmVudFVzZXIuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVJ1bGUuaXNDdXJyZW50VXNlclN1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2VSdWxlLnN0ZXBEZWZpbml0aW9ucy5lbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRldmljZVJ1bGUuc3RlcERlZmluaXRpb25zLmVsc2UudXNlcnMsIGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuaWQgPT09IHZtLmN1cnJlbnRVc2VyLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VSdWxlLmlzQ3VycmVudFVzZXJTdWJzY3JpYmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB2bS5kZXZpY2VSdWxlcyA9IHZtLmRldmljZVJ1bGVzLmNvbmNhdChkYXRhLml0ZW1zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIExvZ2luQ29udHJvbGxlcik7XG5cbiAgICBMb2dpbkNvbnRyb2xsZXIuJGluamVjdCA9IFtcbiAgICAgICAgJyRzdGF0ZScsXG4gICAgICAgICckcm9vdFNjb3BlJyxcbiAgICAgICAgJ25vdGlmeVNlcnZpY2UnLFxuICAgICAgICAnc2Vzc2lvbidcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gTG9naW5Db250cm9sbGVyKCRzdGF0ZSwgJHJvb3RTY29wZSwgbm90aWZ5U2VydmljZSwgc2Vzc2lvbikge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ubG9naW4gPSBsb2dpbjtcblxuICAgICAgICB2bS5sb2dpbkRhdGEgPSB7XG4gICAgICAgICAgICBkZXZpY2VJZDogbnVsbCxcbiAgICAgICAgICAgIHRpY2tldDogbnVsbFxuICAgICAgICB9O1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG5cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9naW4oKSB7XG5cbiAgICAgICAgICAgIGlmIChpc0lucHV0SW5jb21wbGV0ZSgpKSB7XG5cbiAgICAgICAgICAgICAgICBub3RpZnlTZXJ2aWNlLmVycm9yKCdMb2dpbjogJywgJ2RldmljZUlkIGFuZC9vciB0aWNrZXQgbXVzdCBub3QgYmUgZW1wdHknLCBudWxsLCB0cnVlKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuZGV2aWNlSWQgPSB2bS5sb2dpbkRhdGEuZGV2aWNlSWQ7XG5cbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnRpY2tldCA9IHZtLmxvZ2luRGF0YS50aWNrZXQ7XG5cbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4ucXVpY2tEZW1vJyk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzSW5wdXRJbmNvbXBsZXRlKCkge1xuXG4gICAgICAgICAgICByZXR1cm4gdm0ubG9naW5EYXRhLmRldmljZUlkID09PSAnJyB8fCAhdm0ubG9naW5EYXRhLmRldmljZUlkIHx8IHZtLmxvZ2luRGF0YS50aWNrZXQgPT09ICcnIHx8ICF2bS5sb2dpbkRhdGEudGlja2V0O1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSgpKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnSGVhZGVySXRlbU1vZGVsJywgSGVhZGVySXRlbU1vZGVsRmFjdG9yeSk7XG5cbiAgICBIZWFkZXJJdGVtTW9kZWxGYWN0b3J5LiRpbmplY3QgPSBbJyRzdGF0ZScsICckbW9kYWwnLCAndXNlckNvbnRleHQnLCAncGluUmVwb3NpdG9yeSddO1xuXG4gICAgZnVuY3Rpb24gSGVhZGVySXRlbU1vZGVsRmFjdG9yeSgkc3RhdGUsICRtb2RhbCwgdXNlckNvbnRleHQsIHBpblJlcG9zaXRvcnkpIHtcblxuICAgICAgICBmdW5jdGlvbiBIZWFkZXJJdGVtTW9kZWwoKSB7XG5cbiAgICAgICAgICAgIHRoaXMuc2hvd0RldGFpbHMgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaWNvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnRhZ0ljb25zID0gW107XG4gICAgICAgICAgICB0aGlzLnRpdGxlTGV0dGVySWNvbkNsYXNzID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudXNlVGl0bGVMZXR0ZXJBc0ljb24gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmhhc0RldGFpbHMgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZGV0YWlscyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmRldGFpbHNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGFncyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5pbmZvID0gW107XG4gICAgICAgICAgICB0aGlzLmJveEFjdGlvbnMgPSBbXTtcbiAgICAgICAgICAgIHRoaXMudmlzaWJpbGl0eSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnNob3dTdWJzY3JpYmVJbmRpY2F0b3IgPSBmYWxzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgSGVhZGVySXRlbU1vZGVsLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbih0aXRsZSwgZGV0YWlscykge1xuXG4gICAgICAgICAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5kZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYXNEZXRhaWxzID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYXNEZXRhaWxzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgSGVhZGVySXRlbU1vZGVsLnByb3RvdHlwZS50b2dnbGVEZXRhaWxzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHRoaXMuZGV0YWlsc0FjdGl2ZSA9ICF0aGlzLmRldGFpbHNBY3RpdmU7XG5cbiAgICAgICAgfTtcblxuICAgICAgICBIZWFkZXJJdGVtTW9kZWwucHJvdG90eXBlLnJlcGxhY2VJbmZvID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaW5mby5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5mb1tpXS5uYW1lID09PSBrZXkpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9baV0udmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIEhlYWRlckl0ZW1Nb2RlbC5mcm9tRGV2aWNlID0gZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBIZWFkZXJJdGVtTW9kZWwoKTtcblxuICAgICAgICAgICAgbW9kZWwudGl0bGUgPSBkZXZpY2UuZ2V0VGl0bGUoKTtcblxuICAgICAgICAgICAgbW9kZWwuaWQgPSBkZXZpY2UuaWQ7XG5cbiAgICAgICAgICAgIG1vZGVsLmRldmljZSA9IGRldmljZTtcblxuICAgICAgICAgICAgaWYgKGRldmljZS5ncm91bmQpIHtcblxuICAgICAgICAgICAgICAgIG1vZGVsLnZpc2liaWxpdHkgPSBkZXZpY2UuZ3JvdW5kLnZpc2liaWxpdHk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZS50eXBlICE9PSAncXVpY2stZGVtbycpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5zaG93U2V0dXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG1vZGVsLnNob3dTdGF0dXMgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5zaG93U2V0dXAgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG1vZGVsLnNob3dTdGF0dXMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb2RlbC5iYWNrVGV4dCA9ICdCYWNrIHRvIERldmljZXMnO1xuICAgICAgICAgICAgbW9kZWwuc3RhdGVDb250cm9sSWRlbnRpZmllciA9ICdkZXZpY2UtZGV0YWlscyc7XG5cbiAgICAgICAgICAgIG1vZGVsLmJhY2tSb3V0ZSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBtb2RlbC52aXNpYmlsaXR5ID09PSAncGVyc29uYWwnID8gJ21haW4uZGV2aWNlcycgOiAnbWFpbi5ncm91bmREZXZpY2VzJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBkZXZpY2UuZ3JvdW5kSWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBtb2RlbC5pY29uID0gZGV2aWNlLmdldEljb24oKTtcbiAgICAgICAgICAgIG1vZGVsLmhhc0RldGFpbHMgPSBkZXZpY2UuZGVzY3JpcHRpb24gPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICBtb2RlbC5kZXRhaWxzID0gZGV2aWNlLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgbW9kZWwubm90aWZpY2F0aW9uc0FjdGl2ZSA9IGRldmljZS5oYXNOb3RpZmljYXRpb25SdWxlcztcbiAgICAgICAgICAgIG1vZGVsLmF0dGFjaGVkUnVsZXMgPSBkZXZpY2UuaGFzUnVsZXM7XG5cbiAgICAgICAgICAgIGlmIChtb2RlbC5hdHRhY2hlZFJ1bGVzID09PSB0cnVlKSB7XG5cbiAgICAgICAgICAgICAgICBtb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1wZW4tb3V0bGluZSBjbGlja2FibGUnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0NsaWNrIHRvIHZpZXcgcnVsZXMgYXNzb2NpYXRlZCB0byB0aGlzIGRldmljZScsXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL21vZGFscy9ydWxlc19hdHRhY2hlZC92aWV3Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbHMucnVsZXNBdHRhY2hlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBtb2RlbDtcbiAgICAgICAgfTtcblxuICAgICAgICBIZWFkZXJJdGVtTW9kZWwuZnJvbUdyb3VuZCA9IGZ1bmN0aW9uKGdyb3VuZCkge1xuXG4gICAgICAgICAgICB2YXIgbW9kZWwgPSBuZXcgSGVhZGVySXRlbU1vZGVsKCk7XG4gICAgICAgICAgICBtb2RlbC50aXRsZSA9IGdyb3VuZC50aXRsZTtcbiAgICAgICAgICAgIG1vZGVsLmlkID0gZ3JvdW5kLmlkO1xuICAgICAgICAgICAgbW9kZWwuYmFja1RleHQgPSAnQmFjayB0byBHcm91bmRzJztcbiAgICAgICAgICAgIG1vZGVsLmJhY2tSb3V0ZSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbWFpbi5lbnZpcm9ubWVudCdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG1vZGVsLnVzZVRpdGxlTGV0dGVyQXNJY29uID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vZGVsLnRpdGxlTGV0dGVySWNvbkNsYXNzID0gZ3JvdW5kLmNvbG9yO1xuXG4gICAgICAgICAgICBtb2RlbC5oYXNEZXRhaWxzID0gZ3JvdW5kLmRlc2NyaXB0aW9uID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgbW9kZWwuZGV0YWlscyA9IGdyb3VuZC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIG1vZGVsLnNob3dTdWJzY3JpYmVJbmRpY2F0b3IgPSB0cnVlO1xuICAgICAgICAgICAgbW9kZWwubWVtYmVyQ291bnQgPSBncm91bmQubWVtYmVyQ291bnQ7XG4gICAgICAgICAgICBtb2RlbC5kZXZpY2VDb3VudCA9IGdyb3VuZC5kZXZpY2VDb3VudDtcbiAgICAgICAgICAgIG1vZGVsLmdhdGV3YXlDb3VudCA9IGdyb3VuZC5nYXRld2F5Q291bnQ7XG5cbiAgICAgICAgICAgIGlmIChtb2RlbC5oYXNEZXRhaWxzKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwuZGV0YWlsc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1vZGVsLnNob3dTZXR1cCA9IGZhbHNlO1xuICAgICAgICAgICAgbW9kZWwuc2hvd1N0YXR1cyA9IGZhbHNlO1xuXG4gICAgICAgICAgICB2YXIgdXNlcklkID0gdXNlckNvbnRleHQudXNlci5pZDtcblxuICAgICAgICAgICAgaWYgKGdyb3VuZC5vd25lcklkID09PSB1c2VySWQpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1mYWNlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdZb3UgYXJlIG93bmVyIG9mIHRoaXMgZ3JvdW5kJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9kZWwuZ2F0ZXdheUNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIG1vZGVsLnRhZ0ljb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3NsLWdhdGV3YXktZmlsbCBjbGlja2FibGUnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogbW9kZWwuZ2F0ZXdheUNvdW50ICsgKChtb2RlbC5nYXRld2F5Q291bnQgPT09IDEpID8gJyBnYXRld2F5ICcgOiAnIGdhdGV3YXlzICcpICsgJ2luIHRoaXMgZ3JvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IG1vZGVsLmdhdGV3YXlDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5ncm91bmRHYXRld2F5cycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbW9kZWwuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtb2RlbC5kZXZpY2VDb3VudCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwudGFnSWNvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiAnc2wtZGV2aWNlcy1maWxsIGNsaWNrYWJsZScsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBtb2RlbC5kZXZpY2VDb3VudCArICgobW9kZWwuZGV2aWNlQ291bnQgPT09IDEpID8gJyBkZXZpY2UgJyA6ICcgZGV2aWNlcyAnKSArICdpbiB0aGlzIGdyb3VuZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiBtb2RlbC5kZXZpY2VDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5ncm91bmREZXZpY2VzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBtb2RlbC5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1vZGVsLm1lbWJlckNvdW50ID49IDApIHtcbiAgICAgICAgICAgICAgICBtb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1tZW1iZXJzLWZpbGwgY2xpY2thYmxlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG1vZGVsLm1lbWJlckNvdW50ICsgKChtb2RlbC5tZW1iZXJDb3VudCA9PT0gMSkgPyAnIG1lbWJlciAnIDogJyBtZW1iZXJzICcpICsgJ2NvbnRyaWJ1dGluZyB0aGlzIGdyb3VuZCcsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiBtb2RlbC5tZW1iZXJDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5ncm91bmRNZW1iZXJzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBtb2RlbC5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICB9O1xuXG4gICAgICAgIEhlYWRlckl0ZW1Nb2RlbC5mcm9tQXNzZXQgPSBmdW5jdGlvbihhc3NldCwgb3duZXIsIG93bmVyVHlwZSwgZ3JvdW5kKSB7XG4gICAgICAgICAgICB2YXIgbW9kZWwgPSBuZXcgSGVhZGVySXRlbU1vZGVsKCk7XG5cbiAgICAgICAgICAgIG1vZGVsLmhlYWRlciA9ICdhc3NldCc7XG4gICAgICAgICAgICBtb2RlbC50aXRsZSA9IGFzc2V0LnRpdGxlO1xuICAgICAgICAgICAgbW9kZWwuaWQgPSBhc3NldC5pZDtcbiAgICAgICAgICAgIG1vZGVsLmJhY2tUZXh0ID0gJ0JhY2sgdG8gJyArIG93bmVyLnRpdGxlO1xuICAgICAgICAgICAgbW9kZWwuYmFja1JvdXRlID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IG93bmVyVHlwZSA9PT0gJ0RldmljZScgPyAnbWFpbi5kZXZpY2UnIDogJ21haW4uZ2F0ZXdheScsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpZDogb3duZXIuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbW9kZWwuaWNvbiA9IGFzc2V0LmdldEljb24oKTtcbiAgICAgICAgICAgIG1vZGVsLmhhc0RldGFpbHMgPSBmYWxzZTtcbiAgICAgICAgICAgIG1vZGVsLmluZm8ucHVzaCh7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0YXRlJyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogYXNzZXQuc3RhdGUgPyBhc3NldC5zdGF0ZS52YWx1ZSA6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kZWwudGFncy5wdXNoKHtcbiAgICAgICAgICAgICAgICBjc3NDbGFzczogJ3RhZy0nICsgYXNzZXQuaXMsXG4gICAgICAgICAgICAgICAgdGV4dDogYXNzZXQuaXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kZWwudGFncy5wdXNoKHtcbiAgICAgICAgICAgICAgICBjc3NDbGFzczogJ3RhZy1saWdodC1ncmF5JyxcbiAgICAgICAgICAgICAgICB0ZXh0OiBhc3NldC5wcm9maWxlLnR5cGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RlbC5zaG93U2V0dXAgPSBmYWxzZTtcbiAgICAgICAgICAgIG1vZGVsLnNob3dTdGF0dXMgPSBmYWxzZTtcblxuICAgICAgICAgICAgaWYgKGdyb3VuZCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGlzUGlubmVkID0gcGluUmVwb3NpdG9yeS5pc1Bpbm5lZChvd25lci5ncm91bmRJZCwgYXNzZXQuaWQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBpblRvR3JvdW5kQWN0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUGlubmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaW5SZXBvc2l0b3J5LnVucGluKG93bmVyLmdyb3VuZElkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGluVG9Hcm91bmRBY3Rpb24udGl0bGUgPSAnUGluIHRvICcgKyBncm91bmQudGl0bGUgKyAnIGJvYXJkJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaW5Ub0dyb3VuZEFjdGlvbi5jc3NDbGFzcyA9ICdncmlkLWJveC1idG4gc2wtcGluLW91dGxpbmUgc2Vjb25kYXJ5LWFjdGlvbic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQaW5uZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpblJlcG9zaXRvcnkucGluKG93bmVyLmdyb3VuZElkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGluVG9Hcm91bmRBY3Rpb24udGl0bGUgPSAnUGlubmVkIHRvICcgKyBncm91bmQudGl0bGUgKyAnIGJvYXJkJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaW5Ub0dyb3VuZEFjdGlvbi5jc3NDbGFzcyA9ICdncmlkLWJveC1idG4gc2wtcGluIHNlY29uZGFyeS1hY3Rpb24gdmlzaWJsZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQaW5uZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpc1Bpbm5lZCA/ICdQaW5uZWQgdG8gJyArIGdyb3VuZC50aXRsZSArICcgYm9hcmQnIDogJ1BpbiB0byAnICsgZ3JvdW5kLnRpdGxlICsgJyBib2FyZCcsXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiBpc1Bpbm5lZCA/ICdncmlkLWJveC1idG4gc2wtcGluIHNlY29uZGFyeS1hY3Rpb24gdmlzaWJsZScgOiAnZ3JpZC1ib3gtYnRuIHNsLXBpbi1vdXRsaW5lIHNlY29uZGFyeS1hY3Rpb24nXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIG1vZGVsLmJveEFjdGlvbnMucHVzaChwaW5Ub0dyb3VuZEFjdGlvbik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICB9O1xuXG4gICAgICAgIEhlYWRlckl0ZW1Nb2RlbC5mcm9tR2F0ZXdheSA9IGZ1bmN0aW9uKGdhdGV3YXkpIHtcblxuICAgICAgICAgICAgdmFyIG1vZGVsID0gbmV3IEhlYWRlckl0ZW1Nb2RlbCgpO1xuICAgICAgICAgICAgbW9kZWwudGl0bGUgPSBnYXRld2F5LmdldFRpdGxlKCk7XG4gICAgICAgICAgICBtb2RlbC5pZCA9IGdhdGV3YXkuaWQ7XG4gICAgICAgICAgICBtb2RlbC5iYWNrVGV4dCA9ICdCYWNrIHRvIEdhdGV3YXlzJztcbiAgICAgICAgICAgIG1vZGVsLmJhY2tSb3V0ZSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbWFpbi5ncm91bmRHYXRld2F5cycsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBpZDogZ2F0ZXdheS5ncm91bmRJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtb2RlbC5pY29uID0gZ2F0ZXdheS5nZXRJY29uKCk7XG4gICAgICAgICAgICBtb2RlbC5oYXNEZXRhaWxzID0gZ2F0ZXdheS5kZXNjcmlwdGlvbiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIG1vZGVsLmRldGFpbHMgPSBnYXRld2F5LmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgbW9kZWwuaW5mby5wdXNoKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnaWQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBnYXRld2F5LmlkXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG1vZGVsLmhhc0RldGFpbHMpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5kZXRhaWxzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbW9kZWwuc2hvd1NldHVwID0gZmFsc2U7XG4gICAgICAgICAgICBtb2RlbC5zaG93U3RhdHVzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIG1vZGVsLmJveEFjdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5nYXRld2F5X2RldmljZXMnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZ2F0ZXdheS5pZFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgdGV4dDogJ3ZpZXcgZGV2aWNlcycsXG5cbiAgICAgICAgICAgICAgICBjc3NDbGFzczogJ21haW4tYnV0dG9uIGxpZ2h0LWJ0bidcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbW9kZWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEhlYWRlckl0ZW1Nb2RlbDtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnc2xIZWFkZXJJdGVtJywgc2xIZWFkZXJJdGVtKTtcblxuICAgIGZ1bmN0aW9uIHNsSGVhZGVySXRlbSgpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC93aWRnZXRzL2l0ZW1faGVhZGVyL2l0ZW0taGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbW9kZWw6ICc9JyxcbiAgICAgICAgICAgICAgICB0b2dnbGVBY3Rpb246ICcmJyxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogJyYnLFxuICAgICAgICAgICAgICAgIGNvbmZpZzogJ0AnLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG5cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckcGFyc2UnXTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHN0YXRlLCAkcGFyc2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmdvQmFjayA9IGdvQmFjaztcblxuICAgICAgICB2bS5jb25maWd1cmF0aW9uID0ge1xuICAgICAgICAgICAgaGlkZUFjdGlvbnM6IGZhbHNlXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHZtLmNvbmZpZykge1xuXG4gICAgICAgICAgICB2bS5jb25maWd1cmF0aW9uID0gJHBhcnNlKHZtLmNvbmZpZykoKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29CYWNrKCkge1xuXG4gICAgICAgICAgICBpZiAodm0ubW9kZWwudmlzaWJpbGl0eSA9PT0gJ3BlcnNvbmFsJykge1xuXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmRldmljZXMnKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbyh2bS5tb2RlbC5iYWNrUm91dGUubmFtZSwgdm0ubW9kZWwuYmFja1JvdXRlLmRhdGEpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ3NsLmxpc3RIZWFkZXInLCBMaXN0SGVhZGVyVmlld01vZGVsRmFjdG9yeSk7XG5cbiAgICBMaXN0SGVhZGVyVmlld01vZGVsRmFjdG9yeS4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBMaXN0SGVhZGVyVmlld01vZGVsRmFjdG9yeSgpIHtcblxuICAgICAgICBmdW5jdGlvbiBMaXN0SGVhZGVyVmlld01vZGVsKGhlYWRlclRpdGxlLCBoZWFkZXJJbWFnZSwgaGVhZGVyU3ViVGl0bGUpIHtcblxuICAgICAgICAgICAgdGhpcy5oZWFkZXJUaXRsZSA9IGhlYWRlclRpdGxlO1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJJbWFnZSA9IGhlYWRlckltYWdlO1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJTdWJUaXRsZSA9IGhlYWRlclN1YlRpdGxlO1xuICAgICAgICAgICAgdGhpcy5zaG93SGVhZGVyU3VidGl0bGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaGVhZGVyTW9kZSA9ICdjb2xhcHNlZCc7XG4gICAgICAgIH1cblxuICAgICAgICBMaXN0SGVhZGVyVmlld01vZGVsLnByb3RvdHlwZS5zZXRIZWFkZXJNb2RlID0gZnVuY3Rpb24obW9kZSkge1xuXG4gICAgICAgICAgICB0aGlzLmhlYWRlck1vZGUgPSBtb2RlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBMaXN0SGVhZGVyVmlld01vZGVsO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsaXN0SGVhZGVyJywgbGlzdEhlYWRlcik7XG5cbiAgICBsaXN0SGVhZGVyLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGxpc3RIZWFkZXIoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL3dpZGdldHMvbGlzdF9oZWFkZXIvbGlzdC1oZWFkZXIuaHRtbCcsXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoKSB7XG5cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZmFjdG9yeSgnc2wubGlzdEl0ZW0nLCBMaXN0SXRlbVZpZXdNb2RlbEZhY3RvcnkpO1xuXG4gICAgTGlzdEl0ZW1WaWV3TW9kZWxGYWN0b3J5LiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJHN0YXRlJywgJyR0aW1lb3V0JywgJyRtb2RhbCcsICd1dGlsaXR5LmNvbW1vbicsICd1c2VyQ29udGV4dCddO1xuXG4gICAgZnVuY3Rpb24gTGlzdEl0ZW1WaWV3TW9kZWxGYWN0b3J5KCRyb290U2NvcGUsICRzdGF0ZSwgJHRpbWVvdXQsICRtb2RhbCwgY29tbW9uLCB1c2VyQ29udGV4dCkge1xuXG4gICAgICAgIGZ1bmN0aW9uIExpc3RJdGVtVmlld01vZGVsKCkge1xuXG4gICAgICAgICAgICB0aGlzLml0ZW1UaXRsZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLml0ZW1JY29ucyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5pdGVtSWNvbiA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnRhZ0ljb25zID0gW107XG4gICAgICAgICAgICB0aGlzLml0ZW1JZCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLml0ZW1EZXRhaWxzID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuaGFzSXRlbURldGFpbHMgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXRlbURldGFpbHNCb3hBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLml0ZW1Jc0RlbGV0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZE9uID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmluZm8gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMudGFnID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnVzZVRpdGxlTGV0dGVyQXNJY29uID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmdyb3VuZElkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZ3JvdW5kTmFtZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnNob3dTdWJzY3JpYmVJbmRpY2F0b3IgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuY2xpY2thYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIExpc3RJdGVtVmlld01vZGVsLnByb3RvdHlwZS50b2dnbGVJdGVtRGV0YWlsc0JveCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5pdGVtRGV0YWlsc0JveEFjdGl2ZSA9ICF0aGlzLml0ZW1EZXRhaWxzQm94QWN0aXZlO1xuICAgICAgICB9O1xuXG4gICAgICAgIExpc3RJdGVtVmlld01vZGVsLnByb3RvdHlwZS5zZXREZWxldGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1Jc0RlbGV0ZWQgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIExpc3RJdGVtVmlld01vZGVsLmZyb21EZXZpY2UgPSBmdW5jdGlvbihkZXZpY2VNb2RlbCkge1xuICAgICAgICAgICAgdmFyIHZpZXdNb2RlbCA9IG5ldyBMaXN0SXRlbVZpZXdNb2RlbCgpO1xuXG4gICAgICAgICAgICB2aWV3TW9kZWwuZGV2aWNlID0gZGV2aWNlTW9kZWw7XG5cbiAgICAgICAgICAgIHZpZXdNb2RlbC5zaG93RGV2aWNlU3RhdHVzID0gdHJ1ZTtcblxuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1UaXRsZSA9IGRldmljZU1vZGVsLmdldFRpdGxlKCk7XG4gICAgICAgICAgICB2aWV3TW9kZWwuaXRlbUljb24gPSBkZXZpY2VNb2RlbC5nZXRJY29uKCk7XG4gICAgICAgICAgICB2aWV3TW9kZWwuaXRlbURldGFpbHMgPSBkZXZpY2VNb2RlbC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5oYXNJdGVtRGV0YWlscyA9IGRldmljZU1vZGVsLmRlc2NyaXB0aW9uID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JZCA9IGRldmljZU1vZGVsLmlkO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1Jc0RlbGV0ZWQgPSBkZXZpY2VNb2RlbC5fZGVsZXRlZDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5jcmVhdGVkT24gPSBkZXZpY2VNb2RlbC5jcmVhdGVkT247XG4gICAgICAgICAgICB2aWV3TW9kZWwuZ3JvdW5kSWQgPSBkZXZpY2VNb2RlbC5ncm91bmRJZDtcblxuICAgICAgICAgICAgaWYgKGRldmljZU1vZGVsLmdyb3VuZCkge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5ncm91bmRUaXRsZSA9IGRldmljZU1vZGVsLmdyb3VuZC50aXRsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGRldmljZU1vZGVsLmhhc093blByb3BlcnR5KCdydWxlc01ldGEnKSkge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5ub3RpZmljYXRpb25zQWN0aXZlID0gZGV2aWNlTW9kZWwucnVsZXNNZXRhLmhhc05vdGlmaWNhdGlvblJ1bGVzO1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5hdHRhY2hlZFJ1bGVzID0gZGV2aWNlTW9kZWwucnVsZXNNZXRhLmhhc1J1bGVzO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJ2lzVXNlclN1YnNjcmliZWRPblJ1bGUnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmlld01vZGVsLml0ZW1JZCA9PT0gZGF0YS5kZXZpY2VJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLm5vdGlmaWNhdGlvbnNBY3RpdmUgPSBkYXRhLmlzQ3VycmVudFVzZXJTdWJzY3JpYmVkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZpZXdNb2RlbC5pbmZvID0ge1xuICAgICAgICAgICAgICAgIG11bHRpcGxlSWNvbnM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzTmV3OiBkZXZpY2VNb2RlbC4kaXNOZXdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuaW5mby5pc05ldyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwuaW5mby5pc05ldyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2aWV3TW9kZWwuY2xpY2tIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZpZXdNb2RlbC5pdGVtSXNEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZGV2aWNlJywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdmlld01vZGVsLml0ZW1JZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHZpZXdNb2RlbC5hdHRhY2hlZFJ1bGVzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnRhZ0ljb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3NsLXBlbi1vdXRsaW5lIGNsaWNrYWJsZScsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVmlldyBydWxlcyBhc3NvY2lhdGVkIHRvIHRoaXMgZGV2aWNlJyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvbW9kYWxzL3J1bGVzX2F0dGFjaGVkL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21vZGFscy5ydWxlc0F0dGFjaGVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZU1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcbiAgICAgICAgfTtcblxuICAgICAgICBMaXN0SXRlbVZpZXdNb2RlbC5mcm9tTWVtYmVyID0gZnVuY3Rpb24obWVtYmVyTW9kZWwpIHtcbiAgICAgICAgICAgIHZhciB2aWV3TW9kZWwgPSBuZXcgTGlzdEl0ZW1WaWV3TW9kZWwoKTtcblxuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1UaXRsZSA9IG1lbWJlck1vZGVsLnVzZXJuYW1lO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JZCA9IG1lbWJlck1vZGVsLmlkO1xuICAgICAgICAgICAgdmlld01vZGVsLnVzZVRpdGxlTGV0dGVyQXNJY29uID0gdHJ1ZTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5pc0dyb3VuZE93bmVyID0gbWVtYmVyTW9kZWwuaXNHcm91bmRPd25lcjtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5jbGlja2FibGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgdmlld01vZGVsLmluZm8gPSB7XG4gICAgICAgICAgICAgICAgbXVsdGlwbGVJY29uczogZmFsc2VcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuaXNHcm91bmRPd25lcikge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1mYWNlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdPd25lciBvZiB0aGlzIGdyb3VuZCdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcbiAgICAgICAgfTtcblxuICAgICAgICBMaXN0SXRlbVZpZXdNb2RlbC5mcm9tR3JvdW5kID0gZnVuY3Rpb24oZ3JvdW5kKSB7XG5cbiAgICAgICAgICAgIHZhciB2aWV3TW9kZWwgPSBuZXcgTGlzdEl0ZW1WaWV3TW9kZWwoKTtcblxuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1UaXRsZSA9IGdyb3VuZC50aXRsZTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5pdGVtRGV0YWlscyA9IGdyb3VuZC5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5oYXNJdGVtRGV0YWlscyA9IGdyb3VuZC5kZXNjcmlwdGlvbiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5pdGVtSWQgPSBncm91bmQuaWQ7XG4gICAgICAgICAgICB2aWV3TW9kZWwuaXRlbUljb24gPSAnJztcbiAgICAgICAgICAgIHZpZXdNb2RlbC5pdGVtSXNEZWxldGVkID0gZ3JvdW5kLl9kZWxldGVkO1xuICAgICAgICAgICAgdmlld01vZGVsLmNyZWF0ZWRPbiA9IGdyb3VuZC5jcmVhdGVkT247XG5cbiAgICAgICAgICAgIGlmIChncm91bmQudmlzaWJpbGl0eSA9PSAncGVyc29uYWwnKSB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnVzZVRpdGxlTGV0dGVyQXNJY29uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwudGl0bGVMZXR0ZXJJY29uQ2xhc3MgPSAnZ3JvdW5kLXBlcnNvbmFsJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnVzZVRpdGxlTGV0dGVyQXNJY29uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWwudGl0bGVMZXR0ZXJJY29uQ2xhc3MgPSBncm91bmQuY29sb3I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZpZXdNb2RlbC5zaG93U3Vic2NyaWJlSW5kaWNhdG9yID0gdHJ1ZTtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5tZW1iZXJDb3VudCA9IGdyb3VuZC5tZW1iZXJDb3VudDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5kZXZpY2VDb3VudCA9IGdyb3VuZC5kZXZpY2VDb3VudDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5nYXRld2F5Q291bnQgPSBncm91bmQuZ2F0ZXdheUNvdW50O1xuXG4gICAgICAgICAgICB2YXIgdXNlcklkID0gdXNlckNvbnRleHQudXNlci5pZDtcblxuICAgICAgICAgICAgdmlld01vZGVsLmluZm8gPSB7XG4gICAgICAgICAgICAgICAgbXVsdGlwbGVJY29uczogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNOZXc6IGdyb3VuZC4kaXNOZXdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChncm91bmQub3duZXJJZCA9PT0gdXNlcklkKSB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLnRhZ0ljb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBjbGFzczogJ3NsLWZhY2UnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1lvdSBhcmUgb3duZXIgb2YgdGhpcyBncm91bmQnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuZ2F0ZXdheUNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1nYXRld2F5LWZpbGwgY2xpY2thYmxlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZpZXdNb2RlbC5nYXRld2F5Q291bnQgKyAoKHZpZXdNb2RlbC5nYXRld2F5Q291bnQgPT09IDEpID8gJyBnYXRld2F5ICcgOiAnIGdhdGV3YXlzICcpICsgJ2luIHRoaXMgZ3JvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZpZXdNb2RlbC5nYXRld2F5Q291bnQsXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZ3JvdW5kR2F0ZXdheXMnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZpZXdNb2RlbC5pdGVtSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuZGV2aWNlQ291bnQgPj0gMCkge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1kZXZpY2VzLWZpbGwgY2xpY2thYmxlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZpZXdNb2RlbC5kZXZpY2VDb3VudCArICgodmlld01vZGVsLmRldmljZUNvdW50ID09PSAxKSA/ICcgZGV2aWNlICcgOiAnIGRldmljZXMgJykgKyAnaW4gdGhpcyBncm91bmQnLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdmlld01vZGVsLmRldmljZUNvdW50LFxuICAgICAgICAgICAgICAgICAgICBjbGlja0hhbmRsZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmdyb3VuZERldmljZXMnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHZpZXdNb2RlbC5pdGVtSWRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwubWVtYmVyQ291bnQgPj0gMCkge1xuICAgICAgICAgICAgICAgIHZpZXdNb2RlbC50YWdJY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICdzbC1tZW1iZXJzLWZpbGwgY2xpY2thYmxlJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHZpZXdNb2RlbC5tZW1iZXJDb3VudCArICgodmlld01vZGVsLm1lbWJlckNvdW50ID09PSAxKSA/ICcgbWVtYmVyICcgOiAnIG1lbWJlcnMgJykgKyAnY29udHJpYnV0aW5nIHRoaXMgZ3JvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZpZXdNb2RlbC5tZW1iZXJDb3VudCxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5ncm91bmRNZW1iZXJzJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB2aWV3TW9kZWwuaXRlbUlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodmlld01vZGVsLmluZm8uaXNOZXcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLmluZm8uaXNOZXcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmlld01vZGVsLmNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHZpZXdNb2RlbC5pdGVtSXNEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ21haW4uZ3JvdW5kJywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdmlld01vZGVsLml0ZW1JZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcbiAgICAgICAgfTtcblxuICAgICAgICBMaXN0SXRlbVZpZXdNb2RlbC5mcm9tR2F0ZXdheSA9IGZ1bmN0aW9uKGdhdGV3YXlNb2RlbCkge1xuICAgICAgICAgICAgdmFyIHZpZXdNb2RlbCA9IG5ldyBMaXN0SXRlbVZpZXdNb2RlbCgpO1xuXG4gICAgICAgICAgICB2aWV3TW9kZWwuaXRlbVRpdGxlID0gZ2F0ZXdheU1vZGVsLmdldFRpdGxlKCk7XG4gICAgICAgICAgICB2aWV3TW9kZWwuaXRlbUljb24gPSBnYXRld2F5TW9kZWwuZ2V0SWNvbigpO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1EZXRhaWxzID0gZ2F0ZXdheU1vZGVsLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdmlld01vZGVsLmhhc0l0ZW1EZXRhaWxzID0gZ2F0ZXdheU1vZGVsLmRlc2NyaXB0aW9uID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JZCA9IGdhdGV3YXlNb2RlbC5pZDtcbiAgICAgICAgICAgIHZpZXdNb2RlbC5pdGVtSXNEZWxldGVkID0gZ2F0ZXdheU1vZGVsLl9kZWxldGVkO1xuICAgICAgICAgICAgdmlld01vZGVsLmNyZWF0ZWRPbiA9IGdhdGV3YXlNb2RlbC5jcmVhdGVkT247XG4gICAgICAgICAgICB2aWV3TW9kZWwuZ3JvdW5kSWQgPSBnYXRld2F5TW9kZWwuZ3JvdW5kSWQ7XG5cbiAgICAgICAgICAgIGlmIChnYXRld2F5TW9kZWwuZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgdmlld01vZGVsLmdyb3VuZFRpdGxlID0gZ2F0ZXdheU1vZGVsLmdyb3VuZC50aXRsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmlld01vZGVsLmluZm8gPSB7XG4gICAgICAgICAgICAgICAgbXVsdGlwbGVJY29uczogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNOZXc6IGdhdGV3YXlNb2RlbC4kaXNOZXdcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuaW5mby5pc05ldyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwuaW5mby5pc05ldyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2aWV3TW9kZWwuY2xpY2tIYW5kbGVyID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodmlld01vZGVsLml0ZW1Jc0RlbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5nYXRld2F5Jywge1xuICAgICAgICAgICAgICAgICAgICBpZDogdmlld01vZGVsLml0ZW1JZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHZpZXdNb2RlbDtcbiAgICAgICAgfTtcblxuICAgICAgICBMaXN0SXRlbVZpZXdNb2RlbC5mcm9tUnVsZSA9IGZ1bmN0aW9uKHJ1bGVNb2RlbCwgcnVsZURlZmluaXRpb24pIHtcblxuICAgICAgICAgICAgdmFyIHZpZXdNb2RlbCA9IG5ldyBMaXN0SXRlbVZpZXdNb2RlbCgpO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1UaXRsZSA9IHJ1bGVNb2RlbC5uYW1lO1xuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JZCA9IHJ1bGVNb2RlbC5pZDtcblxuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpY29uOiBnZXRJY29uKHJ1bGVNb2RlbCwgJ3doZW4nKSxcbiAgICAgICAgICAgICAgICBhcnJvdzogdHJ1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZpZXdNb2RlbC5pdGVtSWNvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgaWNvbjogZ2V0SWNvbihydWxlTW9kZWwsICd0aGVuJyksXG4gICAgICAgICAgICAgICAgYXJyb3c6IGVsc2VFeGlzdHMocnVsZURlZmluaXRpb24pXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmlld01vZGVsLml0ZW1JY29ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICBpY29uOiBnZXRJY29uKHJ1bGVNb2RlbCwgJ2Vsc2UnKVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZpZXdNb2RlbC5pbmZvID0ge1xuICAgICAgICAgICAgICAgIG11bHRpcGxlSWNvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgYWN0aW9uQXZhaWxpYmxlOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2aWV3TW9kZWwudGFnID0gZ2V0VGFnSW5mbyhydWxlTW9kZWwuc3RhdHVzKTtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJ3Jvb3RTY29wZTpydWxlOnN0YXR1c0NoYW5nZWQnLCBmdW5jdGlvbihldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmICh2aWV3TW9kZWwuaXRlbUlkID09PSBkYXRhLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbC50YWcgPSBnZXRUYWdJbmZvKGRhdGEuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmlld01vZGVsLmNsaWNrSGFuZGxlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL21vZGFscy9ydWxlX29wdGlvbnMvdmlldy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21vZGFscy5ydWxlLk9wdGlvbnMnLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBydWxlTW9kZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEljb24ocnVsZU1vZGVsLCBzZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldGVkU2VjdGlvbiA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbiA9PT0gJ3doZW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldGVkU2VjdGlvbiA9IGdldFNlY3Rpb24oc2VjdGlvbiwgMCwgcnVsZURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ZWRTZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ZWRTZWN0aW9uLmxlZnQgJiYgdGFyZ2V0ZWRTZWN0aW9uLmxlZnQuZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzbC1kZXZpY2UtY3VzdG9tJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldGVkU2VjdGlvbi5kZXZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzbC1kZXZpY2UtY3VzdG9tJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NsLXNlcnZpY2UtY2FsZW5kYXInO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWN0aW9uID09PSAndGhlbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ZWRTZWN0aW9uID0gZ2V0U2VjdGlvbihzZWN0aW9uLCAxLCBydWxlRGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRlZFNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRlZFNlY3Rpb24ubGVmdCAmJiB0YXJnZXRlZFNlY3Rpb24ubGVmdC5kZXZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NsLWRldmljZS1jdXN0b20nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ZWRTZWN0aW9uLmRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NsLWRldmljZS1jdXN0b20nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnc2wtc2VydmljZS1lbWFpbCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICdlbHNlJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZWxzZUV4aXN0cyhydWxlRGVmaW5pdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldGVkU2VjdGlvbiA9IGdldFNlY3Rpb24oc2VjdGlvbiwgMiwgcnVsZURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldGVkU2VjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRlZFNlY3Rpb24ubGVmdCAmJiB0YXJnZXRlZFNlY3Rpb24ubGVmdC5kZXZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzbC1kZXZpY2UtY3VzdG9tJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ZWRTZWN0aW9uLmRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzbC1kZXZpY2UtY3VzdG9tJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnc2wtc2VydmljZS1lbWFpbCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRTZWN0aW9uKHNlY3Rpb25OYW1lLCBpbmRleCwgcnVsZSkge1xuICAgICAgICAgICAgICAgIHZhciBzZWN0aW9uQ29udGFpbmVyID0gcnVsZS5kZWZpbml0aW9uW2luZGV4XVtzZWN0aW9uTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKCFzZWN0aW9uQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlY3Rpb25Db250YWluZXIgPSBydWxlLmRlZmluaXRpb25baW5kZXhdW2NvbW1vbi50b1Bhc2NhbENhc2Uoc2VjdGlvbk5hbWUpXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIXNlY3Rpb25Db250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlY3Rpb25Db250YWluZXJbMF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVsc2VFeGlzdHMocnVsZSkge1xuICAgICAgICAgICAgICAgIHZhciBpc0Vsc2VJblJ1bGUgPSBydWxlLmRlZmluaXRpb25bMl07XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNFbHNlSW5SdWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGFnSW5mbyhydWxlU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChydWxlU3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2xhc3M6ICd0YWctbGlnaHQtZ3JheScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnVGV4dDogJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2xhc3M6ICd0YWctZ3JlZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ1RleHQ6ICdydW5uaW5nJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdDbGFzczogJ3RhZy15ZWxsb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ1RleHQ6ICdpZGxlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdDbGFzczogJ3RhZy1yZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ1RleHQ6ICdjb21waWxhdGlvbiBlcnJvcidcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnQ2xhc3M6ICd0YWctcmVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdUZXh0OiAnbWlzc2luZyBhc3NldHMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdmlld01vZGVsO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBMaXN0SXRlbVZpZXdNb2RlbDtcblxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsaXN0SXRlbScsIGxpc3RJdGVtKTtcblxuICAgIGxpc3RJdGVtLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGxpc3RJdGVtKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC93aWRnZXRzL2xpc3RfaXRlbS9saXN0LWl0ZW0uaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICB2aWV3TW9kZWw6ICc9JyxcbiAgICAgICAgICAgICAgICBncm91bmRUYWc6ICc9JyxcbiAgICAgICAgICAgICAgICBjb2xvcjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnYXJlYVJhbmdlQ2hhcnREZXZpY2VDb250cm9sJywgQXJlYVJhbmdlQ2hhcnREaXJlY3RpdmUpO1xuXG4gICAgQXJlYVJhbmdlQ2hhcnREaXJlY3RpdmUuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gQXJlYVJhbmdlQ2hhcnREaXJlY3RpdmUoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBBcmVhUmFuZ2VDaGFydERldmljZUNvbnRyb2xDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kZXZpY2VzL2NvbnRyb2xzL2FyZWEtcmFuZ2UtY2hhcnQvYXJlYS1yYW5nZS1jaGFydC1kZXZpY2UtY29udHJvbC5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRldmljZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfVxuXG4gICAgQXJlYVJhbmdlQ2hhcnREZXZpY2VDb250cm9sQ29udHJvbGxlci4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBBcmVhUmFuZ2VDaGFydERldmljZUNvbnRyb2xDb250cm9sbGVyKCkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uY29udHJvbENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICB0eXBlOiAnYXJlYS1yYW5nZS1jaGFydCdcbiAgICAgICAgfTtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2JhckNoYXJ0RGV2aWNlQ29udHJvbCcsIEJhckNoYXJ0RGlyZWN0aXZlKTtcblxuICAgIEJhckNoYXJ0RGlyZWN0aXZlLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIEJhckNoYXJ0RGlyZWN0aXZlKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogQmFyQ2hhcnREZXZpY2VDb250cm9sQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGV2aWNlcy9jb250cm9scy9iYXItY2hhcnQvYmFyLWNoYXJ0LWRldmljZS1jb250cm9sLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGV2aWNlOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG5cbiAgICBCYXJDaGFydERldmljZUNvbnRyb2xDb250cm9sbGVyLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIEJhckNoYXJ0RGV2aWNlQ29udHJvbENvbnRyb2xsZXIoKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5jb250cm9sQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdiYXItY2hhcnQnXG4gICAgICAgIH07XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLyAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdlbnJvbGxEZW1vRGV2aWNlQ29udHJvbCcsIGVucm9sbERlbW9Db250cm9sKTtcblxuICAgIGVucm9sbERlbW9Db250cm9sLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGVucm9sbERlbW9Db250cm9sKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogZW5yb2xsRGVtb0NvbnRyb2xDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kZXZpY2VzL2NvbnRyb2xzL2Vucm9sbC1kZW1vL2Vucm9sbC1kZW1vLWNvbnRyb2wuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkZXZpY2U6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIGVucm9sbERlbW9Db250cm9sQ29udHJvbGxlci4kaW5qZWN0ID0gWyd1cmxTaG9ydGVuZXJTZXJ2aWNlJywgJ3Nlc3Npb24nLCAnb3JpZ2luJ107XG5cbiAgICBmdW5jdGlvbiBlbnJvbGxEZW1vQ29udHJvbENvbnRyb2xsZXIodXJsU2hvcnRlbmVyU2VydmljZSwgc2Vzc2lvbiwgb3JpZ2luKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2YXIgc2Vzc2lvbkRhdGEgPSBzZXNzaW9uLmF1dGhlbnRpY2F0aW9uKCk7XG4gICAgICAgIHZhciBnYW1lVG9rZW4gPSBzZXNzaW9uRGF0YS5hY2Nlc3NUb2tlbjtcbiAgICAgICAgdmFyIGdhbWVUaWNrZXQgPSB2bS5kZXZpY2UuYXV0aG9yaXphdGlvbnNbMF07XG5cbiAgICAgICAgdm0ucXJUZXh0ID0gbnVsbDtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdmFyIGxvbmdVcmwgPSBnZXRRUkNvZGVVcmwodm0uZGV2aWNlLm5hbWUsIGdhbWVUaWNrZXQpO1xuICAgICAgICAgICAgdXJsU2hvcnRlbmVyU2VydmljZS5zaG9ydGVuVXJsKGxvbmdVcmwpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oc2hvcnRVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucXJUZXh0ID0gc2hvcnRVcmw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRRUkNvZGVVcmwoZGV2aWNlTmFtZSwgZ2FtZVRva2VuKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAnezB9L2FwcHMvcXVpY2stZGVtby1sYXVuY2hlcj9kZXZpY2VOYW1lPXsxfSZ0b2tlbj17Mn0nLmZvcm1hdChvcmlnaW4sIGRldmljZU5hbWUsIGdhbWVUb2tlbik7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsaW5lQ2hhcnREZXZpY2VDb250cm9sJywgTGluZUNoYXJ0RGlyZWN0aXZlKTtcblxuICAgIExpbmVDaGFydERpcmVjdGl2ZS4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBMaW5lQ2hhcnREaXJlY3RpdmUoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBMaW5lQ2hhcnREZXZpY2VDb250cm9sQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGV2aWNlcy9jb250cm9scy9saW5lLWNoYXJ0L2xpbmUtY2hhcnQtZGV2aWNlLWNvbnRyb2wuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkZXZpY2U6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIExpbmVDaGFydERldmljZUNvbnRyb2xDb250cm9sbGVyLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIExpbmVDaGFydERldmljZUNvbnRyb2xDb250cm9sbGVyKCkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uY29udHJvbENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICB0eXBlOiAnbGluZS1jaGFydCdcbiAgICAgICAgfTtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnYXNzZXRDb21wYXJhdG9yJywgWyckbG9nJyxcblxuICAgICAgICBmdW5jdGlvbigkbG9nKSB7XG5cbiAgICAgICAgICAgIHZhciBsaW5rZXIgPSBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvbXBhcmF0b3JzKHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBhcmF0b3JzID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT0gJ2Jvb2wnIHx8IHR5cGUgPT0gJ2Jvb2xlYW4nIHx8IHR5cGUgPT0gJ3RleHQnIHx8IHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyYXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0VxdWFsIHRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJz09J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTm90IEVxdWFsIHRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJyE9J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSAnaW50ZWdlcicgfHwgdHlwZSA9PSAnaW50JyB8fCB0eXBlID09ICdudW1iZXInIHx8IHR5cGUgPT0gJ251bScgfHwgdHlwZSA9PSAnZGF0ZScgfHwgdHlwZSA9PSAndGltZXNwYW4nIHx8IHR5cGUgPT0gJ2RvdWJsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmF0b3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdFcXVhbCB0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICc9PSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyYXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ05vdCBFcXVhbCB0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICchPSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyYXRvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0xlc3MgdGhhbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICc8J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnTGVzcyBvciBlcXVhbCB0aGFuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJzw9J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJhdG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnR3JlYXRlciB0aGFuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJz4nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmF0b3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdHcmVhdGVyIG9yIGVxdWFsIHRoYW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnPT4nXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3JzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNjb3BlLmNvbXBhcmF0b3JTZWxlY3RlZCA9IGZ1bmN0aW9uKGl0ZW0sIG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbXBhcmF0b3JWYWx1ZSA9IGl0ZW0uaWQ7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvZmlsZScsIGZ1bmN0aW9uKG5ld1Byb2ZpbGUsIG9sZFByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobmV3UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29tcGFyYXRvcnMgPSBnZXRDb21wYXJhdG9ycyhuZXdQcm9maWxlLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvYXNzZXQtY29tcGFyYXRvci92aWV3Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFyYXRvclZhbHVlOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NsQXNzZXRQcm9maWxlRGVzY3JpcHRvcicsIHNsQXNzZXRQcm9maWxlRGVzY3JpcHRvcik7XG5cbiAgICBmdW5jdGlvbiBzbEFzc2V0UHJvZmlsZURlc2NyaXB0b3IoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9hc3NldC1wcm9maWxlLWRlc2NyaXB0b3Ivdmlldy5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUpIHtcblxuICAgICAgICAgICAgc2NvcGUuZXhwZWN0c1R5cGUgPSBudWxsO1xuICAgICAgICAgICAgc2NvcGUudW5pdCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5jb25zdHJhaW50cyA9IG51bGw7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvZmlsZScsIGZ1bmN0aW9uKG5ld1Byb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgIGlmICghbmV3UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5leHBlY3RzVHlwZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnVuaXQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25zdHJhaW50cyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1Byb2ZpbGUudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBcdHNjb3BlLmV4cGVjdHNUeXBlID0gJ2V4cGVjdHMgdHlwZTogJytuZXdQcm9maWxlLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihuZXdQcm9maWxlLnVuaXQpe1xuICAgICAgICAgICAgICAgICAgICBcdHNjb3BlLnVuaXQgPSAndW5pdDogJytuZXdQcm9maWxlLnVuaXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZihuZXdQcm9maWxlLm1pbiAmJiBuZXdQcm9maWxlLm1heCl7XG4gICAgICAgICAgICAgICAgICAgIFx0c2NvcGUuY29uc3RyYWludHMgPSAnd2l0aCB2YWx1ZXMgYmV0d2VlbjogJyArIG5ld1Byb2ZpbGUubWluICsgJyBhbmQgJyArIG5ld1Byb2ZpbGUubWF4O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYobmV3UHJvZmlsZS5taW4pe1xuICAgICAgICAgICAgICAgICAgICBcdHNjb3BlLmNvbnN0cmFpbnRzID0gJ3dpdGggdmFsdWVzIGJpZ2dlciB0aGVuOiAnICsgbmV3UHJvZmlsZS5taW47XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihuZXdQcm9maWxlLm1heCl7XG4gICAgICAgICAgICAgICAgICAgIFx0c2NvcGUuY29uc3RyYWludHMgPSAnd2l0aCB2YWx1ZXMgc21hbGxlciB0aGVuOiAnICsgbmV3UHJvZmlsZS5tYXg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbn0od2luZG93LmFuZ3VsYXIpKTtcbiIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2Fzc2V0VmFsdWVFZGl0b3InLCBhc3NldFZhbHVlRWRpdG9yKTtcblxuICAgIGFzc2V0VmFsdWVFZGl0b3IuJGluamVjdCA9IFsnJGNvbXBpbGUnXTtcblxuICAgIGZ1bmN0aW9uIGFzc2V0VmFsdWVFZGl0b3IoJGNvbXBpbGUpIHtcblxuICAgICAgICB2YXIgZGVmYXVsdFRlbXBsYXRlID0gJzx0ZXh0LXNldHRlciB0ZXh0LXZhbHVlPVwib3BlcmF0aW9uLnZhbHVlXCI8L3RleHQtc2V0dGVyPic7XG4gICAgICAgIHZhciBhc3NldFByb2ZpbGVEZXNjcmlwdG9yVGVtcGxhdGUgPSAnPHNsLWFzc2V0LXByb2ZpbGUtZGVzY3JpcHRvciBwcm9maWxlPVwicHJvZmlsZVwiPjwvc2wtYXNzZXQtcHJvZmlsZS1kZXNjcmlwdG9yPic7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG9wZXJhdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICBpc0VkaXRNb2RlOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvZmlsZScsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKGdldFRlbXBsYXRlKHNjb3BlLnByb2ZpbGUpKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICRjb21waWxlKGVsZW1lbnQuY29udGVudHMoKSkoc2NvcGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGUocHJvZmlsZSkge1xuXG4gICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBkZWZhdWx0VGVtcGxhdGU7XG5cbiAgICAgICAgICAgIGlmICghcHJvZmlsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFwcm9maWxlLnR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc0VtYWlsU2VydmljZShwcm9maWxlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUubGFiZWxzKSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSAnPGxhYmVsLXNldHRlciB2YWx1ZT1cIm9wZXJhdGlvbi52YWx1ZVwiIHByb2ZpbGU9XCJwcm9maWxlXCI+PC9sYWJlbC1zZXR0ZXI+JztcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlLnR5cGUgPT0gJ2Nyb24nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGF5LXRpbWUgY3JvbiA9IFwib3BlcmF0aW9uLnZhbHVlXCIgaXMtZWRpdC1tb2RlID0gXCJpc0VkaXRNb2RlXCI+IDwvZGF5LXRpbWU+ICc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlLnR5cGUgPT0gJ2Jvb2wnIHx8IHByb2ZpbGUudHlwZSA9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9ICc8Ym9vbC1zZXR0ZXIgYm9vbC12YWx1ZT1cIm9wZXJhdGlvbi52YWx1ZVwiPjwvYm9vbC1zZXR0ZXI+JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUudHlwZSA9PSAnaW50JyB8fCBwcm9maWxlLnR5cGUgPT0gJ2ludGVnZXInIHx8IHByb2ZpbGUudHlwZSA9PSAnZGVjaW1hbCcgfHwgcHJvZmlsZS50eXBlID09ICdmbG9hdCcgfHwgcHJvZmlsZS50eXBlID09ICdudW1iZXInIHx8IHByb2ZpbGUudHlwZSA9PSAnZG91YmxlJykge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlID0gJzxudW1iZXItc2V0dGVyIG51bS12YWx1ZT1cIm9wZXJhdGlvbi52YWx1ZVwiPjwvbnVtYmVyLXNldHRlcj4nO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZS50eXBlID09ICdkYXRlJyB8fCBwcm9maWxlLnR5cGUgPT0gJ2RhdGV0aW1lJyB8fCBwcm9maWxlLnR5cGUgPT0gJ3RpbWUnKSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSAnPGRhdGUtc2V0dGVyIGRhdGUtdmFsdWU9XCJvcGVyYXRpb24udmFsdWVcIj48L2RhdGUtc2V0dGVyPic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwcm9maWxlLnR5cGUgPT0gJ3RpbWVzcGFuJyB8fCBwcm9maWxlLnR5cGUgPT0gJ3RpbWVyYW5nZScgfHwgcHJvZmlsZS50eXBlID09ICdkdXJhdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9ICc8dGltZXNwYW4tc2V0dGVyIHRpbWVzcGFuLXZhbHVlPVwib3BlcmF0aW9uLnZhbHVlXCI+PC90aW1lc3Bhbi1zZXR0ZXI+JztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUudHlwZSA9PSAnc3RyaW5nJyB8fCBwcm9maWxlLnR5cGUgPT0gJ3RleHQnKSB7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUgPSAnPHRleHQtc2V0dGVyIHRleHQtdmFsdWU9XCJvcGVyYXRpb24udmFsdWVcIj48L3RleHQtc2V0dGVyPic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRlbXBsYXRlICs9IGFzc2V0UHJvZmlsZURlc2NyaXB0b3JUZW1wbGF0ZTtcblxuICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNFbWFpbFNlcnZpY2UocHJvZmlsZSkge1xuXG4gICAgICAgICAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghcHJvZmlsZS50eXBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZS50eXBlLnN1YmplY3QgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NsUnVsZVNlY3Rpb25EZXRhaWwnLCBzbFJ1bGVTZWN0aW9uRGV0YWlsKTtcblxuICAgIHNsUnVsZVNlY3Rpb25EZXRhaWwuJGluamVjdCA9IFsnJGZpbHRlcicsICd1c2VyQ29udGV4dCddO1xuXG4gICAgZnVuY3Rpb24gc2xSdWxlU2VjdGlvbkRldGFpbCgkZmlsdGVyLCB1c2VyQ29udGV4dCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvcnVsZS1zZWN0aW9uLWRldGFpbC92aWV3Lmh0bWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBzZWN0aW9uRGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIHNlY3Rpb25OYW1lOiAnQCcsXG4gICAgICAgICAgICAgICAgc2VjdGlvblRpdGxlOiAnQCcsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0ZXA6ICc9JyxcbiAgICAgICAgICAgICAgICBjdXJyZW50U2VjdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgIGlzU2VjdGlvblJlYWR5OiAnJicsXG4gICAgICAgICAgICAgICAgaXNFZGl0TW9kZTogJz0/J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vL1xuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUpIHtcblxuICAgICAgICAgICAgc2NvcGUuc3RlcHMgPSBbXTtcblxuICAgICAgICAgICAgaW5pdFN0ZXBzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmlzUmVhZHkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuaXNTZWN0aW9uUmVhZHkoc2NvcGUuc2VjdGlvbk5hbWUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuZ2V0SGVhZGVyVGV4dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZERldmljZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWREZXZpY2UubmFtZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkU2VydmljZS50eXBlID09ICdlbWFpbE1lJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVtYWlsID0gdXNlckNvbnRleHQudXNlci5lbWFpbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZFNlcnZpY2UubmFtZSArICcgdG8gJyArIGVtYWlsO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkU2VydmljZS50eXBlID09ICdub3RpZnknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJDb250ZXh0LnVzZXIubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnU2VuZCAnICsgc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlLm5hbWUgKyAnIHRvICcgKyB1c2VyO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkU2VydmljZS5uYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmdldERldGFpbHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHZhciBkZXRhaWxzVGV4dCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsc1RleHQgKz0gc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRBc3NldC50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsc1RleHQgKz0gZ2V0Q29tcGFyZVRleHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICBkZXRhaWxzVGV4dCArPSBnZXRDb21wYXJlVGV4dCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWxzVGV4dDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENvbXBhcmVUZXh0KCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSAnJztcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZENvbXBhcmVUeXBlID09ICdjb25zdGFudCcgfHwgc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRDb21wYXJlVHlwZSA9PSBudWxsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi5vcCAmJiBzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZEFzc2V0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gc2NvcGUuc2VjdGlvbkRhdGEuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLm9wO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9maWxlID0gc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRBc3NldCA/IHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkQXNzZXQucHJvZmlsZSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlID0gc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlLnByb2ZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRWYWx1ZSA9ICRmaWx0ZXIoJ2Fzc2V0VmFsdWVGb3JtYXQnKShzY29wZS5zZWN0aW9uRGF0YS5jb25zdGFudENvbXBhcmVPcGVyYXRpb24udmFsdWUsIHByb2ZpbGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IGZvcm1hdHRlZFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnNlbGVjdGVkQ29tcGFyZVR5cGUgPT0gJ3JlZmVyZW5jZScpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSAnICcgKyBzY29wZS5zZWN0aW9uRGF0YS5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLm9wICsgJyAnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNlY3Rpb25EYXRhLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9IHNjb3BlLnNlY3Rpb25EYXRhLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5hc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCArPSAnIC8gJyArIHNjb3BlLnNlY3Rpb25EYXRhLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uYXNzZXQudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRDb21wYXJlVHlwZSA9PSAnb25FdmVyeUNoYW5nZScpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuY29uc3RhbnRDb21wYXJlT3BlcmF0aW9uLm9wID09ICdPRUMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ICs9ICcgLSBPbiBFdmVyeSBDaGFuZ2UnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmlzU3Vic3RlcEFjdGl2ZSA9IGZ1bmN0aW9uKHN0ZXBOYW1lKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuY3VycmVudFNlY3Rpb24gIT0gc2NvcGUuc2VjdGlvbk5hbWUpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5jdXJyZW50U3RlcC5uYW1lID09IHN0ZXBOYW1lKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmlzU3Vic3RlcFZpc2libGUgPSBmdW5jdGlvbihzdGVwTmFtZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHN0ZXBOYW1lID09ICdkZXZpY2VPclNlcnZpY2VTdGVwJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNFZGl0TW9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzdGVwTmFtZSA9PSAnZGF5VGltZURlZmluZVN0ZXAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZFNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZFNlcnZpY2UudHlwZSA9PSAnZGF5VGltZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RlcE5hbWUgPT0gJ2RldmljZURlZmluZVN0ZXAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5zZWN0aW9uRGF0YS5zZWxlY3RlZFNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RlcE5hbWUgPT0gJ2VNYWlsTWVEZWZpbmVTdGVwJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlLnR5cGUgPT0gJ2VtYWlsTWUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRTdGVwcygpIHtcblxuICAgICAgICAgICAgICAgIHNjb3BlLnN0ZXBzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZGV2aWNlT3JTZXJ2aWNlU3RlcCdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLnN0ZXBzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZGF5VGltZURlZmluZVN0ZXAnXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS5zdGVwcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2RldmljZURlZmluZVN0ZXAnXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS5zdGVwcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2VNYWlsTWVEZWZpbmVTdGVwJ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLnN0ZXBzO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdzbFJ1bGVTZWN0aW9uUHJldmlldycsIHNsUnVsZVNlY3Rpb25QcmV2aWV3KTtcblxuICAgIHNsUnVsZVNlY3Rpb25QcmV2aWV3LiRpbmplY3QgPSBbJyRmaWx0ZXInXTtcblxuICAgIGZ1bmN0aW9uIHNsUnVsZVNlY3Rpb25QcmV2aWV3KCRmaWx0ZXIpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL3J1bGUtc2VjdGlvbi1wcmV2aWV3L3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHNlY3Rpb25EYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgc2VjdGlvbk5hbWU6ICdAJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNlY3Rpb25EYXRhQXBwbGllZCA9IFtdO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3NlY3Rpb25EYXRhJywgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWN0aW9uRGF0YUFwcGxpZWQgPSBzY29wZS5zZWN0aW9uRGF0YTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWN0aW9uRGF0YUFwcGxpZWQucHVzaChuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLmdldEhlYWRlclRleHQgPSBmdW5jdGlvbihzZWN0aW9uRGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uRGF0YS5zZWxlY3RlZERldmljZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VjdGlvbkRhdGEuc2VsZWN0ZWREZXZpY2UudGl0bGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLnNlbGVjdGVkU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuZ2V0TGVmdE5hbWUgPSBmdW5jdGlvbihzZWN0aW9uRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxlZnROYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLnNlbGVjdGVkQXNzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdE5hbWUgPSBzZWN0aW9uRGF0YS5zZWxlY3RlZEFzc2V0LnRpdGxlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uRGF0YS5zZWxlY3RlZFNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdE5hbWUgPSAnaXMnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0TmFtZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmdldENvbXBhcmF0b3JOYW1lID0gZnVuY3Rpb24oc2VjdGlvbkRhdGEpIHtcblxuICAgICAgICAgICAgICAgIHZhciBjb21wYXJhdG9yTmFtZSA9ICcnO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLnNlbGVjdGVkQ29tcGFyZVR5cGUgPT0gJ2NvbnN0YW50JyB8fCBzZWN0aW9uRGF0YS5zZWxlY3RlZENvbXBhcmVUeXBlID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi5vcCAmJiBzZWN0aW9uRGF0YS5zZWxlY3RlZEFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJhdG9yTmFtZSA9IHRyYW5zbGF0ZU9wZXJhdG9yKHNlY3Rpb25EYXRhLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi5vcCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbkRhdGEuc2VsZWN0ZWRDb21wYXJlVHlwZSA9PSAncmVmZXJlbmNlJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbkRhdGEucmVmZXJlbmNlQ29tcGFyZU9wZXJhdGlvbi5vcCAmJiBzZWN0aW9uRGF0YS5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJhdG9yTmFtZSA9IHRyYW5zbGF0ZU9wZXJhdG9yKHNlY3Rpb25EYXRhLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24ub3ApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLnNlbGVjdGVkQ29tcGFyZVR5cGUgPT09ICdvbkV2ZXJ5Q2hhbmdlJykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uRGF0YS5jb25zdGFudENvbXBhcmVPcGVyYXRpb24ub3AgJiYgc2VjdGlvbkRhdGEuc2VsZWN0ZWRBc3NldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyYXRvck5hbWUgPSB0cmFuc2xhdGVPcGVyYXRvcihzZWN0aW9uRGF0YS5jb25zdGFudENvbXBhcmVPcGVyYXRpb24ub3ApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGFyYXRvck5hbWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uKHNlY3Rpb25EYXRhKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAnJztcblxuICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uRGF0YS5zZWxlY3RlZENvbXBhcmVUeXBlID09ICdjb25zdGFudCcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY3Rpb25EYXRhLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZSA9IHNlY3Rpb25EYXRhLnNlbGVjdGVkQXNzZXQgPyBzZWN0aW9uRGF0YS5zZWxlY3RlZEFzc2V0LnByb2ZpbGUgOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlID0gc2VjdGlvbkRhdGEuc2VsZWN0ZWRTZXJ2aWNlLnByb2ZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJGZpbHRlcignYXNzZXRWYWx1ZUZvcm1hdCcpKHNlY3Rpb25EYXRhLmNvbnN0YW50Q29tcGFyZU9wZXJhdGlvbi52YWx1ZSwgcHJvZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2VjdGlvbkRhdGEuc2VsZWN0ZWRDb21wYXJlVHlwZSA9PSAncmVmZXJlbmNlJykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHNlY3Rpb25EYXRhLnJlZmVyZW5jZUNvbXBhcmVPcGVyYXRpb24uZGV2aWNlLnRpdGxlICsgJyAvICcgKyBzZWN0aW9uRGF0YS5yZWZlcmVuY2VDb21wYXJlT3BlcmF0aW9uLmFzc2V0LnRpdGxlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdHJhbnNsYXRlT3BlcmF0b3IocmF3T3BlcmF0b3IpIHtcblxuICAgICAgICAgICAgICAgIHZhciByZWFsQ29tcGFyYXRvck5hbWUgPSByYXdPcGVyYXRvcjtcblxuICAgICAgICAgICAgICAgIGlmIChyYXdPcGVyYXRvciA9PT0gJ09FQycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhbENvbXBhcmF0b3JOYW1lID0gJ3ZhbHVlIGlzIGNoYW5nZWQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyYXdPcGVyYXRvciA9PT0gJz4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWxDb21wYXJhdG9yTmFtZSA9ICdpcyBncmVhdGVyIHRoYW4nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChyYXdPcGVyYXRvciA9PT0gJzwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYWxDb21wYXJhdG9yTmFtZSA9ICdpcyBsb3dlciB0aGFuJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocmF3T3BlcmF0b3IgPT09ICc9PScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhbENvbXBhcmF0b3JOYW1lID0gJ2VxdWFscyB0byc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJhd09wZXJhdG9yID09PSAnPScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVhbENvbXBhcmF0b3JOYW1lID0gJ3NldCB0byc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlYWxDb21wYXJhdG9yTmFtZTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24gKG5nKSB7XG4gICAgbmcubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdtb2RhbHMucGFzc3dvcmRSZWNvdmVyeS5TdWNjZXNzRGlhbG9nJywgW1xuICAgICAgICAnJHNjb3BlJyxcbiAgICAgICAgJyRtb2RhbEluc3RhbmNlJyxcbiAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7IiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ05ld0RldmljZUNvbnRyb2xsZXInLCBOZXdEZXZpY2VDb250cm9sbGVyKTtcblxuICAgIE5ld0RldmljZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcbiAgICAgICAgJyRzdGF0ZScsXG4gICAgICAgICckcm9vdFNjb3BlJyxcbiAgICAgICAgJyRzY29wZScsXG4gICAgICAgICdkZXZpY2UucmVwb3NpdG9yeScsXG4gICAgICAgICdhc3NldC5yZXBvc2l0b3J5JyxcbiAgICAgICAgJ0dyb3VuZENvbnRleHQnLFxuICAgICAgICAndXRpbHMnXG4gICAgXTtcblxuICAgIGZ1bmN0aW9uIE5ld0RldmljZUNvbnRyb2xsZXIoJHN0YXRlLCAkcm9vdFNjb3BlLCAkc2NvcGUsIERldmljZVJlcG9zaXRvcnksIEFzc2V0UmVwb3NpdG9yeSwgR3JvdW5kQ29udGV4dCwgdXRpbHMpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmdyb3VuZElkID0gbnVsbDtcbiAgICAgICAgdm0uaXNJbnRyb09uRGV2aWNlc0hpZGRlbiA9IGZhbHNlO1xuXG4gICAgICAgIHZtLmhhc01vYmlsZURldmljZSA9IGZhbHNlO1xuICAgICAgICB2bS5oYXNLaXREZXZpY2UgPSBmYWxzZTtcbiAgICAgICAgdm0uaGFzQ3VzdG9tRGV2aWNlID0gZmFsc2U7XG4gICAgICAgIHZtLmRldmljZVR5cGUgPSBudWxsO1xuXG4gICAgICAgIHZtLmlzT25Hcm91bmQgPSAkc3RhdGUuJGN1cnJlbnQuc2VsZi5uYW1lID09PSAnbWFpbi5ncm91bmQnID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNyZWF0ZURldmljZSA9IGNyZWF0ZURldmljZTtcbiAgICAgICAgdm0uY3JlYXRlS2l0RGV2aWNlID0gY3JlYXRlS2l0RGV2aWNlO1xuICAgICAgICB2bS5jcmVhdGVNb2JpbGVEZXZpY2UgPSBjcmVhdGVNb2JpbGVEZXZpY2U7XG4gICAgICAgIHZtLnRvZ2dsZUludHJvT25EZXZpY2VzID0gdG9nZ2xlSW50cm9PbkRldmljZXM7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgdm0uZ3JvdW5kSWQgPSBHcm91bmRDb250ZXh0LmN1cnJlbnRJZDtcblxuICAgICAgICAgICAgdm0uaXNJbnRyb09uRGV2aWNlc0hpZGRlbiA9IHV0aWxzLnByZWZlcmVuY2VzLnJlYWRQYWdlKCdJbnRyb09uRGV2aWNlU3RhdHVzJyk7XG5cbiAgICAgICAgICAgIGlmICh2bS5pc0ludHJvT25EZXZpY2VzSGlkZGVuKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5pc0ludHJvT25EZXZpY2VzSGlkZGVuID0gdm0uaXNJbnRyb09uRGV2aWNlc0hpZGRlbiA9PT0gJ3RydWUnO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIERldmljZVJlcG9zaXRvcnkuZmluZEFsbEluR3JvdW5kKHZtLmdyb3VuZElkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRldmljZXMpIHtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRldmljZXMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZXNbaV0udHlwZSA9PT0gJ3F1aWNrLWRlbW8nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzTW9iaWxlRGV2aWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZXNbaV0udHlwZSA9PT0gJ2FyZHVpbm8nIHx8IGRldmljZXNbaV0udHlwZSA9PT0gJ3JwaScgfHwgZGV2aWNlc1tpXS50eXBlID09PSAnaW50ZWwtZWRpc29uJyB8fCBkZXZpY2VzW2ldLnR5cGUgPT09ICdwcm94aW11cy1sb3JhJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmhhc0tpdERldmljZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2VzW2ldLnR5cGUgPT09ICdjdXN0b20nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzQ3VzdG9tRGV2aWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJ0ludHJvT25EZXZpY2VTdGF0dXNUb2dnbGVkJywgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpIHtcblxuICAgICAgICAgICAgICAgIHZtLmlzSW50cm9PbkRldmljZXNIaWRkZW4gPSBhcmdzO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUtpdERldmljZShuYW1lLCB0eXBlKSB7XG5cbiAgICAgICAgICAgIHZtLmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlXG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIERldmljZVJlcG9zaXRvcnkuY3JlYXRlSW5Hcm91bmQodm0uZGF0YSwgdm0uZ3JvdW5kSWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgIT09ICdjdXN0b20nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVBc3NldHMoZGV2aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5kZXZpY2UnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRldmljZS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyU3RhdGVDb250cm9sKCdkZXZpY2UtZGV0YWlscycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXNzZXRzKGRldmljZSkge1xuXG4gICAgICAgICAgICB2YXIgbGVkUHJvbWlzZSA9IG51bGw7XG4gICAgICAgICAgICB2YXIga25vYlByb21pc2UgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodm0uaXNPbkdyb3VuZCkge1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndXNlci5vbmJvYXJkZWQua2l0RGV2aWNlJywgZGV2aWNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1c2VyLmNyZWF0ZWQuZGV2aWNlJywgZGV2aWNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmRhdGEudHlwZSA9PT0gJ2FyZHVpbm8nKSB7XG5cbiAgICAgICAgICAgICAgICBsZWRQcm9taXNlID0gQXNzZXRSZXBvc2l0b3J5LmNyZWF0ZShkZXZpY2UuaWQsICc0JywgJ0xFRCcsICdhY3R1YXRvcicsICdib29sZWFuJywgJ3RvZ2dsZScpO1xuXG4gICAgICAgICAgICAgICAga25vYlByb21pc2UgPSBBc3NldFJlcG9zaXRvcnkuY3JlYXRlKGRldmljZS5pZCwgJzAnLCAnUm90YXJ5IGtub2InLCAnc2Vuc29yJywgeyB0eXBlOiAnaW50ZWdlcicsIG1pbmltdW06IDAsIG1heGltdW06IDEwMjQgfSwgJ2NpcmNsZS1wcm9ncmVzcycpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLmRhdGEudHlwZSA9PT0gJ2ludGVsLWVkaXNvbicpIHtcblxuICAgICAgICAgICAgICAgIGxlZFByb21pc2UgPSBBc3NldFJlcG9zaXRvcnkuY3JlYXRlKGRldmljZS5pZCwgJzQnLCAnTEVEJywgJ2FjdHVhdG9yJywgJ2Jvb2xlYW4nLCAndG9nZ2xlJyk7XG5cbiAgICAgICAgICAgICAgICBrbm9iUHJvbWlzZSA9IEFzc2V0UmVwb3NpdG9yeS5jcmVhdGUoZGV2aWNlLmlkLCAnMCcsICdSb3Rhcnkga25vYicsICdzZW5zb3InLCB7IHR5cGU6ICdpbnRlZ2VyJywgbWluaW11bTogMCwgbWF4aW11bTogMTAyNCB9LCAnY2lyY2xlLXByb2dyZXNzJyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBsZWRQcm9taXNlID0gQXNzZXRSZXBvc2l0b3J5LmNyZWF0ZShkZXZpY2UuaWQsICdsZWQnLCAnTEVEJywgJ2FjdHVhdG9yJywgJ2Jvb2xlYW4nLCAndG9nZ2xlJyk7XG5cbiAgICAgICAgICAgICAgICBrbm9iUHJvbWlzZSA9IEFzc2V0UmVwb3NpdG9yeS5jcmVhdGUoZGV2aWNlLmlkLCAncm90YXJ5X2tub2InLCAnUm90YXJ5IGtub2InLCAnc2Vuc29yJywgeyB0eXBlOiAnaW50ZWdlcicsIG1pbmltdW06IDAsIG1heGltdW06IDEwMjQgfSwgJ2NpcmNsZS1wcm9ncmVzcycpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1dGlscy4kcS5hbGwoW2xlZFByb21pc2UsIGtub2JQcm9taXNlXSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5kZXZpY2UnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRldmljZS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlclN0YXRlQ29udHJvbCgnZGV2aWNlLWRldGFpbHMnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVEZXZpY2UobmFtZSwgdHlwZSkge1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIERldmljZVJlcG9zaXRvcnkuY3JlYXRlSW5Hcm91bmQoZGF0YSwgdm0uZ3JvdW5kSWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdtYWluLmRldmljZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogZGV2aWNlLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyU3RhdGVDb250cm9sKCdkZXZpY2UtZGV0YWlscycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uaXNPbkdyb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1c2VyLm9uYm9hcmRlZC5jdXN0b21EZXZpY2UnLCBkZXZpY2UpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1c2VyLmNyZWF0ZWQuZGV2aWNlJywgZGV2aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTW9iaWxlRGV2aWNlKGRldmljZU5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG5cbiAgICAgICAgICAgICAgICBuYW1lOiBudWxsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdxdWljay1kZW1vJ1xuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlTmFtZSkge1xuXG4gICAgICAgICAgICAgICAgZGF0YS5uYW1lID0gZGV2aWNlTmFtZTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGRhdGEubmFtZSA9ICdZb3VyIHNtYXJ0cGhvbmUnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBEZXZpY2VSZXBvc2l0b3J5LmNyZWF0ZUluR3JvdW5kKGRhdGEsIHZtLmdyb3VuZElkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRldmljZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbWFpbi5kZXZpY2UnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRldmljZS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlclN0YXRlQ29udHJvbCgnZGV2aWNlLWRldGFpbHMnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5pc09uR3JvdW5kKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1c2VyLm9uYm9hcmRlZC5tb2JpbGUnLCBkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3VzZXIuY3JlYXRlZC5kZXZpY2UnLCBkZXZpY2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJTdGF0ZUNvbnRyb2wodHJpZ2dlcklkKSB7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRyaWdnZXJzID0gYW5ndWxhci5lbGVtZW50KCdbc3RhdGUtY29udHJvbC1idXR0b25dJyk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaWdnZXJzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyaWdnZXJzW2ldLmF0dHJpYnV0ZXNbJ2lkZW50aWZpZXInXS52YWx1ZSA9PSB0cmlnZ2VySWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KHRyaWdnZXJzW2ldKS50cmlnZ2VyKCdjbGljaycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNsaWNrT25UYWIoJ2N1c3RvbScpLCA0MDApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA2MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY2xpY2tPblRhYih0YWJOYW1lKSB7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJOYW1lKSkudHJpZ2dlcignY2xpY2snKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlSW50cm9PbkRldmljZXMoKSB7XG5cbiAgICAgICAgICAgIHZtLmlzSW50cm9PbkRldmljZXNIaWRkZW4gPSAhdm0uaXNJbnRyb09uRGV2aWNlc0hpZGRlbjtcblxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdJbnRyb09uRGV2aWNlU3RhdHVzVG9nZ2xlZCcsIHZtLmlzSW50cm9PbkRldmljZXNIaWRkZW4pO1xuXG4gICAgICAgICAgICB1dGlscy5wcmVmZXJlbmNlcy5yZW1lbWJlclBhZ2UoJ0ludHJvT25EZXZpY2VTdGF0dXMnLCB2bS5pc0ludHJvT25EZXZpY2VzSGlkZGVuKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpe1xuXG5cdG5nLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdib29sU2V0dGVyJywgWyckbG9nJyxcblxuICAgICAgICBmdW5jdGlvbigkbG9nKSB7XG5cbiAgICAgICAgICAgIHZhciBsaW5rZXIgPSBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L2Jvb2wvYm9vbC1zZXR0ZXIuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICAgICAgYm9vbFZhbHVlOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xufSh3aW5kb3cuYW5ndWxhcikpOyIsIihmdW5jdGlvbihuZyl7XG5cblx0bmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVTZXR0ZXInLCBbJyRsb2cnLFxuXG4gICAgICAgIGZ1bmN0aW9uKCRsb2cpIHtcblxuICAgICAgICAgICAgdmFyIGxpbmtlciA9IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvY29uc3RhbnQvZGF0ZS9kYXRlLXNldHRlci5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICBkYXRlVmFsdWU6ICc9J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgXSk7XG59KHdpbmRvdy5hbmd1bGFyKSk7IiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsYWJlbFNldHRlcicsIGxhYmVsU2V0dGVyKTtcblxuICAgIGZ1bmN0aW9uIGxhYmVsU2V0dGVyKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvY29uc3RhbnQvbGFiZWwvdmlldy5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUubGFiZWxzID0gW107XG5cbiAgICAgICAgICAgIHNjb3BlLm9uVmFsdWVTZWxlY3RlZCA9IGZ1bmN0aW9uKGl0ZW0sIG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUudmFsdWUgPSBpdGVtLnZhbHVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9maWxlJywgZnVuY3Rpb24obmV3UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICghbmV3UHJvZmlsZSB8fCAhbmV3UHJvZmlsZS5sYWJlbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubGFiZWxzID0gW107XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1Byb2ZpbGUubGFiZWxzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYmwgPSBuZXdQcm9maWxlLmxhYmVsc1tpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxibC52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmxhYmVscy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbGJsLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbGJsLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxibC5mcm9tICYmIGxibC50bykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaXRlcmF0b3IgPSBsYmwuZnJvbTsgaXRlcmF0b3IgPCBsYmwudG87IGl0ZXJhdG9yKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubGFiZWxzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbGJsLmxhYmVsICsgJyAnICsgaXRlcmF0b3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ251bWJlclNldHRlcicsIG51bWJlclNldHRlcik7XG5cbiAgICBmdW5jdGlvbiBudW1iZXJTZXR0ZXIoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9jb25zdGFudC9udW1iZXIvbnVtYmVyLXNldHRlci5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbnVtVmFsdWU6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfTtcblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKXtcblxuXHRuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgndGV4dFNldHRlcicsIFsnJGxvZycsXG5cbiAgICAgICAgZnVuY3Rpb24oJGxvZykge1xuXG4gICAgICAgICAgICB2YXIgbGlua2VyID0gZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9jb25zdGFudC90ZXh0L3RleHQtc2V0dGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHRWYWx1ZTogJz0nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcblxuXG5cblxufSh3aW5kb3cuYW5ndWxhcikpOyIsIihmdW5jdGlvbihuZykge1xuXG4gICAgbmcubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ3RpbWVzcGFuU2V0dGVyJywgWyckbG9nJyxcblxuICAgICAgICBmdW5jdGlvbigkbG9nKSB7XG5cbiAgICAgICAgICAgIHZhciBsaW5rZXIgPSBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2Fzc2V0cy9qcy9hcHAvZGlyZWN0aXZlcy9ydWxlLXN0ZXBzL2NvbnN0YW50L3RpbWVzcGFuL3RpbWVzcGFuLXNldHRlci5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICAgICB0aW1lc3BhblZhbHVlOiAnPSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIF0pO1xuXG59KHdpbmRvdy5hbmd1bGFyKSk7IiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnYXNzZXRTdGVwJywgWyckZmlsdGVyJywgJ3V0aWxpdHkuZGV2aWNlSWNvbnMnLFxuXG4gICAgICAgIGZ1bmN0aW9uKCRmaWx0ZXIsIGljb25zKSB7XG5cbiAgICAgICAgICAgIHZhciBsaW5rZXIgPSBmdW5jdGlvbihzY29wZSkge1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuZ2V0SWNvbiA9IGZ1bmN0aW9uKGljb25LZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGljb25zLmdldEljb24oaWNvbktleSk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLm9uQXNzZXRTZWxlY3RlZCA9IGZ1bmN0aW9uKGl0ZW0sIG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkQXNzZXQgPSBpdGVtO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvc3RlcHMvYXNzZXQtc3RlcC92aWV3Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0czogJz0nLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0AnLFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEFzc2V0OiAnPScsXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlckJ5VHlwZTogJ0AnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICBdKTtcblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG5cbiAgICBuZy5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnY29tcGFyZVR5cGVTdGVwJyxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgXHRyZXR1cm4ge1xuICAgICAgICBcdFx0cmVzdHJpY3Q6J0UnLFxuICAgICAgICBcdFx0dGVtcGxhdGVVcmw6Jy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9zdGVwcy9jb21wYXJlLXR5cGUtc3RlcC92aWV3Lmh0bWwnLFxuICAgICAgICBcdFx0c2NvcGU6e1xuICAgICAgICBcdFx0XHRzZWxlY3RlZENvbXBhcmVUeXBlOic9JyxcbiAgICAgICAgICAgICAgICAgICAgZm9yQ29tcGFyZTonQCdcbiAgICAgICAgXHRcdH1cbiAgICAgICAgXHR9O1xuICAgICAgICB9KTtcblxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnZGF5VGltZScsIGRheVRpbWUpO1xuXG4gICAgZGF5VGltZS4kaW5qZWN0ID0gWydzZXJ2aWNlLmRheVRpbWUnXTtcblxuICAgIGZ1bmN0aW9uIGRheVRpbWUoZGF5VGltZSkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXNzZXRzL2pzL2FwcC9kaXJlY3RpdmVzL3J1bGUtc3RlcHMvc3RlcHMvZGF5LXRpbWUvZGF5LXRpbWUuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGNyb246ICc9JyxcbiAgICAgICAgICAgICAgICBpc0VkaXRNb2RlOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLmRheXMgPSBbe1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiTU9OXCIsXG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZDogZmFsc2VcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlRVRVwiLFxuICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJXRURcIixcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkOiBmYWxzZVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiVEhVXCIsXG4gICAgICAgICAgICAgICAgaXNTZWxlY3RlZDogZmFsc2VcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIkZSSVwiLFxuICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJTQVRcIixcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcIlNVTlwiLFxuICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICB9XTtcblxuICAgICAgICAgICAgc2NvcGUuYW1QbUhvdXJzID0gXCIwMFwiO1xuXG4gICAgICAgICAgICBzY29wZS5kYXlDbGlja2VkID0gZnVuY3Rpb24oZGF5KSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY29wZS5kYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXlzW2ldLm5hbWUgPT09IGRheS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXlzW2ldLmlzU2VsZWN0ZWQgPSAhc2NvcGUuZGF5c1tpXS5pc1NlbGVjdGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY3JvbiA9IGdlbmVyYXRlQ3JvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NvcGUuaW50ZXJmYWNlQ2xpY2tlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNyb24gPSBnZW5lcmF0ZUNyb24oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NvcGUuY2hhbmdlVGltZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5wYXJ0T2ZEYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYW1QbUhvdXJzID0gXCIxMlwiO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmFtUG1Ib3VycyA9IFwiMDBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnaG91cnMnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHNjb3BlLmNyb24gPSBnZW5lcmF0ZUNyb24oKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ21pbnV0ZXMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5jcm9uID0gZ2VuZXJhdGVDcm9uKCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRVcFZpZXcoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmlzRWRpdE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzZWN0Q3JvbihzY29wZS5jcm9uKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRPZkRheSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5ob3VycyA9IFwiNlwiO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5taW51dGVzID0gXCIwXCI7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNyb24gPSBnZW5lcmF0ZUNyb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ3JvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3JvbiA9ICcwICc7XG4gICAgICAgICAgICAgICAgdmFyIGRheXNTZWxlY3RlZCA9IDA7XG5cbiAgICAgICAgICAgICAgICBjcm9uICs9IHNjb3BlLm1pbnV0ZXMgKyAnICc7XG5cblxuICAgICAgICAgICAgICAgIGlmICghc2NvcGUucGFydE9mRGF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhbUhvdXJzID0gc2NvcGUuaG91cnM7XG4gICAgICAgICAgICAgICAgICAgIGNyb24gKz0gYW1Ib3VycyArICcgJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcG1Ib3VycyA9IChwYXJzZUludChzY29wZS5ob3VycykgKyAxMikudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgY3JvbiArPSBwbUhvdXJzICsgJyAnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNyb24gKz0gJz8gKiAnO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY29wZS5kYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5kYXlzW2ldLmlzU2VsZWN0ZWQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5c1NlbGVjdGVkKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBjcm9uICs9IHNjb3BlLmRheXNbaV0ubmFtZSArICcsJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgICAgIGlmIChkYXlzU2VsZWN0ZWQgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBjcm9uICs9ICcqJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjcm9uID0gY3Jvbi5zbGljZSgwLCAtMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc2VjdENyb24oY3JvblN0aW5nKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3JvbkVsZW1lbnRzID0gY3JvblN0aW5nLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICAgICAgdmFyIGNyb25NaW51dGVzID0gY3JvbkVsZW1lbnRzWzFdO1xuICAgICAgICAgICAgICAgIHZhciBjcm9uSG91cnMgPSBjcm9uRWxlbWVudHNbMl07XG4gICAgICAgICAgICAgICAgdmFyIGNyb25EYXlzT2ZXZWVrID0gY3JvbkVsZW1lbnRzWzVdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNyb25EYXlzT2ZXZWVrKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcGFyYXRlZERheXMgPSBjcm9uRGF5c09mV2Vlay5zcGxpdCgnLCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VwYXJhdGVkRGF5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzY29wZS5kYXlzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlcGFyYXRlZERheXNbaV0gPT0gc2NvcGUuZGF5c1tqXS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRheXNbal0uaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNyb25Ib3VycyA+PSAwICYmIGNyb25Ib3VycyA8IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRPZkRheSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5ob3VycyA9IGNyb25Ib3VycztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY3JvbkhvdXJzID49IDEyICYmIGNyb25Ib3VycyA8IDI0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhcnRPZkRheSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmhvdXJzID0gKGNyb25Ib3VycyAtIDEyKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBzY29wZS5taW51dGVzID0gY3Jvbk1pbnV0ZXM7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0VXBWaWV3KCk7XG5cbiAgICAgICAgfTtcbiAgICB9XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIoZnVuY3Rpb24obmcpIHtcblxuICAgIG5nXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2RldmljZU9yU2VydmljZVN0ZXAnLCBkZXZpY2VPclNlcnZpY2VTdGVwKTtcblxuICAgIGRldmljZU9yU2VydmljZVN0ZXAuJGluamVjdCA9IFsnJGZpbHRlcicsICd1dGlsaXR5LmRldmljZUljb25zJ107XG5cbiAgICBmdW5jdGlvbiBkZXZpY2VPclNlcnZpY2VTdGVwKCRmaWx0ZXIsIGljb25zKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9zdGVwcy9kZXZpY2Utb3Itc2VydmljZS1zdGVwL3ZpZXcuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnQCcsXG4gICAgICAgICAgICAgICAgYXNzZXRUeXBlRmlsdGVyOiAnQCcsXG4gICAgICAgICAgICAgICAgY2hvaWNlVHlwZTogJz0nLFxuICAgICAgICAgICAgICAgIHNlcnZpY2VzOiAnPT8nLFxuICAgICAgICAgICAgICAgIGRldmljZXM6ICc9PycsXG4gICAgICAgICAgICAgICAgZGV2aWNlQm94VGl0bGU6ICdAJyxcbiAgICAgICAgICAgICAgICBkZXZpY2VCb3hTdWJ0ZXh0OiAnQCcsXG4gICAgICAgICAgICAgICAgc2hvd05vdGlmeTogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLmFjdGlvbk9yVHJpZ2dlciA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5kZXZpY2VUZXh0QXBwZW5kID0gbnVsbDtcblxuICAgICAgICAgICAgc2NvcGUuZ2V0SWNvbiA9IGZ1bmN0aW9uKGljb25LZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWNvbnMuZ2V0SWNvbihpY29uS2V5KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLm9uRGV2aWNlU2VsZWN0ZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5jaG9pY2VUeXBlID0gJ2RldmljZSc7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5vblNlcnZpY2VTZWxlY3RlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNob2ljZVR5cGUgPSAnc2VydmljZSc7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5oYXNBdmFpbGFibGVEZXZpY2VzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWREZXZpY2VzID0gJGZpbHRlcignZGV2aWNlc1dpdGhBc3NldEZpbHRlcicpKHNjb3BlLmRldmljZXMsIHNjb3BlLmFzc2V0VHlwZUZpbHRlcik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmlsdGVyZWREZXZpY2VzLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSh3aW5kb3cuYW5ndWxhcikpO1xuIiwiKGZ1bmN0aW9uKG5nKSB7XG4gICAgbmdcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnZGV2aWNlU3RlcCcsIGRldmljZVN0ZXApO1xuXG4gICAgZGV2aWNlU3RlcC4kaW5qZWN0ID0gWyd1dGlsaXR5LmRldmljZUljb25zJ107XG5cbiAgICBmdW5jdGlvbiBkZXZpY2VTdGVwKGljb25zKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9zdGVwcy9kZXZpY2Utc3RlcC92aWV3Lmh0bWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkZXZpY2VzOiAnPScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdAJyxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZERldmljZTogJz0nLFxuICAgICAgICAgICAgICAgIGFzc2V0VHlwZUZpbHRlcjogJ0AnXG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSkge1xuXG4gICAgICAgICAgICBzY29wZS5nZXRJY29uID0gZnVuY3Rpb24oaWNvbktleSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpY29ucy5nZXRJY29uKGljb25LZXkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUub25EZXZpY2VTZWxlY3RlZCA9IGZ1bmN0aW9uKGl0ZW0sIG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWREZXZpY2UgPSBpdGVtO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn0od2luZG93LmFuZ3VsYXIpKTsiLCIoZnVuY3Rpb24obmcpIHtcbiAgICBuZ1xuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCdzZWxlY3ROb3RpZmljYXRpb25UeXBlJywgc2VsZWN0Tm90aWZpY2F0aW9uVHlwZSk7XG5cbiAgICBzZWxlY3ROb3RpZmljYXRpb25UeXBlLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIHNlbGVjdE5vdGlmaWNhdGlvblR5cGUoKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hc3NldHMvanMvYXBwL2RpcmVjdGl2ZXMvcnVsZS1zdGVwcy9zdGVwcy9zZWxlY3Qtbm90aWZpY2F0aW9uLXR5cGUvdmlldy5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWROb3RpZmljYXRpb25zOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXJcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSkge1xuXG4gICAgICAgICAgICBzY29wZS5vbldlYkl0ZW1DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkTm90aWZpY2F0aW9ucy53ZWIgPSAhc2NvcGUuc2VsZWN0ZWROb3RpZmljYXRpb25zLndlYjtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLm9uUHVzaEl0ZW1DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5wdXNoID0gIXNjb3BlLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5wdXNoO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUub25FbWFpbEl0ZW1DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkTm90aWZpY2F0aW9ucy5lbWFpbCA9ICFzY29wZS5zZWxlY3RlZE5vdGlmaWNhdGlvbnMuZW1haWw7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIH1cbiAgICB9XG59KHdpbmRvdy5hbmd1bGFyKSk7XG4iLCIvKiFcbiAqIFNtYXJ0bGl2aW5nIFdpZGdldHMgZm9yIEFuZ3VsYXJcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hbGx0aGluZ3N0YWxzay9zbWFydGxpdmluZy13aWRnZXRzXG4gKiBAbGljZW5zZSBNSVRcbiAqIHYwLjdcbiAqL1xuXG5cbmlmICghU3RyaW5nLnByb3RvdHlwZS5mb3JtYXQpIHtcbiAgICBTdHJpbmcucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZSgveyhcXGQrKX0vZywgZnVuY3Rpb24obWF0Y2gsIG51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBhcmdzW251bWJlcl0gIT0gJ3VuZGVmaW5lZCcgPyBhcmdzW251bWJlcl0gOiBtYXRjaDtcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cblxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycsIFtcbiAgICAgICAgJ25nQW5pbWF0ZScsXG4gICAgICAgICd1aS5zZWxlY3QnLFxuICAgICAgICAnbmdNYXRlcmlhbCcsXG4gICAgICAgICd1aS5rbm9iJyxcbiAgICAgICAgJ2pzb25Gb3JtYXR0ZXInLFxuICAgICAgICAnYW5ndWxhclNwZWN0cnVtQ29sb3JwaWNrZXInLFxuICAgICAgICAnbGVhZmxldC1kaXJlY3RpdmUnLFxuICAgICAgICAnbnZkMycsXG4gICAgICAgICduZ1RvdWNoJ1xuICAgIF0pO1xufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbmdTbWFydGxpdmluZ1dpZGdldHMnKVxuICAgICAgICAuZmFjdG9yeSgnd2lkZ2V0c0NvbW1vbicsIGZhY3RvcnkpO1xuXG4gICAgZmFjdG9yeS4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBmYWN0b3J5KCkge1xuICAgICAgICB2YXIgZGVmYXVsdENvbnRyb2xzID0ge1xuICAgICAgICAgICAgYm9vbGVhbjoge1xuICAgICAgICAgICAgICAgIHNlbnNvcjogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnb25vZmYnO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBhY3R1YXRvcjogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndG9nZ2xlJztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgdmlydHVhbDogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnb25vZmYnO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBjb25maWc6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ29ub2ZmJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3RyaW5nOiB7XG4gICAgICAgICAgICAgICAgc2Vuc29yOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsYWJlbCc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGFjdHVhdG9yOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdpbnB1dCc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIHZpcnR1YWw6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2xhYmVsJztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgY29uZmlnOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsYWJlbCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludGVnZXI6IHtcbiAgICAgICAgICAgICAgICBzZW5zb3I6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2xhYmVsJztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgYWN0dWF0b3I6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGFzc2V0UHJvZmlsZS5taW5pbXVtIHx8IGFzc2V0UHJvZmlsZS5taW5pbXVtID09PSAwKSAmJiAoYXNzZXRQcm9maWxlLm1heGltdW0gfHwgYXNzZXRQcm9maWxlLm1heGltdW0gPT09IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NsaWRlcic7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2lucHV0JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB2aXJ0dWFsOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsYWJlbCc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNvbmZpZzogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBudW1iZXI6IHtcbiAgICAgICAgICAgICAgICBzZW5zb3I6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2xhYmVsJztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgYWN0dWF0b3I6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGFzc2V0UHJvZmlsZS5taW5pbXVtIHx8IGFzc2V0UHJvZmlsZS5taW5pbXVtID09PSAwKSAmJiAoYXNzZXRQcm9maWxlLm1heGltdW0gfHwgYXNzZXRQcm9maWxlLm1heGltdW0gPT09IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NsaWRlcic7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2lucHV0JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB2aXJ0dWFsOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsYWJlbCc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNvbmZpZzogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYmplY3Q6IHtcbiAgICAgICAgICAgICAgICBzZW5zb3I6IGZ1bmN0aW9uKGFzc2V0UHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2pzb24nO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBhY3R1YXRvcjogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndGV4dC1lZGl0b3InO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB2aXJ0dWFsOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdqc29uJztcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgY29uZmlnOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdqc29uJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHNlbnNvcjogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwnO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBhY3R1YXRvcjogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnaW5wdXQnO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB2aXJ0dWFsOiBmdW5jdGlvbihhc3NldFByb2ZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdsYWJlbCc7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGNvbmZpZzogZnVuY3Rpb24oYXNzZXRQcm9maWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGZpbmREZWZhdWx0Q29udHJvbDogZmluZERlZmF1bHRDb250cm9sXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBmaW5kRGVmYXVsdENvbnRyb2woYXNzZXQpIHtcblxuICAgICAgICAgICAgdmFyIGNvbnRyb2wgPSBudWxsO1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IGRlZmF1bHRDb250cm9sc1thc3NldC5wcm9maWxlLnR5cGVdO1xuXG4gICAgICAgICAgICBpZiAoIWNvbmZpZykge1xuICAgICAgICAgICAgICAgIGNvbmZpZyA9IGRlZmF1bHRDb250cm9sc1snZGVmYXVsdCddO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb250cm9sID0gY29uZmlnW2Fzc2V0LmlzXShhc3NldC5wcm9maWxlKTtcblxuICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2w7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5mYWN0b3J5KCdjb25maWcnLCBmYWN0b3J5KTtcblxuICAgIGZhY3RvcnkuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gZmFjdG9yeSgpIHtcblxuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgZGVmYXVsdE1pbmltdW06IDAsXG4gICAgICAgICAgICBkZWZhdWx0TWF4aW11bTogMTAwLFxuICAgICAgICAgICAgb3V0T2ZCb3VuZHNNZXNzYWdlOiAnVmFsdWUgaXMgb3V0IG9mIGJvdW5kcy4gVG8gc2VlIHswfSBjb250cm9sIGFkanVzdCB0aGUgYm91bmRzIGluIGFzc2V0IHByb2ZpbGUuJyxcbiAgICAgICAgICAgIGludmFsaWRCb3VuZHNNZXNzYWdlOiAnTWluaW11bSBib3VuZCBpcyBncmVhdGVyIHRoYW4gbWF4aW11bSBib3VuZC4gQ2hlY2sgYXNzZXQgcHJvZmlsZS4nXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjb25maWc7XG4gICAgfVxufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2R5bmFtaWNDb250cm9sJywgZHluYW1pY0NvbnRyb2wpO1xuXG4gICAgZHluYW1pY0NvbnRyb2wuJGluamVjdCA9IFsnJGNvbXBpbGUnLCAnd2lkZ2V0c0NvbW1vbiddO1xuXG4gICAgZnVuY3Rpb24gZHluYW1pY0NvbnRyb2woJGNvbXBpbGUsIHdpZGdldHNDb21tb24pIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlcixcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgYXNzZXQ6ICc9JyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogJyYnLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbnRyb2woYXNzZXQpIHtcblxuICAgICAgICAgICAgdmFyIGNvbnRyb2xOYW1lID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmNvbnRyb2wpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGFzc2V0LmNvbnRyb2wpID09ICdvYmplY3QnICYmIGFzc2V0LmNvbnRyb2wubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sTmFtZSA9IGFzc2V0LmNvbnRyb2wubmFtZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihhc3NldC5jb250cm9sKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sTmFtZSA9IGFzc2V0LmNvbnRyb2w7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWNvbnRyb2xOYW1lKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbE5hbWUgPSB3aWRnZXRzQ29tbW9uLmZpbmREZWZhdWx0Q29udHJvbChhc3NldCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBjb250cm9sTmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlVGVtcGxhdGUoY29udHJvbE5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gJzx7MH0tY29udHJvbCB2YWx1ZT1cImFzc2V0LnN0YXRlLnZhbHVlXCIgcHJvZmlsZT1cImFzc2V0LnByb2ZpbGVcIiBpZD1cImFzc2V0LmlkXCIgb24tY2hhbmdlPVwicHVibGlzaCh2YWwpXCIgZW5hYmxlZD1cImVuYWJsZWRcIiBhc3NldD1cImFzc2V0XCIgY29uZmlndXJhdGlvbj1cImNvbmZpZ3VyYXRpb25cIj48L3swfS1jb250cm9sPicuZm9ybWF0KGNvbnRyb2xOYW1lKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Fzc2V0JywgZnVuY3Rpb24obmV3QXNzZXQpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5hc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250cm9sTmFtZSA9IGdldENvbnRyb2woc2NvcGUuYXNzZXQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbChnZW5lcmF0ZVRlbXBsYXRlKGNvbnRyb2xOYW1lKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUoZWxlbWVudC5jb250ZW50cygpKShzY29wZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLnB1Ymxpc2ggPSBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUub25DaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2Fzc2V0Q2hhcnQnLCBhc3NldENoYXJ0KTtcblxuICAgIHZhciBfZGVmYXVsdExvYWRGcm9tID0gJ3Bhc3QtMjRoJztcbiAgICB2YXIgX2NoYXJ0UmVmcmVzaFJhdGUgPSAxMDAwO1xuXG4gICAgZnVuY3Rpb24gYXNzZXRDaGFydCgpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y2hhcnQgd2lkdGgtY2hhbmdlLWRldGVjdD48bnZkMyBuZy1jbGFzcz1cInt6b29tOiB2bS5ob3ZlcmVkfVwiIGNsYXNzPWxpbmVjaGFydCBkYXRhPXZtLmNoYXJ0RGF0YSBvcHRpb25zPXZtLm9wdGlvbnMgaWQ9bGluZWNoYXJ0PjwvbnZkMz48L2Rpdj4nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgYXNzZXRzOiAnPScsXG4gICAgICAgICAgICAgICAgY29uZmlnOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgfVxuXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckcScsICckaW50ZXJ2YWwnLCAnaGlzdG9yeS5zZXJ2aWNlJ107XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHEsICRpbnRlcnZhbCwgaGlzdG9yeVNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5jb2xvcnMgPSBkMy5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoWycjNTY2NDZEJywgJyMyNjcwRTAnLCAnIzI1QzJENScsICcjNDNDMzk5JywgJyNBOEMxNEQnLCAnI0Y0QzQ1QicsICcjRkY4NTVBJywgJyNGRjY0NTgnLCAnI0VENEQ3MycsICcjOTA2OEM4J10pO1xuXG4gICAgICAgIHZtLnJlZHJhd1RyaWdnZXIgPSBmYWxzZTtcblxuICAgICAgICAvLyBEYXRhIGZvciBjaGFydC4gRXZlcnkgb2JqZWN0IGluIGFycmF5IG11c3QgY29udGFpbiB7IHZhbHVlczogWyB7eDogLHk6IH0sIHt4OiAseTogfSwgLi4uXX1cbiAgICAgICAgdm0uY2hhcnREYXRhID0gW3tcbiAgICAgICAgICAgIHZhbHVlczogW3tcbiAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgIHk6IDBcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH1dO1xuXG4gICAgICAgIHZtLmRhdGEgPSBbXTtcblxuICAgICAgICB2bS5hc3NldEhpc3RvcmllcyA9IFtdO1xuICAgICAgICB2bS5jb25maWdBc3NldHMgPSBbXTtcblxuICAgICAgICB2bS5ob3ZlcmVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHJlYWxUaW1lSW50ZXJ2YWw7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLmFzc2V0cycsIGluaXRpYWxpemVIaXN0b3J5KTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uY29uZmlnLnJlZnJlc2hDaGFydCcsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplSGlzdG9yeSgpO1xuICAgICAgICAgICAgICAgICAgICB2bS5jb25maWcucmVmcmVzaENoYXJ0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ19fd2lkdGgnLCBmdW5jdGlvbihuZXdXaWR0aCwgb2xkV2lkdGgpIHtcblxuICAgICAgICAgICAgICAgIC8vYWxlcnQoJ2RldGVjdGVkIScgKyBuZXdXaWR0aCk7XG4gICAgICAgICAgICAgICAgaWYgKCEhbmV3V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucmVkcmF3VHJpZ2dlciA9ICF2bS5yZWRyYXdUcmlnZ2VyO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmNvbmZpZy50aW1lU2NhbGUnLCBmdW5jdGlvbihuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gJzYwbScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHJlYWxUaW1lSW50ZXJ2YWwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZWFsVGltZUludGVydmFsID0gJGludGVydmFsKGluaXRpYWxpemVIaXN0b3J5LCA2MDAwMCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lUaW1lcigpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHNjb3BlLiRvbignZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgZGVzdHJveVRpbWVyKCk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZXN0cm95VGltZXIoKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQocmVhbFRpbWVJbnRlcnZhbCkpIHtcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHJlYWxUaW1lSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIHJlYWxUaW1lSW50ZXJ2YWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplSGlzdG9yeSgpIHtcblxuICAgICAgICAgICAgdm0uZGF0YSA9IFtdO1xuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnID09PSBudWxsIHx8IHZtLmNvbmZpZyA9PT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodm0uYXNzZXRzLmxlbmd0aCA9PT0gMSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wQXNzZXQgPSB2bS5hc3NldHNbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBBc3NldC5jb250cm9sKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wQXNzZXQuY29udHJvbC5leHRyYXMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNvbmZpZyA9IHRlbXBBc3NldC5jb250cm9sLmV4dHJhcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jb25maWcgPSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpbmUtY2hhcnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2NhbGU6ICc2MG0nXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGltZVNldCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmICh2bS5jb25maWcudHlwZSA9PT0gJ2Jhci1jaGFydCcpIHtcblxuICAgICAgICAgICAgICAgIHZtLm9wdGlvbnMgPSBnZW5lcmF0ZUJhckNoYXJ0T3B0aW9ucygpO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLmNvbmZpZy50eXBlID09PSAnbGluZS1jaGFydCcpIHtcblxuICAgICAgICAgICAgICAgIHZtLm9wdGlvbnMgPSBnZW5lcmF0ZUxpbmVDaGFydE9wdGlvbnMoKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5jb25maWcudHlwZSA9PT0gJ2FyZWEtcmFuZ2UtY2hhcnQnKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5vcHRpb25zID0gZ2VuZXJhdGVBcmVhUmFuZ2VDaGFydE9wdGlvbnMoKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSkge1xuXG4gICAgICAgICAgICAgICAgdGltZVNldCA9IGdlbmVyYXRlVGltZVNldCh2bS5jb25maWcudGltZVNjYWxlLCB2bS5jb25maWcucGFnZSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0ID0gZ2VuZXJhdGVUaW1lU2V0KCc2MG0nLCB2bS5jb25maWcucGFnZSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmFzc2V0cyAmJiB2bS5hc3NldHMubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeURhdGFQcm9taXNlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5hc3NldHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYXNzZXQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5hc3NldHNbaV0uX3Nob3dBc3NldCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NldCA9IHZtLmFzc2V0c1tpXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0LmlzICE9PSAnY29uZmlnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gaGlzdG9yeVNlcnZpY2UuZ2V0QXNzZXRIaXN0b3J5KGFzc2V0LmlkLCB0aW1lU2V0LmZyb20sIHRpbWVTZXQudG8sIHRpbWVTZXQucmVzb2x1dGlvbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0SGlzdG9yeUxvYWRlZEhhbmRsZXIoYXNzZXQpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlEYXRhUHJvbWlzZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnB1c2gocHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNvbmZpZ0Fzc2V0cy5wdXNoKGFzc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHEuYWxsKGhpc3RvcnlEYXRhUHJvbWlzZXMpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5jb25maWdBc3NldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzZXQgPSB2bS5jb25maWdBc3NldHNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdGFudERhdGFNYXBwZXIoYXNzZXQsIHZtLmFzc2V0SGlzdG9yaWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY29uZmlnQXNzZXRzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hc3NldEhpc3RvcmllcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jaGFydERhdGEgPSBhbmd1bGFyLmNvcHkodm0uZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVUaW1lU2V0KHRpbWUsIHBhZ2UpIHtcblxuICAgICAgICAgICAgdmFyIHRpbWVTZXQgPSB7XG4gICAgICAgICAgICAgICAgZnJvbTogbnVsbCxcbiAgICAgICAgICAgICAgICB0bzogbnVsbCxcbiAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAocGFnZSA9PT0gbnVsbCB8fCBwYWdlID09PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIHBhZ2UgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZnJhbWVTdGFydCA9IG51bGw7XG4gICAgICAgICAgICB2YXIgZnJhbWVFbmQgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodGltZSA9PT0gJzMwZCcpIHtcblxuICAgICAgICAgICAgICAgIGZyYW1lU3RhcnQgPSAzMCAqIChwYWdlICsgMSk7XG4gICAgICAgICAgICAgICAgZnJhbWVFbmQgPSAzMCAqIHBhZ2U7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LnJlc29sdXRpb24gPSAnZGF5JztcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQuZnJvbSA9IG1vbWVudCgpLnN1YnRyYWN0KGZyYW1lU3RhcnQsICdkYXlzJyk7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LmZyb20gPSB0aW1lU2V0LmZyb20uZm9ybWF0KCk7XG5cbiAgICAgICAgICAgICAgICB2bS5jb25maWcuZnJvbSA9IHRpbWVTZXQuZnJvbTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQudG8gPSBtb21lbnQoKS5zdWJ0cmFjdChmcmFtZUVuZCwgJ2RheXMnKTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQudG8gPSB0aW1lU2V0LnRvLmZvcm1hdCgpO1xuXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnLnRvID0gdGltZVNldC50bztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGltZSA9PT0gJzdkJykge1xuXG4gICAgICAgICAgICAgICAgZnJhbWVTdGFydCA9IDcgKiAocGFnZSArIDEpO1xuICAgICAgICAgICAgICAgIGZyYW1lRW5kID0gNyAqIHBhZ2U7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LnJlc29sdXRpb24gPSAnaG91cic7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LmZyb20gPSBtb21lbnQoKS5zdWJ0cmFjdChmcmFtZVN0YXJ0LCAnZGF5cycpO1xuXG4gICAgICAgICAgICAgICAgdGltZVNldC5mcm9tID0gdGltZVNldC5mcm9tLmZvcm1hdCgpO1xuXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnLmZyb20gPSB0aW1lU2V0LmZyb207XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LnRvID0gbW9tZW50KCkuc3VidHJhY3QoZnJhbWVFbmQsICdkYXlzJyk7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LnRvID0gdGltZVNldC50by5mb3JtYXQoKTtcblxuICAgICAgICAgICAgICAgIHZtLmNvbmZpZy50byA9IHRpbWVTZXQudG87XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRpbWUgPT09ICcyNGgnKSB7XG5cbiAgICAgICAgICAgICAgICBmcmFtZVN0YXJ0ID0gMjQgKiAocGFnZSArIDEpO1xuICAgICAgICAgICAgICAgIGZyYW1lRW5kID0gMjQgKiBwYWdlO1xuXG4gICAgICAgICAgICAgICAgdGltZVNldC5yZXNvbHV0aW9uID0gJ21pbnV0ZSc7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LmZyb20gPSBtb21lbnQoKS5zdWJ0cmFjdChmcmFtZVN0YXJ0LCAnaG91cnMnKTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQuZnJvbSA9IHRpbWVTZXQuZnJvbS5mb3JtYXQoKTtcblxuICAgICAgICAgICAgICAgIHZtLmNvbmZpZy5mcm9tID0gdGltZVNldC5mcm9tO1xuXG4gICAgICAgICAgICAgICAgdGltZVNldC50byA9IG1vbWVudCgpLnN1YnRyYWN0KGZyYW1lRW5kLCAnaG91cnMnKTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQudG8gPSB0aW1lU2V0LnRvLmZvcm1hdCgpO1xuXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnLnRvID0gdGltZVNldC50bztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGltZSA9PT0gJzYwbScpIHtcblxuICAgICAgICAgICAgICAgIGZyYW1lU3RhcnQgPSA2MCAqIChwYWdlICsgMSk7XG4gICAgICAgICAgICAgICAgZnJhbWVFbmQgPSA2MCAqIHBhZ2U7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LnJlc29sdXRpb24gPSAnbWludXRlJztcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQuZnJvbSA9IG1vbWVudCgpLnN1YnRyYWN0KGZyYW1lU3RhcnQsICdtaW51dGVzJyk7XG5cbiAgICAgICAgICAgICAgICB0aW1lU2V0LmZyb20gPSB0aW1lU2V0LmZyb20uZm9ybWF0KCk7XG5cbiAgICAgICAgICAgICAgICB2bS5jb25maWcuZnJvbSA9IHRpbWVTZXQuZnJvbTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQudG8gPSBtb21lbnQoKS5zdWJ0cmFjdChmcmFtZUVuZCwgJ21pbnV0ZXMnKTtcblxuICAgICAgICAgICAgICAgIHRpbWVTZXQudG8gPSB0aW1lU2V0LnRvLmZvcm1hdCgpO1xuXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnLnRvID0gdGltZVNldC50bztcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGltZVNldDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEhpc3RvcnlMb2FkZWRIYW5kbGVyKGFzc2V0KSB7XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihoaXN0b3J5KSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodm0uY29uZmlnLnR5cGUgPT09ICdhcmVhLXJhbmdlLWNoYXJ0Jykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLmFzc2V0SGlzdG9yaWVzLnB1c2goaGlzdG9yeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXJlYVJhbmdlRGF0YU1hcHBlcihoaXN0b3J5LCBhc3NldCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLmFzc2V0SGlzdG9yaWVzLnB1c2goaGlzdG9yeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGF0YU1hcHBlcihoaXN0b3J5LCBhc3NldCwgJ2F2ZXJhZ2UnKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlTGluZUNoYXJ0T3B0aW9ucygpIHtcblxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgY2hhcnQ6IHt9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnR5cGUgPSAnbGluZUNoYXJ0JztcbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQudXNlSW50ZXJhY3RpdmVHdWlkZWxpbmUgPSBmYWxzZTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQuaW50ZXJwb2xhdGUgPSAnbW9ub3RvbmUnO1xuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5wb2ludFNpemUgPSAxMDtcbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQuZHVyYXRpb24gPSAwO1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnggPSBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQueDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueSA9IGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC55ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoZC55ICogMTAwKSAvIDEwMDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueEF4aXMgPSB7XG4gICAgICAgICAgICAgICAgdGlja0Zvcm1hdDogdGlja0Zvcm1hdGVyLFxuICAgICAgICAgICAgICAgIHRpY2tWYWx1ZXM6IHRpY2tWYWx1ZXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueUF4aXMgPSB7XG4gICAgICAgICAgICAgICAgdGlja0Zvcm1hdDogZnVuY3Rpb24oZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkMy5mb3JtYXQoJywuMWYnKShkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnNob3dMZWdlbmQgPSBmYWxzZTtcbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQubWFyZ2luID0ge1xuICAgICAgICAgICAgICAgIHRvcDogNDAsXG4gICAgICAgICAgICAgICAgbGVmdDogNDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDQwLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogNDBcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQubGluZXMgPSB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2g6IHtcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Q2xpY2s6IGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tIYW5kbGVyKGUpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudE1vdXNlb3ZlcjogaG92ZXJFdmVudFxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlQmFyQ2hhcnRPcHRpb25zKCkge1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBjaGFydDoge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueCA9IGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC54O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC55ID0gZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIGlmIChkLnkgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQueTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChkLnkgKiAxMDApIC8gMTAwO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5kdXJhdGlvbiA9IDA7XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueEF4aXMgPSB7XG4gICAgICAgICAgICAgICAgdGlja0Zvcm1hdDogdGlja0Zvcm1hdGVyLFxuICAgICAgICAgICAgICAgIHRpY2tWYWx1ZXM6IHRpY2tWYWx1ZXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueUF4aXMxID0ge1xuICAgICAgICAgICAgICAgIHRpY2tGb3JtYXQ6IGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc05hTihkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQzLmZvcm1hdCgnLC4xZicpKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5zaG93TGVnZW5kID0gZmFsc2U7XG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnN0YWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5tYXJnaW4gPSB7XG4gICAgICAgICAgICAgICAgdG9wOiA0MCxcbiAgICAgICAgICAgICAgICBsZWZ0OiA0MCxcbiAgICAgICAgICAgICAgICByaWdodDogNDAsXG4gICAgICAgICAgICAgICAgYm90dG9tOiA0MFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5iYXJzMSA9IHtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaDoge1xuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRDbGljazogZnVuY3Rpb24oZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja0hhbmRsZXIoZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50TW91c2VvdmVyOiBob3ZlckV2ZW50XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnR5cGUgPSAnbXVsdGlDaGFydCc7XG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnNob3dDb250cm9scyA9IGZhbHNlO1xuXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlQXJlYVJhbmdlQ2hhcnRPcHRpb25zKCkge1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBjaGFydDoge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQudHlwZSA9ICdsaW5lQ2hhcnQnO1xuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC51c2VJbnRlcmFjdGl2ZUd1aWRlbGluZSA9IGZhbHNlO1xuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5pbnRlcnBvbGF0ZSA9ICdtb25vdG9uZSc7XG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnBvaW50U2l6ZSA9IDEwO1xuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5kdXJhdGlvbiA9IDA7XG5cbiAgICAgICAgICAgIG9wdGlvbnMuY2hhcnQueCA9IGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC54O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC55ID0gZnVuY3Rpb24oZCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGQueSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC55O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKGQueSAqIDEwMCkgLyAxMDA7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnhBeGlzID0ge1xuICAgICAgICAgICAgICAgIHRpY2tGb3JtYXQ6IHRpY2tGb3JtYXRlcixcbiAgICAgICAgICAgICAgICB0aWNrVmFsdWVzOiB0aWNrVmFsdWVzXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LnlBeGlzID0ge1xuICAgICAgICAgICAgICAgIHRpY2tGb3JtYXQ6IGZ1bmN0aW9uKGQpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZDMuZm9ybWF0KCcsLjFmJykoZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgb3B0aW9ucy5jaGFydC5zaG93TGVnZW5kID0gZmFsc2U7XG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0Lm1hcmdpbiA9IHtcbiAgICAgICAgICAgICAgICB0b3A6IDQwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDQwLFxuICAgICAgICAgICAgICAgIHJpZ2h0OiA0MCxcbiAgICAgICAgICAgICAgICBib3R0b206IDQwXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBvcHRpb25zLmNoYXJ0LmxpbmVzID0ge1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudENsaWNrOiBmdW5jdGlvbihlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrSGFuZGxlcihlKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRNb3VzZW92ZXI6IGhvdmVyRXZlbnRcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjbGlja0hhbmRsZXIoZXZlbnQpIHtcblxuICAgICAgICAgICAgdmFyIHRpbWVUb1pvb20gPSBudWxsO1xuICAgICAgICAgICAgdmFyIHBhZ2UgPSAwO1xuXG4gICAgICAgICAgICBpZiAoZXZlbnQuZGF0YSAmJiBldmVudC5kYXRhLnggIT09IG51bGwpIHtcblxuICAgICAgICAgICAgICAgIHRpbWVUb1pvb20gPSBldmVudC5kYXRhLng7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQubGVuZ3RoICYmIGV2ZW50Lmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgIHRpbWVUb1pvb20gPSBldmVudFswXS5wb2ludC54O1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdGltZVRvWm9vbSA9IGV2ZW50LnBvaW50Lng7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50aW1lU2NhbGUgPT09ICczMGQnKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5jb25maWcucGFnZSA9IG1vbWVudChuZXcgRGF0ZSgpKS5kaWZmKHRpbWVUb1pvb20sICdkYXlzJyk7XG5cbiAgICAgICAgICAgICAgICB2bS5jb25maWcudGltZVNjYWxlID0gJzI0aCc7XG5cbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3RpbWVTY2FsZVVwZGF0ZWQnLCB2bS5jb25maWcudGltZVNjYWxlKTtcblxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVIaXN0b3J5KCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50aW1lU2NhbGUgPT09ICc3ZCcpIHtcblxuICAgICAgICAgICAgICAgIHZtLmNvbmZpZy5wYWdlID0gbW9tZW50KG5ldyBEYXRlKCkpLmRpZmYodGltZVRvWm9vbSwgJ2RheXMnKTtcblxuICAgICAgICAgICAgICAgIHZtLmNvbmZpZy50aW1lU2NhbGUgPSAnMjRoJztcblxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndGltZVNjYWxlVXBkYXRlZCcsIHZtLmNvbmZpZy50aW1lU2NhbGUpO1xuXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUhpc3RvcnkoKTtcblxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50aW1lU2NhbGUgPT09ICcyNGgnKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5jb25maWcucGFnZSA9IG1vbWVudChuZXcgRGF0ZSgpKS5kaWZmKHRpbWVUb1pvb20sICdob3VycycpO1xuXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnLnRpbWVTY2FsZSA9ICc2MG0nO1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd0aW1lU2NhbGVVcGRhdGVkJywgdm0uY29uZmlnLnRpbWVTY2FsZSk7XG5cbiAgICAgICAgICAgICAgICBpbml0aWFsaXplSGlzdG9yeSgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGhvdmVyRXZlbnQoZSkge1xuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSA9PT0gJzYwbScpIHtcbiAgICAgICAgICAgICAgICB2bS5ob3ZlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmhvdmVyZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB0aWNrRm9ybWF0ZXIoZCkge1xuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50aW1lU2NhbGUgPT09ICc3ZCcpIHtcblxuICAgICAgICAgICAgICAgIHZhciBkYXlzRGF0ZSA9IG5ldyBEYXRlKGQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkMy50aW1lLmZvcm1hdCgnJUEnKShkYXlzRGF0ZSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSA9PT0gJzMwZCcpIHtcblxuICAgICAgICAgICAgICAgIHZhciBtb250aERhdGUgPSBuZXcgRGF0ZShkKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkMy50aW1lLmZvcm1hdCgnJWQgJWInKShtb250aERhdGUpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBob3Vyc0RhdGUgPSBuZXcgRGF0ZShkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDMudGltZS5mb3JtYXQoJyVIOiVNJykoaG91cnNEYXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRpY2tWYWx1ZXMoZCkge1xuXG4gICAgICAgICAgICB2YXIgZmlyc3RUaW1lID0gZFswXS52YWx1ZXNbMF0ueDtcbiAgICAgICAgICAgIHZhciBzaXplID0gZFswXS52YWx1ZXMubGVuZ3RoO1xuICAgICAgICAgICAgdmFyIGxhc3RUaW1lID0gZFswXS52YWx1ZXNbc2l6ZSAtIDFdLng7XG4gICAgICAgICAgICB2YXIgdGltZUZvcm1hdCA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmICh2bS5jb25maWcudGltZVNjYWxlID09PSAnNjBtJykge1xuICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQgPSBkMy50aW1lLm1pbnV0ZS5yYW5nZShuZXcgRGF0ZShmaXJzdFRpbWUpLCBuZXcgRGF0ZShsYXN0VGltZSksIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50aW1lU2NhbGUgPT09ICcyNGgnKSB7XG4gICAgICAgICAgICAgICAgdGltZUZvcm1hdCA9IGQzLnRpbWUuaG91ci5yYW5nZShuZXcgRGF0ZShmaXJzdFRpbWUpLCBuZXcgRGF0ZShsYXN0VGltZSksIDQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSA9PT0gJzdkJykge1xuICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQgPSBkMy50aW1lLmRheS5yYW5nZShuZXcgRGF0ZShmaXJzdFRpbWUpLCBuZXcgRGF0ZShsYXN0VGltZSksIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSA9PT0gJzMwZCcpIHtcblxuICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQgPSBkMy50aW1lLmRheS5yYW5nZShuZXcgRGF0ZShmaXJzdFRpbWUpLCBuZXcgRGF0ZShsYXN0VGltZSksIDQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGltZUZvcm1hdDtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkRGF0YShzZXJpZXMsIHRpbWUsIHZhbHVlKSB7XG5cbiAgICAgICAgICAgIHZhciBkID0ge1xuICAgICAgICAgICAgICAgIHg6IHRpbWUsXG4gICAgICAgICAgICAgICAgeTogdmFsdWVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZXJpZXMudmFsdWVzLnB1c2goZCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkYXRhTWFwcGVyKGhpc3RvcnksIGFzc2V0LCBkYXRhUG9pbnQpIHtcblxuICAgICAgICAgICAgdmFyIHNlcmllcyA9IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtdLFxuICAgICAgICAgICAgICAgIGtleTogYXNzZXQudGl0bGVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlzdG9yeS5kYXRhLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaGQgPSBoaXN0b3J5LmRhdGFbaV07XG5cbiAgICAgICAgICAgICAgICBpZiAoaGQuZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGFQb2ludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMsIG5ldyBEYXRlKGhkLmF0KSwgaGQuZGF0YS5hdmcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFQb2ludCA9PT0gJ2F2ZXJhZ2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGREYXRhKHNlcmllcywgbmV3IERhdGUoaGQuYXQpLCBoZC5kYXRhLmF2Zyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVBvaW50ID09PSAnbWluaW11bScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERhdGEoc2VyaWVzLCBuZXcgRGF0ZShoZC5hdCksIGhkLmRhdGEubWluKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhUG9pbnQgPT09ICdtYXhpbXVtJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMsIG5ldyBEYXRlKGhkLmF0KSwgaGQuZGF0YS5tYXgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhZGREYXRhKHNlcmllcywgbmV3IERhdGUoaGQuYXQpLCBudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5fYXNzZXRDb2xvcikge1xuICAgICAgICAgICAgICAgIHNlcmllcy5jb2xvciA9IGFzc2V0Ll9hc3NldENvbG9yO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXJpZXMuY29sb3IgPSB2bS5jb2xvcnMoMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlcmllcy52YWx1ZXMgPSBzb3J0RGF0YShzZXJpZXMudmFsdWVzKTtcblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50eXBlID09PSAnYmFyLWNoYXJ0Jykge1xuXG4gICAgICAgICAgICAgICAgc2VyaWVzLnR5cGUgPSAnYmFyJztcbiAgICAgICAgICAgICAgICBzZXJpZXMueUF4aXMgPSAxO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZtLmRhdGEucHVzaChzZXJpZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29uc3RhbnREYXRhTWFwcGVyKGFzc2V0LCBhc3NldEhpc3Rvcmllcykge1xuXG4gICAgICAgICAgICB2YXIgc2VyaWVzID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlczogW10sXG4gICAgICAgICAgICAgICAga2V5OiBhc3NldC50aXRsZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG51bWJlck9mUG9pbnRzID0gMDtcbiAgICAgICAgICAgIHZhciB0aW1lRm9ybWF0ID0gJ2gnO1xuXG4gICAgICAgICAgICBpZiAodm0uY29uZmlnLnRpbWVTY2FsZSA9PT0gJzYwbScpIHtcbiAgICAgICAgICAgICAgICBudW1iZXJPZlBvaW50cyA9IDYwO1xuICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQgPSAnbSc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2bS5jb25maWcudGltZVNjYWxlID09PSAnMjRoJykge1xuICAgICAgICAgICAgICAgIG51bWJlck9mUG9pbnRzID0gMjQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2bS5jb25maWcudGltZVNjYWxlID09PSAnN2QnKSB7XG4gICAgICAgICAgICAgICAgbnVtYmVyT2ZQb2ludHMgPSA3O1xuICAgICAgICAgICAgICAgIHRpbWVGb3JtYXQgPSAnZCc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2bS5jb25maWcudGltZVNjYWxlID09PSAnMzBkJykge1xuXG4gICAgICAgICAgICAgICAgbnVtYmVyT2ZQb2ludHMgPSAzMDtcbiAgICAgICAgICAgICAgICB0aW1lRm9ybWF0ID0gJ2QnO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhc3NldEhpc3Rvcmllcy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGFzc2V0SGlzdG9yaWVzWzBdLmRhdGE7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhpc3RvcnkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQuc3RhdGUgJiYgYXNzZXQuc3RhdGUudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERhdGEoc2VyaWVzLCBuZXcgRGF0ZShoaXN0b3J5W2ldLmF0KSwgYXNzZXQuc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMsIG5ldyBEYXRlKGhpc3RvcnlbaV0uYXQpLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtYmVyT2ZQb2ludHM7IGorKykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gbW9tZW50KCkuc3VidHJhY3QoaiwgdGltZUZvcm1hdCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc2V0LnN0YXRlICYmIGFzc2V0LnN0YXRlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGREYXRhKHNlcmllcywgdGltZSwgYXNzZXQuc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMsIHRpbWUsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5fYXNzZXRDb2xvcikge1xuICAgICAgICAgICAgICAgIHNlcmllcy5jb2xvciA9IGFzc2V0Ll9hc3NldENvbG9yO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXJpZXMuY29sb3IgPSB2bS5jb2xvcnMoMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlcmllcy52YWx1ZXMgPSBzb3J0RGF0YShzZXJpZXMudmFsdWVzKTtcblxuICAgICAgICAgICAgaWYgKHZtLmNvbmZpZy50eXBlID09PSAnYmFyLWNoYXJ0Jykge1xuXG4gICAgICAgICAgICAgICAgc2VyaWVzLnR5cGUgPSAnbGluZSc7XG4gICAgICAgICAgICAgICAgc2VyaWVzLnlBeGlzID0gMTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2bS5kYXRhLnB1c2goc2VyaWVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFyZWFSYW5nZURhdGFNYXBwZXIoaGlzdG9yeSwgYXNzZXQpIHtcblxuICAgICAgICAgICAgdmFyIHNlcmllczEgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICBrZXk6IGFzc2V0LnRpdGxlICsgJyBNYXhpbXVtJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNlcmllczIgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICBrZXk6IGFzc2V0LnRpdGxlICsgJyBBdmVyYWdlJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNlcmllczMgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXSxcbiAgICAgICAgICAgICAgICBrZXk6IGFzc2V0LnRpdGxlICsgJyBNaW5pbXVtJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0b3J5LmRhdGEubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgIHZhciBoZCA9IGhpc3RvcnkuZGF0YVtpXTtcblxuICAgICAgICAgICAgICAgIGlmIChoZC5kYXRhKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMxLCBuZXcgRGF0ZShoZC5hdCksIGhkLmRhdGEubWF4KTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMyLCBuZXcgRGF0ZShoZC5hdCksIGhkLmRhdGEuYXZnKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMzLCBuZXcgRGF0ZShoZC5hdCksIGhkLmRhdGEubWluKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFkZERhdGEoc2VyaWVzMSwgbmV3IERhdGUoaGQuYXQpLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgYWRkRGF0YShzZXJpZXMyLCBuZXcgRGF0ZShoZC5hdCksIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICBhZGREYXRhKHNlcmllczMsIG5ldyBEYXRlKGhkLmF0KSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYXNzZXQuX2Fzc2V0Q29sb3IpIHtcbiAgICAgICAgICAgICAgICBzZXJpZXMxLmNvbG9yID0gYXNzZXQuX2Fzc2V0Q29sb3I7XG4gICAgICAgICAgICAgICAgc2VyaWVzMi5jb2xvciA9IGFzc2V0Ll9hc3NldENvbG9yO1xuICAgICAgICAgICAgICAgIHNlcmllczMuY29sb3IgPSBhc3NldC5fYXNzZXRDb2xvcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBzZXJpZXMxLmNvbG9yID0gdm0uY29sb3JzKDApO1xuICAgICAgICAgICAgICAgIHNlcmllczIuY29sb3IgPSB2bS5jb2xvcnMoMCk7XG4gICAgICAgICAgICAgICAgc2VyaWVzMy5jb2xvciA9IHZtLmNvbG9ycygwKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZXJpZXMxLnZhbHVlcyA9IHNvcnREYXRhKHNlcmllczEudmFsdWVzKTtcbiAgICAgICAgICAgIHNlcmllczIudmFsdWVzID0gc29ydERhdGEoc2VyaWVzMi52YWx1ZXMpO1xuICAgICAgICAgICAgc2VyaWVzMy52YWx1ZXMgPSBzb3J0RGF0YShzZXJpZXMzLnZhbHVlcyk7XG5cbiAgICAgICAgICAgIHNlcmllczEuY2xhc3NlZCA9ICdkYXNoZWQnO1xuICAgICAgICAgICAgc2VyaWVzMi5zdHJva2VXaWR0aCA9IDI7XG4gICAgICAgICAgICBzZXJpZXMzLmNsYXNzZWQgPSAnZGFzaGVkJztcblxuICAgICAgICAgICAgdm0uZGF0YS5wdXNoKHNlcmllczEpO1xuICAgICAgICAgICAgdm0uZGF0YS5wdXNoKHNlcmllczIpO1xuICAgICAgICAgICAgdm0uZGF0YS5wdXNoKHNlcmllczMpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzb3J0RGF0YShhcnJheSkge1xuICAgICAgICAgICAgYXJyYXkuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleUEgPSBhLng7XG4gICAgICAgICAgICAgICAgdmFyIGtleUIgPSBiLng7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5QSA8IGtleUIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXlBID4ga2V5Qikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NoYXJ0Q29udHJvbCcsIGNoYXJ0Q29udHJvbCk7XG5cbiAgICBmdW5jdGlvbiBjaGFydENvbnRyb2woKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGFzc2V0LWNoYXJ0IGFzc2V0cz1hc3NldHMgY29uZmlnPWNvbmZpZ3VyYXRpb24+PC9hc3NldC1jaGFydD4nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGFzc2V0OiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLmFzc2V0cyA9IFtdO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Fzc2V0JywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBzY29wZS5hc3NldHMgPSBbXTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLmFzc2V0Ll9zaG93QXNzZXQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuYXNzZXRzLnB1c2goc2NvcGUuYXNzZXQpO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG4gICAgfVxuXG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnY2lyY2xlUHJvZ3Jlc3NDb250cm9sJywgY2lyY2xlUHJvZ3Jlc3NDb250cm9sKTtcblxuICAgIGNpcmNsZVByb2dyZXNzQ29udHJvbC4kaW5qZWN0ID0gWydjb25maWcnXTtcblxuICAgIGZ1bmN0aW9uIGNpcmNsZVByb2dyZXNzQ29udHJvbChjb25maWcpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1jb250cm9sLWtub2IgbmctaWY9IWJsb2NrZWQ+PGtub2Iga25vYi1kYXRhPXZhbHVlIGtub2Itb3B0aW9ucz1vcHRpb25zIGRhdGEtd2lkdGg9MjI5IGRhdGEtaGVpZ2h0PTIyOT48L2tub2I+PHNwYW4gY2xhc3M9a25vYi11bml0Pnt7cHJvZmlsZS51bml0fX08L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1jb250cm9sLWZhbGxiYWNrIG5nLWlmPWJsb2NrZWQ+PGRpdiBjbGFzcz12YWx1ZS11bml0PjxzcGFuIGNsYXNzPXZhbHVlPnt7dmFsdWV9fTwvc3Bhbj4gPHNwYW4gY2xhc3M9dW5pdD57e3Byb2ZpbGUudW5pdH19PC9zcGFuPjwvZGl2PjxwPnt7bWVzc2FnZX19PC9wPjwvZGl2PicsXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJz0nLFxuICAgICAgICAgICAgICAgIGlkOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHZhciBhc3NldFZhbHVlT3V0T2ZCb3VuZHNNZXNzYWdlID0gY29uZmlnLm91dE9mQm91bmRzTWVzc2FnZS5mb3JtYXQoJ0NpcmNsZSBwcm9ncmVzcycpO1xuICAgICAgICAgICAgdmFyIGludmFsaWRNaW5NYXhDb25maWd1cmF0aW9uTWVzc2FnZSA9IGNvbmZpZy5pbnZhbGlkQm91bmRzTWVzc2FnZTtcblxuICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IG51bGw7XG5cbiAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHk6IHRydWUsXG4gICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAwLjMwLFxuICAgICAgICAgICAgICAgIG1pbjogY29uZmlnLmRlZmF1bHRNaW5pbXVtLFxuICAgICAgICAgICAgICAgIG1heDogY29uZmlnLmRlZmF1bHRNYXhpbXVtLFxuICAgICAgICAgICAgICAgIHN0ZXA6IDEsXG4gICAgICAgICAgICAgICAgZGlzcGxheVByZXZpb3VzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFuZ2xlT2Zmc2V0OiAxODAsXG4gICAgICAgICAgICAgICAgZm9udDogJycsXG4gICAgICAgICAgICAgICAgZm9udFdlaWdodDogOTAwLFxuICAgICAgICAgICAgICAgIGZvbnRTaXplOiA1MCxcbiAgICAgICAgICAgICAgICBpbnB1dENvbG9yOiAnIzU1NjM2YycsXG4gICAgICAgICAgICAgICAgZmdDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgICAgICBiZ0NvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgICAgIGxpbmVDYXA6ICdyb3VuZCcsXG4gICAgICAgICAgICAgICAgZHJhdzogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0gZS52YWwoKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3ID0gZS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYztcbiAgICAgICAgICAgICAgICAgICAgdmFyIGE7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZm9yZWdyb3VuZENpcmNsZVN0cm9rZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcmVncm91bmRDaXJjbGVGaWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYmFja2dyb3VuZENpcmNsZVNpemU7XG5cbiAgICAgICAgICAgICAgICAgICAgYyA9IHRoaXMuZzsgLy8gY29udGV4dFxuICAgICAgICAgICAgICAgICAgICBhID0gdGhpcy5hcmModGhpcy5jdik7IC8vIEFyY1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93Lm9yaWVudGF0aW9uID09ICd1bmRlZmluZWQnIHx8IHdpbmRvdy5pbm5lcldpZHRoID4gNzUwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kQ2lyY2xlRmlsbCA9IDE2O1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWdyb3VuZENpcmNsZVN0cm9rZSA9IDIwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENpcmNsZVNpemUgPSAyO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWdyb3VuZENpcmNsZVN0cm9rZSA9IDUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWdyb3VuZENpcmNsZUZpbGwgPSAzODtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDaXJjbGVTaXplID0gNjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vZHJhdyBiYWNrZ3JvdW5kIGNpcmNsZVxuXG4gICAgICAgICAgICAgICAgICAgIGMuYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgICAgIGMuYXJjKHRoaXMueHksIHRoaXMueHksIHRoaXMucmFkaXVzLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBjLnN0cm9rZVN0eWxlID0gJyM1NTYzNmMnO1xuICAgICAgICAgICAgICAgICAgICBjLmxpbmVXaWR0aCA9IGJhY2tncm91bmRDaXJjbGVTaXplO1xuICAgICAgICAgICAgICAgICAgICBjLnN0cm9rZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vZHJhdyBmb3JlZ3JvdW5kIGZpbGwgY2lyY2xlXG5cbiAgICAgICAgICAgICAgICAgICAgYy5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgYy5hcmModGhpcy54eSwgdGhpcy54eSwgdGhpcy5yYWRpdXMsIGEucywgYS5lLCBhLmQpO1xuICAgICAgICAgICAgICAgICAgICBjLnN0cm9rZVN0eWxlID0gJyM1NTYzNmMnO1xuICAgICAgICAgICAgICAgICAgICBjLmxpbmVDYXAgPSAnc3F1YXJlJztcbiAgICAgICAgICAgICAgICAgICAgYy5saW5lV2lkdGggPSBmb3JlZ3JvdW5kQ2lyY2xlU3Ryb2tlO1xuICAgICAgICAgICAgICAgICAgICBjLnN0cm9rZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGMuYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICAgICAgICAgIGMuYXJjKHRoaXMueHksIHRoaXMueHksIHRoaXMucmFkaXVzLCBhLnMsIGEuZSwgYS5kKTtcbiAgICAgICAgICAgICAgICAgICAgYy5zdHJva2VTdHlsZSA9ICcjZjBmMGYwJztcbiAgICAgICAgICAgICAgICAgICAgYy5saW5lQ2FwID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGMubGluZVdpZHRoID0gZm9yZWdyb3VuZENpcmNsZUZpbGw7XG4gICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnZhbHVlID09PSB1bmRlZmluZWQgfHwgc2NvcGUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUudmFsKCdubyB2YWx1ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGwgPCA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb250U2l6ZSA9ICczNXB4JztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplID0gdyAvIGwgKiAyLjM7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBlLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogZm9udFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbGluZS1oZWlnaHQnOiBmb250U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdmb250LXNpemUnOiBmb250U2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdtYXJnaW4tdG9wJzogJzkwcHgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogJzE3M3B4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdtYXJnaW4tbGVmdCc6ICctMjAycHgnXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmFsdWUnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS52YWx1ZSA8IHNjb3BlLm9wdGlvbnMubWluIHx8IHNjb3BlLnZhbHVlID4gc2NvcGUub3B0aW9ucy5tYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBhc3NldFZhbHVlT3V0T2ZCb3VuZHNNZXNzYWdlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9maWxlJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzTnVtYmVyKHNjb3BlLnByb2ZpbGUubWluaW11bSkgJiYgYW5ndWxhci5pc051bWJlcihzY29wZS5wcm9maWxlLm1heGltdW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLm1pbiA9IHNjb3BlLnByb2ZpbGUubWluaW11bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMubWF4ID0gc2NvcGUucHJvZmlsZS5tYXhpbXVtO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5taW4gPSBjb25maWcuZGVmYXVsdE1pbmltdW07XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLm1heCA9IGNvbmZpZy5kZWZhdWx0TWF4aW11bTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5vcHRpb25zLm1pbiA+IHNjb3BlLm9wdGlvbnMubWF4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gaW52YWxpZE1pbk1heENvbmZpZ3VyYXRpb25NZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy92YWx1ZSBpcyBvdXQgb2YgYm91bmRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5vcHRpb25zLm1pbiA+IHNjb3BlLnZhbHVlIHx8IHNjb3BlLm9wdGlvbnMubWF4IDwgc2NvcGUudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IGFzc2V0VmFsdWVPdXRPZkJvdW5kc01lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLnN0ZXAgPSAwLjE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnY29sb3JDb250cm9sJywgY29sb3JDb250cm9sKTtcblxuICAgIGZ1bmN0aW9uIGNvbG9yQ29udHJvbCgpIHtcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC1jb2xvcj48c3ZnIHZlcnNpb249MS4xIGlkPUxheWVyXzEgeG1sbnM9aHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcgeG1sbnM6eGxpbms9aHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayB4PTBweCB5PTBweCB3aWR0aD0xNTBweCBoZWlnaHQ9MTUwcHggdmlld2JveD1cXFwiNzUgMCAxNTAgMTUwXFxcIiBlbmFibGUtYmFja2dyb3VuZD1cXFwibmV3IDc1IDAgMTUwIDE1MFxcXCIgeG1sOnNwYWNlPXByZXNlcnZlPjxwYXRoIGZpbGw9I0VERURFRCBkPVxcXCJNMTUwLDBjLTQxLjQyMSwwLTc1LDMzLjU3OS03NSw3NWMwLDAuMzc3LDAuMDIzLDAuNzQ5LDAuMDI4LDEuMTI0Qzc1LjAyMSw3Ni4yMTksNzUsNzYuMzEsNzUsNzYuNDA2djY5Ljc3MSBjMCwyLjExMSwxLjcxMiwzLjgyMywzLjgyMywzLjgyM2g2OS43NzFjMC4wOTcsMCwwLjE4Ny0wLjAyMSwwLjI4Mi0wLjAyOGMwLjM3NiwwLjAwNiwwLjc0NywwLjAyOCwxLjEyNCwwLjAyOCBjNDEuNDIxLDAsNzUtMzMuNTc5LDc1LTc1QzIyNSwzMy41NzksMTkxLjQyMSwwLDE1MCwweiBNODguNjIsMTQzLjk5OWMtNC4yMDgsMC03LjYyLTMuNDEyLTcuNjItNy42MmMwLTQuMjA4LDMuNDEyLTcuNjIsNy42Mi03LjYyIGM0LjIwOCwwLDcuNjIsMy40MTIsNy42Miw3LjYyQzk2LjI0LDE0MC41ODgsOTIuODI5LDE0My45OTksODguNjIsMTQzLjk5OXpcXFwiPjwvcGF0aD48Y2lyY2xlIGlkPWNvbG9yc3ZndHdvIGZpbGw9IzI1RThBMiBjeD0xNTAgY3k9NzUgcj01Ni44MjY+PC9jaXJjbGU+PHBhdGggb3BhY2l0eT0wLjA2IGQ9XFxcIk0xNTAsMTYuMTQxYzMyLjUwNywwLDU4Ljg1OSwyNi4zNTIsNTguODU5LDU4Ljg1OVMxODIuNTA3LDEzMy44NTksMTUwLDEzMy44NTlTOTEuMTQxLDEwNy41MDcsOTEuMTQxLDc1IFMxMTcuNDkzLDE2LjE0MSwxNTAsMTYuMTQxeiBNMTAxLjkxNyw3NWMwLDI2LjU1NiwyMS41MjgsNDguMDgzLDQ4LjA4Myw0OC4wODNTMTk4LjA4MywxMDEuNTU2LDE5OC4wODMsNzUgUzE3Ni41NTYsMjYuOTE3LDE1MCwyNi45MTdTMTAxLjkxNyw0OC40NDQsMTAxLjkxNyw3NXpcXFwiPjwvcGF0aD48L3N2Zz48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Yoc2NvcGUudmFsdWUpID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsdWUuciAhPT0gbnVsbCAmJiBzY29wZS52YWx1ZS5nICE9PSBudWxsICYmIHNjb3BlLnZhbHVlLmIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZXhSZWQgPSBzY29wZS52YWx1ZS5yLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhleFJlZCA9IG5vcm1hbGlzZUhleChoZXhSZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhleEdyZWVuID0gc2NvcGUudmFsdWUuZy50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgICAgICAgICBoZXhHcmVlbiA9IG5vcm1hbGlzZUhleChoZXhHcmVlbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGV4Qmx1ZSA9IHNjb3BlLnZhbHVlLmIudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGV4Qmx1ZSA9IG5vcm1hbGlzZUhleChoZXhCbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbG9yID0gJyMnICsgaGV4UmVkICsgaGV4R3JlZW4gKyBoZXhCbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9ICQoJyNjb2xvcnN2Z3R3bycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hdHRyKCdmaWxsJywgc2NvcGUuY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Yoc2NvcGUudmFsdWUpID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNIZXhDb2xvcihzY29wZS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xvcnN2ZyA9ICQoJyNjb2xvcnN2Z3R3bycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3JzdmcuYXR0cignZmlsbCcsIHNjb3BlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0hleENvbG9yKGNvbG9yU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbG9yU3RyaW5nWzBdID09PSAnIycpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbG9yU3RyaW5nLmxlbmd0aCA9PT0gNyB8fCBjb2xvclN0cmluZy5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uU3RyaW5nID0gbmV3IFJlZ0V4cCgnXiMoWzAtOWEtZkEtRl17Nn18WzAtOWEtZkEtRl17M30pJCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25TdHJpbmcudGVzdChjb2xvclN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpc2VIZXgoaGV4VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGV4VmFsdWUubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vcm1hbGlzZWRWYWx1ZSA9ICcwJyArIGhleFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXNlZFZhbHVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoZXhWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2NvbG9yUGlja2VyQ29udHJvbCcsIGNvbG9yUGlja2VyQ29udHJvbCk7XG5cbiAgICBjb2xvclBpY2tlckNvbnRyb2wuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gY29sb3JQaWNrZXJDb250cm9sKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1jb2xvci1waWNrZXItZGlzYWJsZXIgbmctaWY9IWVuYWJsZWQ+PC9kaXY+PGRpdiBjbGFzcz1jb250cm9sLWNvbG9yLXBpY2tlciBuZy1pZj1tb2RlIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6ICFlbmFibGVkfVxcXCI+PHNwZWN0cnVtLWNvbG9ycGlja2VyIG9uLWNoYW5nZT1jb2xvckNoYW5nZShjb2xvcikgbmctbW9kZWw9Y29sb3Igb24tbW92ZT1vbk1vdmUoY29sb3IpIG9wdGlvbnM9XFxcInsgc2hvd0lucHV0OiB0cnVlLCBwcmVmZXJyZWRGb3JtYXQ6XFwncmdiXFwnLCBmbGF0OiB0cnVlLCBjaG9vc2VUZXh0OiBcXCdcXCcgfVxcXCI+PC9zcGVjdHJ1bS1jb2xvcnBpY2tlcj48L2Rpdj48ZGl2IGNsYXNzPWNvbnRyb2wtY29sb3ItcGlja2VyIG5nLWlmPSFtb2RlPjxzcGVjdHJ1bS1jb2xvcnBpY2tlciBvbi1jaGFuZ2U9Y29sb3JDaGFuZ2UoY29sb3IpIG5nLW1vZGVsPWNvbG9yIG9uLW1vdmU9b25Nb3ZlKGNvbG9yKSBvcHRpb25zPVxcXCJ7IHNob3dJbnB1dDogdHJ1ZSwgcHJlZmVycmVkRm9ybWF0OlxcJ2hleFxcJywgZmxhdDogdHJ1ZSwgY2hvb3NlVGV4dDogXFwnXFwnIH1cXFwiPjwvc3BlY3RydW0tY29sb3JwaWNrZXI+PC9kaXY+JyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlcixcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZW5hYmxlZDogJz0nLFxuICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJz0nLFxuICAgICAgICAgICAgICAgIGlkOiAnPScsXG4gICAgICAgICAgICAgICAgaXM6ICc9JyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogJyYnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICB2YXIgZGVmYXVsdFN0YXRlID0gJ3JnYigwLDAsMCknO1xuXG4gICAgICAgICAgICBzY29wZS5maXJzdFRpbWVQYXNzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByZXBhcmVWYWx1ZSh2YWx1ZU9iamVjdCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlT2JqZWN0ID09PSBudWxsIHx8IHZhbHVlT2JqZWN0ID09PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdFN0YXRlO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlT2JqZWN0LnIgIT09IG51bGwgJiYgdmFsdWVPYmplY3QuZyAhPT0gbnVsbCAmJiB2YWx1ZU9iamVjdC5iICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHJnYlN0cmluZyA9ICdyZ2IoJyArIHZhbHVlT2JqZWN0LnIgKyAnLCcgKyB2YWx1ZU9iamVjdC5nICsgJywnICsgdmFsdWVPYmplY3QuYiArICcpJztcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmdiU3RyaW5nO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0hleENvbG9yKHZhbHVlT2JqZWN0KSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZU9iamVjdDtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTdGF0ZTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2NvcGUuY29sb3JDaGFuZ2UgPSBmdW5jdGlvbihjb2xvcikge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpcnN0VGltZVBhc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmdiID0gY29sb3JUb09iamVjdChjb2xvcik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ29iamVjdCcgJiYgKHR5cGVvZiByZ2IgPT09ICdvYmplY3QnKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNjb3BlLnZhbHVlIHx8IHJnYi5yICE9PSBzY29wZS52YWx1ZS5yIHx8IHJnYi5nICE9PSBzY29wZS52YWx1ZS5nIHx8IHJnYi5iICE9PSBzY29wZS52YWx1ZS5iKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUocmdiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09PSAnc3RyaW5nJyAmJiAodHlwZW9mIGNvbG9yID09PSAnc3RyaW5nJykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbG9yICE9PSBzY29wZS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaFZhbHVlKGNvbG9yKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmZpcnN0VGltZVBhc3MgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUub25Nb3ZlID0gZnVuY3Rpb24oY29sb3IpIHtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLnNwZWN0cnVtLWNvbG9yLXByZXZpZXcnKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6IGNvbG9yXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmFsdWUnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHNjb3BlLmNvbG9yID0gcHJlcGFyZVZhbHVlKHNjb3BlLnZhbHVlKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLnNwZWN0cnVtLWluaXRpYWxDb2xvci1wcmV2aWV3LCAuc3BlY3RydW0tY29sb3ItcHJldmlldycpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogc2NvcGUuY29sb3JcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvZmlsZScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09PSAnb2JqZWN0Jykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tb2RlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ3N0cmluZycpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubW9kZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gY29sb3JUb09iamVjdChjb2xvcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvbG9yU3RyaW5nID0gY29sb3Iuc2xpY2UoNCwgY29sb3IubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBjb2xvclN0cmluZyA9IGNvbG9yU3RyaW5nLnN1YnN0cmluZygwLCBjb2xvclN0cmluZy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB2YXIgY29sb3JWYWx1ZXMgPSBjb2xvclN0cmluZy5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIHZhciByZWQgPSBjb2xvclZhbHVlc1swXS5yZXBsYWNlKCcgJywgJycpO1xuICAgICAgICAgICAgICAgIHZhciBncmVlbiA9IGNvbG9yVmFsdWVzWzFdLnJlcGxhY2UoJyAnLCAnJyk7XG4gICAgICAgICAgICAgICAgdmFyIGJsdWUgPSBjb2xvclZhbHVlc1syXS5yZXBsYWNlKCcgJywgJycpO1xuICAgICAgICAgICAgICAgIHZhciBjb2xvck9iamVjdCA9IHt9O1xuICAgICAgICAgICAgICAgIGNvbG9yT2JqZWN0LnIgPSBwYXJzZUludChyZWQpO1xuICAgICAgICAgICAgICAgIGNvbG9yT2JqZWN0LmcgPSBwYXJzZUludChncmVlbik7XG4gICAgICAgICAgICAgICAgY29sb3JPYmplY3QuYiA9IHBhcnNlSW50KGJsdWUpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yT2JqZWN0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0hleENvbG9yKGNvbG9yU3RyaW5nKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29sb3JTdHJpbmdbMF0gPT09ICcjJykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xvclN0cmluZy5sZW5ndGggPT09IDcgfHwgY29sb3JTdHJpbmcubGVuZ3RoID09PSA0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0aW9uU3RyaW5nID0gbmV3IFJlZ0V4cCgnXiMoWzAtOWEtZkEtRl17Nn18WzAtOWEtZkEtRl17M30pJCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGlvblN0cmluZy50ZXN0KGNvbG9yU3RyaW5nKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwdWJsaXNoVmFsdWUodmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5lbmFibGVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLm9uQ2hhbmdlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbmdTbWFydGxpdmluZ1dpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdsYWJlbENvbnRyb2wnLCBkaXJlY3RpdmUpO1xuXG4gICAgZnVuY3Rpb24gZGlyZWN0aXZlKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC1sYWJlbCBuZy1jbGFzcz1cXFwie1xcJ25vLWNvbG9yXFwnIDogdm0uY3VycmVudENvbG9yID09IHVuZGVmaW5lZCB8fCB2bS5jdXJyZW50Q29sb3IgPT0gbnVsbCB8fCB2bS5jdXJyZW50Q29sb3IgPT0gdm0uZGVmYXVsdENvbG9yfVxcXCI+PGxhYmVsIHN0eWxlPWJhY2tncm91bmQtY29sb3I6e3t2bS5jdXJyZW50Q29sb3J9fT48c3BhbiBuZy1pZj1cXFwidm0udmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2bS52YWx1ZSAhPT0gbnVsbFxcXCI+e3t2bS5jdXJyZW50TGFiZWx9fTwvc3Bhbj4gPHNwYW4gY2xhc3M9ZW1wdHkgbmctaWY9XFxcInZtLnZhbHVlID09PSB1bmRlZmluZWQgfHwgdm0udmFsdWUgPT09IG51bGxcXFwiPjxpPm5vIHZhbHVlPC9pPjwvc3Bhbj48YXNpZGUgc3R5bGU9XFxcImJvcmRlci1jb2xvcjp7e3ZtLmN1cnJlbnRDb2xvcn19IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50IHRyYW5zcGFyZW50XFxcIj48L2FzaWRlPjwvbGFiZWw+PC9kaXY+JyxcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIGFzc2V0OiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgIH1cblxuICAgIHZhciBERUZBVUxUX0NPTE9SID0gJyNmZmZmZmYnO1xuICAgIHZhciBERUZBVUxUX0xBQkVMID0gJ25vIHZhbHVlJztcblxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJ107XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ub3B0aW9ucyA9IFtdO1xuXG4gICAgICAgIHZtLmN1cnJlbnRDb2xvciA9IG51bGw7XG5cbiAgICAgICAgdm0uZGVmYXVsdENvbG9yID0gREVGQVVMVF9DT0xPUjtcblxuICAgICAgICB2bS5jdXJyZW50TGFiZWwgPSBudWxsO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmFzc2V0LmNvbnRyb2wnLCBjb250cm9sV2F0Y2hlciwgdHJ1ZSk7XG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnZhbHVlJywgdmFsdWVXYXRjaGVyKTtcblxuICAgICAgICBmdW5jdGlvbiBjb250cm9sV2F0Y2hlcihjb250cm9sU2V0dGluZ3MpIHtcblxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBleHRyYWN0VmFsdWVzKGNvbnRyb2xTZXR0aW5ncyk7XG5cbiAgICAgICAgICAgIGV4dHJhY3RDb2xvcnMob3B0aW9ucywgY29udHJvbFNldHRpbmdzKTtcblxuICAgICAgICAgICAgZXh0cmFjdExhYmVscyhvcHRpb25zLCBjb250cm9sU2V0dGluZ3MpO1xuXG4gICAgICAgICAgICB2bS5vcHRpb25zID0gb3B0aW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHZhbHVlV2F0Y2hlcihuZXdWYWx1ZSkge1xuXG4gICAgICAgICAgICB2YXIgZm91bmRPcHRpb24gPSBudWxsO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0ub3B0aW9ucywgZnVuY3Rpb24ob3B0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uLnZhbHVlID09PSBuZXdWYWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kT3B0aW9uID0gb3B0aW9uO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGZvdW5kT3B0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICB2bS5jdXJyZW50TGFiZWwgPSBmb3VuZE9wdGlvbi5sYWJlbDtcblxuICAgICAgICAgICAgICAgIHZtLmN1cnJlbnRDb2xvciA9IGZvdW5kT3B0aW9uLmNvbG9yO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdm0uY3VycmVudExhYmVsID0gbmV3VmFsdWU7XG5cbiAgICAgICAgICAgICAgICB2bS5jdXJyZW50Q29sb3IgPSBERUZBVUxUX0NPTE9SO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBleHRyYWN0VmFsdWVzKGNvbnRyb2xTZXR0aW5ncykge1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoY29udHJvbFNldHRpbmdzICYmIGNvbnRyb2xTZXR0aW5ncy5leHRyYXMgJiYgY29udHJvbFNldHRpbmdzLmV4dHJhcy52YWx1ZXMpIHtcblxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChjb250cm9sU2V0dGluZ3MuZXh0cmFzLnZhbHVlcywgZnVuY3Rpb24ob3B0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBvcHRpb25cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGV4dHJhY3RDb2xvcnMob3B0aW9ucywgY29udHJvbFNldHRpbmdzKSB7XG5cbiAgICAgICAgICAgIGlmICghY29udHJvbFNldHRpbmdzKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKG9wdGlvbiwgaW5kZXgpIHtcblxuICAgICAgICAgICAgICAgIC8vZmlyc3QsIHJlYWQgZnJvbSBzZXR0aW5ncy5bb3B0aW9uVmFsdWVdLCBhcyB0aGlzIGlzIHByaW9yaXR5XG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xTZXR0aW5ncy5leHRyYXNbb3B0aW9uLnZhbHVlXSkge1xuXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5jb2xvciA9IGNvbnRyb2xTZXR0aW5ncy5leHRyYXNbb3B0aW9uLnZhbHVlXTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xTZXR0aW5ncy5leHRyYXMuY29sb3JzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmNvbG9yID0gREVGQVVMVF9DT0xPUjtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnRyb2xTZXR0aW5ncy5leHRyYXMuY29sb3JzW2luZGV4XSA9PT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgICAgICAgICAgICAgICAgICBvcHRpb24uY29sb3IgPSBERUZBVUxUX0NPTE9SO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9wdGlvbi5jb2xvciA9IGNvbnRyb2xTZXR0aW5ncy5leHRyYXMuY29sb3JzW2luZGV4XTtcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBleHRyYWN0TGFiZWxzKG9wdGlvbnMsIGNvbnRyb2xTZXR0aW5ncykge1xuXG4gICAgICAgICAgICBpZiAoIWNvbnRyb2xTZXR0aW5ncykge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChvcHRpb25zLCBmdW5jdGlvbihvcHRpb24sIGluZGV4KSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xTZXR0aW5ncy5leHRyYXMubGFiZWxzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmxhYmVsID0gb3B0aW9uLnZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29udHJvbFNldHRpbmdzLmV4dHJhcy5sYWJlbHNbaW5kZXhdID09PSAndW5kZWZpbmVkJykge1xuXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5sYWJlbCA9IG9wdGlvbi52YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvcHRpb24ubGFiZWwgPSBjb250cm9sU2V0dGluZ3MuZXh0cmFzLmxhYmVsc1tpbmRleF07XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2Ryb3Bkb3duQ29udHJvbCcsIGRyb3Bkb3duQ29udHJvbCk7XG5cbiAgICBkcm9wZG93bkNvbnRyb2wuJGluamVjdCA9IFtdO1xuXG4gICAgZnVuY3Rpb24gZHJvcGRvd25Db250cm9sKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1jb250cm9sLWRyb3Bkb3duIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6ICFlbmFibGVkfVxcXCI+PHVpLXNlbGVjdCBuZy1kaXNhYmxlZD0hZW5hYmxlZCB0aGVtZT1zZWxlY3RpemUgbmctbW9kZWw9c2VsZWN0ZWRWYWx1ZSBvbi1zZWxlY3Q9b25JdGVtU2VsZWN0ZWQoJGl0ZW0sJG1vZGVsKSBzZWFyY2gtZW5hYmxlZD1mYWxzZT48dWktc2VsZWN0LW1hdGNoIHBsYWNlaG9sZGVyPVxcXCJzZWxlY3Qgb3B0aW9uXFxcIj57eyRzZWxlY3Quc2VsZWN0ZWQubmFtZX19IHt7cHJvZmlsZS51bml0fX08L3VpLXNlbGVjdC1tYXRjaD48dWktc2VsZWN0LWNob2ljZXMgcmVwZWF0PVxcXCJpdGVtIGluIGxpc3RFbGVtZW50c1xcXCI+PGFzaWRlPnt7aXRlbS5uYW1lfX0ge3twcm9maWxlLnVuaXR9fTwvYXNpZGU+PC91aS1zZWxlY3QtY2hvaWNlcz48L3VpLXNlbGVjdD48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBpczogJz0nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLmxpc3RFbGVtZW50cyA9IFtdO1xuICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRWYWx1ZSA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5vbkl0ZW1TZWxlY3RlZCA9IG9uSXRlbVNlbGVjdGVkO1xuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9maWxlJywgd2F0Y2hQcm9maWxlKTtcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmFsdWUnLCB3YXRjaFZhbHVlKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gb25JdGVtU2VsZWN0ZWQoaXRlbSwgbW9kZWwpIHtcbiAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUoaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hWYWx1ZSh2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm9uQ2hhbmdlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gd2F0Y2hQcm9maWxlKCkge1xuXG4gICAgICAgICAgICAgICAgc2NvcGUubGlzdEVsZW1lbnRzID0gW107XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxpc3RFbGVtZW50cyA9IGV4dHJhY3RPcHRpb25zRnJvbVByb2ZpbGUoc2NvcGUucHJvZmlsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRWYWx1ZSA9IGdldFNlbGVjdGVkT3B0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdhdGNoVmFsdWUoKSB7XG5cbiAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZFZhbHVlID0gZ2V0U2VsZWN0ZWRPcHRpb24oKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBleHRyYWN0T3B0aW9uc0Zyb21Qcm9maWxlKHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gW107XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvZmlsZS5lbnVtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHByb2ZpbGUuZW51bSwgZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHByb2ZpbGUubGFiZWxzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHByb2ZpbGUubGFiZWxzLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2YWwubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHByb2ZpbGUudHlwZSA9PSAnYm9vbGVhbicpIHtcblxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3RydWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdmYWxzZScsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRTZWxlY3RlZE9wdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIHZhciBzZWxPcHRpb24gPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHNjb3BlLmxpc3RFbGVtZW50cywgZnVuY3Rpb24ob3B0aW9uKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbi52YWx1ZSA9PT0gc2NvcGUudmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsT3B0aW9uID0gb3B0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbE9wdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbmdTbWFydGxpdmluZ1dpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdpbnB1dENvbnRyb2wnLCBpbnB1dENvbnRyb2wpO1xuXG4gICAgaW5wdXRDb250cm9sLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGlucHV0Q29udHJvbCgpIHtcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC1pbnB1dCBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiAhZW5hYmxlZH1cXFwiPjxpbnB1dCB0eXBlPXRleHQgbmctbW9kZWw9bG9jYWxWYWx1ZSBwbGFjZWhvbGRlcj1cXFwiRW50ZXIgdmFsdWVcXFwiIG5nLWRpc2FibGVkPSFlbmFibGVkPiA8YnV0dG9uIGNsYXNzPWlucHV0LWNvbnRyb2wtYnRuIG5nLWNsaWNrPXNlbmRWYWx1ZShsb2NhbFZhbHVlKSBuZy1kaXNhYmxlZD0hZW5hYmxlZD48L2J1dHRvbj48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogJyYnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3ZhbHVlJywgZnVuY3Rpb24obmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5sb2NhbFZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5iaW5kKCdrZXlkb3duIGtleXByZXNzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNlbmRWYWx1ZShzY29wZS5sb2NhbFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2NvcGUuc2VuZFZhbHVlID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbm9ybWFsaXNlZFZhbHVlID0gbm9ybWFsaXNlRGF0YSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlSW5wdXREYXRhKG5vcm1hbGlzZWRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaFZhbHVlKG5vcm1hbGlzZWRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVJbnB1dERhdGEodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09ICdpbnRlZ2VyJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbnRlZ2VyKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Cb3VuZHModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKHZhbHVlKSA9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Cb3VuZHModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKHZhbHVlKSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpc2VEYXRhKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ251bWJlcicgfHwgc2NvcGUucHJvZmlsZS50eXBlID09PSAnaW50ZWdlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGRhdGEpID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0ludGVnZXIodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJSAxID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzTnVtYmVyKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICUgMSAhPT0gMCB8fCB2YWx1ZSAlIDEgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaXNJbkJvdW5kcyh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IHNjb3BlLnByb2ZpbGUubWluaW11bSB8fCB2YWx1ZSA+IHNjb3BlLnByb2ZpbGUubWF4aW11bSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwdWJsaXNoVmFsdWUodmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5vbkNoYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5vbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbmdTbWFydGxpdmluZ1dpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdqc29uQ29udHJvbCcsIGpzb25Db250cm9sKTtcblxuICAgIGpzb25Db250cm9sLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIGpzb25Db250cm9sKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wtanNvbj48anNvbi1mb3JtYXR0ZXIganNvbj12YWx1ZSBvcGVuPTI+PC9qc29uLWZvcm1hdHRlcj48L2Rpdj4nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9PycsXG4gICAgICAgICAgICAgICAgaWQ6ICc9J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlclxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgaWYgKHNjb3BlLnZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS52YWx1ZSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmFsdWUnLCBmdW5jdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgna25vYkNvbnRyb2wnLCBrbm9iQ29udHJvbCk7XG5cbiAgICBrbm9iQ29udHJvbC4kaW5qZWN0ID0gWyckaW50ZXJ2YWwnLCAnY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBrbm9iQ29udHJvbCgkaW50ZXJ2YWwsIGNvbmZpZykge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wta25vYiBuZy1pZj0hYmxvY2tlZCBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiAhZW5hYmxlZH1cXFwiPjxrbm9iIGtub2ItZGF0YT12YWx1ZSBrbm9iLW9wdGlvbnM9b3B0aW9ucyBkYXRhLXdpZHRoPTIyOSBkYXRhLWhlaWdodD0yMjk+PC9rbm9iPjxzcGFuIGNsYXNzPWtub2ItdW5pdD57e3Byb2ZpbGUudW5pdH19PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9Y29udHJvbC1mYWxsYmFjayBuZy1pZj1ibG9ja2VkPjxkaXYgY2xhc3M9dmFsdWUtdW5pdD48c3BhbiBjbGFzcz12YWx1ZT57e3ZhbHVlfX08L3NwYW4+IDxzcGFuIGNsYXNzPXVuaXQ+e3twcm9maWxlLnVuaXR9fTwvc3Bhbj48L2Rpdj48cD57e21lc3NhZ2V9fTwvcD48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogJyYnXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICB2YXIgYXNzZXRWYWx1ZU91dE9mQm91bmRzTWVzc2FnZSA9IGNvbmZpZy5vdXRPZkJvdW5kc01lc3NhZ2UuZm9ybWF0KCdLbm9iJyk7XG5cbiAgICAgICAgICAgIHZhciBpbnZhbGlkTWluTWF4Q29uZmlndXJhdGlvbk1lc3NhZ2UgPSBjb25maWcuaW52YWxpZEJvdW5kc01lc3NhZ2U7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZVRvUHVibGlzaCA9IG51bGw7XG5cbiAgICAgICAgICAgIHZhciBwdWJsaXNoSW50ZXJ2YWwgPSBudWxsO1xuXG4gICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gbnVsbDtcblxuICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IG51bGw7XG5cbiAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHk6ICFzY29wZS5lbmFibGVkLFxuICAgICAgICAgICAgICAgIG1pbjogY29uZmlnLmRlZmF1bHRNaW5pbXVtLFxuICAgICAgICAgICAgICAgIG1heDogY29uZmlnLmRlZmF1bHRNYXhpbXVtLFxuICAgICAgICAgICAgICAgIHN0ZXA6IDEsXG4gICAgICAgICAgICAgICAgdGhpY2tuZXNzOiAwLjMwLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlQcmV2aW91czogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhbmdsZU9mZnNldDogMTgwLFxuICAgICAgICAgICAgICAgIGZvbnQ6ICcnLFxuICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6IDkwMCxcbiAgICAgICAgICAgICAgICBpbnB1dENvbG9yOiAnIzU1NjM2YycsXG4gICAgICAgICAgICAgICAgZmdDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgICAgICAgICBiZ0NvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICAgICAgICAgIGxpbmVDYXA6ICdyb3VuZCcsXG4gICAgICAgICAgICAgICAgbW91c2VXaGVlbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVsZWFzZTogZnVuY3Rpb24obmV3VmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsdWUgIT09IG5ld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlVG9QdWJsaXNoID0gbmV3VmFsdWU7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBkcmF3OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsID0gZS52YWwoKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3ID0gZS53aWR0aCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IHcgLyBsICogMi41O1xuICAgICAgICAgICAgICAgICAgICBpZiAobCA8IDgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplID0gJzM1cHgnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGZvbnRTaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xpbmUtaGVpZ2h0JzogZm9udFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZm9udC1zaXplJzogZm9udFNpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLXRvcCc6ICc5MHB4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICd3aWR0aCc6ICcxNzNweCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbWFyZ2luLWxlZnQnOiAnLTIwMnB4J1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuZzsgLy8gY29udGV4dFxuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMuYXJjKHRoaXMuY3YpOyAvLyBBcmNcblxuICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlU2l6ZSA9IDQwOyAvLyByYWRpdXMgb2Yga25vYiBoYW5kbGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcmVncm91bmRDaXJjbGVTdHJva2UgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcmVncm91bmRDaXJjbGVGaWxsID0gMzg7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVMaW5lU2l6ZSA9IDY7XG4gICAgICAgICAgICAgICAgICAgIHZhciBiYWNrZ3JvdW5kQ2lyY2xlU2l6ZSA9IDY7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cub3JpZW50YXRpb24gPT0gJ3VuZGVmaW5lZCcgfHwgd2luZG93LmlubmVyV2lkdGggPiA3NTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVNpemUgPSAxNTsgLy8gcmFkaXVzIG9mIGtub2IgaGFuZGxlXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kQ2lyY2xlU3Ryb2tlID0gMjA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kQ2lyY2xlRmlsbCA9IDE2O1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTGluZVNpemUgPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENpcmNsZVNpemUgPSAyO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb3VzZVBvcyA9IGdldE1vdXNlUG9zKGMuY2FudmFzLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoTWF0aC5wb3coKG1vdXNlUG9zLnggLSB4KSwgMikgKyBNYXRoLnBvdygobW91c2VQb3MueSAtIHkpLCAyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCBoYW5kbGVTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3Vyc29yJzogJ21vdmUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2N1cnNvcic6ICdkZWZhdWx0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TW91c2VQb3MoY2FudmFzLCBldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGV2ZW50LmNsaWVudFggLSByZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy9kcmF3IGJhY2tncm91bmQgY2lyY2xlXG5cbiAgICAgICAgICAgICAgICAgICAgYy5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgYy5hcmModGhpcy54eSwgdGhpcy54eSwgdGhpcy5yYWRpdXMsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlU3R5bGUgPSAnIzU1NjM2Yyc7XG4gICAgICAgICAgICAgICAgICAgIGMubGluZVdpZHRoID0gYmFja2dyb3VuZENpcmNsZVNpemU7XG4gICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9kcmF3IGZvcmVncm91bmQgZmlsbCBjaXJjbGVcblxuICAgICAgICAgICAgICAgICAgICBjLmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgICAgICBjLmFyYyh0aGlzLnh5LCB0aGlzLnh5LCB0aGlzLnJhZGl1cywgYS5zLCBhLmUsIGEuZCk7XG4gICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlU3R5bGUgPSAnIzU1NjM2Yyc7XG4gICAgICAgICAgICAgICAgICAgIGMubGluZUNhcCA9ICdzcXVhcmUnO1xuICAgICAgICAgICAgICAgICAgICBjLmxpbmVXaWR0aCA9IGZvcmVncm91bmRDaXJjbGVTdHJva2U7XG4gICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYy5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgYy5hcmModGhpcy54eSwgdGhpcy54eSwgdGhpcy5yYWRpdXMsIGEucywgYS5lLCBhLmQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYy5zdHJva2VTdHlsZSA9ICcjZmZmJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlU3R5bGUgPSAnI2YwZjBmMCc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjLmxpbmVDYXAgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgYy5saW5lV2lkdGggPSBmb3JlZ3JvdW5kQ2lyY2xlRmlsbDtcbiAgICAgICAgICAgICAgICAgICAgYy5zdHJva2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAvL2RyYXcgaGFuZGxlXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgZW5kIGFuZ2xlIGNvb3JkaW5hdGVzLiBmb3VuZCBpdCBoZXJlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4MzQyMjE2L2hvdy10by1nZXQtYW4tYXJyYXktb2YtY29vcmRpbmF0ZXMtdGhhdC1tYWtlLXVwLWEtY2lyY2xlLWluLWNhbnZhc1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhZGlhbnMgPSBhLmUgLSBNYXRoLlBJIC8gMTgwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSB0aGlzLnh5ICsgdGhpcy5yYWRpdXMgKiBNYXRoLmNvcyhyYWRpYW5zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB5ID0gdGhpcy54eSArIHRoaXMucmFkaXVzICogTWF0aC5zaW4ocmFkaWFucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHlvdXIgY3VzdG9tIGRvdFxuICAgICAgICAgICAgICAgICAgICAgICAgYy5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGMuYXJjKHgsIHksIGhhbmRsZVNpemUsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjLmZpbGxTdHlsZSA9ICcjZmZmJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGMuc3Ryb2tlU3R5bGUgPSAnIzU1NjM2Yyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBjLmxpbmVDYXAgPSAncm91bmQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgYy5saW5lV2lkdGggPSBoYW5kbGVMaW5lU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGMuZmlsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYy5zdHJva2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHB1Ymxpc2hJbnRlcnZhbCA9ICRpbnRlcnZhbChwdWJsaXNoSW50ZXJ2YWxIYW5kbGVyLCAxMDAwKTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9maWxlJywgcHJvZmlsZVdhdGNoZXIpO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3ZhbHVlJywgdmFsdWVXYXRjaGVyKTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdlbmFibGVkJywgZW5hYmxlV2F0Y2hlcik7XG5cbiAgICAgICAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBkZXN0cm95SGFuZGxlcik7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByb2ZpbGVXYXRjaGVyKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc051bWJlcihzY29wZS5wcm9maWxlLm1pbmltdW0pICYmIGFuZ3VsYXIuaXNOdW1iZXIoc2NvcGUucHJvZmlsZS5tYXhpbXVtKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLm1pbiA9IHNjb3BlLnByb2ZpbGUubWluaW11bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMubWF4ID0gc2NvcGUucHJvZmlsZS5tYXhpbXVtO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMubWluID0gY29uZmlnLmRlZmF1bHRNaW5pbXVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5tYXggPSBjb25maWcuZGVmYXVsdE1heGltdW07XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5vcHRpb25zLm1pbiA+IHNjb3BlLm9wdGlvbnMubWF4KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBpbnZhbGlkTWluTWF4Q29uZmlndXJhdGlvbk1lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5vcHRpb25zLm1pbiA+IHNjb3BlLnZhbHVlIHx8IHNjb3BlLm9wdGlvbnMubWF4IDwgc2NvcGUudmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gYXNzZXRWYWx1ZU91dE9mQm91bmRzTWVzc2FnZTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5wcm9maWxlLnR5cGUgPT0gJ251bWJlcicpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5zdGVwID0gMC4xO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZW5hYmxlV2F0Y2hlcigpIHtcblxuICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMucmVhZE9ubHkgPSAhc2NvcGUuZW5hYmxlZDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB2YWx1ZVdhdGNoZXIoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsdWUgPCBzY29wZS5vcHRpb25zLm1pbiB8fCBzY29wZS52YWx1ZSA+IHNjb3BlLm9wdGlvbnMubWF4KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IGFzc2V0VmFsdWVPdXRPZkJvdW5kc01lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcHVibGlzaEludGVydmFsSGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZVRvUHVibGlzaCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hWYWx1ZSh2YWx1ZVRvUHVibGlzaCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFsdWVUb1B1Ymxpc2ggPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBkZXN0cm95SGFuZGxlcigpIHtcblxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwocHVibGlzaEludGVydmFsKTtcblxuICAgICAgICAgICAgICAgIHB1Ymxpc2hJbnRlcnZhbCA9IG51bGw7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gcHVibGlzaFZhbHVlKHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUub25DaGFuZ2UpIHtcblxuICAgICAgICAgICAgICAgICAgICBzY29wZS5vbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2xpbmVQcm9ncmVzc0NvbnRyb2wnLCBsaW5lUHJvZ3Jlc3NDb250cm9sKTtcblxuICAgIGxpbmVQcm9ncmVzc0NvbnRyb2wuJGluamVjdCA9IFsnY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBsaW5lUHJvZ3Jlc3NDb250cm9sKGNvbmZpZykge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wtc2xpZGVyIG5nLXNob3c9IWJsb2NrZWQ+PGFydGljbGUgY2xhc3M9c2xpZGVyLXZhbD48c3BhbiBjbGFzcz1zbGlkZXItdmFsdWU+e3t2YWx1ZX19PC9zcGFuPiA8c3BhbiBjbGFzcz1zbGlkZXItdW5pdD57e3Byb2ZpbGUudW5pdH19PC9zcGFuPjwvYXJ0aWNsZT48ZGl2PjxtZC1zbGlkZXIgbmctaWY9c2xpZGVyU2V0dGluZ3NBcmVSZWFkeSBhcmlhLWxhYmVsPWxpbmVQcm9ncmVzcyBuZy1kaXNhYmxlZD10cnVlIG5nLW1vZGVsPXZhbHVlIG1pbj1cXFwie3sgc2xpZGVyU2V0dGluZ3MubWluaW11bSB9fVxcXCIgbWF4PVxcXCJ7eyBzbGlkZXJTZXR0aW5ncy5tYXhpbXVtIH19XFxcIiBzdGVwPTE+PC9tZC1zbGlkZXI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz1jb250cm9sLWZhbGxiYWNrIG5nLXNob3c9YmxvY2tlZD48ZGl2IGNsYXNzPXZhbHVlLXVuaXQ+PHNwYW4gY2xhc3M9dmFsdWU+e3t2YWx1ZX19PC9zcGFuPiA8c3BhbiBjbGFzcz11bml0Pnt7cHJvZmlsZS51bml0fX08L3NwYW4+PC9kaXY+PHA+e3ttZXNzYWdlfX08L3A+PC9kaXY+JyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtlcixcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgdmFyIGFzc2V0VmFsdWVPdXRPZkJvdW5kc01lc3NhZ2UgPSBjb25maWcub3V0T2ZCb3VuZHNNZXNzYWdlLmZvcm1hdCgnTGluZSBwcm9ncmVzcycpO1xuICAgICAgICAgICAgdmFyIGludmFsaWRNaW5NYXhDb25maWd1cmF0aW9uTWVzc2FnZSA9IGNvbmZpZy5pbnZhbGlkQm91bmRzTWVzc2FnZTtcblxuICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IG51bGw7XG4gICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgIHNjb3BlLnNsaWRlclNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIG1pbmltdW06IGNvbmZpZy5kZWZhdWx0TWluaW11bSxcbiAgICAgICAgICAgICAgICBtYXhpbXVtOiBjb25maWcuZGVmYXVsdE1heGltdW1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgndmFsdWUnLCBmdW5jdGlvbihuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS52YWx1ZSA+IHNjb3BlLnNsaWRlclNldHRpbmdzLm1heGltdW0gfHwgc2NvcGUudmFsdWUgPCBzY29wZS5zbGlkZXJTZXR0aW5ncy5taW5pbXVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gYXNzZXRWYWx1ZU91dE9mQm91bmRzTWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvZmlsZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5wcm9maWxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNOdW1iZXIoc2NvcGUucHJvZmlsZS5taW5pbXVtKSAmJiBhbmd1bGFyLmlzTnVtYmVyKHNjb3BlLnByb2ZpbGUubWF4aW11bSkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2xpZGVyU2V0dGluZ3MubWluaW11bSA9IHNjb3BlLnByb2ZpbGUubWluaW11bTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNsaWRlclNldHRpbmdzLm1heGltdW0gPSBzY29wZS5wcm9maWxlLm1heGltdW07XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNsaWRlclNldHRpbmdzLm1pbmltdW0gPSBjb25maWcuZGVmYXVsdE1pbmltdW07XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zbGlkZXJTZXR0aW5ncy5tYXhpbXVtID0gY29uZmlnLmRlZmF1bHRNYXhpbXVtO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNsaWRlclNldHRpbmdzLm1pbmltdW0gPiBzY29wZS5zbGlkZXJTZXR0aW5ncy5tYXhpbXVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBpbnZhbGlkTWluTWF4Q29uZmlndXJhdGlvbk1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUuc2xpZGVyU2V0dGluZ3MubWluaW11bSA+IHNjb3BlLnZhbHVlIHx8IHNjb3BlLnNsaWRlclNldHRpbmdzLm1heGltdW0gPCBzY29wZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gYXNzZXRWYWx1ZU91dE9mQm91bmRzTWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL0hhY2sgYmVjYXVzZSBvZiB0aGUgcHJvYmxlbSB3aXRoIG5nTWF0ZXJpYWwgc2xpZGVyXG4gICAgICAgICAgICBzY29wZS5zbGlkZXJTZXR0aW5nc0FyZVJlYWR5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbG9ja1VubG9ja0NvbnRyb2wnLCBsb2NrVW5sb2NrQ29udHJvbCk7XG5cbiAgICBsb2NrVW5sb2NrQ29udHJvbC4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBsb2NrVW5sb2NrQ29udHJvbCgpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wtbG9jay11bmxvY2sgbmctY2xpY2s9b25DbGljaygpIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6ICFlbmFibGVkfVxcXCI+PGJ1dHRvbiBuZy1kaXNhYmxlZD0hZW5hYmxlZCBuZy1jbGFzcz1cXFwieyBsb2NrZWQ6IGxvY2tlZCB9XFxcIj48L2J1dHRvbj48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICAvL0RlZmF1bHQgY29udHJvbHMgc3RhdGU6XG4gICAgICAgICAgICBzY29wZS51bmxvY2tlZFZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICBzY29wZS5sb2NrZWRWYWx1ZSA9IHRydWU7XG4gICAgICAgICAgICBzY29wZS5sb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9maWxlJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS5lbnVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51bmxvY2tlZFZhbHVlID0gc2NvcGUucHJvZmlsZS5lbnVtWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9ja2VkVmFsdWUgPSBzY29wZS5wcm9maWxlLmVudW1bMV07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVubG9ja2VkVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2NrZWRWYWx1ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5wcm9maWxlLnR5cGUgPT0gJ2ludGVnZXInKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudW5sb2NrZWRWYWx1ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9ja2VkVmFsdWUgPSBzY29wZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3ZhbHVlJywgZnVuY3Rpb24obmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAvL2lmIG5vdCBsb2NrZWQgLT4gbG9ja1xuICAgICAgICAgICAgICAgIGlmIChzY29wZS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghc2NvcGUubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUoc2NvcGUubG9ja2VkVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9ja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5sb2NrZWQpIHsgLy9pZiBsb2NrZWQgLT4gdW5sb2NrXG4gICAgICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUoc2NvcGUudW5sb2NrZWRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2NrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2hWYWx1ZSh2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLm9uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbDogdmFsdWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnZhbHVlID09PSBzY29wZS5sb2NrZWRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5sb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUudmFsdWUgPT09IHNjb3BlLnVubG9ja2VkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9ja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbWFwQ29udHJvbCcsIG1hcENvbnRyb2wpO1xuXG4gICAgbWFwQ29udHJvbC4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBtYXBDb250cm9sKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgdGVtcGxhdGU6ICc8bGVhZmxldCBpZD17e3ZtLmlkfX0gY2xhc3M9Y29udHJvbC1tYXAgbWFya2Vycz12bS5tYXJrZXJzIGNlbnRlcj12bS5jZW50ZXIgZGVmYXVsdHM9dm0uZGVmYXVsdHMgcGF0aHM9dm0ucGF0aHM+PC9sZWFmbGV0PicsXG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG4gICAgfVxuXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGludGVydmFsJywgJ2xlYWZsZXREYXRhJ107XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgJGludGVydmFsLCBsZWFmbGV0RGF0YSkge1xuXG4gICAgICAgIHZhciBtYXBEZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIGljb246IHtcbiAgICAgICAgICAgICAgICBpbWFnZTogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQjRBQUFBd0NBWUFBQUFHbHNya0FBQUFDWEJJV1hNQUFBc1RBQUFMRXdFQW1wd1lBQUE1bEdsVVdIUllUVXc2WTI5dExtRmtiMkpsTG5odGNBQUFBQUFBUEQ5NGNHRmphMlYwSUdKbFoybHVQU0x2dTc4aUlHbGtQU0pYTlUwd1RYQkRaV2hwU0hweVpWTjZUbFJqZW10ak9XUWlQejRLUEhnNmVHMXdiV1YwWVNCNGJXeHVjenA0UFNKaFpHOWlaVHB1Y3pwdFpYUmhMeUlnZURwNGJYQjBhejBpUVdSdlltVWdXRTFRSUVOdmNtVWdOUzQxTFdNd01qRWdOemt1TVRVME9URXhMQ0F5TURFekx6RXdMekk1TFRFeE9qUTNPakUySUNBZ0lDQWdJQ0FpUGdvZ0lDQThjbVJtT2xKRVJpQjRiV3h1Y3pweVpHWTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1Rrdk1ESXZNakl0Y21SbUxYTjViblJoZUMxdWN5TWlQZ29nSUNBZ0lDQThjbVJtT2tSbGMyTnlhWEIwYVc5dUlISmtaanBoWW05MWREMGlJZ29nSUNBZ0lDQWdJQ0FnSUNCNGJXeHVjenA0YlhBOUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZlR0Z3THpFdU1DOGlDaUFnSUNBZ0lDQWdJQ0FnSUhodGJHNXpPbmh0Y0UxTlBTSm9kSFJ3T2k4dmJuTXVZV1J2WW1VdVkyOXRMM2hoY0M4eExqQXZiVzB2SWdvZ0lDQWdJQ0FnSUNBZ0lDQjRiV3h1Y3pwemRGSmxaajBpYUhSMGNEb3ZMMjV6TG1Ga2IySmxMbU52YlM5NFlYQXZNUzR3TDNOVWVYQmxMMUpsYzI5MWNtTmxVbVZtSXlJS0lDQWdJQ0FnSUNBZ0lDQWdlRzFzYm5NNmMzUkZkblE5SW1oMGRIQTZMeTl1Y3k1aFpHOWlaUzVqYjIwdmVHRndMekV1TUM5elZIbHdaUzlTWlhOdmRYSmpaVVYyWlc1MEl5SUtJQ0FnSUNBZ0lDQWdJQ0FnZUcxc2JuTTZaR005SW1oMGRIQTZMeTl3ZFhKc0xtOXlaeTlrWXk5bGJHVnRaVzUwY3k4eExqRXZJZ29nSUNBZ0lDQWdJQ0FnSUNCNGJXeHVjenB3YUc5MGIzTm9iM0E5SW1oMGRIQTZMeTl1Y3k1aFpHOWlaUzVqYjIwdmNHaHZkRzl6YUc5d0x6RXVNQzhpQ2lBZ0lDQWdJQ0FnSUNBZ0lIaHRiRzV6T25ScFptWTlJbWgwZEhBNkx5OXVjeTVoWkc5aVpTNWpiMjB2ZEdsbVppOHhMakF2SWdvZ0lDQWdJQ0FnSUNBZ0lDQjRiV3h1Y3pwbGVHbG1QU0pvZEhSd09pOHZibk11WVdSdlltVXVZMjl0TDJWNGFXWXZNUzR3THlJK0NpQWdJQ0FnSUNBZ0lEeDRiWEE2UTNKbFlYUnZjbFJ2YjJ3K1FXUnZZbVVnVUdodmRHOXphRzl3SUVORElDaFhhVzVrYjNkektUd3ZlRzF3T2tOeVpXRjBiM0pVYjI5c1Bnb2dJQ0FnSUNBZ0lDQThlRzF3T2tOeVpXRjBaVVJoZEdVK01qQXhOUzB4TUMweU1sUXhNam8wT0Rvd09Dc3dNam93TUR3dmVHMXdPa055WldGMFpVUmhkR1UrQ2lBZ0lDQWdJQ0FnSUR4NGJYQTZUVzlrYVdaNVJHRjBaVDR5TURFMUxURXdMVEl5VkRFek9qVXlPakUyS3pBeU9qQXdQQzk0YlhBNlRXOWthV1o1UkdGMFpUNEtJQ0FnSUNBZ0lDQWdQSGh0Y0RwTlpYUmhaR0YwWVVSaGRHVStNakF4TlMweE1DMHlNbFF4TXpvMU1qb3hOaXN3TWpvd01Ed3ZlRzF3T2sxbGRHRmtZWFJoUkdGMFpUNEtJQ0FnSUNBZ0lDQWdQSGh0Y0UxTk9rbHVjM1JoYm1ObFNVUStlRzF3TG1scFpEcGtOelUxTVRZNE9DMDVaRGhoTFdReU5HVXRPRFZoWmkxaE9UQXhNRE5tTWpNMU1UVThMM2h0Y0UxTk9rbHVjM1JoYm1ObFNVUStDaUFnSUNBZ0lDQWdJRHg0YlhCTlRUcEViMk4xYldWdWRFbEVQbmh0Y0M1a2FXUTZPVEl4UlRRNE9USTNPRUU1TVRGRk5VSXpPREJDTmpVNFFURTVORGRFUWtZOEwzaHRjRTFOT2tSdlkzVnRaVzUwU1VRK0NpQWdJQ0FnSUNBZ0lEeDRiWEJOVFRwRVpYSnBkbVZrUm5KdmJTQnlaR1k2Y0dGeWMyVlVlWEJsUFNKU1pYTnZkWEpqWlNJK0NpQWdJQ0FnSUNBZ0lDQWdJRHh6ZEZKbFpqcHBibk4wWVc1alpVbEVQbmh0Y0M1cGFXUTZPVEl4UlRRNE9FWTNPRUU1TVRGRk5VSXpPREJDTmpVNFFURTVORGRFUWtZOEwzTjBVbVZtT21sdWMzUmhibU5sU1VRK0NpQWdJQ0FnSUNBZ0lDQWdJRHh6ZEZKbFpqcGtiMk4xYldWdWRFbEVQbmh0Y0M1a2FXUTZPVEl4UlRRNE9UQTNPRUU1TVRGRk5VSXpPREJDTmpVNFFURTVORGRFUWtZOEwzTjBVbVZtT21SdlkzVnRaVzUwU1VRK0NpQWdJQ0FnSUNBZ0lEd3ZlRzF3VFUwNlJHVnlhWFpsWkVaeWIyMCtDaUFnSUNBZ0lDQWdJRHg0YlhCTlRUcFBjbWxuYVc1aGJFUnZZM1Z0Wlc1MFNVUStlRzF3TG1ScFpEbzVNakZGTkRnNU1qYzRRVGt4TVVVMVFqTTRNRUkyTlRoQk1UazBOMFJDUmp3dmVHMXdUVTA2VDNKcFoybHVZV3hFYjJOMWJXVnVkRWxFUGdvZ0lDQWdJQ0FnSUNBOGVHMXdUVTA2U0dsemRHOXllVDRLSUNBZ0lDQWdJQ0FnSUNBZ1BISmtaanBUWlhFK0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4eVpHWTZiR2tnY21SbU9uQmhjbk5sVkhsd1pUMGlVbVZ6YjNWeVkyVWlQZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4YzNSRmRuUTZZV04wYVc5dVBuTmhkbVZrUEM5emRFVjJkRHBoWTNScGIyNCtDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHh6ZEVWMmREcHBibk4wWVc1alpVbEVQbmh0Y0M1cGFXUTZaRGMxTlRFMk9EZ3RPV1E0WVMxa01qUmxMVGcxWVdZdFlUa3dNVEF6WmpJek5URTFQQzl6ZEVWMmREcHBibk4wWVc1alpVbEVQZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4YzNSRmRuUTZkMmhsYmo0eU1ERTFMVEV3TFRJeVZERXpPalV5T2pFMkt6QXlPakF3UEM5emRFVjJkRHAzYUdWdVBnb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThjM1JGZG5RNmMyOW1kSGRoY21WQloyVnVkRDVCWkc5aVpTQlFhRzkwYjNOb2IzQWdRME1nS0ZkcGJtUnZkM01wUEM5emRFVjJkRHB6YjJaMGQyRnlaVUZuWlc1MFBnb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThjM1JGZG5RNlkyaGhibWRsWkQ0dlBDOXpkRVYyZERwamFHRnVaMlZrUGdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4TDNKa1pqcHNhVDRLSUNBZ0lDQWdJQ0FnSUNBZ1BDOXlaR1k2VTJWeFBnb2dJQ0FnSUNBZ0lDQThMM2h0Y0UxTk9raHBjM1J2Y25rK0NpQWdJQ0FnSUNBZ0lEeGtZenBtYjNKdFlYUSthVzFoWjJVdmNHNW5QQzlrWXpwbWIzSnRZWFErQ2lBZ0lDQWdJQ0FnSUR4d2FHOTBiM05vYjNBNlEyOXNiM0pOYjJSbFBqTThMM0JvYjNSdmMyaHZjRHBEYjJ4dmNrMXZaR1UrQ2lBZ0lDQWdJQ0FnSUR4MGFXWm1Pazl5YVdWdWRHRjBhVzl1UGpFOEwzUnBabVk2VDNKcFpXNTBZWFJwYjI0K0NpQWdJQ0FnSUNBZ0lEeDBhV1ptT2xoU1pYTnZiSFYwYVc5dVBqY3lNREF3TUM4eE1EQXdNRHd2ZEdsbVpqcFlVbVZ6YjJ4MWRHbHZiajRLSUNBZ0lDQWdJQ0FnUEhScFptWTZXVkpsYzI5c2RYUnBiMjQrTnpJd01EQXdMekV3TURBd1BDOTBhV1ptT2xsU1pYTnZiSFYwYVc5dVBnb2dJQ0FnSUNBZ0lDQThkR2xtWmpwU1pYTnZiSFYwYVc5dVZXNXBkRDR5UEM5MGFXWm1PbEpsYzI5c2RYUnBiMjVWYm1sMFBnb2dJQ0FnSUNBZ0lDQThaWGhwWmpwRGIyeHZjbE53WVdObFBqWTFOVE0xUEM5bGVHbG1Pa052Ykc5eVUzQmhZMlUrQ2lBZ0lDQWdJQ0FnSUR4bGVHbG1PbEJwZUdWc1dFUnBiV1Z1YzJsdmJqNHpNRHd2WlhocFpqcFFhWGhsYkZoRWFXMWxibk5wYjI0K0NpQWdJQ0FnSUNBZ0lEeGxlR2xtT2xCcGVHVnNXVVJwYldWdWMybHZiajQwT0R3dlpYaHBaanBRYVhobGJGbEVhVzFsYm5OcGIyNCtDaUFnSUNBZ0lEd3ZjbVJtT2tSbGMyTnlhWEIwYVc5dVBnb2dJQ0E4TDNKa1pqcFNSRVkrQ2p3dmVEcDRiWEJ0WlhSaFBnb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvOFAzaHdZV05yWlhRZ1pXNWtQU0ozSWo4K1puaGV4QUFBQUNCalNGSk5BQUI2SlFBQWdJTUFBUG4vQUFDQTZRQUFkVEFBQU9wZ0FBQTZtQUFBRjIrU1g4VkdBQUFFWTBsRVFWUjQycnlZUzJna1JSakhmMVhkUGNsTWtra2krd0tYMVNpN3E3SXNDQjcySUI0WFJNR2pnZ2RSVHg0VUJmR0ZxSmNvb29KNmN0ZURCOEdETHhTTUlxajRBa1VrSzJRUEs3dXVpUkdqeVQ0eWVVL1BWSDBlcWtZbjA1MTB6MHlTLzJIbzZlNnYvdlc5djJwMTZPRkpjdUE2NERod0RMZ1IyTmZ5ZkFZWUIzNEVQZ2ZPWmkwWVpqdy9DandKM0FFVU4zbHZDTGdldUJ0WUJqNEJYZ1JPYlNTZ04xbHNGUGdGdUN1RHRCVjl3SjNlQWk4QmhiekV1NEV2Z0tjQVJYZDRGUGdTdURMTDFHWGdhK0NHMUdXVUJxVlJLbWpha3lCaVFReUlUWk82R2ZqT3g4ZHNHbkVCR051SVZBVUZSQ3dTTDJIalJiQXhJS0FqVkRTQUt2UzdkMHpOM1YrUEViLzJMY0JxSy9HbzMxMFRCRlFJT3NTc1hrQVdwN0hWQ3RnYUlnSUlTbW5RSWFvd2dPN2ZqeTd0QVN6WWVxdW5idklCOXhDQTh1bDBCSmhJa2thZ3dGVE9ZK1ovYzBRNmNxSHh2Nlhkajk5TVVENUFNSHpZdWNYR2FXRnlGSmpRVGRxMjJoYTB4bHo2Rlh2cExFcUhxS0RvN2l2bEYxVHVXbWtJZWxCQkFic3doYmw0R29XQVRzM1dseHRSZlJDNHJWVmJGVVRZeFduTTRoU0VQWTR3NmJ0azhJVkZ6TkpmMUN2bm5adVNPQTRjMGNDdFFMQitnUWdicjJBcXY2TUkzSUp0UU9rSXUvQUhFbGRBUjJtdjNLNTltTGNJQnRqVldhUzJERUhVZnZicUNERlY3UEtzZDBYQ3o4YzBjSGc5cTBKc0hhbFcydFowbmF0MDZEUTJxUUYyVUFON0U4Vk02bEJmODRXaVUyaWt0cHFXVmdCN2RXb3RGUUZNZDhWUzRTdVpwSm02b0lFNFhTcm9qbGdBN1Vxc1UyUWRxdHIzMGlaWVY0bkNFbUs3MGRxZ3dwSlBxUVR4akU1VUxIR0JvWHFIbklCSVp3cGJnKzRkUmdXRnRPWXhvWUZ2azBJMWRHazN1cWVNcEplOUROSWFLaXloU25zMnN0cjMybmVObGZXU0JoVVVDUWF2OWYvcitjbkZOWWhnY0FRVkRZRFVFdjRGUHRMQUhIQ2lOYmpFVkZGOSt3aUhEcm1VeUtPNTFCRVRFdzVlUTFBK3NKSE1tOEJNb3p2dEFxYUFVckx4QjlpbFB6SHo1NkJlQlIwME5RcWZlbUxBR3RBUndkQUl1bnkxNzFnSlMxVjliNTVwVlBFTHZrT05Kc3dHQk9XclVMMVh1UHBidll6VTE2RFI4RldJQ291b25tSDB3SDUwejdDTEN6RnAycjdSeUNMVk5ONFdnRE4rUjZuMUY2V2d2b2JVbHY2Yk5KU09VRkVmUkNXWE5iYTJVUmU3N012elhPc0VFZ09QQWUrbEVsc2ZKRHBFRlhlaHZUYUNPRE9iT0N2c25tdVFwazJaN3dPZlpVYXRpUkZUUlV6VkVVcG1vUmtIWHM4YWIrOEY1dGs2R09DZVBIUDFQOEFUVzBqOFBIQTY3MG5pQlBEVkZwQk9BTSswZTRTNUgxanJrdmkrVHM1T2s4RFRYWkMrQXZ6Y0NYRkRlTHdEMGtuZzhjM25rMnc4MEFIeGcxa2pUQjdpbjRDVGJaQ08rZk14M1JMamZiMlM4OTFIOG8yQytUQUh2SkRqdlpONVBrTzBRd3p3YW5PdFRjRUs4R3orNFRjL2xvRFhObm4rRnZEM2RoQTMrbWxhSFkrOVJkZ3U0b3ZBMnluM1B3RE9iU2R4WTJaS0N5cTJtM2dDK0tIcC94bmdtNTBnQm5pbjZmcmQ3QlA3MWhGLzNIVDlZV2RueWM0dzdVMjhrUHhva3c4aG5lT1UzNERkYWVKUC9aZEFkcHA0RE9qdlZQamZBUUFqMUh5cTdnNWF1UUFBQUFCSlJVNUVya0pnZ2c9PScsXG4gICAgICAgICAgICAgICAgc2hhZG93SW1hZ2U6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURJQUFBQWRDQVlBQUFEb3hUOVNBQUFBQ1hCSVdYTUFBQXNUQUFBTEV3RUFtcHdZQUFBNWxHbFVXSFJZVFV3NlkyOXRMbUZrYjJKbExuaHRjQUFBQUFBQVBEOTRjR0ZqYTJWMElHSmxaMmx1UFNMdnU3OGlJR2xrUFNKWE5VMHdUWEJEWldocFNIcHlaVk42VGxSamVtdGpPV1FpUHo0S1BIZzZlRzF3YldWMFlTQjRiV3h1Y3pwNFBTSmhaRzlpWlRwdWN6cHRaWFJoTHlJZ2VEcDRiWEIwYXowaVFXUnZZbVVnV0UxUUlFTnZjbVVnTlM0MUxXTXdNakVnTnprdU1UVTBPVEV4TENBeU1ERXpMekV3THpJNUxURXhPalEzT2pFMklDQWdJQ0FnSUNBaVBnb2dJQ0E4Y21SbU9sSkVSaUI0Yld4dWN6cHlaR1k5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZNREl2TWpJdGNtUm1MWE41Ym5SaGVDMXVjeU1pUGdvZ0lDQWdJQ0E4Y21SbU9rUmxjMk55YVhCMGFXOXVJSEprWmpwaFltOTFkRDBpSWdvZ0lDQWdJQ0FnSUNBZ0lDQjRiV3h1Y3pwNGJYQTlJbWgwZEhBNkx5OXVjeTVoWkc5aVpTNWpiMjB2ZUdGd0x6RXVNQzhpQ2lBZ0lDQWdJQ0FnSUNBZ0lIaHRiRzV6T25odGNFMU5QU0pvZEhSd09pOHZibk11WVdSdlltVXVZMjl0TDNoaGNDOHhMakF2Ylcwdklnb2dJQ0FnSUNBZ0lDQWdJQ0I0Yld4dWN6cHpkRkpsWmowaWFIUjBjRG92TDI1ekxtRmtiMkpsTG1OdmJTOTRZWEF2TVM0d0wzTlVlWEJsTDFKbGMyOTFjbU5sVW1WbUl5SUtJQ0FnSUNBZ0lDQWdJQ0FnZUcxc2JuTTZjM1JGZG5ROUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZlR0Z3THpFdU1DOXpWSGx3WlM5U1pYTnZkWEpqWlVWMlpXNTBJeUlLSUNBZ0lDQWdJQ0FnSUNBZ2VHMXNibk02WkdNOUltaDBkSEE2THk5d2RYSnNMbTl5Wnk5a1l5OWxiR1Z0Wlc1MGN5OHhMakV2SWdvZ0lDQWdJQ0FnSUNBZ0lDQjRiV3h1Y3pwd2FHOTBiM05vYjNBOUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZjR2h2ZEc5emFHOXdMekV1TUM4aUNpQWdJQ0FnSUNBZ0lDQWdJSGh0Ykc1ek9uUnBabVk5SW1oMGRIQTZMeTl1Y3k1aFpHOWlaUzVqYjIwdmRHbG1aaTh4TGpBdklnb2dJQ0FnSUNBZ0lDQWdJQ0I0Yld4dWN6cGxlR2xtUFNKb2RIUndPaTh2Ym5NdVlXUnZZbVV1WTI5dEwyVjRhV1l2TVM0d0x5SStDaUFnSUNBZ0lDQWdJRHg0YlhBNlEzSmxZWFJ2Y2xSdmIydytRV1J2WW1VZ1VHaHZkRzl6YUc5d0lFTkRJQ2hYYVc1a2IzZHpLVHd2ZUcxd09rTnlaV0YwYjNKVWIyOXNQZ29nSUNBZ0lDQWdJQ0E4ZUcxd09rTnlaV0YwWlVSaGRHVStNakF4TlMweE1DMHlNbFF4TWpvME9Eb3dPQ3N3TWpvd01Ed3ZlRzF3T2tOeVpXRjBaVVJoZEdVK0NpQWdJQ0FnSUNBZ0lEeDRiWEE2VFc5a2FXWjVSR0YwWlQ0eU1ERTFMVEV3TFRJeVZERXpPalV5T2pJNUt6QXlPakF3UEM5NGJYQTZUVzlrYVdaNVJHRjBaVDRLSUNBZ0lDQWdJQ0FnUEhodGNEcE5aWFJoWkdGMFlVUmhkR1UrTWpBeE5TMHhNQzB5TWxReE16bzFNam95T1Nzd01qb3dNRHd2ZUcxd09rMWxkR0ZrWVhSaFJHRjBaVDRLSUNBZ0lDQWdJQ0FnUEhodGNFMU5Pa2x1YzNSaGJtTmxTVVErZUcxd0xtbHBaRHBoTlRnMFptWTRNQzAzWVRFMkxUQm1ORGd0T1RVd1lTMDNOemd6TXpZMU1HUTVOemc4TDNodGNFMU5Pa2x1YzNSaGJtTmxTVVErQ2lBZ0lDQWdJQ0FnSUR4NGJYQk5UVHBFYjJOMWJXVnVkRWxFUG5odGNDNWthV1E2T0RoRE56TkZNVUkzT0VFNU1URkZOVUZDTURKQ00wSTNOa1EzUlRNM1JqYzhMM2h0Y0UxTk9rUnZZM1Z0Wlc1MFNVUStDaUFnSUNBZ0lDQWdJRHg0YlhCTlRUcEVaWEpwZG1Wa1JuSnZiU0J5WkdZNmNHRnljMlZVZVhCbFBTSlNaWE52ZFhKalpTSStDaUFnSUNBZ0lDQWdJQ0FnSUR4emRGSmxaanBwYm5OMFlXNWpaVWxFUG5odGNDNXBhV1E2T0RoRE56TkZNVGczT0VFNU1URkZOVUZDTURKQ00wSTNOa1EzUlRNM1JqYzhMM04wVW1WbU9tbHVjM1JoYm1ObFNVUStDaUFnSUNBZ0lDQWdJQ0FnSUR4emRGSmxaanBrYjJOMWJXVnVkRWxFUG5odGNDNWthV1E2T0RoRE56TkZNVGszT0VFNU1URkZOVUZDTURKQ00wSTNOa1EzUlRNM1JqYzhMM04wVW1WbU9tUnZZM1Z0Wlc1MFNVUStDaUFnSUNBZ0lDQWdJRHd2ZUcxd1RVMDZSR1Z5YVhabFpFWnliMjArQ2lBZ0lDQWdJQ0FnSUR4NGJYQk5UVHBQY21sbmFXNWhiRVJ2WTNWdFpXNTBTVVErZUcxd0xtUnBaRG80T0VNM00wVXhRamM0UVRreE1VVTFRVUl3TWtJelFqYzJSRGRGTXpkR056d3ZlRzF3VFUwNlQzSnBaMmx1WVd4RWIyTjFiV1Z1ZEVsRVBnb2dJQ0FnSUNBZ0lDQThlRzF3VFUwNlNHbHpkRzl5ZVQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwVFpYRStDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrZ2NtUm1PbkJoY25ObFZIbHdaVDBpVW1WemIzVnlZMlVpUGdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOGMzUkZkblE2WVdOMGFXOXVQbk5oZG1Wa1BDOXpkRVYyZERwaFkzUnBiMjQrQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4emRFVjJkRHBwYm5OMFlXNWpaVWxFUG5odGNDNXBhV1E2WVRVNE5HWm1PREF0TjJFeE5pMHdaalE0TFRrMU1HRXROemM0TXpNMk5UQmtPVGM0UEM5emRFVjJkRHBwYm5OMFlXNWpaVWxFUGdvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOGMzUkZkblE2ZDJobGJqNHlNREUxTFRFd0xUSXlWREV6T2pVeU9qSTVLekF5T2pBd1BDOXpkRVYyZERwM2FHVnVQZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4YzNSRmRuUTZjMjltZEhkaGNtVkJaMlZ1ZEQ1QlpHOWlaU0JRYUc5MGIzTm9iM0FnUTBNZ0tGZHBibVJ2ZDNNcFBDOXpkRVYyZERwemIyWjBkMkZ5WlVGblpXNTBQZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4YzNSRmRuUTZZMmhoYm1kbFpENHZQQzl6ZEVWMmREcGphR0Z1WjJWa1Bnb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBOEwzSmtaanBzYVQ0S0lDQWdJQ0FnSUNBZ0lDQWdQQzl5WkdZNlUyVnhQZ29nSUNBZ0lDQWdJQ0E4TDNodGNFMU5Pa2hwYzNSdmNuaytDaUFnSUNBZ0lDQWdJRHhrWXpwbWIzSnRZWFErYVcxaFoyVXZjRzVuUEM5a1l6cG1iM0p0WVhRK0NpQWdJQ0FnSUNBZ0lEeHdhRzkwYjNOb2IzQTZRMjlzYjNKTmIyUmxQak04TDNCb2IzUnZjMmh2Y0RwRGIyeHZjazF2WkdVK0NpQWdJQ0FnSUNBZ0lEeDBhV1ptT2s5eWFXVnVkR0YwYVc5dVBqRThMM1JwWm1ZNlQzSnBaVzUwWVhScGIyNCtDaUFnSUNBZ0lDQWdJRHgwYVdabU9saFNaWE52YkhWMGFXOXVQamN5TURBd01DOHhNREF3TUR3dmRHbG1aanBZVW1WemIyeDFkR2x2Ymo0S0lDQWdJQ0FnSUNBZ1BIUnBabVk2V1ZKbGMyOXNkWFJwYjI0K056SXdNREF3THpFd01EQXdQQzkwYVdabU9sbFNaWE52YkhWMGFXOXVQZ29nSUNBZ0lDQWdJQ0E4ZEdsbVpqcFNaWE52YkhWMGFXOXVWVzVwZEQ0eVBDOTBhV1ptT2xKbGMyOXNkWFJwYjI1VmJtbDBQZ29nSUNBZ0lDQWdJQ0E4WlhocFpqcERiMnh2Y2xOd1lXTmxQalkxTlRNMVBDOWxlR2xtT2tOdmJHOXlVM0JoWTJVK0NpQWdJQ0FnSUNBZ0lEeGxlR2xtT2xCcGVHVnNXRVJwYldWdWMybHZiajQxTUR3dlpYaHBaanBRYVhobGJGaEVhVzFsYm5OcGIyNCtDaUFnSUNBZ0lDQWdJRHhsZUdsbU9sQnBlR1ZzV1VScGJXVnVjMmx2Ymo0eU9Ud3ZaWGhwWmpwUWFYaGxiRmxFYVcxbGJuTnBiMjQrQ2lBZ0lDQWdJRHd2Y21SbU9rUmxjMk55YVhCMGFXOXVQZ29nSUNBOEwzSmtaanBTUkVZK0Nqd3ZlRHA0YlhCdFpYUmhQZ29nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdDaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0NpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQUtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBbzhQM2h3WVdOclpYUWdaVzVrUFNKM0lqOCsxaU9URlFBQUFDQmpTRkpOQUFCNkpRQUFnSU1BQVBuL0FBQ0E2UUFBZFRBQUFPcGdBQUE2bUFBQUYyK1NYOFZHQUFBQ0kwbEVRVlI0MnR5WTYwN0RNQXlGVDlxd3NRMTQvL2RFb05KTHdnK09wWU9WMGE0M0JwV3NCcENvUC9zNGRoSnl6dmdQVHdTQUVNS2Uzd3p1ZmUzSnRORW41L3dGc3BQVEFVRGwzcUVBWkFDSmx1V2RmOHpJUmdBVmdKb1daVzFXZ2xHbkIxb0hvS2ZaNy9LV0lPWk1EZUNCLy92STljSEJHS2lYbURtWXhEcmFCNEFXUU1PZnYyVW9yZ2hoQUVjQWozd2JRSFNTK3FsVzhoV0p0WVI1cDMxb2R0WUFNZWs4QXJnSVJKVG9UeTN3RW1CTlo2TUVwK2JmR3BOaVhKaUZ3Q3hjYUdmNVVKam8rQzBadDR3bTFrekg5ZUtNR01TTFFLd0pVQUxTekJqWTdJd0VrZE96UUZRNzlxRnZ6OXdQVjR6SzA4NFFvS1JhV2xwUzdKYU5FKzFoSndqckxRMTNyV2Jwcm1YWk9GTmE5Y1lBaVcvckpXOEFYcmxPYy90SVJSbWRDQkUzS214dGpOYmRHK2toamUvd2NjWVdlQ1RJMm5XUlhSUHNwUjRhc1k0UXMwZVVpdld3WmpaMEdQU3pWU3ZkdkpOWkt5OFpHaTBicHh0M3FlQStuTnpZWWM3M01sTjFoVUV4alkzMFUwRnFONExVRTZXaWpnOVhKbHBkYTlSSG5iOFZwR1lHbnR4MjY2T2RDNE5lNzZ6a2RISm5qMWxIMWpnQndocmZoZXU2b08rU1RBWnFYUFhkRnc1S3E1eTE0OGhBZUNEQXMwaEtIVTlPMDZweGN6eHQ0ZmhVa0tvQUVTU3luZXdtdmppOVZQYTdmQ2djVVE4eW1rZVJpYmRyVWYrZFc1UUN4Sm4xRUtRSnRhTDV3ZTFJOTNFZEpCQlJ6aFNkUVBoZEJyOFYrVnVrMWJzOWY3aW55RThGOFh2NzNVVitES1FVOFQ5MWx4cit5OTN2NXdDVi9RcDRkeWdtQlFBQUFBQkpSVTVFcmtKZ2dnPT0nLFxuICAgICAgICAgICAgICAgIGljb25TaXplOiBbMzAsIDQ4XSxcbiAgICAgICAgICAgICAgICBzaGFkb3dTaXplOiBbNTAsIDI5XSxcbiAgICAgICAgICAgICAgICBpY29uQW5jaG9yOiBbMTUsIDQ4XSxcbiAgICAgICAgICAgICAgICBzaGFkb3dBbmNob3I6IFszLCAyOV1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBiZWhhdmlvcjoge1xuICAgICAgICAgICAgICAgIGRyYXdMaW5lQmV0d2VlbkxvY2F0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsaW5lQ29sb3I6ICcjM0Q5MUNFJyxcbiAgICAgICAgICAgICAgICBsaW5lV2VpZ2h0OiA2LFxuICAgICAgICAgICAgICAgIGxpbmVPcGFjaXR5OiAwLjRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250cm9sczoge1xuICAgICAgICAgICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZG91YmxlQ2xpY2tab29tOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0aW9uQ29udHJvbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB6b29tQ29udHJvbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkcmFnZ2luZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0aWxlTGF5ZXI6ICdodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjZW50ZXI6IHt9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHBlbmRpbmdTdGF0ZUxvY2F0aW9uID0gbnVsbDtcbiAgICAgICAgdmFyIHBlbmRpbmdQYXRocyA9IFtdO1xuICAgICAgICB2YXIgbWFwSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICAgICAgICAvL21hcCBpcyBub3QgdXBkYXRlIGV2ZXJ5IHRpbWUgc3RhdGUgY2hhbmdlcywgYnV0IGV2ZXJ5IGluIGludGVydmFsIHNwZWNpZmllZFxuICAgICAgICB2YXIgbWFwVXBkYXRlSW50ZXJ2YWwgPSAzMDAwO1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmNlbnRlciA9IG1hcERlZmF1bHRzLmNlbnRlcjtcbiAgICAgICAgdm0ubWFya2VycyA9IFtdO1xuICAgICAgICB2bS5kZWZhdWx0cyA9IG1hcERlZmF1bHRzLmNvbnRyb2xzO1xuXG4gICAgICAgIHZtLnBhdGhzID0ge1xuICAgICAgICAgICAgbW92ZW1lbnQ6IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogbWFwRGVmYXVsdHMuYmVoYXZpb3IubGluZUNvbG9yLFxuICAgICAgICAgICAgICAgIHdlaWdodDogbWFwRGVmYXVsdHMuYmVoYXZpb3IubGluZVdlaWdodCxcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiBtYXBEZWZhdWx0cy5iZWhhdmlvci5saW5lT3BhY2l0eSxcbiAgICAgICAgICAgICAgICBsYXRsbmdzOiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnZhbHVlJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWRPck51bGwodm0udmFsdWUpKSB7XG5cbiAgICAgICAgICAgICAgICAvL3NldHVwIGZvciBuZXh0IG1hcCB1cGRhdGVcbiAgICAgICAgICAgICAgICBwZW5kaW5nU3RhdGVMb2NhdGlvbiA9IGV4dHJhY3RTdGF0ZUxvY2F0aW9uKHZtLnZhbHVlKTtcbiAgICAgICAgICAgICAgICBwZW5kaW5nUGF0aHMucHVzaChhbmd1bGFyLmNvcHkocGVuZGluZ1N0YXRlTG9jYXRpb24ubG9jYXRpb24pKTtcblxuICAgICAgICAgICAgICAgIC8vb24gaW5pdGFsIHN0YXRlIGNoYW5nZSwgdXBkYXRlIG1hcCBpbW1lZGlhdGVseVxuICAgICAgICAgICAgICAgIGlmICghbWFwSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTWFwKCk7XG4gICAgICAgICAgICAgICAgICAgIG1hcEluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRpbnRlcnZhbCh1cGRhdGVNYXAsIG1hcFVwZGF0ZUludGVydmFsKTtcblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVNYXAoKSB7XG5cbiAgICAgICAgICAgIGlmIChwZW5kaW5nU3RhdGVMb2NhdGlvbikge1xuXG4gICAgICAgICAgICAgICAgdm0uY2VudGVyID0gYW5ndWxhci5jb3B5KHBlbmRpbmdTdGF0ZUxvY2F0aW9uLmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgICAgIC8vc2V0IG1hcC56b29tIG9ubHkgaWYgdGhlcmUgaXMgb25seSBvbmUgcmVsZXZhbnQgcG9pbnQgb24gdGhlIG1hcFxuICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgbW9yZSB0aGVuIG9uZSBwb2ludCwgZml0IHRvIGJvdW5kIHdpbGwgYmUgYXBwbGllZC5cbiAgICAgICAgICAgICAgICBpZiAodm0ucGF0aHMubW92ZW1lbnQubGF0bG5ncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLnpvb20gPSBwZW5kaW5nU3RhdGVMb2NhdGlvbi56b29tO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMgPSBbZ2V0TWFya2VyKHBlbmRpbmdTdGF0ZUxvY2F0aW9uLmxvY2F0aW9uKV07XG5cbiAgICAgICAgICAgICAgICBpZiAobWFwRGVmYXVsdHMuYmVoYXZpb3IuZHJhd0xpbmVCZXR3ZWVuTG9jYXRpb25zKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHBlbmRpbmdQYXRocywgZnVuY3Rpb24ocCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucGF0aHMubW92ZW1lbnQubGF0bG5ncy5wdXNoKHApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvL2RvIGZpdCB0byBib3VuZHMgb25seSBpZiB0aGVyZSBpcyBtb3JlIHRoZSBvbmUgcG9pbnRcbiAgICAgICAgICAgICAgICAgICAgLy9pZiB0aGVyZSBvbmUgb3Igbm9uZSwgbGVhdmUgdGhlIGRlZmF1bHQgem9vbVxuICAgICAgICAgICAgICAgICAgICBpZiAodm0ucGF0aHMubW92ZW1lbnQubGF0bG5ncy5sZW5ndGggPiAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxlYWZsZXREYXRhLmdldE1hcCh2bS5pZCkudGhlbihmdW5jdGlvbihtYXApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5maXRCb3VuZHModm0ucGF0aHMubW92ZW1lbnQubGF0bG5ncyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHBlbmRpbmdTdGF0ZUxvY2F0aW9uID0gbnVsbDtcbiAgICAgICAgICAgICAgICBwZW5kaW5nUGF0aHMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGV4dHJhY3RTdGF0ZUxvY2F0aW9uKHN0YXRlKSB7XG5cbiAgICAgICAgICAgIGlmIChpc1VuZGVmaW5lZE9yTnVsbChzdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyAnU21hcnRsaXZpbmcgV2lkZ2V0cyAtIE1hcCBDb250cm9sIC0gSW52YWxpZCBsb2NhdGlvbic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzdGF0ZUxvY2F0aW9uID0ge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhdDogMCxcbiAgICAgICAgICAgICAgICAgICAgbG5nOiAwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB6b29tOiAxMVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShzdGF0ZSkpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5sZW5ndGggPT09IDIgJiYgYW5ndWxhci5pc051bWJlcihzdGF0ZVswXSkgJiYgYW5ndWxhci5pc051bWJlcihzdGF0ZVsxXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVMb2NhdGlvbi5sb2NhdGlvbi5sYXQgPSBzdGF0ZVswXTtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVMb2NhdGlvbi5sb2NhdGlvbi5sbmcgPSBzdGF0ZVsxXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlTG9jYXRpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc051bWJlcihzdGF0ZS5sYXQpICYmIGFuZ3VsYXIuaXNOdW1iZXIoc3RhdGUubG5nKSkge1xuICAgICAgICAgICAgICAgIHN0YXRlTG9jYXRpb24ubG9jYXRpb24ubGF0ID0gc3RhdGUubGF0O1xuICAgICAgICAgICAgICAgIHN0YXRlTG9jYXRpb24ubG9jYXRpb24ubG5nID0gc3RhdGUubG5nO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUxvY2F0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc051bWJlcihzdGF0ZS5sYXRpdHVkZSkgJiYgYW5ndWxhci5pc051bWJlcihzdGF0ZS5sb25naXR1ZGUpKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVMb2NhdGlvbi5sb2NhdGlvbi5sYXQgPSBzdGF0ZS5sYXRpdHVkZTtcbiAgICAgICAgICAgICAgICBzdGF0ZUxvY2F0aW9uLmxvY2F0aW9uLmxuZyA9IHN0YXRlLmxvbmdpdHVkZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVMb2NhdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNOdW1iZXIoc3RhdGUubGF0KSAmJiBhbmd1bGFyLmlzTnVtYmVyKHN0YXRlLmxvbmcpKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVMb2NhdGlvbi5sb2NhdGlvbi5sYXQgPSBzdGF0ZS5sYXQ7XG4gICAgICAgICAgICAgICAgc3RhdGVMb2NhdGlvbi5sb2NhdGlvbi5sbmcgPSBzdGF0ZS5sb25nO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUxvY2F0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aHJvdyAnU21hcnRsaXZpbmcgV2lkZ2V0cyAtIE1hcCBDb250cm9sIC0gSW52YWxpZCBsb2NhdGlvbic7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRNYXJrZXIobG9jYXRpb24pIHtcbiAgICAgICAgICAgIHZhciBtYXJrZXIgPSB7XG4gICAgICAgICAgICAgICAgbGF0OiBsb2NhdGlvbi5sYXQsXG4gICAgICAgICAgICAgICAgbG5nOiBsb2NhdGlvbi5sbmcsXG4gICAgICAgICAgICAgICAgaWNvbjoge1xuICAgICAgICAgICAgICAgICAgICBpY29uVXJsOiBtYXBEZWZhdWx0cy5pY29uLmltYWdlLFxuICAgICAgICAgICAgICAgICAgICBzaGFkb3dVcmw6IG1hcERlZmF1bHRzLmljb24uc2hhZG93SW1hZ2UsXG4gICAgICAgICAgICAgICAgICAgIGljb25TaXplOiBtYXBEZWZhdWx0cy5pY29uLmljb25TaXplLFxuICAgICAgICAgICAgICAgICAgICBzaGFkb3dTaXplOiBtYXBEZWZhdWx0cy5pY29uLnNoYWRvd1NpemUsXG4gICAgICAgICAgICAgICAgICAgIGljb25BbmNob3I6IG1hcERlZmF1bHRzLmljb24uaWNvbkFuY2hvcixcbiAgICAgICAgICAgICAgICAgICAgc2hhZG93QW5jaG9yOiBtYXBEZWZhdWx0cy5pY29uLnNoYWRvd0FuY2hvclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gbWFya2VyO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNVbmRlZmluZWRPck51bGwodikge1xuICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNVbmRlZmluZWQodikgfHwgdiA9PT0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnb25vZmZDb250cm9sJywgb25vZmZDb250cm9sKTtcblxuICAgIG9ub2ZmQ29udHJvbC4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBvbm9mZkNvbnRyb2woKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wtb25vZmY+PGRpdiBjbGFzcz1pbmRpY2F0b3IgbmctY2xhc3M9XFxcInsgb246IHR1cm5Pbn1cXFwiPjwvZGl2PjwvZGl2PicsXG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJz0nLFxuICAgICAgICAgICAgICAgIGlkOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICBzY29wZS50dXJuT24gPSBmYWxzZTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS5lbnVtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS52YWx1ZSA9PT0gc2NvcGUucHJvZmlsZS5lbnVtWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHVybk9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUudmFsdWUgPT09IHNjb3BlLnByb2ZpbGUuZW51bVswXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnR1cm5PbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ2ludGVnZXInIHx8IHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS52YWx1ZSAhPT0gMCAmJiBzY29wZS52YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50dXJuT24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50dXJuT24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5wcm9maWxlLnR5cGUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHVybk9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHVybk9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUucHJvZmlsZS50eXBlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsdWUgPT09ICcnIHx8IHNjb3BlLnZhbHVlID09PSB1bmRlZmluZWQgfHwgc2NvcGUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50dXJuT24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHVybk9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY29wZS5wcm9maWxlLnR5cGUgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0VtcHR5T2JqZWN0KHNjb3BlLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnR1cm5PbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS50dXJuT24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpc0VtcHR5T2JqZWN0KG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaikgPT09ICd7fSc7XG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIFB1c2hCdXR0b25TdGF0dXMgPSB7XG4gICAgICAgIHByb2ZpbGVWYWxpZDogMCxcbiAgICAgICAgcHJvZmlsZUludmFsaWQ6IDFcbiAgICB9O1xuXG4gICAgdmFyIFBVQkxJU0hfSU5URVJWQUxfVElNRU9VVCA9IDEwMDA7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgncHVzaEJ1dHRvbkNvbnRyb2wnLCBkaXJlY3RpdmUpO1xuXG4gICAgZnVuY3Rpb24gZGlyZWN0aXZlKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC1wdXNoLWJ1dHRvbiBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiAhdm0uZW5hYmxlZH1cXFwiPjxidXR0b24gbmctZGlzYWJsZWQ9IXZtLmVuYWJsZWQgbmctbW91c2Vkb3duPXZtLm9uUHJlc3MoKSBuZy10b3VjaHN0YXJ0PXZtLm9uUHJlc3MoKSBuZy1tb3VzZXVwPXZtLm9uUmVsZWFzZSgpIG5nLXRvdWNoZW5kPXZtLm9uUmVsZWFzZSgpPjwvYnV0dG9uPjwvZGl2PicsXG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nLFxuICAgICAgICAgICAgICAgIGFzc2V0OiAnPScsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6ICcmJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICB9XG5cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckdGltZW91dCcsICckaW50ZXJ2YWwnXTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJGludGVydmFsKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5zdGF0dXMgPSBQdXNoQnV0dG9uU3RhdHVzLnByb2ZpbGVWYWxpZDtcbiAgICAgICAgdm0ub25QcmVzcyA9IG9uUHJlc3M7XG4gICAgICAgIHZtLm9uUmVsZWFzZSA9IG9uUmVsZWFzZTtcblxuICAgICAgICB2YXIgcHVibGlzaEludGVydmFsID0gbnVsbDtcbiAgICAgICAgdmFyIHByZXNzVmFsdWUgPSB0cnVlO1xuICAgICAgICB2YXIgcmVsZWFzZVZhbHVlID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGJ1dHRvbkNvbmZpZ3VyYXRpb24gPSB7XG4gICAgICAgICAgICB0eXBlOiAncHVzaC10by1tYWtlJyxcbiAgICAgICAgICAgIGludGVydmFsOiBmYWxzZSxcbiAgICAgICAgICAgIGJyZWFrOiB0cnVlXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uYXNzZXQuY29udHJvbCcsIGNvbnRyb2xXYXRjaGVyLCB0cnVlKTtcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uYXNzZXQucHJvZmlsZScsIHByb2ZpbGVXYXRjaGVyKTtcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBvbkRlc3Ryb3kpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHByb2ZpbGVXYXRjaGVyKHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZVByb2ZpbGUocHJvZmlsZSkpIHtcblxuICAgICAgICAgICAgICAgIHZtLnN0YXR1cyA9IFB1c2hCdXR0b25TdGF0dXMucHJvZmlsZUludmFsaWQ7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uZmlndXJlUHJlc3NBbmRSZWxlYXNlVmFsdWVzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb250cm9sV2F0Y2hlcihjb250cm9sU2V0dGluZ3MpIHtcblxuICAgICAgICAgICAgaWYgKGNvbnRyb2xTZXR0aW5ncyAmJiBjb250cm9sU2V0dGluZ3MuZXh0cmFzKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbFNldHRpbmdzLmV4dHJhcy50eXBlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ29uZmlndXJhdGlvbi50eXBlID0gY29udHJvbFNldHRpbmdzLmV4dHJhcy50eXBlO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xTZXR0aW5ncy5leHRyYXMuYmVoYXZpb3IgPT09ICdjb250aW51b3VzJyB8fCBjb250cm9sU2V0dGluZ3MuZXh0cmFzLmJlaGF2aW9yID09PSAnY29udGludW91cy1icmVhaycpIHtcblxuICAgICAgICAgICAgICAgICAgICBidXR0b25Db25maWd1cmF0aW9uLmludGVydmFsID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjb250cm9sU2V0dGluZ3MuZXh0cmFzLmJlaGF2aW9yID09PSAnY29udGludW91cycpIHtcblxuICAgICAgICAgICAgICAgICAgICBidXR0b25Db25maWd1cmF0aW9uLmJyZWFrID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25maWd1cmVQcmVzc0FuZFJlbGVhc2VWYWx1ZXMoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlUHJlc3NBbmRSZWxlYXNlVmFsdWVzKCkge1xuXG4gICAgICAgICAgICBpZiAodm0ucHJvZmlsZS5lbnVtKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uQ29uZmlndXJhdGlvbi50eXBlID09PSAncHVzaC10by1tYWtlJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHByZXNzVmFsdWUgPSB2bS5wcm9maWxlLmVudW1bMF07XG5cbiAgICAgICAgICAgICAgICAgICAgcmVsZWFzZVZhbHVlID0gdm0ucHJvZmlsZS5lbnVtWzFdO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBwcmVzc1ZhbHVlID0gdm0ucHJvZmlsZS5lbnVtWzFdO1xuXG4gICAgICAgICAgICAgICAgICAgIHJlbGVhc2VWYWx1ZSA9IHZtLnByb2ZpbGUuZW51bVswXTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vaWYgcHJvZmlsZS5lbnVtIGlzIGNvbmZpZ3VyZWQsIHRoZW4gdGhlcmUgaXMgbm8gc2Vuc2UgdG8gY2hlY2sgaWYgXG4gICAgICAgICAgICAgICAgLy9wcm9maWxlLnR5cGUgaXMgYm9vbGVhbiBvciB3aGF0ZXZlciBiZWNhdXNlIGZpcnN0IHZhbHVlIHdpbGwgYWx3YXlzIGJlIHVzZWRcbiAgICAgICAgICAgICAgICAvL3RvIGFjdHVhdGUgb25QdXNoIGFuZCBvblJlbGVhc2Ugd2lsbCBiZSB1c2VkIHRvIGFjdHVhdGUgb25SZWxlYXNlXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh2bS5wcm9maWxlLnR5cGUgPT09ICdib29sZWFuJykge1xuXG4gICAgICAgICAgICAgICAgaWYgKGJ1dHRvbkNvbmZpZ3VyYXRpb24udHlwZSA9PT0gJ3B1c2gtdG8tbWFrZScpIHtcblxuICAgICAgICAgICAgICAgICAgICBwcmVzc1ZhbHVlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICByZWxlYXNlVmFsdWUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcHJlc3NWYWx1ZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgIHJlbGVhc2VWYWx1ZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVQcm9maWxlKHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUudHlwZSA9PT0gJ2Jvb2xlYW4nKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocHJvZmlsZS5lbnVtICYmIHByb2ZpbGUuZW51bS5sZW5ndGggPT09IDIpIHtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb25QcmVzcygpIHtcblxuICAgICAgICAgICAgaWYgKGJ1dHRvbkNvbmZpZ3VyYXRpb24uaW50ZXJ2YWwpIHtcblxuICAgICAgICAgICAgICAgIGlmIChwdWJsaXNoSW50ZXJ2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHB1Ymxpc2hJbnRlcnZhbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaEludGVydmFsID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHB1Ymxpc2gocHJlc3NWYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICBwdWJsaXNoSW50ZXJ2YWwgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaChwcmVzc1ZhbHVlKTtcblxuICAgICAgICAgICAgICAgIH0sIFBVQkxJU0hfSU5URVJWQUxfVElNRU9VVCk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBwdWJsaXNoKHByZXNzVmFsdWUpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9uUmVsZWFzZSgpIHtcblxuICAgICAgICAgICAgaWYgKHB1Ymxpc2hJbnRlcnZhbCkge1xuXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChwdWJsaXNoSW50ZXJ2YWwpO1xuXG4gICAgICAgICAgICAgICAgcHVibGlzaEludGVydmFsID0gbnVsbDtcblxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmIChidXR0b25Db25maWd1cmF0aW9uLmJyZWFrKSB7XG5cbiAgICAgICAgICAgICAgICAvL21ha2UgYSBzaG9ydCBkZWxheSBiZWZvcmUgcHVibGlzaGluZyByZWxlYXNlIHRvIG1ha2Ugc3VyZVxuICAgICAgICAgICAgICAgIC8vcHJlc3MgZXZlbnQgaGFzIHJlYWNoZWQgc2VydmVyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaChyZWxlYXNlVmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgfSwgMTApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2goY29tbWFuZFZhbHVlKSB7XG5cbiAgICAgICAgICAgIGlmICh2bS5vbkNoYW5nZSkge1xuXG4gICAgICAgICAgICAgICAgdm0ub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB2YWw6IGNvbW1hbmRWYWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9uRGVzdHJveSgpIHtcblxuICAgICAgICAgICAgaWYgKHB1Ymxpc2hJbnRlcnZhbCkge1xuXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChwdWJsaXNoSW50ZXJ2YWwpO1xuXG4gICAgICAgICAgICAgICAgcHVibGlzaEludGVydmFsID0gbnVsbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cblxufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCduZ1NtYXJ0bGl2aW5nV2lkZ2V0cycpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NsaWRlckNvbnRyb2wnLCBzbGlkZXJDb250cm9sKTtcblxuICAgIHNsaWRlckNvbnRyb2wuJGluamVjdCA9IFsnJGludGVydmFsJywgJ2NvbmZpZyddO1xuXG4gICAgZnVuY3Rpb24gc2xpZGVyQ29udHJvbCgkaW50ZXJ2YWwsIGNvbmZpZykge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPWNvbnRyb2wtc2xpZGVyIG5nLXNob3c9IWJsb2NrZWQgbmctY2xhc3M9XFxcIntkaXNhYmxlZDogIWVuYWJsZWR9XFxcIj48YXJ0aWNsZSBjbGFzcz1zbGlkZXItdmFsPjxzcGFuIGNsYXNzPXNsaWRlci12YWx1ZT57e3ZhbHVlfX08L3NwYW4+IDxzcGFuIGNsYXNzPXNsaWRlci11bml0Pnt7cHJvZmlsZS51bml0fX08L3NwYW4+PC9hcnRpY2xlPjxkaXY+PG1kLXNsaWRlciBuZy1pZj1zbGlkZXJTZXR0aW5nc0FyZVJlYWR5IG5nLWRpc2FibGVkPSFlbmFibGVkIGFyaWEtbGFiZWw9c2xpZGVyIG5nLW1vZGVsPXNsaWRlci52YWx1ZSBtaW49XFxcInt7IHNsaWRlclNldHRpbmdzLm1pbmltdW0gfX1cXFwiIG1heD1cXFwie3sgc2xpZGVyU2V0dGluZ3MubWF4aW11bSB9fVxcXCIgc3RlcD0xPjwvbWQtc2xpZGVyPjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9Y29udHJvbC1mYWxsYmFjayBuZy1zaG93PWJsb2NrZWQ+PGRpdiBjbGFzcz12YWx1ZS11bml0PjxzcGFuIGNsYXNzPXZhbHVlPnt7dmFsdWV9fTwvc3Bhbj4gPHNwYW4gY2xhc3M9dW5pdD57e3Byb2ZpbGUudW5pdH19PC9zcGFuPjwvZGl2PjxwPnt7bWVzc2FnZX19PC9wPjwvZGl2PicsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGVuYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJz0nLFxuICAgICAgICAgICAgICAgIHByb2ZpbGU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgdmFyIGFzc2V0VmFsdWVPdXRPZkJvdW5kc01lc3NhZ2UgPSBjb25maWcub3V0T2ZCb3VuZHNNZXNzYWdlLmZvcm1hdCgnU2xpZGVyJyk7XG5cbiAgICAgICAgICAgIHZhciBpbnZhbGlkTWluTWF4Q29uZmlndXJhdGlvbk1lc3NhZ2UgPSBjb25maWcuaW52YWxpZEJvdW5kc01lc3NhZ2U7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZVRvUHVibGlzaCA9IG51bGw7XG5cbiAgICAgICAgICAgIHZhciBwdWJsaXNoSW50ZXJ2YWwgPSBudWxsO1xuXG4gICAgICAgICAgICBzY29wZS5ibG9ja2VkID0gbnVsbDtcblxuICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IG51bGw7XG5cbiAgICAgICAgICAgIHNjb3BlLnNsaWRlciA9IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2xpZGVyU2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgbWluaW11bTogY29uZmlnLmRlZmF1bHRNaW5pbXVtLFxuICAgICAgICAgICAgICAgIG1heGltdW06IGNvbmZpZy5kZWZhdWx0TWF4aW11bVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy9IYWNrIGJlY2F1c2Ugb2YgdGhlIHByb2JsZW0gd2l0aCBuZ01hdGVyaWFsIHNsaWRlclxuICAgICAgICAgICAgc2NvcGUuc2xpZGVyU2V0dGluZ3NBcmVSZWFkeSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBwdWJsaXNoSW50ZXJ2YWwgPSAkaW50ZXJ2YWwocHVibGlzaEludGVydmFsSGFuZGxlciwgMTAwMCk7XG4gICAgICAgICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZGVzdHJveUhhbmRsZXIpO1xuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIHZhbHVlV2F0Y2hlcik7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3NsaWRlci52YWx1ZScsIHNsaWRlclZhbHVlV2F0Y2hlcik7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Byb2ZpbGUnLCBwcm9maWxlV2F0Y2hlcik7XG5cbiAgICAgICAgICAgIC8vSGFjayBiZWNhdXNlIG9mIHRoZSBwcm9ibGVtIHdpdGggbmdNYXRlcmlhbCBzbGlkZXJcbiAgICAgICAgICAgIHNjb3BlLnNsaWRlclNldHRpbmdzQXJlUmVhZHkgPSB0cnVlO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBwdWJsaXNoSW50ZXJ2YWxIYW5kbGVyKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlVG9QdWJsaXNoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcHVibGlzaFZhbHVlKHZhbHVlVG9QdWJsaXNoKTtcblxuICAgICAgICAgICAgICAgICAgICB2YWx1ZVRvUHVibGlzaCA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lIYW5kbGVyKCkge1xuXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChwdWJsaXNoSW50ZXJ2YWwpO1xuXG4gICAgICAgICAgICAgICAgcHVibGlzaEludGVydmFsID0gbnVsbDtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB2YWx1ZVdhdGNoZXIobmV3VmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS52YWx1ZSA+IHNjb3BlLnNsaWRlclNldHRpbmdzLm1heGltdW0gfHwgc2NvcGUudmFsdWUgPCBzY29wZS5zbGlkZXJTZXR0aW5ncy5taW5pbXVtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IGFzc2V0VmFsdWVPdXRPZkJvdW5kc01lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNsaWRlci52YWx1ZSA9IG5ld1ZhbHVlO1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2xpZGVyVmFsdWVXYXRjaGVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgLy9TZXR1cCB2YWx1ZSB0byBwdWJsaXNoIG9ubHkgaWYgc2xpZGVyLnZhbHVlIGlzIGRpZmZlcmVudCB0aGVuIGN1cnJlbnQgdmFsdWVcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuc2xpZGVyLnZhbHVlICE9PSBzY29wZS52YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlVG9QdWJsaXNoID0gbmV3VmFsdWU7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByb2ZpbGVXYXRjaGVyKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc051bWJlcihzY29wZS5wcm9maWxlLm1pbmltdW0pICYmIGFuZ3VsYXIuaXNOdW1iZXIoc2NvcGUucHJvZmlsZS5tYXhpbXVtKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zbGlkZXJTZXR0aW5ncy5taW5pbXVtID0gc2NvcGUucHJvZmlsZS5taW5pbXVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2xpZGVyU2V0dGluZ3MubWF4aW11bSA9IHNjb3BlLnByb2ZpbGUubWF4aW11bTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zbGlkZXJTZXR0aW5ncy5taW5pbXVtID0gY29uZmlnLmRlZmF1bHRNaW5pbXVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2xpZGVyU2V0dGluZ3MubWF4aW11bSA9IGNvbmZpZy5kZWZhdWx0TWF4aW11bTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnNsaWRlclNldHRpbmdzLm1pbmltdW0gPiBzY29wZS5zbGlkZXJTZXR0aW5ncy5tYXhpbXVtKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IGludmFsaWRNaW5NYXhDb25maWd1cmF0aW9uTWVzc2FnZTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjb3BlLnNsaWRlclNldHRpbmdzLm1pbmltdW0gPiBzY29wZS52YWx1ZSB8fCBzY29wZS5zbGlkZXJTZXR0aW5ncy5tYXhpbXVtIDwgc2NvcGUudmFsdWUpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYmxvY2tlZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBhc3NldFZhbHVlT3V0T2ZCb3VuZHNNZXNzYWdlO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmJsb2NrZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwdWJsaXNoVmFsdWUodmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5vbkNoYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5vbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWw6IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnc3Bpbm5lckNvbnRyb2wnLCBkaXJlY3RpdmUpO1xuXG4gICAgZnVuY3Rpb24gZGlyZWN0aXZlKCkge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC1zcGlubmVyIG5nLWNsYXNzPVxcXCJ7ZGlzYWJsZWQ6ICF2bS5zcGluZXJTdGF0dXMuZW5hYmxlZH1cXFwiPjxkaXYgbmctaWY9IXNJbnQodm0uc3RlcCk+PGJ1dHRvbiBjbGFzcz1cXFwic3Bpbm5lci1idG4gcGx1c1xcXCIgbmctY2xpY2s9dm0uaW5jcmVhc2UoKSBuZy1kaXNhYmxlZD0hdm0uc3BpbmVyU3RhdHVzLmVuYWJsZWQgYW5ndWxhci1yaXBwbGU+PC9idXR0b24+PHAgY2xhc3M9c3Bpbm5lci12YWx1ZT57eyB2bS5hc3NldC5zdGF0ZS52YWx1ZSB9fTwvcD48YnV0dG9uIGNsYXNzPVxcXCJzcGlubmVyLWJ0biBtaW51c1xcXCIgbmctY2xpY2s9dm0uZGVjcmVhc2UoKSBuZy1kaXNhYmxlZD0hdm0uc3BpbmVyU3RhdHVzLmVuYWJsZWQgYW5ndWxhci1yaXBwbGU+PC9idXR0b24+PC9kaXY+PGRpdiBjbGFzcz1jb250cm9sLWZhbGxiYWNrIG5nLWlmPWlzSW50KHZtLnN0ZXApPjxkaXYgY2xhc3M9dmFsdWUtdW5pdD48aDE+PGI+TWlzbWF0Y2ghPC9iPjwvaDE+PC9kaXY+PHA+e3sgdm0uc3BpbmVyU3RhdHVzLm1lc3NhZ2V9fTwvcD48L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBhc3NldDogJz0nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgfVxuXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnXTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlKSB7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5pbmNyZWFzZSA9IGluY3JlYXNlO1xuICAgICAgICB2bS5kZWNyZWFzZSA9IGRlY3JlYXNlO1xuXG4gICAgICAgIHZtLnNwaW5lclN0YXR1cyA9IHtcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBtZXNzYWdlOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc3RlcCA9IG51bGw7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uYXNzZXQuY29udHJvbCcsIGNvbnRyb2xXYXRjaGVyLCB0cnVlKTtcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uYXNzZXQucHJvZmlsZScsIHByb2ZpbGVXYXRjaGVyKTtcblxuICAgICAgICBmdW5jdGlvbiBwcm9maWxlV2F0Y2hlcihwcm9maWxlKSB7XG5cbiAgICAgICAgICAgIGNvbXBhcmVTdGVwV2l0aFByb2ZpbGUocHJvZmlsZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xXYXRjaGVyKGNvbnRyb2xTZXR0aW5ncykge1xuXG4gICAgICAgICAgICBpZiAoY29udHJvbFNldHRpbmdzICYmIGNvbnRyb2xTZXR0aW5ncy5leHRyYXMpIHtcblxuICAgICAgICAgICAgICAgIGlmIChjb250cm9sU2V0dGluZ3MuZXh0cmFzLnN0ZXApIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS5zdGVwID0gY29udHJvbFNldHRpbmdzLmV4dHJhcy5zdGVwO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmVTdGVwV2l0aFByb2ZpbGUodm0uYXNzZXQucHJvZmlsZSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodm0ucHJvZmlsZS50eXBlID09PSAnbnVtYmVyJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0ZXAgPSAwLjE7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZtLnByb2ZpbGUudHlwZSA9PT0gJ2ludGVnZXInKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uc3RlcCA9IDE7XG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb21wYXJlU3RlcFdpdGhQcm9maWxlKHByb2ZpbGUpIHtcblxuICAgICAgICAgICAgaWYgKHByb2ZpbGUudHlwZSA9PT0gJ2ludGVnZXInKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNJbnQodm0uc3RlcCkpIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS5zcGluZXJTdGF0dXMuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNwaW5lclN0YXR1cy5tZXNzYWdlID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uc3BpbmVyU3RhdHVzLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3BpbmVyU3RhdHVzLm1lc3NhZ2UgPSAnU3RlcCBkb2VzIG5vdCBtYXRjaCBhc3NldCBwcm9maWxlIHR5cGUuJztcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9maWxlLnR5cGUgPT09ICdudW1iZXInKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKHZtLnN0ZXApID09PSAnbnVtYmVyJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnNwaW5lclN0YXR1cy5lbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3BpbmVyU3RhdHVzLm1lc3NhZ2UgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICB2bS5zcGluZXJTdGF0dXMuZW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB2bS5zcGluZXJTdGF0dXMubWVzc2FnZSA9ICdTdGVwIGRvZXMgbm90IG1hdGNoIGFzc2V0IHByb2ZpbGUgdHlwZS4nO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgdm0uc3BpbmVyU3RhdHVzLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5zcGluZXJTdGF0dXMubWVzc2FnZSA9ICdBc3NldCBwcm9maWxlIHNob3VsZCBiZSBpbnRlZ2VyIG9yIG51bWJlcic7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGlzSW50KHZhbHVlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAhaXNOYU4odmFsdWUpICYmIHBhcnNlSW50KE51bWJlcih2YWx1ZSkpID09IHZhbHVlICYmICFpc05hTihwYXJzZUludCh2YWx1ZSwgMTApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluY3JlYXNlKCkge1xuXG4gICAgICAgICAgICB2YXIgdmFsdWVUb1NlbmQgPSBudWxsO1xuXG4gICAgICAgICAgICBpZiAodm0uYXNzZXQuc3RhdGUgJiYgdm0uYXNzZXQuc3RhdGUudmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIHZhbHVlVG9TZW5kID0gcHJlcGFyZVZhbHVlKHZtLmFzc2V0LnN0YXRlLnZhbHVlKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZhbHVlVG9TZW5kID0gcHJlcGFyZVZhbHVlKG51bGwpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhbHVlVG9TZW5kICs9IHZtLnN0ZXA7XG5cbiAgICAgICAgICAgIHB1Ymxpc2godmFsdWVUb1NlbmQpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZWNyZWFzZSgpIHtcblxuICAgICAgICAgICAgdmFyIHZhbHVlVG9TZW5kID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKHZtLmFzc2V0LnN0YXRlICYmIHZtLmFzc2V0LnN0YXRlLnZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICB2YWx1ZVRvU2VuZCA9IHByZXBhcmVWYWx1ZSh2bS5hc3NldC5zdGF0ZS52YWx1ZSk7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICB2YWx1ZVRvU2VuZCA9IHByZXBhcmVWYWx1ZShudWxsKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YWx1ZVRvU2VuZCAtPSB2bS5zdGVwO1xuXG4gICAgICAgICAgICBwdWJsaXNoKHZhbHVlVG9TZW5kKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcHJlcGFyZVZhbHVlKHZhbHVlKSB7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZVRvU2VuZCA9IHZhbHVlO1xuXG4gICAgICAgICAgICBpZiAodmFsdWVUb1NlbmQgPT09IG51bGwgfHwgdmFsdWVUb1NlbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhbHVlVG9TZW5kID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLmFzc2V0LnByb2ZpbGUudHlwZSA9PT0gJ2ludGVnZXInICYmIHR5cGVvZih2YWx1ZVRvU2VuZCkgPT09ICdudW1iZXInKSB7XG5cbiAgICAgICAgICAgICAgICB2YWx1ZVRvU2VuZCA9IH5+dmFsdWVUb1NlbmQ7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlVG9TZW5kO1xuXG4gICAgICAgIH1cblxuXG4gICAgICAgIGZ1bmN0aW9uIHB1Ymxpc2goY29tbWFuZFZhbHVlKSB7XG5cbiAgICAgICAgICAgIGlmICh2bS5vbkNoYW5nZSkge1xuXG4gICAgICAgICAgICAgICAgdm0ub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB2YWw6IGNvbW1hbmRWYWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG5cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbmdTbWFydGxpdmluZ1dpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCd0ZXh0Q29udHJvbCcsIHRleHRDb250cm9sKTtcblxuICAgIHRleHRDb250cm9sLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIHRleHRDb250cm9sKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1jb250cm9sLXRleHQ+PGRpdiBjbGFzcz10ZXh0LWNvbnRlbnQ+e3t2YWx1ZX19IDxzcGFuIGNsYXNzPWVtcHR5IG5nLWlmPVxcXCJ2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsXFxcIj48aT5ubyB2YWx1ZSB0byBkaXNwbGF5PC9pPjwvc3Bhbj48L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgndGV4dEVkaXRvckNvbnRyb2wnLCB0ZXh0RWRpdG9yQ29udHJvbCk7XG5cbiAgICB0ZXh0RWRpdG9yQ29udHJvbC4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiB0ZXh0RWRpdG9yQ29udHJvbCgpIHtcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9Y29udHJvbC10ZXh0LWVkaXRvciBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiAhZW5hYmxlZH1cXFwiPjx0ZXh0YXJlYSBuZy1tb2RlbD10ZXh0VmFsdWUgbmctZGlzYWJsZWQ9IWVuYWJsZWQgcGxhY2Vob2xkZXI9XFxcImVudGVyIHRleHRcXFwiPjwvdGV4dGFyZWE+IDxidXR0b24gY2xhc3M9dGV4dC1lZGl0b3ItY29udHJvbC1idG4gbmctY2xpY2s9c2VuZFRleHQodGV4dFZhbHVlKSBuZy1kaXNhYmxlZD0hZW5hYmxlZD48L2J1dHRvbj48L2Rpdj4nLFxuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBpczogJz0nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAnJidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtlcihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUudGV4dFZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2NvcGUuc2VuZFRleHQgPSBmdW5jdGlvbih2YWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUob2JqZWN0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwdWJsaXNoVmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcHVibGlzaFZhbHVlKHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUub25DaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgndG9nZ2xlQ29udHJvbCcsIHRvZ2dsZUNvbnRyb2wpO1xuXG4gICAgdG9nZ2xlQ29udHJvbC4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiB0b2dnbGVDb250cm9sKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1jb250cm9sLXRvZ2dsZSBuZy1jbGFzcz1cXFwie2Rpc2FibGVkOiAhZW5hYmxlZH1cXFwiPjxzcGFuIGNsYXNzPWxlZnQtdmFsdWU+e3tsZWZ0VmFsdWV9fTwvc3Bhbj48bWQtc3dpdGNoIGFyaWEtbGFiZWw9dG9nZ2xlX2NvbnRyb2wgbmctbW9kZWw9dG9nZ2xlIG5nLWNsaWNrPW9uQ2xpY2soKSBuZy1kaXNhYmxlZD0hZW5hYmxlZD48L21kLXN3aXRjaD48c3BhbiBjbGFzcz1yaWdodC12YWx1ZT57e3JpZ2h0VmFsdWV9fTwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiAnPScsXG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogJyYnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua2VyXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgc2NvcGUubGVmdFZhbHVlID0gZmFsc2U7XG4gICAgICAgICAgICBzY29wZS5yaWdodFZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICAgIHNjb3BlLnRvZ2dsZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Byb2ZpbGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUucHJvZmlsZS5lbnVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sZWZ0VmFsdWUgPSBzY29wZS5wcm9maWxlLmVudW1bMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yaWdodFZhbHVlID0gc2NvcGUucHJvZmlsZS5lbnVtWzFdO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sZWZ0VmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yaWdodFZhbHVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnByb2ZpbGUudHlwZSA9PSAnaW50ZWdlcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5sZWZ0VmFsdWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJpZ2h0VmFsdWUgPSBzY29wZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3ZhbHVlJywgZnVuY3Rpb24obmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUudmFsdWUgPT0gc2NvcGUucmlnaHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS50b2dnbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUudmFsdWUgPT0gc2NvcGUubGVmdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnRvZ2dsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRvZ2dsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaFZhbHVlKHNjb3BlLmxlZnRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUudG9nZ2xlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlzaFZhbHVlKHNjb3BlLnJpZ2h0VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gcHVibGlzaFZhbHVlKHZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUub25DaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsOiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnb250YWJsZUNvbnRyb2wnLCBvbnRhYmxlQ29udHJvbCk7XG5cbiAgICBvbnRhYmxlQ29udHJvbC4kaW5qZWN0ID0gWyckaW50ZXJ2YWwnLCAnY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBvbnRhYmxlQ29udHJvbCgkaW50ZXJ2YWwsIGNvbmZpZykge1xuXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBsaW5rOiBsaW5rZXIsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPXNsLWNvbnRyb2wtb250YWJsZT48ZGl2IGNsYXNzPWluZGljYXRvciBuZy1jbGFzcz1cXFwieyBvbnRhYmxlOiBvbnRhYmxlID09PSB0cnVlIH1cXFwiPjxzcGFuIGNsYXNzPXBob25lPjwvc3Bhbj4gPHNwYW4gY2xhc3M9c2hhZG93Pjwvc3Bhbj48L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLm9udGFibGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09ICdvbnRhYmxlJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm9udGFibGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWx1ZSA9PT0gJ25vdG9udGFibGUnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub250YWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KCkpO1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgncm90YXRlQ29udHJvbCcsIHJvdGF0ZUNvbnRyb2wpO1xuXG4gICAgcm90YXRlQ29udHJvbC4kaW5qZWN0ID0gWyckaW50ZXJ2YWwnLCAnY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiByb3RhdGVDb250cm9sKCRpbnRlcnZhbCwgY29uZmlnKSB7XG5cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGxpbms6IGxpbmtlcixcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9c2wtY29udHJvbC1yb3RhdGlvbj48ZGl2IGNsYXNzPWluZGljYXRvciBuZy1jbGFzcz1cXFwieyBsZWZ0OiByb3RhdGVMZWZ0ID09PSB0cnVlLCByaWdodDogcm90YXRlTGVmdCA9PT0gZmFsc2UgfVxcXCI+PC9kaXY+PC9kaXY+JyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcHJvZmlsZTogJz0nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAnPScsXG4gICAgICAgICAgICAgICAgaWQ6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua2VyKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICBzY29wZS5yb3RhdGVMZWZ0ID0gbnVsbDtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09ICdyaWdodFJvdGF0aW9uJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnJvdGF0ZUxlZnQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUgPT09ICdsZWZ0Um90YXRpb24nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUucm90YXRlTGVmdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0oKSk7XG4oZnVuY3Rpb24oKSB7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25nU21hcnRsaXZpbmdXaWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnc2hha2VDb250cm9sJywgc2hha2VDb250cm9sKTtcblxuICAgIHNoYWtlQ29udHJvbC4kaW5qZWN0ID0gWyckaW50ZXJ2YWwnLCAnY29uZmlnJ107XG5cbiAgICBmdW5jdGlvbiBzaGFrZUNvbnRyb2woJGludGVydmFsLCBjb25maWcpIHtcblxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgbGluazogbGlua2VyLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1zbC1jb250cm9sLXNoYWtlPjxkaXYgY2xhc3M9aW5kaWNhdG9yIG5nLWNsYXNzPVxcXCJ7IHNoYWtpbmc6IHNoYWtpbmcgPT09IHRydWV9XFxcIj48L2Rpdj48L2Rpdj4nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBwcm9maWxlOiAnPScsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICc9JyxcbiAgICAgICAgICAgICAgICBpZDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBsaW5rZXIoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNoYWtpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd2YWx1ZScsIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09ICdzaGFraW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNoYWtpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWx1ZSA9PT0gJ3N0aWxsJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNoYWtpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSgpKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
